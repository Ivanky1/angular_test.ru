/*! jQuery v1.9.1 | (c) 2005, 2012 jQuery Foundation, Inc. | jquery.org/license
 //@ sourceMappingURL=jquery.min.map
 */
(function (e, t) {
    var n, r, i = typeof t, o = e.document, a = e.location, s = e.jQuery, u = e.$, l = {}, c = [], p = "1.9.1", f = c.concat, d = c.push, h = c.slice, g = c.indexOf, m = l.toString, y = l.hasOwnProperty, v = p.trim, b = function (e, t) {
        return new b.fn.init(e, t, r)
    }, x = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source, w = /\S+/g, T = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, N = /^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/, C = /^<(\w+)\s*\/?>(?:<\/\1>|)$/, k = /^[\],:{}\s]*$/, E = /(?:^|:|,)(?:\s*\[)+/g, S = /\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g, A = /"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g, j = /^-ms-/, D = /-([\da-z])/gi, L = function (e, t) {
        return t.toUpperCase()
    }, H = function (e) {
        (o.addEventListener || "load" === e.type || "complete" === o.readyState) && (q(), b.ready())
    }, q = function () {
        o.addEventListener ? (o.removeEventListener("DOMContentLoaded", H, !1), e.removeEventListener("load", H, !1)) : (o.detachEvent("onreadystatechange", H), e.detachEvent("onload", H))
    };
    b.fn = b.prototype = {jquery: p, constructor: b, init: function (e, n, r) {
        var i, a;
        if (!e)return this;
        if ("string" == typeof e) {
            if (i = "<" === e.charAt(0) && ">" === e.charAt(e.length - 1) && e.length >= 3 ? [null, e, null] : N.exec(e), !i || !i[1] && n)return!n || n.jquery ? (n || r).find(e) : this.constructor(n).find(e);
            if (i[1]) {
                if (n = n instanceof b ? n[0] : n, b.merge(this, b.parseHTML(i[1], n && n.nodeType ? n.ownerDocument || n : o, !0)), C.test(i[1]) && b.isPlainObject(n))for (i in n)b.isFunction(this[i]) ? this[i](n[i]) : this.attr(i, n[i]);
                return this
            }
            if (a = o.getElementById(i[2]), a && a.parentNode) {
                if (a.id !== i[2])return r.find(e);
                this.length = 1, this[0] = a
            }
            return this.context = o, this.selector = e, this
        }
        return e.nodeType ? (this.context = this[0] = e, this.length = 1, this) : b.isFunction(e) ? r.ready(e) : (e.selector !== t && (this.selector = e.selector, this.context = e.context), b.makeArray(e, this))
    }, selector: "", length: 0, size: function () {
        return this.length
    }, toArray: function () {
        return h.call(this)
    }, get: function (e) {
        return null == e ? this.toArray() : 0 > e ? this[this.length + e] : this[e]
    }, pushStack: function (e) {
        var t = b.merge(this.constructor(), e);
        return t.prevObject = this, t.context = this.context, t
    }, each: function (e, t) {
        return b.each(this, e, t)
    }, ready: function (e) {
        return b.ready.promise().done(e), this
    }, slice: function () {
        return this.pushStack(h.apply(this, arguments))
    }, first: function () {
        return this.eq(0)
    }, last: function () {
        return this.eq(-1)
    }, eq: function (e) {
        var t = this.length, n = +e + (0 > e ? t : 0);
        return this.pushStack(n >= 0 && t > n ? [this[n]] : [])
    }, map: function (e) {
        return this.pushStack(b.map(this, function (t, n) {
            return e.call(t, n, t)
        }))
    }, end: function () {
        return this.prevObject || this.constructor(null)
    }, push: d, sort: [].sort, splice: [].splice}, b.fn.init.prototype = b.fn, b.extend = b.fn.extend = function () {
        var e, n, r, i, o, a, s = arguments[0] || {}, u = 1, l = arguments.length, c = !1;
        for ("boolean" == typeof s && (c = s, s = arguments[1] || {}, u = 2), "object" == typeof s || b.isFunction(s) || (s = {}), l === u && (s = this, --u); l > u; u++)if (null != (o = arguments[u]))for (i in o)e = s[i], r = o[i], s !== r && (c && r && (b.isPlainObject(r) || (n = b.isArray(r))) ? (n ? (n = !1, a = e && b.isArray(e) ? e : []) : a = e && b.isPlainObject(e) ? e : {}, s[i] = b.extend(c, a, r)) : r !== t && (s[i] = r));
        return s
    }, b.extend({noConflict: function (t) {
        return e.$ === b && (e.$ = u), t && e.jQuery === b && (e.jQuery = s), b
    }, isReady: !1, readyWait: 1, holdReady: function (e) {
        e ? b.readyWait++ : b.ready(!0)
    }, ready: function (e) {
        if (e === !0 ? !--b.readyWait : !b.isReady) {
            if (!o.body)return setTimeout(b.ready);
            b.isReady = !0, e !== !0 && --b.readyWait > 0 || (n.resolveWith(o, [b]), b.fn.trigger && b(o).trigger("ready").off("ready"))
        }
    }, isFunction: function (e) {
        return"function" === b.type(e)
    }, isArray: Array.isArray || function (e) {
        return"array" === b.type(e)
    }, isWindow: function (e) {
        return null != e && e == e.window
    }, isNumeric: function (e) {
        return!isNaN(parseFloat(e)) && isFinite(e)
    }, type: function (e) {
        return null == e ? e + "" : "object" == typeof e || "function" == typeof e ? l[m.call(e)] || "object" : typeof e
    }, isPlainObject: function (e) {
        if (!e || "object" !== b.type(e) || e.nodeType || b.isWindow(e))return!1;
        try {
            if (e.constructor && !y.call(e, "constructor") && !y.call(e.constructor.prototype, "isPrototypeOf"))return!1
        } catch (n) {
            return!1
        }
        var r;
        for (r in e);
        return r === t || y.call(e, r)
    }, isEmptyObject: function (e) {
        var t;
        for (t in e)return!1;
        return!0
    }, error: function (e) {
        throw Error(e)
    }, parseHTML: function (e, t, n) {
        if (!e || "string" != typeof e)return null;
        "boolean" == typeof t && (n = t, t = !1), t = t || o;
        var r = C.exec(e), i = !n && [];
        return r ? [t.createElement(r[1])] : (r = b.buildFragment([e], t, i), i && b(i).remove(), b.merge([], r.childNodes))
    }, parseJSON: function (n) {
        return e.JSON && e.JSON.parse ? e.JSON.parse(n) : null === n ? n : "string" == typeof n && (n = b.trim(n), n && k.test(n.replace(S, "@").replace(A, "]").replace(E, ""))) ? Function("return " + n)() : (b.error("Invalid JSON: " + n), t)
    }, parseXML: function (n) {
        var r, i;
        if (!n || "string" != typeof n)return null;
        try {
            e.DOMParser ? (i = new DOMParser, r = i.parseFromString(n, "text/xml")) : (r = new ActiveXObject("Microsoft.XMLDOM"), r.async = "false", r.loadXML(n))
        } catch (o) {
            r = t
        }
        return r && r.documentElement && !r.getElementsByTagName("parsererror").length || b.error("Invalid XML: " + n), r
    }, noop: function () {
    }, globalEval: function (t) {
        t && b.trim(t) && (e.execScript || function (t) {
            e.eval.call(e, t)
        })(t)
    }, camelCase: function (e) {
        return e.replace(j, "ms-").replace(D, L)
    }, nodeName: function (e, t) {
        return e.nodeName && e.nodeName.toLowerCase() === t.toLowerCase()
    }, each: function (e, t, n) {
        var r, i = 0, o = e.length, a = M(e);
        if (n) {
            if (a) {
                for (; o > i; i++)if (r = t.apply(e[i], n), r === !1)break
            } else for (i in e)if (r = t.apply(e[i], n), r === !1)break
        } else if (a) {
            for (; o > i; i++)if (r = t.call(e[i], i, e[i]), r === !1)break
        } else for (i in e)if (r = t.call(e[i], i, e[i]), r === !1)break;
        return e
    }, trim: v && !v.call("\ufeff\u00a0") ? function (e) {
        return null == e ? "" : v.call(e)
    } : function (e) {
        return null == e ? "" : (e + "").replace(T, "")
    }, makeArray: function (e, t) {
        var n = t || [];
        return null != e && (M(Object(e)) ? b.merge(n, "string" == typeof e ? [e] : e) : d.call(n, e)), n
    }, inArray: function (e, t, n) {
        var r;
        if (t) {
            if (g)return g.call(t, e, n);
            for (r = t.length, n = n ? 0 > n ? Math.max(0, r + n) : n : 0; r > n; n++)if (n in t && t[n] === e)return n
        }
        return-1
    }, merge: function (e, n) {
        var r = n.length, i = e.length, o = 0;
        if ("number" == typeof r)for (; r > o; o++)e[i++] = n[o]; else while (n[o] !== t)e[i++] = n[o++];
        return e.length = i, e
    }, grep: function (e, t, n) {
        var r, i = [], o = 0, a = e.length;
        for (n = !!n; a > o; o++)r = !!t(e[o], o), n !== r && i.push(e[o]);
        return i
    }, map: function (e, t, n) {
        var r, i = 0, o = e.length, a = M(e), s = [];
        if (a)for (; o > i; i++)r = t(e[i], i, n), null != r && (s[s.length] = r); else for (i in e)r = t(e[i], i, n), null != r && (s[s.length] = r);
        return f.apply([], s)
    }, guid: 1, proxy: function (e, n) {
        var r, i, o;
        return"string" == typeof n && (o = e[n], n = e, e = o), b.isFunction(e) ? (r = h.call(arguments, 2), i = function () {
            return e.apply(n || this, r.concat(h.call(arguments)))
        }, i.guid = e.guid = e.guid || b.guid++, i) : t
    }, access: function (e, n, r, i, o, a, s) {
        var u = 0, l = e.length, c = null == r;
        if ("object" === b.type(r)) {
            o = !0;
            for (u in r)b.access(e, n, u, r[u], !0, a, s)
        } else if (i !== t && (o = !0, b.isFunction(i) || (s = !0), c && (s ? (n.call(e, i), n = null) : (c = n, n = function (e, t, n) {
            return c.call(b(e), n)
        })), n))for (; l > u; u++)n(e[u], r, s ? i : i.call(e[u], u, n(e[u], r)));
        return o ? e : c ? n.call(e) : l ? n(e[0], r) : a
    }, now: function () {
        return(new Date).getTime()
    }}), b.ready.promise = function (t) {
        if (!n)if (n = b.Deferred(), "complete" === o.readyState)setTimeout(b.ready); else if (o.addEventListener)o.addEventListener("DOMContentLoaded", H, !1), e.addEventListener("load", H, !1); else {
            o.attachEvent("onreadystatechange", H), e.attachEvent("onload", H);
            var r = !1;
            try {
                r = null == e.frameElement && o.documentElement
            } catch (i) {
            }
            r && r.doScroll && function a() {
                if (!b.isReady) {
                    try {
                        r.doScroll("left")
                    } catch (e) {
                        return setTimeout(a, 50)
                    }
                    q(), b.ready()
                }
            }()
        }
        return n.promise(t)
    }, b.each("Boolean Number String Function Array Date RegExp Object Error".split(" "), function (e, t) {
        l["[object " + t + "]"] = t.toLowerCase()
    });
    function M(e) {
        var t = e.length, n = b.type(e);
        return b.isWindow(e) ? !1 : 1 === e.nodeType && t ? !0 : "array" === n || "function" !== n && (0 === t || "number" == typeof t && t > 0 && t - 1 in e)
    }

    r = b(o);
    var _ = {};

    function F(e) {
        var t = _[e] = {};
        return b.each(e.match(w) || [], function (e, n) {
            t[n] = !0
        }), t
    }

    b.Callbacks = function (e) {
        e = "string" == typeof e ? _[e] || F(e) : b.extend({}, e);
        var n, r, i, o, a, s, u = [], l = !e.once && [], c = function (t) {
            for (r = e.memory && t, i = !0, a = s || 0, s = 0, o = u.length, n = !0; u && o > a; a++)if (u[a].apply(t[0], t[1]) === !1 && e.stopOnFalse) {
                r = !1;
                break
            }
            n = !1, u && (l ? l.length && c(l.shift()) : r ? u = [] : p.disable())
        }, p = {add: function () {
            if (u) {
                var t = u.length;
                (function i(t) {
                    b.each(t, function (t, n) {
                        var r = b.type(n);
                        "function" === r ? e.unique && p.has(n) || u.push(n) : n && n.length && "string" !== r && i(n)
                    })
                })(arguments), n ? o = u.length : r && (s = t, c(r))
            }
            return this
        }, remove: function () {
            return u && b.each(arguments, function (e, t) {
                var r;
                while ((r = b.inArray(t, u, r)) > -1)u.splice(r, 1), n && (o >= r && o--, a >= r && a--)
            }), this
        }, has: function (e) {
            return e ? b.inArray(e, u) > -1 : !(!u || !u.length)
        }, empty: function () {
            return u = [], this
        }, disable: function () {
            return u = l = r = t, this
        }, disabled: function () {
            return!u
        }, lock: function () {
            return l = t, r || p.disable(), this
        }, locked: function () {
            return!l
        }, fireWith: function (e, t) {
            return t = t || [], t = [e, t.slice ? t.slice() : t], !u || i && !l || (n ? l.push(t) : c(t)), this
        }, fire: function () {
            return p.fireWith(this, arguments), this
        }, fired: function () {
            return!!i
        }};
        return p
    }, b.extend({Deferred: function (e) {
        var t = [
            ["resolve", "done", b.Callbacks("once memory"), "resolved"],
            ["reject", "fail", b.Callbacks("once memory"), "rejected"],
            ["notify", "progress", b.Callbacks("memory")]
        ], n = "pending", r = {state: function () {
            return n
        }, always: function () {
            return i.done(arguments).fail(arguments), this
        }, then: function () {
            var e = arguments;
            return b.Deferred(function (n) {
                b.each(t, function (t, o) {
                    var a = o[0], s = b.isFunction(e[t]) && e[t];
                    i[o[1]](function () {
                        var e = s && s.apply(this, arguments);
                        e && b.isFunction(e.promise) ? e.promise().done(n.resolve).fail(n.reject).progress(n.notify) : n[a + "With"](this === r ? n.promise() : this, s ? [e] : arguments)
                    })
                }), e = null
            }).promise()
        }, promise: function (e) {
            return null != e ? b.extend(e, r) : r
        }}, i = {};
        return r.pipe = r.then, b.each(t, function (e, o) {
            var a = o[2], s = o[3];
            r[o[1]] = a.add, s && a.add(function () {
                n = s
            }, t[1 ^ e][2].disable, t[2][2].lock), i[o[0]] = function () {
                return i[o[0] + "With"](this === i ? r : this, arguments), this
            }, i[o[0] + "With"] = a.fireWith
        }), r.promise(i), e && e.call(i, i), i
    }, when: function (e) {
        var t = 0, n = h.call(arguments), r = n.length, i = 1 !== r || e && b.isFunction(e.promise) ? r : 0, o = 1 === i ? e : b.Deferred(), a = function (e, t, n) {
            return function (r) {
                t[e] = this, n[e] = arguments.length > 1 ? h.call(arguments) : r, n === s ? o.notifyWith(t, n) : --i || o.resolveWith(t, n)
            }
        }, s, u, l;
        if (r > 1)for (s = Array(r), u = Array(r), l = Array(r); r > t; t++)n[t] && b.isFunction(n[t].promise) ? n[t].promise().done(a(t, l, n)).fail(o.reject).progress(a(t, u, s)) : --i;
        return i || o.resolveWith(l, n), o.promise()
    }}), b.support = function () {
        var t, n, r, a, s, u, l, c, p, f, d = o.createElement("div");
        if (d.setAttribute("className", "t"), d.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>", n = d.getElementsByTagName("*"), r = d.getElementsByTagName("a")[0], !n || !r || !n.length)return{};
        s = o.createElement("select"), l = s.appendChild(o.createElement("option")), a = d.getElementsByTagName("input")[0], r.style.cssText = "top:1px;float:left;opacity:.5", t = {getSetAttribute: "t" !== d.className, leadingWhitespace: 3 === d.firstChild.nodeType, tbody: !d.getElementsByTagName("tbody").length, htmlSerialize: !!d.getElementsByTagName("link").length, style: /top/.test(r.getAttribute("style")), hrefNormalized: "/a" === r.getAttribute("href"), opacity: /^0.5/.test(r.style.opacity), cssFloat: !!r.style.cssFloat, checkOn: !!a.value, optSelected: l.selected, enctype: !!o.createElement("form").enctype, html5Clone: "<:nav></:nav>" !== o.createElement("nav").cloneNode(!0).outerHTML, boxModel: "CSS1Compat" === o.compatMode, deleteExpando: !0, noCloneEvent: !0, inlineBlockNeedsLayout: !1, shrinkWrapBlocks: !1, reliableMarginRight: !0, boxSizingReliable: !0, pixelPosition: !1}, a.checked = !0, t.noCloneChecked = a.cloneNode(!0).checked, s.disabled = !0, t.optDisabled = !l.disabled;
        try {
            delete d.test
        } catch (h) {
            t.deleteExpando = !1
        }
        a = o.createElement("input"), a.setAttribute("value", ""), t.input = "" === a.getAttribute("value"), a.value = "t", a.setAttribute("type", "radio"), t.radioValue = "t" === a.value, a.setAttribute("checked", "t"), a.setAttribute("name", "t"), u = o.createDocumentFragment(), u.appendChild(a), t.appendChecked = a.checked, t.checkClone = u.cloneNode(!0).cloneNode(!0).lastChild.checked, d.attachEvent && (d.attachEvent("onclick", function () {
            t.noCloneEvent = !1
        }), d.cloneNode(!0).click());
        for (f in{submit: !0, change: !0, focusin: !0})d.setAttribute(c = "on" + f, "t"), t[f + "Bubbles"] = c in e || d.attributes[c].expando === !1;
        return d.style.backgroundClip = "content-box", d.cloneNode(!0).style.backgroundClip = "", t.clearCloneStyle = "content-box" === d.style.backgroundClip, b(function () {
            var n, r, a, s = "padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;", u = o.getElementsByTagName("body")[0];
            u && (n = o.createElement("div"), n.style.cssText = "border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px", u.appendChild(n).appendChild(d), d.innerHTML = "<table><tr><td></td><td>t</td></tr></table>", a = d.getElementsByTagName("td"), a[0].style.cssText = "padding:0;margin:0;border:0;display:none", p = 0 === a[0].offsetHeight, a[0].style.display = "", a[1].style.display = "none", t.reliableHiddenOffsets = p && 0 === a[0].offsetHeight, d.innerHTML = "", d.style.cssText = "box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;", t.boxSizing = 4 === d.offsetWidth, t.doesNotIncludeMarginInBodyOffset = 1 !== u.offsetTop, e.getComputedStyle && (t.pixelPosition = "1%" !== (e.getComputedStyle(d, null) || {}).top, t.boxSizingReliable = "4px" === (e.getComputedStyle(d, null) || {width: "4px"}).width, r = d.appendChild(o.createElement("div")), r.style.cssText = d.style.cssText = s, r.style.marginRight = r.style.width = "0", d.style.width = "1px", t.reliableMarginRight = !parseFloat((e.getComputedStyle(r, null) || {}).marginRight)), typeof d.style.zoom !== i && (d.innerHTML = "", d.style.cssText = s + "width:1px;padding:1px;display:inline;zoom:1", t.inlineBlockNeedsLayout = 3 === d.offsetWidth, d.style.display = "block", d.innerHTML = "<div></div>", d.firstChild.style.width = "5px", t.shrinkWrapBlocks = 3 !== d.offsetWidth, t.inlineBlockNeedsLayout && (u.style.zoom = 1)), u.removeChild(n), n = d = a = r = null)
        }), n = s = u = l = r = a = null, t
    }();
    var O = /(?:\{[\s\S]*\}|\[[\s\S]*\])$/, B = /([A-Z])/g;

    function P(e, n, r, i) {
        if (b.acceptData(e)) {
            var o, a, s = b.expando, u = "string" == typeof n, l = e.nodeType, p = l ? b.cache : e, f = l ? e[s] : e[s] && s;
            if (f && p[f] && (i || p[f].data) || !u || r !== t)return f || (l ? e[s] = f = c.pop() || b.guid++ : f = s), p[f] || (p[f] = {}, l || (p[f].toJSON = b.noop)), ("object" == typeof n || "function" == typeof n) && (i ? p[f] = b.extend(p[f], n) : p[f].data = b.extend(p[f].data, n)), o = p[f], i || (o.data || (o.data = {}), o = o.data), r !== t && (o[b.camelCase(n)] = r), u ? (a = o[n], null == a && (a = o[b.camelCase(n)])) : a = o, a
        }
    }

    function R(e, t, n) {
        if (b.acceptData(e)) {
            var r, i, o, a = e.nodeType, s = a ? b.cache : e, u = a ? e[b.expando] : b.expando;
            if (s[u]) {
                if (t && (o = n ? s[u] : s[u].data)) {
                    b.isArray(t) ? t = t.concat(b.map(t, b.camelCase)) : t in o ? t = [t] : (t = b.camelCase(t), t = t in o ? [t] : t.split(" "));
                    for (r = 0, i = t.length; i > r; r++)delete o[t[r]];
                    if (!(n ? $ : b.isEmptyObject)(o))return
                }
                (n || (delete s[u].data, $(s[u]))) && (a ? b.cleanData([e], !0) : b.support.deleteExpando || s != s.window ? delete s[u] : s[u] = null)
            }
        }
    }

    b.extend({cache: {}, expando: "jQuery" + (p + Math.random()).replace(/\D/g, ""), noData: {embed: !0, object: "clsid:D27CDB6E-AE6D-11cf-96B8-444553540000", applet: !0}, hasData: function (e) {
        return e = e.nodeType ? b.cache[e[b.expando]] : e[b.expando], !!e && !$(e)
    }, data: function (e, t, n) {
        return P(e, t, n)
    }, removeData: function (e, t) {
        return R(e, t)
    }, _data: function (e, t, n) {
        return P(e, t, n, !0)
    }, _removeData: function (e, t) {
        return R(e, t, !0)
    }, acceptData: function (e) {
        if (e.nodeType && 1 !== e.nodeType && 9 !== e.nodeType)return!1;
        var t = e.nodeName && b.noData[e.nodeName.toLowerCase()];
        return!t || t !== !0 && e.getAttribute("classid") === t
    }}), b.fn.extend({data: function (e, n) {
        var r, i, o = this[0], a = 0, s = null;
        if (e === t) {
            if (this.length && (s = b.data(o), 1 === o.nodeType && !b._data(o, "parsedAttrs"))) {
                for (r = o.attributes; r.length > a; a++)i = r[a].name, i.indexOf("data-") || (i = b.camelCase(i.slice(5)), W(o, i, s[i]));
                b._data(o, "parsedAttrs", !0)
            }
            return s
        }
        return"object" == typeof e ? this.each(function () {
            b.data(this, e)
        }) : b.access(this, function (n) {
            return n === t ? o ? W(o, e, b.data(o, e)) : null : (this.each(function () {
                b.data(this, e, n)
            }), t)
        }, null, n, arguments.length > 1, null, !0)
    }, removeData: function (e) {
        return this.each(function () {
            b.removeData(this, e)
        })
    }});
    function W(e, n, r) {
        if (r === t && 1 === e.nodeType) {
            var i = "data-" + n.replace(B, "-$1").toLowerCase();
            if (r = e.getAttribute(i), "string" == typeof r) {
                try {
                    r = "true" === r ? !0 : "false" === r ? !1 : "null" === r ? null : +r + "" === r ? +r : O.test(r) ? b.parseJSON(r) : r
                } catch (o) {
                }
                b.data(e, n, r)
            } else r = t
        }
        return r
    }

    function $(e) {
        var t;
        for (t in e)if (("data" !== t || !b.isEmptyObject(e[t])) && "toJSON" !== t)return!1;
        return!0
    }

    b.extend({queue: function (e, n, r) {
        var i;
        return e ? (n = (n || "fx") + "queue", i = b._data(e, n), r && (!i || b.isArray(r) ? i = b._data(e, n, b.makeArray(r)) : i.push(r)), i || []) : t
    }, dequeue: function (e, t) {
        t = t || "fx";
        var n = b.queue(e, t), r = n.length, i = n.shift(), o = b._queueHooks(e, t), a = function () {
            b.dequeue(e, t)
        };
        "inprogress" === i && (i = n.shift(), r--), o.cur = i, i && ("fx" === t && n.unshift("inprogress"), delete o.stop, i.call(e, a, o)), !r && o && o.empty.fire()
    }, _queueHooks: function (e, t) {
        var n = t + "queueHooks";
        return b._data(e, n) || b._data(e, n, {empty: b.Callbacks("once memory").add(function () {
            b._removeData(e, t + "queue"), b._removeData(e, n)
        })})
    }}), b.fn.extend({queue: function (e, n) {
        var r = 2;
        return"string" != typeof e && (n = e, e = "fx", r--), r > arguments.length ? b.queue(this[0], e) : n === t ? this : this.each(function () {
            var t = b.queue(this, e, n);
            b._queueHooks(this, e), "fx" === e && "inprogress" !== t[0] && b.dequeue(this, e)
        })
    }, dequeue: function (e) {
        return this.each(function () {
            b.dequeue(this, e)
        })
    }, delay: function (e, t) {
        return e = b.fx ? b.fx.speeds[e] || e : e, t = t || "fx", this.queue(t, function (t, n) {
            var r = setTimeout(t, e);
            n.stop = function () {
                clearTimeout(r)
            }
        })
    }, clearQueue: function (e) {
        return this.queue(e || "fx", [])
    }, promise: function (e, n) {
        var r, i = 1, o = b.Deferred(), a = this, s = this.length, u = function () {
            --i || o.resolveWith(a, [a])
        };
        "string" != typeof e && (n = e, e = t), e = e || "fx";
        while (s--)r = b._data(a[s], e + "queueHooks"), r && r.empty && (i++, r.empty.add(u));
        return u(), o.promise(n)
    }});
    var I, z, X = /[\t\r\n]/g, U = /\r/g, V = /^(?:input|select|textarea|button|object)$/i, Y = /^(?:a|area)$/i, J = /^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i, G = /^(?:checked|selected)$/i, Q = b.support.getSetAttribute, K = b.support.input;
    b.fn.extend({attr: function (e, t) {
        return b.access(this, b.attr, e, t, arguments.length > 1)
    }, removeAttr: function (e) {
        return this.each(function () {
            b.removeAttr(this, e)
        })
    }, prop: function (e, t) {
        return b.access(this, b.prop, e, t, arguments.length > 1)
    }, removeProp: function (e) {
        return e = b.propFix[e] || e, this.each(function () {
            try {
                this[e] = t, delete this[e]
            } catch (n) {
            }
        })
    }, addClass: function (e) {
        var t, n, r, i, o, a = 0, s = this.length, u = "string" == typeof e && e;
        if (b.isFunction(e))return this.each(function (t) {
            b(this).addClass(e.call(this, t, this.className))
        });
        if (u)for (t = (e || "").match(w) || []; s > a; a++)if (n = this[a], r = 1 === n.nodeType && (n.className ? (" " + n.className + " ").replace(X, " ") : " ")) {
            o = 0;
            while (i = t[o++])0 > r.indexOf(" " + i + " ") && (r += i + " ");
            n.className = b.trim(r)
        }
        return this
    }, removeClass: function (e) {
        var t, n, r, i, o, a = 0, s = this.length, u = 0 === arguments.length || "string" == typeof e && e;
        if (b.isFunction(e))return this.each(function (t) {
            b(this).removeClass(e.call(this, t, this.className))
        });
        if (u)for (t = (e || "").match(w) || []; s > a; a++)if (n = this[a], r = 1 === n.nodeType && (n.className ? (" " + n.className + " ").replace(X, " ") : "")) {
            o = 0;
            while (i = t[o++])while (r.indexOf(" " + i + " ") >= 0)r = r.replace(" " + i + " ", " ");
            n.className = e ? b.trim(r) : ""
        }
        return this
    }, toggleClass: function (e, t) {
        var n = typeof e, r = "boolean" == typeof t;
        return b.isFunction(e) ? this.each(function (n) {
            b(this).toggleClass(e.call(this, n, this.className, t), t)
        }) : this.each(function () {
            if ("string" === n) {
                var o, a = 0, s = b(this), u = t, l = e.match(w) || [];
                while (o = l[a++])u = r ? u : !s.hasClass(o), s[u ? "addClass" : "removeClass"](o)
            } else(n === i || "boolean" === n) && (this.className && b._data(this, "__className__", this.className), this.className = this.className || e === !1 ? "" : b._data(this, "__className__") || "")
        })
    }, hasClass: function (e) {
        var t = " " + e + " ", n = 0, r = this.length;
        for (; r > n; n++)if (1 === this[n].nodeType && (" " + this[n].className + " ").replace(X, " ").indexOf(t) >= 0)return!0;
        return!1
    }, val: function (e) {
        var n, r, i, o = this[0];
        {
            if (arguments.length)return i = b.isFunction(e), this.each(function (n) {
                var o, a = b(this);
                1 === this.nodeType && (o = i ? e.call(this, n, a.val()) : e, null == o ? o = "" : "number" == typeof o ? o += "" : b.isArray(o) && (o = b.map(o, function (e) {
                    return null == e ? "" : e + ""
                })), r = b.valHooks[this.type] || b.valHooks[this.nodeName.toLowerCase()], r && "set"in r && r.set(this, o, "value") !== t || (this.value = o))
            });
            if (o)return r = b.valHooks[o.type] || b.valHooks[o.nodeName.toLowerCase()], r && "get"in r && (n = r.get(o, "value")) !== t ? n : (n = o.value, "string" == typeof n ? n.replace(U, "") : null == n ? "" : n)
        }
    }}), b.extend({valHooks: {option: {get: function (e) {
        var t = e.attributes.value;
        return!t || t.specified ? e.value : e.text
    }}, select: {get: function (e) {
        var t, n, r = e.options, i = e.selectedIndex, o = "select-one" === e.type || 0 > i, a = o ? null : [], s = o ? i + 1 : r.length, u = 0 > i ? s : o ? i : 0;
        for (; s > u; u++)if (n = r[u], !(!n.selected && u !== i || (b.support.optDisabled ? n.disabled : null !== n.getAttribute("disabled")) || n.parentNode.disabled && b.nodeName(n.parentNode, "optgroup"))) {
            if (t = b(n).val(), o)return t;
            a.push(t)
        }
        return a
    }, set: function (e, t) {
        var n = b.makeArray(t);
        return b(e).find("option").each(function () {
            this.selected = b.inArray(b(this).val(), n) >= 0
        }), n.length || (e.selectedIndex = -1), n
    }}}, attr: function (e, n, r) {
        var o, a, s, u = e.nodeType;
        if (e && 3 !== u && 8 !== u && 2 !== u)return typeof e.getAttribute === i ? b.prop(e, n, r) : (a = 1 !== u || !b.isXMLDoc(e), a && (n = n.toLowerCase(), o = b.attrHooks[n] || (J.test(n) ? z : I)), r === t ? o && a && "get"in o && null !== (s = o.get(e, n)) ? s : (typeof e.getAttribute !== i && (s = e.getAttribute(n)), null == s ? t : s) : null !== r ? o && a && "set"in o && (s = o.set(e, r, n)) !== t ? s : (e.setAttribute(n, r + ""), r) : (b.removeAttr(e, n), t))
    }, removeAttr: function (e, t) {
        var n, r, i = 0, o = t && t.match(w);
        if (o && 1 === e.nodeType)while (n = o[i++])r = b.propFix[n] || n, J.test(n) ? !Q && G.test(n) ? e[b.camelCase("default-" + n)] = e[r] = !1 : e[r] = !1 : b.attr(e, n, ""), e.removeAttribute(Q ? n : r)
    }, attrHooks: {type: {set: function (e, t) {
        if (!b.support.radioValue && "radio" === t && b.nodeName(e, "input")) {
            var n = e.value;
            return e.setAttribute("type", t), n && (e.value = n), t
        }
    }}}, propFix: {tabindex: "tabIndex", readonly: "readOnly", "for": "htmlFor", "class": "className", maxlength: "maxLength", cellspacing: "cellSpacing", cellpadding: "cellPadding", rowspan: "rowSpan", colspan: "colSpan", usemap: "useMap", frameborder: "frameBorder", contenteditable: "contentEditable"}, prop: function (e, n, r) {
        var i, o, a, s = e.nodeType;
        if (e && 3 !== s && 8 !== s && 2 !== s)return a = 1 !== s || !b.isXMLDoc(e), a && (n = b.propFix[n] || n, o = b.propHooks[n]), r !== t ? o && "set"in o && (i = o.set(e, r, n)) !== t ? i : e[n] = r : o && "get"in o && null !== (i = o.get(e, n)) ? i : e[n]
    }, propHooks: {tabIndex: {get: function (e) {
        var n = e.getAttributeNode("tabindex");
        return n && n.specified ? parseInt(n.value, 10) : V.test(e.nodeName) || Y.test(e.nodeName) && e.href ? 0 : t
    }}}}), z = {get: function (e, n) {
        var r = b.prop(e, n), i = "boolean" == typeof r && e.getAttribute(n), o = "boolean" == typeof r ? K && Q ? null != i : G.test(n) ? e[b.camelCase("default-" + n)] : !!i : e.getAttributeNode(n);
        return o && o.value !== !1 ? n.toLowerCase() : t
    }, set: function (e, t, n) {
        return t === !1 ? b.removeAttr(e, n) : K && Q || !G.test(n) ? e.setAttribute(!Q && b.propFix[n] || n, n) : e[b.camelCase("default-" + n)] = e[n] = !0, n
    }}, K && Q || (b.attrHooks.value = {get: function (e, n) {
        var r = e.getAttributeNode(n);
        return b.nodeName(e, "input") ? e.defaultValue : r && r.specified ? r.value : t
    }, set: function (e, n, r) {
        return b.nodeName(e, "input") ? (e.defaultValue = n, t) : I && I.set(e, n, r)
    }}), Q || (I = b.valHooks.button = {get: function (e, n) {
        var r = e.getAttributeNode(n);
        return r && ("id" === n || "name" === n || "coords" === n ? "" !== r.value : r.specified) ? r.value : t
    }, set: function (e, n, r) {
        var i = e.getAttributeNode(r);
        return i || e.setAttributeNode(i = e.ownerDocument.createAttribute(r)), i.value = n += "", "value" === r || n === e.getAttribute(r) ? n : t
    }}, b.attrHooks.contenteditable = {get: I.get, set: function (e, t, n) {
        I.set(e, "" === t ? !1 : t, n)
    }}, b.each(["width", "height"], function (e, n) {
        b.attrHooks[n] = b.extend(b.attrHooks[n], {set: function (e, r) {
            return"" === r ? (e.setAttribute(n, "auto"), r) : t
        }})
    })), b.support.hrefNormalized || (b.each(["href", "src", "width", "height"], function (e, n) {
        b.attrHooks[n] = b.extend(b.attrHooks[n], {get: function (e) {
            var r = e.getAttribute(n, 2);
            return null == r ? t : r
        }})
    }), b.each(["href", "src"], function (e, t) {
        b.propHooks[t] = {get: function (e) {
            return e.getAttribute(t, 4)
        }}
    })), b.support.style || (b.attrHooks.style = {get: function (e) {
        return e.style.cssText || t
    }, set: function (e, t) {
        return e.style.cssText = t + ""
    }}), b.support.optSelected || (b.propHooks.selected = b.extend(b.propHooks.selected, {get: function (e) {
        var t = e.parentNode;
        return t && (t.selectedIndex, t.parentNode && t.parentNode.selectedIndex), null
    }})), b.support.enctype || (b.propFix.enctype = "encoding"), b.support.checkOn || b.each(["radio", "checkbox"], function () {
        b.valHooks[this] = {get: function (e) {
            return null === e.getAttribute("value") ? "on" : e.value
        }}
    }), b.each(["radio", "checkbox"], function () {
        b.valHooks[this] = b.extend(b.valHooks[this], {set: function (e, n) {
            return b.isArray(n) ? e.checked = b.inArray(b(e).val(), n) >= 0 : t
        }})
    });
    var Z = /^(?:input|select|textarea)$/i, et = /^key/, tt = /^(?:mouse|contextmenu)|click/, nt = /^(?:focusinfocus|focusoutblur)$/, rt = /^([^.]*)(?:\.(.+)|)$/;

    function it() {
        return!0
    }

    function ot() {
        return!1
    }

    b.event = {global: {}, add: function (e, n, r, o, a) {
        var s, u, l, c, p, f, d, h, g, m, y, v = b._data(e);
        if (v) {
            r.handler && (c = r, r = c.handler, a = c.selector), r.guid || (r.guid = b.guid++), (u = v.events) || (u = v.events = {}), (f = v.handle) || (f = v.handle = function (e) {
                return typeof b === i || e && b.event.triggered === e.type ? t : b.event.dispatch.apply(f.elem, arguments)
            }, f.elem = e), n = (n || "").match(w) || [""], l = n.length;
            while (l--)s = rt.exec(n[l]) || [], g = y = s[1], m = (s[2] || "").split(".").sort(), p = b.event.special[g] || {}, g = (a ? p.delegateType : p.bindType) || g, p = b.event.special[g] || {}, d = b.extend({type: g, origType: y, data: o, handler: r, guid: r.guid, selector: a, needsContext: a && b.expr.match.needsContext.test(a), namespace: m.join(".")}, c), (h = u[g]) || (h = u[g] = [], h.delegateCount = 0, p.setup && p.setup.call(e, o, m, f) !== !1 || (e.addEventListener ? e.addEventListener(g, f, !1) : e.attachEvent && e.attachEvent("on" + g, f))), p.add && (p.add.call(e, d), d.handler.guid || (d.handler.guid = r.guid)), a ? h.splice(h.delegateCount++, 0, d) : h.push(d), b.event.global[g] = !0;
            e = null
        }
    }, remove: function (e, t, n, r, i) {
        var o, a, s, u, l, c, p, f, d, h, g, m = b.hasData(e) && b._data(e);
        if (m && (c = m.events)) {
            t = (t || "").match(w) || [""], l = t.length;
            while (l--)if (s = rt.exec(t[l]) || [], d = g = s[1], h = (s[2] || "").split(".").sort(), d) {
                p = b.event.special[d] || {}, d = (r ? p.delegateType : p.bindType) || d, f = c[d] || [], s = s[2] && RegExp("(^|\\.)" + h.join("\\.(?:.*\\.|)") + "(\\.|$)"), u = o = f.length;
                while (o--)a = f[o], !i && g !== a.origType || n && n.guid !== a.guid || s && !s.test(a.namespace) || r && r !== a.selector && ("**" !== r || !a.selector) || (f.splice(o, 1), a.selector && f.delegateCount--, p.remove && p.remove.call(e, a));
                u && !f.length && (p.teardown && p.teardown.call(e, h, m.handle) !== !1 || b.removeEvent(e, d, m.handle), delete c[d])
            } else for (d in c)b.event.remove(e, d + t[l], n, r, !0);
            b.isEmptyObject(c) && (delete m.handle, b._removeData(e, "events"))
        }
    }, trigger: function (n, r, i, a) {
        var s, u, l, c, p, f, d, h = [i || o], g = y.call(n, "type") ? n.type : n, m = y.call(n, "namespace") ? n.namespace.split(".") : [];
        if (l = f = i = i || o, 3 !== i.nodeType && 8 !== i.nodeType && !nt.test(g + b.event.triggered) && (g.indexOf(".") >= 0 && (m = g.split("."), g = m.shift(), m.sort()), u = 0 > g.indexOf(":") && "on" + g, n = n[b.expando] ? n : new b.Event(g, "object" == typeof n && n), n.isTrigger = !0, n.namespace = m.join("."), n.namespace_re = n.namespace ? RegExp("(^|\\.)" + m.join("\\.(?:.*\\.|)") + "(\\.|$)") : null, n.result = t, n.target || (n.target = i), r = null == r ? [n] : b.makeArray(r, [n]), p = b.event.special[g] || {}, a || !p.trigger || p.trigger.apply(i, r) !== !1)) {
            if (!a && !p.noBubble && !b.isWindow(i)) {
                for (c = p.delegateType || g, nt.test(c + g) || (l = l.parentNode); l; l = l.parentNode)h.push(l), f = l;
                f === (i.ownerDocument || o) && h.push(f.defaultView || f.parentWindow || e)
            }
            d = 0;
            while ((l = h[d++]) && !n.isPropagationStopped())n.type = d > 1 ? c : p.bindType || g, s = (b._data(l, "events") || {})[n.type] && b._data(l, "handle"), s && s.apply(l, r), s = u && l[u], s && b.acceptData(l) && s.apply && s.apply(l, r) === !1 && n.preventDefault();
            if (n.type = g, !(a || n.isDefaultPrevented() || p._default && p._default.apply(i.ownerDocument, r) !== !1 || "click" === g && b.nodeName(i, "a") || !b.acceptData(i) || !u || !i[g] || b.isWindow(i))) {
                f = i[u], f && (i[u] = null), b.event.triggered = g;
                try {
                    i[g]()
                } catch (v) {
                }
                b.event.triggered = t, f && (i[u] = f)
            }
            return n.result
        }
    }, dispatch: function (e) {
        e = b.event.fix(e);
        var n, r, i, o, a, s = [], u = h.call(arguments), l = (b._data(this, "events") || {})[e.type] || [], c = b.event.special[e.type] || {};
        if (u[0] = e, e.delegateTarget = this, !c.preDispatch || c.preDispatch.call(this, e) !== !1) {
            s = b.event.handlers.call(this, e, l), n = 0;
            while ((o = s[n++]) && !e.isPropagationStopped()) {
                e.currentTarget = o.elem, a = 0;
                while ((i = o.handlers[a++]) && !e.isImmediatePropagationStopped())(!e.namespace_re || e.namespace_re.test(i.namespace)) && (e.handleObj = i, e.data = i.data, r = ((b.event.special[i.origType] || {}).handle || i.handler).apply(o.elem, u), r !== t && (e.result = r) === !1 && (e.preventDefault(), e.stopPropagation()))
            }
            return c.postDispatch && c.postDispatch.call(this, e), e.result
        }
    }, handlers: function (e, n) {
        var r, i, o, a, s = [], u = n.delegateCount, l = e.target;
        if (u && l.nodeType && (!e.button || "click" !== e.type))for (; l != this; l = l.parentNode || this)if (1 === l.nodeType && (l.disabled !== !0 || "click" !== e.type)) {
            for (o = [], a = 0; u > a; a++)i = n[a], r = i.selector + " ", o[r] === t && (o[r] = i.needsContext ? b(r, this).index(l) >= 0 : b.find(r, this, null, [l]).length), o[r] && o.push(i);
            o.length && s.push({elem: l, handlers: o})
        }
        return n.length > u && s.push({elem: this, handlers: n.slice(u)}), s
    }, fix: function (e) {
        if (e[b.expando])return e;
        var t, n, r, i = e.type, a = e, s = this.fixHooks[i];
        s || (this.fixHooks[i] = s = tt.test(i) ? this.mouseHooks : et.test(i) ? this.keyHooks : {}), r = s.props ? this.props.concat(s.props) : this.props, e = new b.Event(a), t = r.length;
        while (t--)n = r[t], e[n] = a[n];
        return e.target || (e.target = a.srcElement || o), 3 === e.target.nodeType && (e.target = e.target.parentNode), e.metaKey = !!e.metaKey, s.filter ? s.filter(e, a) : e
    }, props: "altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "), fixHooks: {}, keyHooks: {props: "char charCode key keyCode".split(" "), filter: function (e, t) {
        return null == e.which && (e.which = null != t.charCode ? t.charCode : t.keyCode), e
    }}, mouseHooks: {props: "button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "), filter: function (e, n) {
        var r, i, a, s = n.button, u = n.fromElement;
        return null == e.pageX && null != n.clientX && (i = e.target.ownerDocument || o, a = i.documentElement, r = i.body, e.pageX = n.clientX + (a && a.scrollLeft || r && r.scrollLeft || 0) - (a && a.clientLeft || r && r.clientLeft || 0), e.pageY = n.clientY + (a && a.scrollTop || r && r.scrollTop || 0) - (a && a.clientTop || r && r.clientTop || 0)), !e.relatedTarget && u && (e.relatedTarget = u === e.target ? n.toElement : u), e.which || s === t || (e.which = 1 & s ? 1 : 2 & s ? 3 : 4 & s ? 2 : 0), e
    }}, special: {load: {noBubble: !0}, click: {trigger: function () {
        return b.nodeName(this, "input") && "checkbox" === this.type && this.click ? (this.click(), !1) : t
    }}, focus: {trigger: function () {
        if (this !== o.activeElement && this.focus)try {
            return this.focus(), !1
        } catch (e) {
        }
    }, delegateType: "focusin"}, blur: {trigger: function () {
        return this === o.activeElement && this.blur ? (this.blur(), !1) : t
    }, delegateType: "focusout"}, beforeunload: {postDispatch: function (e) {
        e.result !== t && (e.originalEvent.returnValue = e.result)
    }}}, simulate: function (e, t, n, r) {
        var i = b.extend(new b.Event, n, {type: e, isSimulated: !0, originalEvent: {}});
        r ? b.event.trigger(i, null, t) : b.event.dispatch.call(t, i), i.isDefaultPrevented() && n.preventDefault()
    }}, b.removeEvent = o.removeEventListener ? function (e, t, n) {
        e.removeEventListener && e.removeEventListener(t, n, !1)
    } : function (e, t, n) {
        var r = "on" + t;
        e.detachEvent && (typeof e[r] === i && (e[r] = null), e.detachEvent(r, n))
    }, b.Event = function (e, n) {
        return this instanceof b.Event ? (e && e.type ? (this.originalEvent = e, this.type = e.type, this.isDefaultPrevented = e.defaultPrevented || e.returnValue === !1 || e.getPreventDefault && e.getPreventDefault() ? it : ot) : this.type = e, n && b.extend(this, n), this.timeStamp = e && e.timeStamp || b.now(), this[b.expando] = !0, t) : new b.Event(e, n)
    }, b.Event.prototype = {isDefaultPrevented: ot, isPropagationStopped: ot, isImmediatePropagationStopped: ot, preventDefault: function () {
        var e = this.originalEvent;
        this.isDefaultPrevented = it, e && (e.preventDefault ? e.preventDefault() : e.returnValue = !1)
    }, stopPropagation: function () {
        var e = this.originalEvent;
        this.isPropagationStopped = it, e && (e.stopPropagation && e.stopPropagation(), e.cancelBubble = !0)
    }, stopImmediatePropagation: function () {
        this.isImmediatePropagationStopped = it, this.stopPropagation()
    }}, b.each({mouseenter: "mouseover", mouseleave: "mouseout"}, function (e, t) {
        b.event.special[e] = {delegateType: t, bindType: t, handle: function (e) {
            var n, r = this, i = e.relatedTarget, o = e.handleObj;
            return(!i || i !== r && !b.contains(r, i)) && (e.type = o.origType, n = o.handler.apply(this, arguments), e.type = t), n
        }}
    }), b.support.submitBubbles || (b.event.special.submit = {setup: function () {
        return b.nodeName(this, "form") ? !1 : (b.event.add(this, "click._submit keypress._submit", function (e) {
            var n = e.target, r = b.nodeName(n, "input") || b.nodeName(n, "button") ? n.form : t;
            r && !b._data(r, "submitBubbles") && (b.event.add(r, "submit._submit", function (e) {
                e._submit_bubble = !0
            }), b._data(r, "submitBubbles", !0))
        }), t)
    }, postDispatch: function (e) {
        e._submit_bubble && (delete e._submit_bubble, this.parentNode && !e.isTrigger && b.event.simulate("submit", this.parentNode, e, !0))
    }, teardown: function () {
        return b.nodeName(this, "form") ? !1 : (b.event.remove(this, "._submit"), t)
    }}), b.support.changeBubbles || (b.event.special.change = {setup: function () {
        return Z.test(this.nodeName) ? (("checkbox" === this.type || "radio" === this.type) && (b.event.add(this, "propertychange._change", function (e) {
            "checked" === e.originalEvent.propertyName && (this._just_changed = !0)
        }), b.event.add(this, "click._change", function (e) {
            this._just_changed && !e.isTrigger && (this._just_changed = !1), b.event.simulate("change", this, e, !0)
        })), !1) : (b.event.add(this, "beforeactivate._change", function (e) {
            var t = e.target;
            Z.test(t.nodeName) && !b._data(t, "changeBubbles") && (b.event.add(t, "change._change", function (e) {
                !this.parentNode || e.isSimulated || e.isTrigger || b.event.simulate("change", this.parentNode, e, !0)
            }), b._data(t, "changeBubbles", !0))
        }), t)
    }, handle: function (e) {
        var n = e.target;
        return this !== n || e.isSimulated || e.isTrigger || "radio" !== n.type && "checkbox" !== n.type ? e.handleObj.handler.apply(this, arguments) : t
    }, teardown: function () {
        return b.event.remove(this, "._change"), !Z.test(this.nodeName)
    }}), b.support.focusinBubbles || b.each({focus: "focusin", blur: "focusout"}, function (e, t) {
        var n = 0, r = function (e) {
            b.event.simulate(t, e.target, b.event.fix(e), !0)
        };
        b.event.special[t] = {setup: function () {
            0 === n++ && o.addEventListener(e, r, !0)
        }, teardown: function () {
            0 === --n && o.removeEventListener(e, r, !0)
        }}
    }), b.fn.extend({on: function (e, n, r, i, o) {
        var a, s;
        if ("object" == typeof e) {
            "string" != typeof n && (r = r || n, n = t);
            for (a in e)this.on(a, n, r, e[a], o);
            return this
        }
        if (null == r && null == i ? (i = n, r = n = t) : null == i && ("string" == typeof n ? (i = r, r = t) : (i = r, r = n, n = t)), i === !1)i = ot; else if (!i)return this;
        return 1 === o && (s = i, i = function (e) {
            return b().off(e), s.apply(this, arguments)
        }, i.guid = s.guid || (s.guid = b.guid++)), this.each(function () {
            b.event.add(this, e, i, r, n)
        })
    }, one: function (e, t, n, r) {
        return this.on(e, t, n, r, 1)
    }, off: function (e, n, r) {
        var i, o;
        if (e && e.preventDefault && e.handleObj)return i = e.handleObj, b(e.delegateTarget).off(i.namespace ? i.origType + "." + i.namespace : i.origType, i.selector, i.handler), this;
        if ("object" == typeof e) {
            for (o in e)this.off(o, n, e[o]);
            return this
        }
        return(n === !1 || "function" == typeof n) && (r = n, n = t), r === !1 && (r = ot), this.each(function () {
            b.event.remove(this, e, r, n)
        })
    }, bind: function (e, t, n) {
        return this.on(e, null, t, n)
    }, unbind: function (e, t) {
        return this.off(e, null, t)
    }, delegate: function (e, t, n, r) {
        return this.on(t, e, n, r)
    }, undelegate: function (e, t, n) {
        return 1 === arguments.length ? this.off(e, "**") : this.off(t, e || "**", n)
    }, trigger: function (e, t) {
        return this.each(function () {
            b.event.trigger(e, t, this)
        })
    }, triggerHandler: function (e, n) {
        var r = this[0];
        return r ? b.event.trigger(e, n, r, !0) : t
    }}), function (e, t) {
        var n, r, i, o, a, s, u, l, c, p, f, d, h, g, m, y, v, x = "sizzle" + -new Date, w = e.document, T = {}, N = 0, C = 0, k = it(), E = it(), S = it(), A = typeof t, j = 1 << 31, D = [], L = D.pop, H = D.push, q = D.slice, M = D.indexOf || function (e) {
            var t = 0, n = this.length;
            for (; n > t; t++)if (this[t] === e)return t;
            return-1
        }, _ = "[\\x20\\t\\r\\n\\f]", F = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+", O = F.replace("w", "w#"), B = "([*^$|!~]?=)", P = "\\[" + _ + "*(" + F + ")" + _ + "*(?:" + B + _ + "*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|(" + O + ")|)|)" + _ + "*\\]", R = ":(" + F + ")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|" + P.replace(3, 8) + ")*)|.*)\\)|)", W = RegExp("^" + _ + "+|((?:^|[^\\\\])(?:\\\\.)*)" + _ + "+$", "g"), $ = RegExp("^" + _ + "*," + _ + "*"), I = RegExp("^" + _ + "*([\\x20\\t\\r\\n\\f>+~])" + _ + "*"), z = RegExp(R), X = RegExp("^" + O + "$"), U = {ID: RegExp("^#(" + F + ")"), CLASS: RegExp("^\\.(" + F + ")"), NAME: RegExp("^\\[name=['\"]?(" + F + ")['\"]?\\]"), TAG: RegExp("^(" + F.replace("w", "w*") + ")"), ATTR: RegExp("^" + P), PSEUDO: RegExp("^" + R), CHILD: RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + _ + "*(even|odd|(([+-]|)(\\d*)n|)" + _ + "*(?:([+-]|)" + _ + "*(\\d+)|))" + _ + "*\\)|)", "i"), needsContext: RegExp("^" + _ + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + _ + "*((?:-\\d)?\\d*)" + _ + "*\\)|)(?=[^-]|$)", "i")}, V = /[\x20\t\r\n\f]*[+~]/, Y = /^[^{]+\{\s*\[native code/, J = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/, G = /^(?:input|select|textarea|button)$/i, Q = /^h\d$/i, K = /'|\\/g, Z = /\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g, et = /\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g, tt = function (e, t) {
            var n = "0x" + t - 65536;
            return n !== n ? t : 0 > n ? String.fromCharCode(n + 65536) : String.fromCharCode(55296 | n >> 10, 56320 | 1023 & n)
        };
        try {
            q.call(w.documentElement.childNodes, 0)[0].nodeType
        } catch (nt) {
            q = function (e) {
                var t, n = [];
                while (t = this[e++])n.push(t);
                return n
            }
        }
        function rt(e) {
            return Y.test(e + "")
        }

        function it() {
            var e, t = [];
            return e = function (n, r) {
                return t.push(n += " ") > i.cacheLength && delete e[t.shift()], e[n] = r
            }
        }

        function ot(e) {
            return e[x] = !0, e
        }

        function at(e) {
            var t = p.createElement("div");
            try {
                return e(t)
            } catch (n) {
                return!1
            } finally {
                t = null
            }
        }

        function st(e, t, n, r) {
            var i, o, a, s, u, l, f, g, m, v;
            if ((t ? t.ownerDocument || t : w) !== p && c(t), t = t || p, n = n || [], !e || "string" != typeof e)return n;
            if (1 !== (s = t.nodeType) && 9 !== s)return[];
            if (!d && !r) {
                if (i = J.exec(e))if (a = i[1]) {
                    if (9 === s) {
                        if (o = t.getElementById(a), !o || !o.parentNode)return n;
                        if (o.id === a)return n.push(o), n
                    } else if (t.ownerDocument && (o = t.ownerDocument.getElementById(a)) && y(t, o) && o.id === a)return n.push(o), n
                } else {
                    if (i[2])return H.apply(n, q.call(t.getElementsByTagName(e), 0)), n;
                    if ((a = i[3]) && T.getByClassName && t.getElementsByClassName)return H.apply(n, q.call(t.getElementsByClassName(a), 0)), n
                }
                if (T.qsa && !h.test(e)) {
                    if (f = !0, g = x, m = t, v = 9 === s && e, 1 === s && "object" !== t.nodeName.toLowerCase()) {
                        l = ft(e), (f = t.getAttribute("id")) ? g = f.replace(K, "\\$&") : t.setAttribute("id", g), g = "[id='" + g + "'] ", u = l.length;
                        while (u--)l[u] = g + dt(l[u]);
                        m = V.test(e) && t.parentNode || t, v = l.join(",")
                    }
                    if (v)try {
                        return H.apply(n, q.call(m.querySelectorAll(v), 0)), n
                    } catch (b) {
                    } finally {
                        f || t.removeAttribute("id")
                    }
                }
            }
            return wt(e.replace(W, "$1"), t, n, r)
        }

        a = st.isXML = function (e) {
            var t = e && (e.ownerDocument || e).documentElement;
            return t ? "HTML" !== t.nodeName : !1
        }, c = st.setDocument = function (e) {
            var n = e ? e.ownerDocument || e : w;
            return n !== p && 9 === n.nodeType && n.documentElement ? (p = n, f = n.documentElement, d = a(n), T.tagNameNoComments = at(function (e) {
                return e.appendChild(n.createComment("")), !e.getElementsByTagName("*").length
            }), T.attributes = at(function (e) {
                e.innerHTML = "<select></select>";
                var t = typeof e.lastChild.getAttribute("multiple");
                return"boolean" !== t && "string" !== t
            }), T.getByClassName = at(function (e) {
                return e.innerHTML = "<div class='hidden e'></div><div class='hidden'></div>", e.getElementsByClassName && e.getElementsByClassName("e").length ? (e.lastChild.className = "e", 2 === e.getElementsByClassName("e").length) : !1
            }), T.getByName = at(function (e) {
                e.id = x + 0, e.innerHTML = "<a name='" + x + "'></a><div name='" + x + "'></div>", f.insertBefore(e, f.firstChild);
                var t = n.getElementsByName && n.getElementsByName(x).length === 2 + n.getElementsByName(x + 0).length;
                return T.getIdNotName = !n.getElementById(x), f.removeChild(e), t
            }), i.attrHandle = at(function (e) {
                return e.innerHTML = "<a href='#'></a>", e.firstChild && typeof e.firstChild.getAttribute !== A && "#" === e.firstChild.getAttribute("href")
            }) ? {} : {href: function (e) {
                return e.getAttribute("href", 2)
            }, type: function (e) {
                return e.getAttribute("type")
            }}, T.getIdNotName ? (i.find.ID = function (e, t) {
                if (typeof t.getElementById !== A && !d) {
                    var n = t.getElementById(e);
                    return n && n.parentNode ? [n] : []
                }
            }, i.filter.ID = function (e) {
                var t = e.replace(et, tt);
                return function (e) {
                    return e.getAttribute("id") === t
                }
            }) : (i.find.ID = function (e, n) {
                if (typeof n.getElementById !== A && !d) {
                    var r = n.getElementById(e);
                    return r ? r.id === e || typeof r.getAttributeNode !== A && r.getAttributeNode("id").value === e ? [r] : t : []
                }
            }, i.filter.ID = function (e) {
                var t = e.replace(et, tt);
                return function (e) {
                    var n = typeof e.getAttributeNode !== A && e.getAttributeNode("id");
                    return n && n.value === t
                }
            }), i.find.TAG = T.tagNameNoComments ? function (e, n) {
                return typeof n.getElementsByTagName !== A ? n.getElementsByTagName(e) : t
            } : function (e, t) {
                var n, r = [], i = 0, o = t.getElementsByTagName(e);
                if ("*" === e) {
                    while (n = o[i++])1 === n.nodeType && r.push(n);
                    return r
                }
                return o
            }, i.find.NAME = T.getByName && function (e, n) {
                return typeof n.getElementsByName !== A ? n.getElementsByName(name) : t
            }, i.find.CLASS = T.getByClassName && function (e, n) {
                return typeof n.getElementsByClassName === A || d ? t : n.getElementsByClassName(e)
            }, g = [], h = [":focus"], (T.qsa = rt(n.querySelectorAll)) && (at(function (e) {
                e.innerHTML = "<select><option selected=''></option></select>", e.querySelectorAll("[selected]").length || h.push("\\[" + _ + "*(?:checked|disabled|ismap|multiple|readonly|selected|value)"), e.querySelectorAll(":checked").length || h.push(":checked")
            }), at(function (e) {
                e.innerHTML = "<input type='hidden' i=''/>", e.querySelectorAll("[i^='']").length && h.push("[*^$]=" + _ + "*(?:\"\"|'')"), e.querySelectorAll(":enabled").length || h.push(":enabled", ":disabled"), e.querySelectorAll("*,:x"), h.push(",.*:")
            })), (T.matchesSelector = rt(m = f.matchesSelector || f.mozMatchesSelector || f.webkitMatchesSelector || f.oMatchesSelector || f.msMatchesSelector)) && at(function (e) {
                T.disconnectedMatch = m.call(e, "div"), m.call(e, "[s!='']:x"), g.push("!=", R)
            }), h = RegExp(h.join("|")), g = RegExp(g.join("|")), y = rt(f.contains) || f.compareDocumentPosition ? function (e, t) {
                var n = 9 === e.nodeType ? e.documentElement : e, r = t && t.parentNode;
                return e === r || !(!r || 1 !== r.nodeType || !(n.contains ? n.contains(r) : e.compareDocumentPosition && 16 & e.compareDocumentPosition(r)))
            } : function (e, t) {
                if (t)while (t = t.parentNode)if (t === e)return!0;
                return!1
            }, v = f.compareDocumentPosition ? function (e, t) {
                var r;
                return e === t ? (u = !0, 0) : (r = t.compareDocumentPosition && e.compareDocumentPosition && e.compareDocumentPosition(t)) ? 1 & r || e.parentNode && 11 === e.parentNode.nodeType ? e === n || y(w, e) ? -1 : t === n || y(w, t) ? 1 : 0 : 4 & r ? -1 : 1 : e.compareDocumentPosition ? -1 : 1
            } : function (e, t) {
                var r, i = 0, o = e.parentNode, a = t.parentNode, s = [e], l = [t];
                if (e === t)return u = !0, 0;
                if (!o || !a)return e === n ? -1 : t === n ? 1 : o ? -1 : a ? 1 : 0;
                if (o === a)return ut(e, t);
                r = e;
                while (r = r.parentNode)s.unshift(r);
                r = t;
                while (r = r.parentNode)l.unshift(r);
                while (s[i] === l[i])i++;
                return i ? ut(s[i], l[i]) : s[i] === w ? -1 : l[i] === w ? 1 : 0
            }, u = !1, [0, 0].sort(v), T.detectDuplicates = u, p) : p
        }, st.matches = function (e, t) {
            return st(e, null, null, t)
        }, st.matchesSelector = function (e, t) {
            if ((e.ownerDocument || e) !== p && c(e), t = t.replace(Z, "='$1']"), !(!T.matchesSelector || d || g && g.test(t) || h.test(t)))try {
                var n = m.call(e, t);
                if (n || T.disconnectedMatch || e.document && 11 !== e.document.nodeType)return n
            } catch (r) {
            }
            return st(t, p, null, [e]).length > 0
        }, st.contains = function (e, t) {
            return(e.ownerDocument || e) !== p && c(e), y(e, t)
        }, st.attr = function (e, t) {
            var n;
            return(e.ownerDocument || e) !== p && c(e), d || (t = t.toLowerCase()), (n = i.attrHandle[t]) ? n(e) : d || T.attributes ? e.getAttribute(t) : ((n = e.getAttributeNode(t)) || e.getAttribute(t)) && e[t] === !0 ? t : n && n.specified ? n.value : null
        }, st.error = function (e) {
            throw Error("Syntax error, unrecognized expression: " + e)
        }, st.uniqueSort = function (e) {
            var t, n = [], r = 1, i = 0;
            if (u = !T.detectDuplicates, e.sort(v), u) {
                for (; t = e[r]; r++)t === e[r - 1] && (i = n.push(r));
                while (i--)e.splice(n[i], 1)
            }
            return e
        };
        function ut(e, t) {
            var n = t && e, r = n && (~t.sourceIndex || j) - (~e.sourceIndex || j);
            if (r)return r;
            if (n)while (n = n.nextSibling)if (n === t)return-1;
            return e ? 1 : -1
        }

        function lt(e) {
            return function (t) {
                var n = t.nodeName.toLowerCase();
                return"input" === n && t.type === e
            }
        }

        function ct(e) {
            return function (t) {
                var n = t.nodeName.toLowerCase();
                return("input" === n || "button" === n) && t.type === e
            }
        }

        function pt(e) {
            return ot(function (t) {
                return t = +t, ot(function (n, r) {
                    var i, o = e([], n.length, t), a = o.length;
                    while (a--)n[i = o[a]] && (n[i] = !(r[i] = n[i]))
                })
            })
        }

        o = st.getText = function (e) {
            var t, n = "", r = 0, i = e.nodeType;
            if (i) {
                if (1 === i || 9 === i || 11 === i) {
                    if ("string" == typeof e.textContent)return e.textContent;
                    for (e = e.firstChild; e; e = e.nextSibling)n += o(e)
                } else if (3 === i || 4 === i)return e.nodeValue
            } else for (; t = e[r]; r++)n += o(t);
            return n
        }, i = st.selectors = {cacheLength: 50, createPseudo: ot, match: U, find: {}, relative: {">": {dir: "parentNode", first: !0}, " ": {dir: "parentNode"}, "+": {dir: "previousSibling", first: !0}, "~": {dir: "previousSibling"}}, preFilter: {ATTR: function (e) {
            return e[1] = e[1].replace(et, tt), e[3] = (e[4] || e[5] || "").replace(et, tt), "~=" === e[2] && (e[3] = " " + e[3] + " "), e.slice(0, 4)
        }, CHILD: function (e) {
            return e[1] = e[1].toLowerCase(), "nth" === e[1].slice(0, 3) ? (e[3] || st.error(e[0]), e[4] = +(e[4] ? e[5] + (e[6] || 1) : 2 * ("even" === e[3] || "odd" === e[3])), e[5] = +(e[7] + e[8] || "odd" === e[3])) : e[3] && st.error(e[0]), e
        }, PSEUDO: function (e) {
            var t, n = !e[5] && e[2];
            return U.CHILD.test(e[0]) ? null : (e[4] ? e[2] = e[4] : n && z.test(n) && (t = ft(n, !0)) && (t = n.indexOf(")", n.length - t) - n.length) && (e[0] = e[0].slice(0, t), e[2] = n.slice(0, t)), e.slice(0, 3))
        }}, filter: {TAG: function (e) {
            return"*" === e ? function () {
                return!0
            } : (e = e.replace(et, tt).toLowerCase(), function (t) {
                return t.nodeName && t.nodeName.toLowerCase() === e
            })
        }, CLASS: function (e) {
            var t = k[e + " "];
            return t || (t = RegExp("(^|" + _ + ")" + e + "(" + _ + "|$)")) && k(e, function (e) {
                return t.test(e.className || typeof e.getAttribute !== A && e.getAttribute("class") || "")
            })
        }, ATTR: function (e, t, n) {
            return function (r) {
                var i = st.attr(r, e);
                return null == i ? "!=" === t : t ? (i += "", "=" === t ? i === n : "!=" === t ? i !== n : "^=" === t ? n && 0 === i.indexOf(n) : "*=" === t ? n && i.indexOf(n) > -1 : "$=" === t ? n && i.slice(-n.length) === n : "~=" === t ? (" " + i + " ").indexOf(n) > -1 : "|=" === t ? i === n || i.slice(0, n.length + 1) === n + "-" : !1) : !0
            }
        }, CHILD: function (e, t, n, r, i) {
            var o = "nth" !== e.slice(0, 3), a = "last" !== e.slice(-4), s = "of-type" === t;
            return 1 === r && 0 === i ? function (e) {
                return!!e.parentNode
            } : function (t, n, u) {
                var l, c, p, f, d, h, g = o !== a ? "nextSibling" : "previousSibling", m = t.parentNode, y = s && t.nodeName.toLowerCase(), v = !u && !s;
                if (m) {
                    if (o) {
                        while (g) {
                            p = t;
                            while (p = p[g])if (s ? p.nodeName.toLowerCase() === y : 1 === p.nodeType)return!1;
                            h = g = "only" === e && !h && "nextSibling"
                        }
                        return!0
                    }
                    if (h = [a ? m.firstChild : m.lastChild], a && v) {
                        c = m[x] || (m[x] = {}), l = c[e] || [], d = l[0] === N && l[1], f = l[0] === N && l[2], p = d && m.childNodes[d];
                        while (p = ++d && p && p[g] || (f = d = 0) || h.pop())if (1 === p.nodeType && ++f && p === t) {
                            c[e] = [N, d, f];
                            break
                        }
                    } else if (v && (l = (t[x] || (t[x] = {}))[e]) && l[0] === N)f = l[1]; else while (p = ++d && p && p[g] || (f = d = 0) || h.pop())if ((s ? p.nodeName.toLowerCase() === y : 1 === p.nodeType) && ++f && (v && ((p[x] || (p[x] = {}))[e] = [N, f]), p === t))break;
                    return f -= i, f === r || 0 === f % r && f / r >= 0
                }
            }
        }, PSEUDO: function (e, t) {
            var n, r = i.pseudos[e] || i.setFilters[e.toLowerCase()] || st.error("unsupported pseudo: " + e);
            return r[x] ? r(t) : r.length > 1 ? (n = [e, e, "", t], i.setFilters.hasOwnProperty(e.toLowerCase()) ? ot(function (e, n) {
                var i, o = r(e, t), a = o.length;
                while (a--)i = M.call(e, o[a]), e[i] = !(n[i] = o[a])
            }) : function (e) {
                return r(e, 0, n)
            }) : r
        }}, pseudos: {not: ot(function (e) {
            var t = [], n = [], r = s(e.replace(W, "$1"));
            return r[x] ? ot(function (e, t, n, i) {
                var o, a = r(e, null, i, []), s = e.length;
                while (s--)(o = a[s]) && (e[s] = !(t[s] = o))
            }) : function (e, i, o) {
                return t[0] = e, r(t, null, o, n), !n.pop()
            }
        }), has: ot(function (e) {
            return function (t) {
                return st(e, t).length > 0
            }
        }), contains: ot(function (e) {
            return function (t) {
                return(t.textContent || t.innerText || o(t)).indexOf(e) > -1
            }
        }), lang: ot(function (e) {
            return X.test(e || "") || st.error("unsupported lang: " + e), e = e.replace(et, tt).toLowerCase(), function (t) {
                var n;
                do if (n = d ? t.getAttribute("xml:lang") || t.getAttribute("lang") : t.lang)return n = n.toLowerCase(), n === e || 0 === n.indexOf(e + "-"); while ((t = t.parentNode) && 1 === t.nodeType);
                return!1
            }
        }), target: function (t) {
            var n = e.location && e.location.hash;
            return n && n.slice(1) === t.id
        }, root: function (e) {
            return e === f
        }, focus: function (e) {
            return e === p.activeElement && (!p.hasFocus || p.hasFocus()) && !!(e.type || e.href || ~e.tabIndex)
        }, enabled: function (e) {
            return e.disabled === !1
        }, disabled: function (e) {
            return e.disabled === !0
        }, checked: function (e) {
            var t = e.nodeName.toLowerCase();
            return"input" === t && !!e.checked || "option" === t && !!e.selected
        }, selected: function (e) {
            return e.parentNode && e.parentNode.selectedIndex, e.selected === !0
        }, empty: function (e) {
            for (e = e.firstChild; e; e = e.nextSibling)if (e.nodeName > "@" || 3 === e.nodeType || 4 === e.nodeType)return!1;
            return!0
        }, parent: function (e) {
            return!i.pseudos.empty(e)
        }, header: function (e) {
            return Q.test(e.nodeName)
        }, input: function (e) {
            return G.test(e.nodeName)
        }, button: function (e) {
            var t = e.nodeName.toLowerCase();
            return"input" === t && "button" === e.type || "button" === t
        }, text: function (e) {
            var t;
            return"input" === e.nodeName.toLowerCase() && "text" === e.type && (null == (t = e.getAttribute("type")) || t.toLowerCase() === e.type)
        }, first: pt(function () {
            return[0]
        }), last: pt(function (e, t) {
            return[t - 1]
        }), eq: pt(function (e, t, n) {
            return[0 > n ? n + t : n]
        }), even: pt(function (e, t) {
            var n = 0;
            for (; t > n; n += 2)e.push(n);
            return e
        }), odd: pt(function (e, t) {
            var n = 1;
            for (; t > n; n += 2)e.push(n);
            return e
        }), lt: pt(function (e, t, n) {
            var r = 0 > n ? n + t : n;
            for (; --r >= 0;)e.push(r);
            return e
        }), gt: pt(function (e, t, n) {
            var r = 0 > n ? n + t : n;
            for (; t > ++r;)e.push(r);
            return e
        })}};
        for (n in{radio: !0, checkbox: !0, file: !0, password: !0, image: !0})i.pseudos[n] = lt(n);
        for (n in{submit: !0, reset: !0})i.pseudos[n] = ct(n);
        function ft(e, t) {
            var n, r, o, a, s, u, l, c = E[e + " "];
            if (c)return t ? 0 : c.slice(0);
            s = e, u = [], l = i.preFilter;
            while (s) {
                (!n || (r = $.exec(s))) && (r && (s = s.slice(r[0].length) || s), u.push(o = [])), n = !1, (r = I.exec(s)) && (n = r.shift(), o.push({value: n, type: r[0].replace(W, " ")}), s = s.slice(n.length));
                for (a in i.filter)!(r = U[a].exec(s)) || l[a] && !(r = l[a](r)) || (n = r.shift(), o.push({value: n, type: a, matches: r}), s = s.slice(n.length));
                if (!n)break
            }
            return t ? s.length : s ? st.error(e) : E(e, u).slice(0)
        }

        function dt(e) {
            var t = 0, n = e.length, r = "";
            for (; n > t; t++)r += e[t].value;
            return r
        }

        function ht(e, t, n) {
            var i = t.dir, o = n && "parentNode" === i, a = C++;
            return t.first ? function (t, n, r) {
                while (t = t[i])if (1 === t.nodeType || o)return e(t, n, r)
            } : function (t, n, s) {
                var u, l, c, p = N + " " + a;
                if (s) {
                    while (t = t[i])if ((1 === t.nodeType || o) && e(t, n, s))return!0
                } else while (t = t[i])if (1 === t.nodeType || o)if (c = t[x] || (t[x] = {}), (l = c[i]) && l[0] === p) {
                    if ((u = l[1]) === !0 || u === r)return u === !0
                } else if (l = c[i] = [p], l[1] = e(t, n, s) || r, l[1] === !0)return!0
            }
        }

        function gt(e) {
            return e.length > 1 ? function (t, n, r) {
                var i = e.length;
                while (i--)if (!e[i](t, n, r))return!1;
                return!0
            } : e[0]
        }

        function mt(e, t, n, r, i) {
            var o, a = [], s = 0, u = e.length, l = null != t;
            for (; u > s; s++)(o = e[s]) && (!n || n(o, r, i)) && (a.push(o), l && t.push(s));
            return a
        }

        function yt(e, t, n, r, i, o) {
            return r && !r[x] && (r = yt(r)), i && !i[x] && (i = yt(i, o)), ot(function (o, a, s, u) {
                var l, c, p, f = [], d = [], h = a.length, g = o || xt(t || "*", s.nodeType ? [s] : s, []), m = !e || !o && t ? g : mt(g, f, e, s, u), y = n ? i || (o ? e : h || r) ? [] : a : m;
                if (n && n(m, y, s, u), r) {
                    l = mt(y, d), r(l, [], s, u), c = l.length;
                    while (c--)(p = l[c]) && (y[d[c]] = !(m[d[c]] = p))
                }
                if (o) {
                    if (i || e) {
                        if (i) {
                            l = [], c = y.length;
                            while (c--)(p = y[c]) && l.push(m[c] = p);
                            i(null, y = [], l, u)
                        }
                        c = y.length;
                        while (c--)(p = y[c]) && (l = i ? M.call(o, p) : f[c]) > -1 && (o[l] = !(a[l] = p))
                    }
                } else y = mt(y === a ? y.splice(h, y.length) : y), i ? i(null, a, y, u) : H.apply(a, y)
            })
        }

        function vt(e) {
            var t, n, r, o = e.length, a = i.relative[e[0].type], s = a || i.relative[" "], u = a ? 1 : 0, c = ht(function (e) {
                return e === t
            }, s, !0), p = ht(function (e) {
                return M.call(t, e) > -1
            }, s, !0), f = [function (e, n, r) {
                return!a && (r || n !== l) || ((t = n).nodeType ? c(e, n, r) : p(e, n, r))
            }];
            for (; o > u; u++)if (n = i.relative[e[u].type])f = [ht(gt(f), n)]; else {
                if (n = i.filter[e[u].type].apply(null, e[u].matches), n[x]) {
                    for (r = ++u; o > r; r++)if (i.relative[e[r].type])break;
                    return yt(u > 1 && gt(f), u > 1 && dt(e.slice(0, u - 1)).replace(W, "$1"), n, r > u && vt(e.slice(u, r)), o > r && vt(e = e.slice(r)), o > r && dt(e))
                }
                f.push(n)
            }
            return gt(f)
        }

        function bt(e, t) {
            var n = 0, o = t.length > 0, a = e.length > 0, s = function (s, u, c, f, d) {
                var h, g, m, y = [], v = 0, b = "0", x = s && [], w = null != d, T = l, C = s || a && i.find.TAG("*", d && u.parentNode || u), k = N += null == T ? 1 : Math.random() || .1;
                for (w && (l = u !== p && u, r = n); null != (h = C[b]); b++) {
                    if (a && h) {
                        g = 0;
                        while (m = e[g++])if (m(h, u, c)) {
                            f.push(h);
                            break
                        }
                        w && (N = k, r = ++n)
                    }
                    o && ((h = !m && h) && v--, s && x.push(h))
                }
                if (v += b, o && b !== v) {
                    g = 0;
                    while (m = t[g++])m(x, y, u, c);
                    if (s) {
                        if (v > 0)while (b--)x[b] || y[b] || (y[b] = L.call(f));
                        y = mt(y)
                    }
                    H.apply(f, y), w && !s && y.length > 0 && v + t.length > 1 && st.uniqueSort(f)
                }
                return w && (N = k, l = T), x
            };
            return o ? ot(s) : s
        }

        s = st.compile = function (e, t) {
            var n, r = [], i = [], o = S[e + " "];
            if (!o) {
                t || (t = ft(e)), n = t.length;
                while (n--)o = vt(t[n]), o[x] ? r.push(o) : i.push(o);
                o = S(e, bt(i, r))
            }
            return o
        };
        function xt(e, t, n) {
            var r = 0, i = t.length;
            for (; i > r; r++)st(e, t[r], n);
            return n
        }

        function wt(e, t, n, r) {
            var o, a, u, l, c, p = ft(e);
            if (!r && 1 === p.length) {
                if (a = p[0] = p[0].slice(0), a.length > 2 && "ID" === (u = a[0]).type && 9 === t.nodeType && !d && i.relative[a[1].type]) {
                    if (t = i.find.ID(u.matches[0].replace(et, tt), t)[0], !t)return n;
                    e = e.slice(a.shift().value.length)
                }
                o = U.needsContext.test(e) ? 0 : a.length;
                while (o--) {
                    if (u = a[o], i.relative[l = u.type])break;
                    if ((c = i.find[l]) && (r = c(u.matches[0].replace(et, tt), V.test(a[0].type) && t.parentNode || t))) {
                        if (a.splice(o, 1), e = r.length && dt(a), !e)return H.apply(n, q.call(r, 0)), n;
                        break
                    }
                }
            }
            return s(e, p)(r, t, d, n, V.test(e)), n
        }

        i.pseudos.nth = i.pseudos.eq;
        function Tt() {
        }

        i.filters = Tt.prototype = i.pseudos, i.setFilters = new Tt, c(), st.attr = b.attr, b.find = st, b.expr = st.selectors, b.expr[":"] = b.expr.pseudos, b.unique = st.uniqueSort, b.text = st.getText, b.isXMLDoc = st.isXML, b.contains = st.contains
    }(e);
    var at = /Until$/, st = /^(?:parents|prev(?:Until|All))/, ut = /^.[^:#\[\.,]*$/, lt = b.expr.match.needsContext, ct = {children: !0, contents: !0, next: !0, prev: !0};
    b.fn.extend({find: function (e) {
        var t, n, r, i = this.length;
        if ("string" != typeof e)return r = this, this.pushStack(b(e).filter(function () {
            for (t = 0; i > t; t++)if (b.contains(r[t], this))return!0
        }));
        for (n = [], t = 0; i > t; t++)b.find(e, this[t], n);
        return n = this.pushStack(i > 1 ? b.unique(n) : n), n.selector = (this.selector ? this.selector + " " : "") + e, n
    }, has: function (e) {
        var t, n = b(e, this), r = n.length;
        return this.filter(function () {
            for (t = 0; r > t; t++)if (b.contains(this, n[t]))return!0
        })
    }, not: function (e) {
        return this.pushStack(ft(this, e, !1))
    }, filter: function (e) {
        return this.pushStack(ft(this, e, !0))
    }, is: function (e) {
        return!!e && ("string" == typeof e ? lt.test(e) ? b(e, this.context).index(this[0]) >= 0 : b.filter(e, this).length > 0 : this.filter(e).length > 0)
    }, closest: function (e, t) {
        var n, r = 0, i = this.length, o = [], a = lt.test(e) || "string" != typeof e ? b(e, t || this.context) : 0;
        for (; i > r; r++) {
            n = this[r];
            while (n && n.ownerDocument && n !== t && 11 !== n.nodeType) {
                if (a ? a.index(n) > -1 : b.find.matchesSelector(n, e)) {
                    o.push(n);
                    break
                }
                n = n.parentNode
            }
        }
        return this.pushStack(o.length > 1 ? b.unique(o) : o)
    }, index: function (e) {
        return e ? "string" == typeof e ? b.inArray(this[0], b(e)) : b.inArray(e.jquery ? e[0] : e, this) : this[0] && this[0].parentNode ? this.first().prevAll().length : -1
    }, add: function (e, t) {
        var n = "string" == typeof e ? b(e, t) : b.makeArray(e && e.nodeType ? [e] : e), r = b.merge(this.get(), n);
        return this.pushStack(b.unique(r))
    }, addBack: function (e) {
        return this.add(null == e ? this.prevObject : this.prevObject.filter(e))
    }}), b.fn.andSelf = b.fn.addBack;
    function pt(e, t) {
        do e = e[t]; while (e && 1 !== e.nodeType);
        return e
    }

    b.each({parent: function (e) {
        var t = e.parentNode;
        return t && 11 !== t.nodeType ? t : null
    }, parents: function (e) {
        return b.dir(e, "parentNode")
    }, parentsUntil: function (e, t, n) {
        return b.dir(e, "parentNode", n)
    }, next: function (e) {
        return pt(e, "nextSibling")
    }, prev: function (e) {
        return pt(e, "previousSibling")
    }, nextAll: function (e) {
        return b.dir(e, "nextSibling")
    }, prevAll: function (e) {
        return b.dir(e, "previousSibling")
    }, nextUntil: function (e, t, n) {
        return b.dir(e, "nextSibling", n)
    }, prevUntil: function (e, t, n) {
        return b.dir(e, "previousSibling", n)
    }, siblings: function (e) {
        return b.sibling((e.parentNode || {}).firstChild, e)
    }, children: function (e) {
        return b.sibling(e.firstChild)
    }, contents: function (e) {
        return b.nodeName(e, "iframe") ? e.contentDocument || e.contentWindow.document : b.merge([], e.childNodes)
    }}, function (e, t) {
        b.fn[e] = function (n, r) {
            var i = b.map(this, t, n);
            return at.test(e) || (r = n), r && "string" == typeof r && (i = b.filter(r, i)), i = this.length > 1 && !ct[e] ? b.unique(i) : i, this.length > 1 && st.test(e) && (i = i.reverse()), this.pushStack(i)
        }
    }), b.extend({filter: function (e, t, n) {
        return n && (e = ":not(" + e + ")"), 1 === t.length ? b.find.matchesSelector(t[0], e) ? [t[0]] : [] : b.find.matches(e, t)
    }, dir: function (e, n, r) {
        var i = [], o = e[n];
        while (o && 9 !== o.nodeType && (r === t || 1 !== o.nodeType || !b(o).is(r)))1 === o.nodeType && i.push(o), o = o[n];
        return i
    }, sibling: function (e, t) {
        var n = [];
        for (; e; e = e.nextSibling)1 === e.nodeType && e !== t && n.push(e);
        return n
    }});
    function ft(e, t, n) {
        if (t = t || 0, b.isFunction(t))return b.grep(e, function (e, r) {
            var i = !!t.call(e, r, e);
            return i === n
        });
        if (t.nodeType)return b.grep(e, function (e) {
            return e === t === n
        });
        if ("string" == typeof t) {
            var r = b.grep(e, function (e) {
                return 1 === e.nodeType
            });
            if (ut.test(t))return b.filter(t, r, !n);
            t = b.filter(t, r)
        }
        return b.grep(e, function (e) {
            return b.inArray(e, t) >= 0 === n
        })
    }

    function dt(e) {
        var t = ht.split("|"), n = e.createDocumentFragment();
        if (n.createElement)while (t.length)n.createElement(t.pop());
        return n
    }

    var ht = "abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video", gt = / jQuery\d+="(?:null|\d+)"/g, mt = RegExp("<(?:" + ht + ")[\\s/>]", "i"), yt = /^\s+/, vt = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi, bt = /<([\w:]+)/, xt = /<tbody/i, wt = /<|&#?\w+;/, Tt = /<(?:script|style|link)/i, Nt = /^(?:checkbox|radio)$/i, Ct = /checked\s*(?:[^=]|=\s*.checked.)/i, kt = /^$|\/(?:java|ecma)script/i, Et = /^true\/(.*)/, St = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g, At = {option: [1, "<select multiple='multiple'>", "</select>"], legend: [1, "<fieldset>", "</fieldset>"], area: [1, "<map>", "</map>"], param: [1, "<object>", "</object>"], thead: [1, "<table>", "</table>"], tr: [2, "<table><tbody>", "</tbody></table>"], col: [2, "<table><tbody></tbody><colgroup>", "</colgroup></table>"], td: [3, "<table><tbody><tr>", "</tr></tbody></table>"], _default: b.support.htmlSerialize ? [0, "", ""] : [1, "X<div>", "</div>"]}, jt = dt(o), Dt = jt.appendChild(o.createElement("div"));
    At.optgroup = At.option, At.tbody = At.tfoot = At.colgroup = At.caption = At.thead, At.th = At.td, b.fn.extend({text: function (e) {
        return b.access(this, function (e) {
            return e === t ? b.text(this) : this.empty().append((this[0] && this[0].ownerDocument || o).createTextNode(e))
        }, null, e, arguments.length)
    }, wrapAll: function (e) {
        if (b.isFunction(e))return this.each(function (t) {
            b(this).wrapAll(e.call(this, t))
        });
        if (this[0]) {
            var t = b(e, this[0].ownerDocument).eq(0).clone(!0);
            this[0].parentNode && t.insertBefore(this[0]), t.map(function () {
                var e = this;
                while (e.firstChild && 1 === e.firstChild.nodeType)e = e.firstChild;
                return e
            }).append(this)
        }
        return this
    }, wrapInner: function (e) {
        return b.isFunction(e) ? this.each(function (t) {
            b(this).wrapInner(e.call(this, t))
        }) : this.each(function () {
            var t = b(this), n = t.contents();
            n.length ? n.wrapAll(e) : t.append(e)
        })
    }, wrap: function (e) {
        var t = b.isFunction(e);
        return this.each(function (n) {
            b(this).wrapAll(t ? e.call(this, n) : e)
        })
    }, unwrap: function () {
        return this.parent().each(function () {
            b.nodeName(this, "body") || b(this).replaceWith(this.childNodes)
        }).end()
    }, append: function () {
        return this.domManip(arguments, !0, function (e) {
            (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) && this.appendChild(e)
        })
    }, prepend: function () {
        return this.domManip(arguments, !0, function (e) {
            (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) && this.insertBefore(e, this.firstChild)
        })
    }, before: function () {
        return this.domManip(arguments, !1, function (e) {
            this.parentNode && this.parentNode.insertBefore(e, this)
        })
    }, after: function () {
        return this.domManip(arguments, !1, function (e) {
            this.parentNode && this.parentNode.insertBefore(e, this.nextSibling)
        })
    }, remove: function (e, t) {
        var n, r = 0;
        for (; null != (n = this[r]); r++)(!e || b.filter(e, [n]).length > 0) && (t || 1 !== n.nodeType || b.cleanData(Ot(n)), n.parentNode && (t && b.contains(n.ownerDocument, n) && Mt(Ot(n, "script")), n.parentNode.removeChild(n)));
        return this
    }, empty: function () {
        var e, t = 0;
        for (; null != (e = this[t]); t++) {
            1 === e.nodeType && b.cleanData(Ot(e, !1));
            while (e.firstChild)e.removeChild(e.firstChild);
            e.options && b.nodeName(e, "select") && (e.options.length = 0)
        }
        return this
    }, clone: function (e, t) {
        return e = null == e ? !1 : e, t = null == t ? e : t, this.map(function () {
            return b.clone(this, e, t)
        })
    }, html: function (e) {
        return b.access(this, function (e) {
            var n = this[0] || {}, r = 0, i = this.length;
            if (e === t)return 1 === n.nodeType ? n.innerHTML.replace(gt, "") : t;
            if (!("string" != typeof e || Tt.test(e) || !b.support.htmlSerialize && mt.test(e) || !b.support.leadingWhitespace && yt.test(e) || At[(bt.exec(e) || ["", ""])[1].toLowerCase()])) {
                e = e.replace(vt, "<$1></$2>");
                try {
                    for (; i > r; r++)n = this[r] || {}, 1 === n.nodeType && (b.cleanData(Ot(n, !1)), n.innerHTML = e);
                    n = 0
                } catch (o) {
                }
            }
            n && this.empty().append(e)
        }, null, e, arguments.length)
    }, replaceWith: function (e) {
        var t = b.isFunction(e);
        return t || "string" == typeof e || (e = b(e).not(this).detach()), this.domManip([e], !0, function (e) {
            var t = this.nextSibling, n = this.parentNode;
            n && (b(this).remove(), n.insertBefore(e, t))
        })
    }, detach: function (e) {
        return this.remove(e, !0)
    }, domManip: function (e, n, r) {
        e = f.apply([], e);
        var i, o, a, s, u, l, c = 0, p = this.length, d = this, h = p - 1, g = e[0], m = b.isFunction(g);
        if (m || !(1 >= p || "string" != typeof g || b.support.checkClone) && Ct.test(g))return this.each(function (i) {
            var o = d.eq(i);
            m && (e[0] = g.call(this, i, n ? o.html() : t)), o.domManip(e, n, r)
        });
        if (p && (l = b.buildFragment(e, this[0].ownerDocument, !1, this), i = l.firstChild, 1 === l.childNodes.length && (l = i), i)) {
            for (n = n && b.nodeName(i, "tr"), s = b.map(Ot(l, "script"), Ht), a = s.length; p > c; c++)o = l, c !== h && (o = b.clone(o, !0, !0), a && b.merge(s, Ot(o, "script"))), r.call(n && b.nodeName(this[c], "table") ? Lt(this[c], "tbody") : this[c], o, c);
            if (a)for (u = s[s.length - 1].ownerDocument, b.map(s, qt), c = 0; a > c; c++)o = s[c], kt.test(o.type || "") && !b._data(o, "globalEval") && b.contains(u, o) && (o.src ? b.ajax({url: o.src, type: "GET", dataType: "script", async: !1, global: !1, "throws": !0}) : b.globalEval((o.text || o.textContent || o.innerHTML || "").replace(St, "")));
            l = i = null
        }
        return this
    }});
    function Lt(e, t) {
        return e.getElementsByTagName(t)[0] || e.appendChild(e.ownerDocument.createElement(t))
    }

    function Ht(e) {
        var t = e.getAttributeNode("type");
        return e.type = (t && t.specified) + "/" + e.type, e
    }

    function qt(e) {
        var t = Et.exec(e.type);
        return t ? e.type = t[1] : e.removeAttribute("type"), e
    }

    function Mt(e, t) {
        var n, r = 0;
        for (; null != (n = e[r]); r++)b._data(n, "globalEval", !t || b._data(t[r], "globalEval"))
    }

    function _t(e, t) {
        if (1 === t.nodeType && b.hasData(e)) {
            var n, r, i, o = b._data(e), a = b._data(t, o), s = o.events;
            if (s) {
                delete a.handle, a.events = {};
                for (n in s)for (r = 0, i = s[n].length; i > r; r++)b.event.add(t, n, s[n][r])
            }
            a.data && (a.data = b.extend({}, a.data))
        }
    }

    function Ft(e, t) {
        var n, r, i;
        if (1 === t.nodeType) {
            if (n = t.nodeName.toLowerCase(), !b.support.noCloneEvent && t[b.expando]) {
                i = b._data(t);
                for (r in i.events)b.removeEvent(t, r, i.handle);
                t.removeAttribute(b.expando)
            }
            "script" === n && t.text !== e.text ? (Ht(t).text = e.text, qt(t)) : "object" === n ? (t.parentNode && (t.outerHTML = e.outerHTML), b.support.html5Clone && e.innerHTML && !b.trim(t.innerHTML) && (t.innerHTML = e.innerHTML)) : "input" === n && Nt.test(e.type) ? (t.defaultChecked = t.checked = e.checked, t.value !== e.value && (t.value = e.value)) : "option" === n ? t.defaultSelected = t.selected = e.defaultSelected : ("input" === n || "textarea" === n) && (t.defaultValue = e.defaultValue)
        }
    }

    b.each({appendTo: "append", prependTo: "prepend", insertBefore: "before", insertAfter: "after", replaceAll: "replaceWith"}, function (e, t) {
        b.fn[e] = function (e) {
            var n, r = 0, i = [], o = b(e), a = o.length - 1;
            for (; a >= r; r++)n = r === a ? this : this.clone(!0), b(o[r])[t](n), d.apply(i, n.get());
            return this.pushStack(i)
        }
    });
    function Ot(e, n) {
        var r, o, a = 0, s = typeof e.getElementsByTagName !== i ? e.getElementsByTagName(n || "*") : typeof e.querySelectorAll !== i ? e.querySelectorAll(n || "*") : t;
        if (!s)for (s = [], r = e.childNodes || e; null != (o = r[a]); a++)!n || b.nodeName(o, n) ? s.push(o) : b.merge(s, Ot(o, n));
        return n === t || n && b.nodeName(e, n) ? b.merge([e], s) : s
    }

    function Bt(e) {
        Nt.test(e.type) && (e.defaultChecked = e.checked)
    }

    b.extend({clone: function (e, t, n) {
        var r, i, o, a, s, u = b.contains(e.ownerDocument, e);
        if (b.support.html5Clone || b.isXMLDoc(e) || !mt.test("<" + e.nodeName + ">") ? o = e.cloneNode(!0) : (Dt.innerHTML = e.outerHTML, Dt.removeChild(o = Dt.firstChild)), !(b.support.noCloneEvent && b.support.noCloneChecked || 1 !== e.nodeType && 11 !== e.nodeType || b.isXMLDoc(e)))for (r = Ot(o), s = Ot(e), a = 0; null != (i = s[a]); ++a)r[a] && Ft(i, r[a]);
        if (t)if (n)for (s = s || Ot(e), r = r || Ot(o), a = 0; null != (i = s[a]); a++)_t(i, r[a]); else _t(e, o);
        return r = Ot(o, "script"), r.length > 0 && Mt(r, !u && Ot(e, "script")), r = s = i = null, o
    }, buildFragment: function (e, t, n, r) {
        var i, o, a, s, u, l, c, p = e.length, f = dt(t), d = [], h = 0;
        for (; p > h; h++)if (o = e[h], o || 0 === o)if ("object" === b.type(o))b.merge(d, o.nodeType ? [o] : o); else if (wt.test(o)) {
            s = s || f.appendChild(t.createElement("div")), u = (bt.exec(o) || ["", ""])[1].toLowerCase(), c = At[u] || At._default, s.innerHTML = c[1] + o.replace(vt, "<$1></$2>") + c[2], i = c[0];
            while (i--)s = s.lastChild;
            if (!b.support.leadingWhitespace && yt.test(o) && d.push(t.createTextNode(yt.exec(o)[0])), !b.support.tbody) {
                o = "table" !== u || xt.test(o) ? "<table>" !== c[1] || xt.test(o) ? 0 : s : s.firstChild, i = o && o.childNodes.length;
                while (i--)b.nodeName(l = o.childNodes[i], "tbody") && !l.childNodes.length && o.removeChild(l)
            }
            b.merge(d, s.childNodes), s.textContent = "";
            while (s.firstChild)s.removeChild(s.firstChild);
            s = f.lastChild
        } else d.push(t.createTextNode(o));
        s && f.removeChild(s), b.support.appendChecked || b.grep(Ot(d, "input"), Bt), h = 0;
        while (o = d[h++])if ((!r || -1 === b.inArray(o, r)) && (a = b.contains(o.ownerDocument, o), s = Ot(f.appendChild(o), "script"), a && Mt(s), n)) {
            i = 0;
            while (o = s[i++])kt.test(o.type || "") && n.push(o)
        }
        return s = null, f
    }, cleanData: function (e, t) {
        var n, r, o, a, s = 0, u = b.expando, l = b.cache, p = b.support.deleteExpando, f = b.event.special;
        for (; null != (n = e[s]); s++)if ((t || b.acceptData(n)) && (o = n[u], a = o && l[o])) {
            if (a.events)for (r in a.events)f[r] ? b.event.remove(n, r) : b.removeEvent(n, r, a.handle);
            l[o] && (delete l[o], p ? delete n[u] : typeof n.removeAttribute !== i ? n.removeAttribute(u) : n[u] = null, c.push(o))
        }
    }});
    var Pt, Rt, Wt, $t = /alpha\([^)]*\)/i, It = /opacity\s*=\s*([^)]*)/, zt = /^(top|right|bottom|left)$/, Xt = /^(none|table(?!-c[ea]).+)/, Ut = /^margin/, Vt = RegExp("^(" + x + ")(.*)$", "i"), Yt = RegExp("^(" + x + ")(?!px)[a-z%]+$", "i"), Jt = RegExp("^([+-])=(" + x + ")", "i"), Gt = {BODY: "block"}, Qt = {position: "absolute", visibility: "hidden", display: "block"}, Kt = {letterSpacing: 0, fontWeight: 400}, Zt = ["Top", "Right", "Bottom", "Left"], en = ["Webkit", "O", "Moz", "ms"];

    function tn(e, t) {
        if (t in e)return t;
        var n = t.charAt(0).toUpperCase() + t.slice(1), r = t, i = en.length;
        while (i--)if (t = en[i] + n, t in e)return t;
        return r
    }

    function nn(e, t) {
        return e = t || e, "none" === b.css(e, "display") || !b.contains(e.ownerDocument, e)
    }

    function rn(e, t) {
        var n, r, i, o = [], a = 0, s = e.length;
        for (; s > a; a++)r = e[a], r.style && (o[a] = b._data(r, "olddisplay"), n = r.style.display, t ? (o[a] || "none" !== n || (r.style.display = ""), "" === r.style.display && nn(r) && (o[a] = b._data(r, "olddisplay", un(r.nodeName)))) : o[a] || (i = nn(r), (n && "none" !== n || !i) && b._data(r, "olddisplay", i ? n : b.css(r, "display"))));
        for (a = 0; s > a; a++)r = e[a], r.style && (t && "none" !== r.style.display && "" !== r.style.display || (r.style.display = t ? o[a] || "" : "none"));
        return e
    }

    b.fn.extend({css: function (e, n) {
        return b.access(this, function (e, n, r) {
            var i, o, a = {}, s = 0;
            if (b.isArray(n)) {
                for (o = Rt(e), i = n.length; i > s; s++)a[n[s]] = b.css(e, n[s], !1, o);
                return a
            }
            return r !== t ? b.style(e, n, r) : b.css(e, n)
        }, e, n, arguments.length > 1)
    }, show: function () {
        return rn(this, !0)
    }, hide: function () {
        return rn(this)
    }, toggle: function (e) {
        var t = "boolean" == typeof e;
        return this.each(function () {
            (t ? e : nn(this)) ? b(this).show() : b(this).hide()
        })
    }}), b.extend({cssHooks: {opacity: {get: function (e, t) {
        if (t) {
            var n = Wt(e, "opacity");
            return"" === n ? "1" : n
        }
    }}}, cssNumber: {columnCount: !0, fillOpacity: !0, fontWeight: !0, lineHeight: !0, opacity: !0, orphans: !0, widows: !0, zIndex: !0, zoom: !0}, cssProps: {"float": b.support.cssFloat ? "cssFloat" : "styleFloat"}, style: function (e, n, r, i) {
        if (e && 3 !== e.nodeType && 8 !== e.nodeType && e.style) {
            var o, a, s, u = b.camelCase(n), l = e.style;
            if (n = b.cssProps[u] || (b.cssProps[u] = tn(l, u)), s = b.cssHooks[n] || b.cssHooks[u], r === t)return s && "get"in s && (o = s.get(e, !1, i)) !== t ? o : l[n];
            if (a = typeof r, "string" === a && (o = Jt.exec(r)) && (r = (o[1] + 1) * o[2] + parseFloat(b.css(e, n)), a = "number"), !(null == r || "number" === a && isNaN(r) || ("number" !== a || b.cssNumber[u] || (r += "px"), b.support.clearCloneStyle || "" !== r || 0 !== n.indexOf("background") || (l[n] = "inherit"), s && "set"in s && (r = s.set(e, r, i)) === t)))try {
                l[n] = r
            } catch (c) {
            }
        }
    }, css: function (e, n, r, i) {
        var o, a, s, u = b.camelCase(n);
        return n = b.cssProps[u] || (b.cssProps[u] = tn(e.style, u)), s = b.cssHooks[n] || b.cssHooks[u], s && "get"in s && (a = s.get(e, !0, r)), a === t && (a = Wt(e, n, i)), "normal" === a && n in Kt && (a = Kt[n]), "" === r || r ? (o = parseFloat(a), r === !0 || b.isNumeric(o) ? o || 0 : a) : a
    }, swap: function (e, t, n, r) {
        var i, o, a = {};
        for (o in t)a[o] = e.style[o], e.style[o] = t[o];
        i = n.apply(e, r || []);
        for (o in t)e.style[o] = a[o];
        return i
    }}), e.getComputedStyle ? (Rt = function (t) {
        return e.getComputedStyle(t, null)
    }, Wt = function (e, n, r) {
        var i, o, a, s = r || Rt(e), u = s ? s.getPropertyValue(n) || s[n] : t, l = e.style;
        return s && ("" !== u || b.contains(e.ownerDocument, e) || (u = b.style(e, n)), Yt.test(u) && Ut.test(n) && (i = l.width, o = l.minWidth, a = l.maxWidth, l.minWidth = l.maxWidth = l.width = u, u = s.width, l.width = i, l.minWidth = o, l.maxWidth = a)), u
    }) : o.documentElement.currentStyle && (Rt = function (e) {
        return e.currentStyle
    }, Wt = function (e, n, r) {
        var i, o, a, s = r || Rt(e), u = s ? s[n] : t, l = e.style;
        return null == u && l && l[n] && (u = l[n]), Yt.test(u) && !zt.test(n) && (i = l.left, o = e.runtimeStyle, a = o && o.left, a && (o.left = e.currentStyle.left), l.left = "fontSize" === n ? "1em" : u, u = l.pixelLeft + "px", l.left = i, a && (o.left = a)), "" === u ? "auto" : u
    });
    function on(e, t, n) {
        var r = Vt.exec(t);
        return r ? Math.max(0, r[1] - (n || 0)) + (r[2] || "px") : t
    }

    function an(e, t, n, r, i) {
        var o = n === (r ? "border" : "content") ? 4 : "width" === t ? 1 : 0, a = 0;
        for (; 4 > o; o += 2)"margin" === n && (a += b.css(e, n + Zt[o], !0, i)), r ? ("content" === n && (a -= b.css(e, "padding" + Zt[o], !0, i)), "margin" !== n && (a -= b.css(e, "border" + Zt[o] + "Width", !0, i))) : (a += b.css(e, "padding" + Zt[o], !0, i), "padding" !== n && (a += b.css(e, "border" + Zt[o] + "Width", !0, i)));
        return a
    }

    function sn(e, t, n) {
        var r = !0, i = "width" === t ? e.offsetWidth : e.offsetHeight, o = Rt(e), a = b.support.boxSizing && "border-box" === b.css(e, "boxSizing", !1, o);
        if (0 >= i || null == i) {
            if (i = Wt(e, t, o), (0 > i || null == i) && (i = e.style[t]), Yt.test(i))return i;
            r = a && (b.support.boxSizingReliable || i === e.style[t]), i = parseFloat(i) || 0
        }
        return i + an(e, t, n || (a ? "border" : "content"), r, o) + "px"
    }

    function un(e) {
        var t = o, n = Gt[e];
        return n || (n = ln(e, t), "none" !== n && n || (Pt = (Pt || b("<iframe frameborder='0' width='0' height='0'/>").css("cssText", "display:block !important")).appendTo(t.documentElement), t = (Pt[0].contentWindow || Pt[0].contentDocument).document, t.write("<!doctype html><html><body>"), t.close(), n = ln(e, t), Pt.detach()), Gt[e] = n), n
    }

    function ln(e, t) {
        var n = b(t.createElement(e)).appendTo(t.body), r = b.css(n[0], "display");
        return n.remove(), r
    }

    b.each(["height", "width"], function (e, n) {
        b.cssHooks[n] = {get: function (e, r, i) {
            return r ? 0 === e.offsetWidth && Xt.test(b.css(e, "display")) ? b.swap(e, Qt, function () {
                return sn(e, n, i)
            }) : sn(e, n, i) : t
        }, set: function (e, t, r) {
            var i = r && Rt(e);
            return on(e, t, r ? an(e, n, r, b.support.boxSizing && "border-box" === b.css(e, "boxSizing", !1, i), i) : 0)
        }}
    }), b.support.opacity || (b.cssHooks.opacity = {get: function (e, t) {
        return It.test((t && e.currentStyle ? e.currentStyle.filter : e.style.filter) || "") ? .01 * parseFloat(RegExp.$1) + "" : t ? "1" : ""
    }, set: function (e, t) {
        var n = e.style, r = e.currentStyle, i = b.isNumeric(t) ? "alpha(opacity=" + 100 * t + ")" : "", o = r && r.filter || n.filter || "";
        n.zoom = 1, (t >= 1 || "" === t) && "" === b.trim(o.replace($t, "")) && n.removeAttribute && (n.removeAttribute("filter"), "" === t || r && !r.filter) || (n.filter = $t.test(o) ? o.replace($t, i) : o + " " + i)
    }}), b(function () {
        b.support.reliableMarginRight || (b.cssHooks.marginRight = {get: function (e, n) {
            return n ? b.swap(e, {display: "inline-block"}, Wt, [e, "marginRight"]) : t
        }}), !b.support.pixelPosition && b.fn.position && b.each(["top", "left"], function (e, n) {
            b.cssHooks[n] = {get: function (e, r) {
                return r ? (r = Wt(e, n), Yt.test(r) ? b(e).position()[n] + "px" : r) : t
            }}
        })
    }), b.expr && b.expr.filters && (b.expr.filters.hidden = function (e) {
        return 0 >= e.offsetWidth && 0 >= e.offsetHeight || !b.support.reliableHiddenOffsets && "none" === (e.style && e.style.display || b.css(e, "display"))
    }, b.expr.filters.visible = function (e) {
        return!b.expr.filters.hidden(e)
    }), b.each({margin: "", padding: "", border: "Width"}, function (e, t) {
        b.cssHooks[e + t] = {expand: function (n) {
            var r = 0, i = {}, o = "string" == typeof n ? n.split(" ") : [n];
            for (; 4 > r; r++)i[e + Zt[r] + t] = o[r] || o[r - 2] || o[0];
            return i
        }}, Ut.test(e) || (b.cssHooks[e + t].set = on)
    });
    var cn = /%20/g, pn = /\[\]$/, fn = /\r?\n/g, dn = /^(?:submit|button|image|reset|file)$/i, hn = /^(?:input|select|textarea|keygen)/i;
    b.fn.extend({serialize: function () {
        return b.param(this.serializeArray())
    }, serializeArray: function () {
        return this.map(function () {
            var e = b.prop(this, "elements");
            return e ? b.makeArray(e) : this
        }).filter(function () {
            var e = this.type;
            return this.name && !b(this).is(":disabled") && hn.test(this.nodeName) && !dn.test(e) && (this.checked || !Nt.test(e))
        }).map(function (e, t) {
            var n = b(this).val();
            return null == n ? null : b.isArray(n) ? b.map(n, function (e) {
                return{name: t.name, value: e.replace(fn, "\r\n")}
            }) : {name: t.name, value: n.replace(fn, "\r\n")}
        }).get()
    }}), b.param = function (e, n) {
        var r, i = [], o = function (e, t) {
            t = b.isFunction(t) ? t() : null == t ? "" : t, i[i.length] = encodeURIComponent(e) + "=" + encodeURIComponent(t)
        };
        if (n === t && (n = b.ajaxSettings && b.ajaxSettings.traditional), b.isArray(e) || e.jquery && !b.isPlainObject(e))b.each(e, function () {
            o(this.name, this.value)
        }); else for (r in e)gn(r, e[r], n, o);
        return i.join("&").replace(cn, "+")
    };
    function gn(e, t, n, r) {
        var i;
        if (b.isArray(t))b.each(t, function (t, i) {
            n || pn.test(e) ? r(e, i) : gn(e + "[" + ("object" == typeof i ? t : "") + "]", i, n, r)
        }); else if (n || "object" !== b.type(t))r(e, t); else for (i in t)gn(e + "[" + i + "]", t[i], n, r)
    }

    b.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "), function (e, t) {
        b.fn[t] = function (e, n) {
            return arguments.length > 0 ? this.on(t, null, e, n) : this.trigger(t)
        }
    }), b.fn.hover = function (e, t) {
        return this.mouseenter(e).mouseleave(t || e)
    };
    var mn, yn, vn = b.now(), bn = /\?/, xn = /#.*$/, wn = /([?&])_=[^&]*/, Tn = /^(.*?):[ \t]*([^\r\n]*)\r?$/gm, Nn = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/, Cn = /^(?:GET|HEAD)$/, kn = /^\/\//, En = /^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/, Sn = b.fn.load, An = {}, jn = {}, Dn = "*/".concat("*");
    try {
        yn = a.href
    } catch (Ln) {
        yn = o.createElement("a"), yn.href = "", yn = yn.href
    }
    mn = En.exec(yn.toLowerCase()) || [];
    function Hn(e) {
        return function (t, n) {
            "string" != typeof t && (n = t, t = "*");
            var r, i = 0, o = t.toLowerCase().match(w) || [];
            if (b.isFunction(n))while (r = o[i++])"+" === r[0] ? (r = r.slice(1) || "*", (e[r] = e[r] || []).unshift(n)) : (e[r] = e[r] || []).push(n)
        }
    }

    function qn(e, n, r, i) {
        var o = {}, a = e === jn;

        function s(u) {
            var l;
            return o[u] = !0, b.each(e[u] || [], function (e, u) {
                var c = u(n, r, i);
                return"string" != typeof c || a || o[c] ? a ? !(l = c) : t : (n.dataTypes.unshift(c), s(c), !1)
            }), l
        }

        return s(n.dataTypes[0]) || !o["*"] && s("*")
    }

    function Mn(e, n) {
        var r, i, o = b.ajaxSettings.flatOptions || {};
        for (i in n)n[i] !== t && ((o[i] ? e : r || (r = {}))[i] = n[i]);
        return r && b.extend(!0, e, r), e
    }

    b.fn.load = function (e, n, r) {
        if ("string" != typeof e && Sn)return Sn.apply(this, arguments);
        var i, o, a, s = this, u = e.indexOf(" ");
        return u >= 0 && (i = e.slice(u, e.length), e = e.slice(0, u)), b.isFunction(n) ? (r = n, n = t) : n && "object" == typeof n && (a = "POST"), s.length > 0 && b.ajax({url: e, type: a, dataType: "html", data: n}).done(function (e) {
            o = arguments, s.html(i ? b("<div>").append(b.parseHTML(e)).find(i) : e)
        }).complete(r && function (e, t) {
            s.each(r, o || [e.responseText, t, e])
        }), this
    }, b.each(["ajaxStart", "ajaxStop", "ajaxComplete", "ajaxError", "ajaxSuccess", "ajaxSend"], function (e, t) {
        b.fn[t] = function (e) {
            return this.on(t, e)
        }
    }), b.each(["get", "post"], function (e, n) {
        b[n] = function (e, r, i, o) {
            return b.isFunction(r) && (o = o || i, i = r, r = t), b.ajax({url: e, type: n, dataType: o, data: r, success: i})
        }
    }), b.extend({active: 0, lastModified: {}, etag: {}, ajaxSettings: {url: yn, type: "GET", isLocal: Nn.test(mn[1]), global: !0, processData: !0, async: !0, contentType: "application/x-www-form-urlencoded; charset=UTF-8", accepts: {"*": Dn, text: "text/plain", html: "text/html", xml: "application/xml, text/xml", json: "application/json, text/javascript"}, contents: {xml: /xml/, html: /html/, json: /json/}, responseFields: {xml: "responseXML", text: "responseText"}, converters: {"* text": e.String, "text html": !0, "text json": b.parseJSON, "text xml": b.parseXML}, flatOptions: {url: !0, context: !0}}, ajaxSetup: function (e, t) {
        return t ? Mn(Mn(e, b.ajaxSettings), t) : Mn(b.ajaxSettings, e)
    }, ajaxPrefilter: Hn(An), ajaxTransport: Hn(jn), ajax: function (e, n) {
        "object" == typeof e && (n = e, e = t), n = n || {};
        var r, i, o, a, s, u, l, c, p = b.ajaxSetup({}, n), f = p.context || p, d = p.context && (f.nodeType || f.jquery) ? b(f) : b.event, h = b.Deferred(), g = b.Callbacks("once memory"), m = p.statusCode || {}, y = {}, v = {}, x = 0, T = "canceled", N = {readyState: 0, getResponseHeader: function (e) {
            var t;
            if (2 === x) {
                if (!c) {
                    c = {};
                    while (t = Tn.exec(a))c[t[1].toLowerCase()] = t[2]
                }
                t = c[e.toLowerCase()]
            }
            return null == t ? null : t
        }, getAllResponseHeaders: function () {
            return 2 === x ? a : null
        }, setRequestHeader: function (e, t) {
            var n = e.toLowerCase();
            return x || (e = v[n] = v[n] || e, y[e] = t), this
        }, overrideMimeType: function (e) {
            return x || (p.mimeType = e), this
        }, statusCode: function (e) {
            var t;
            if (e)if (2 > x)for (t in e)m[t] = [m[t], e[t]]; else N.always(e[N.status]);
            return this
        }, abort: function (e) {
            var t = e || T;
            return l && l.abort(t), k(0, t), this
        }};
        if (h.promise(N).complete = g.add, N.success = N.done, N.error = N.fail, p.url = ((e || p.url || yn) + "").replace(xn, "").replace(kn, mn[1] + "//"), p.type = n.method || n.type || p.method || p.type, p.dataTypes = b.trim(p.dataType || "*").toLowerCase().match(w) || [""], null == p.crossDomain && (r = En.exec(p.url.toLowerCase()), p.crossDomain = !(!r || r[1] === mn[1] && r[2] === mn[2] && (r[3] || ("http:" === r[1] ? 80 : 443)) == (mn[3] || ("http:" === mn[1] ? 80 : 443)))), p.data && p.processData && "string" != typeof p.data && (p.data = b.param(p.data, p.traditional)), qn(An, p, n, N), 2 === x)return N;
        u = p.global, u && 0 === b.active++ && b.event.trigger("ajaxStart"), p.type = p.type.toUpperCase(), p.hasContent = !Cn.test(p.type), o = p.url, p.hasContent || (p.data && (o = p.url += (bn.test(o) ? "&" : "?") + p.data, delete p.data), p.cache === !1 && (p.url = wn.test(o) ? o.replace(wn, "$1_=" + vn++) : o + (bn.test(o) ? "&" : "?") + "_=" + vn++)), p.ifModified && (b.lastModified[o] && N.setRequestHeader("If-Modified-Since", b.lastModified[o]), b.etag[o] && N.setRequestHeader("If-None-Match", b.etag[o])), (p.data && p.hasContent && p.contentType !== !1 || n.contentType) && N.setRequestHeader("Content-Type", p.contentType), N.setRequestHeader("Accept", p.dataTypes[0] && p.accepts[p.dataTypes[0]] ? p.accepts[p.dataTypes[0]] + ("*" !== p.dataTypes[0] ? ", " + Dn + "; q=0.01" : "") : p.accepts["*"]);
        for (i in p.headers)N.setRequestHeader(i, p.headers[i]);
        if (p.beforeSend && (p.beforeSend.call(f, N, p) === !1 || 2 === x))return N.abort();
        T = "abort";
        for (i in{success: 1, error: 1, complete: 1})N[i](p[i]);
        if (l = qn(jn, p, n, N)) {
            N.readyState = 1, u && d.trigger("ajaxSend", [N, p]), p.async && p.timeout > 0 && (s = setTimeout(function () {
                N.abort("timeout")
            }, p.timeout));
            try {
                x = 1, l.send(y, k)
            } catch (C) {
                if (!(2 > x))throw C;
                k(-1, C)
            }
        } else k(-1, "No Transport");
        function k(e, n, r, i) {
            var c, y, v, w, T, C = n;
            2 !== x && (x = 2, s && clearTimeout(s), l = t, a = i || "", N.readyState = e > 0 ? 4 : 0, r && (w = _n(p, N, r)), e >= 200 && 300 > e || 304 === e ? (p.ifModified && (T = N.getResponseHeader("Last-Modified"), T && (b.lastModified[o] = T), T = N.getResponseHeader("etag"), T && (b.etag[o] = T)), 204 === e ? (c = !0, C = "nocontent") : 304 === e ? (c = !0, C = "notmodified") : (c = Fn(p, w), C = c.state, y = c.data, v = c.error, c = !v)) : (v = C, (e || !C) && (C = "error", 0 > e && (e = 0))), N.status = e, N.statusText = (n || C) + "", c ? h.resolveWith(f, [y, C, N]) : h.rejectWith(f, [N, C, v]), N.statusCode(m), m = t, u && d.trigger(c ? "ajaxSuccess" : "ajaxError", [N, p, c ? y : v]), g.fireWith(f, [N, C]), u && (d.trigger("ajaxComplete", [N, p]), --b.active || b.event.trigger("ajaxStop")))
        }

        return N
    }, getScript: function (e, n) {
        return b.get(e, t, n, "script")
    }, getJSON: function (e, t, n) {
        return b.get(e, t, n, "json")
    }});
    function _n(e, n, r) {
        var i, o, a, s, u = e.contents, l = e.dataTypes, c = e.responseFields;
        for (s in c)s in r && (n[c[s]] = r[s]);
        while ("*" === l[0])l.shift(), o === t && (o = e.mimeType || n.getResponseHeader("Content-Type"));
        if (o)for (s in u)if (u[s] && u[s].test(o)) {
            l.unshift(s);
            break
        }
        if (l[0]in r)a = l[0]; else {
            for (s in r) {
                if (!l[0] || e.converters[s + " " + l[0]]) {
                    a = s;
                    break
                }
                i || (i = s)
            }
            a = a || i
        }
        return a ? (a !== l[0] && l.unshift(a), r[a]) : t
    }

    function Fn(e, t) {
        var n, r, i, o, a = {}, s = 0, u = e.dataTypes.slice(), l = u[0];
        if (e.dataFilter && (t = e.dataFilter(t, e.dataType)), u[1])for (i in e.converters)a[i.toLowerCase()] = e.converters[i];
        for (; r = u[++s];)if ("*" !== r) {
            if ("*" !== l && l !== r) {
                if (i = a[l + " " + r] || a["* " + r], !i)for (n in a)if (o = n.split(" "), o[1] === r && (i = a[l + " " + o[0]] || a["* " + o[0]])) {
                    i === !0 ? i = a[n] : a[n] !== !0 && (r = o[0], u.splice(s--, 0, r));
                    break
                }
                if (i !== !0)if (i && e["throws"])t = i(t); else try {
                    t = i(t)
                } catch (c) {
                    return{state: "parsererror", error: i ? c : "No conversion from " + l + " to " + r}
                }
            }
            l = r
        }
        return{state: "success", data: t}
    }

    b.ajaxSetup({accepts: {script: "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"}, contents: {script: /(?:java|ecma)script/}, converters: {"text script": function (e) {
        return b.globalEval(e), e
    }}}), b.ajaxPrefilter("script", function (e) {
        e.cache === t && (e.cache = !1), e.crossDomain && (e.type = "GET", e.global = !1)
    }), b.ajaxTransport("script", function (e) {
        if (e.crossDomain) {
            var n, r = o.head || b("head")[0] || o.documentElement;
            return{send: function (t, i) {
                n = o.createElement("script"), n.async = !0, e.scriptCharset && (n.charset = e.scriptCharset), n.src = e.url, n.onload = n.onreadystatechange = function (e, t) {
                    (t || !n.readyState || /loaded|complete/.test(n.readyState)) && (n.onload = n.onreadystatechange = null, n.parentNode && n.parentNode.removeChild(n), n = null, t || i(200, "success"))
                }, r.insertBefore(n, r.firstChild)
            }, abort: function () {
                n && n.onload(t, !0)
            }}
        }
    });
    var On = [], Bn = /(=)\?(?=&|$)|\?\?/;
    b.ajaxSetup({jsonp: "callback", jsonpCallback: function () {
        var e = On.pop() || b.expando + "_" + vn++;
        return this[e] = !0, e
    }}), b.ajaxPrefilter("json jsonp", function (n, r, i) {
        var o, a, s, u = n.jsonp !== !1 && (Bn.test(n.url) ? "url" : "string" == typeof n.data && !(n.contentType || "").indexOf("application/x-www-form-urlencoded") && Bn.test(n.data) && "data");
        return u || "jsonp" === n.dataTypes[0] ? (o = n.jsonpCallback = b.isFunction(n.jsonpCallback) ? n.jsonpCallback() : n.jsonpCallback, u ? n[u] = n[u].replace(Bn, "$1" + o) : n.jsonp !== !1 && (n.url += (bn.test(n.url) ? "&" : "?") + n.jsonp + "=" + o), n.converters["script json"] = function () {
            return s || b.error(o + " was not called"), s[0]
        }, n.dataTypes[0] = "json", a = e[o], e[o] = function () {
            s = arguments
        }, i.always(function () {
            e[o] = a, n[o] && (n.jsonpCallback = r.jsonpCallback, On.push(o)), s && b.isFunction(a) && a(s[0]), s = a = t
        }), "script") : t
    });
    var Pn, Rn, Wn = 0, $n = e.ActiveXObject && function () {
        var e;
        for (e in Pn)Pn[e](t, !0)
    };

    function In() {
        try {
            return new e.XMLHttpRequest
        } catch (t) {
        }
    }

    function zn() {
        try {
            return new e.ActiveXObject("Microsoft.XMLHTTP")
        } catch (t) {
        }
    }

    b.ajaxSettings.xhr = e.ActiveXObject ? function () {
        return!this.isLocal && In() || zn()
    } : In, Rn = b.ajaxSettings.xhr(), b.support.cors = !!Rn && "withCredentials"in Rn, Rn = b.support.ajax = !!Rn, Rn && b.ajaxTransport(function (n) {
        if (!n.crossDomain || b.support.cors) {
            var r;
            return{send: function (i, o) {
                var a, s, u = n.xhr();
                if (n.username ? u.open(n.type, n.url, n.async, n.username, n.password) : u.open(n.type, n.url, n.async), n.xhrFields)for (s in n.xhrFields)u[s] = n.xhrFields[s];
                n.mimeType && u.overrideMimeType && u.overrideMimeType(n.mimeType), n.crossDomain || i["X-Requested-With"] || (i["X-Requested-With"] = "XMLHttpRequest");
                try {
                    for (s in i)u.setRequestHeader(s, i[s])
                } catch (l) {
                }
                u.send(n.hasContent && n.data || null), r = function (e, i) {
                    var s, l, c, p;
                    try {
                        if (r && (i || 4 === u.readyState))if (r = t, a && (u.onreadystatechange = b.noop, $n && delete Pn[a]), i)4 !== u.readyState && u.abort(); else {
                            p = {}, s = u.status, l = u.getAllResponseHeaders(), "string" == typeof u.responseText && (p.text = u.responseText);
                            try {
                                c = u.statusText
                            } catch (f) {
                                c = ""
                            }
                            s || !n.isLocal || n.crossDomain ? 1223 === s && (s = 204) : s = p.text ? 200 : 404
                        }
                    } catch (d) {
                        i || o(-1, d)
                    }
                    p && o(s, c, p, l)
                }, n.async ? 4 === u.readyState ? setTimeout(r) : (a = ++Wn, $n && (Pn || (Pn = {}, b(e).unload($n)), Pn[a] = r), u.onreadystatechange = r) : r()
            }, abort: function () {
                r && r(t, !0)
            }}
        }
    });
    var Xn, Un, Vn = /^(?:toggle|show|hide)$/, Yn = RegExp("^(?:([+-])=|)(" + x + ")([a-z%]*)$", "i"), Jn = /queueHooks$/, Gn = [nr], Qn = {"*": [function (e, t) {
        var n, r, i = this.createTween(e, t), o = Yn.exec(t), a = i.cur(), s = +a || 0, u = 1, l = 20;
        if (o) {
            if (n = +o[2], r = o[3] || (b.cssNumber[e] ? "" : "px"), "px" !== r && s) {
                s = b.css(i.elem, e, !0) || n || 1;
                do u = u || ".5", s /= u, b.style(i.elem, e, s + r); while (u !== (u = i.cur() / a) && 1 !== u && --l)
            }
            i.unit = r, i.start = s, i.end = o[1] ? s + (o[1] + 1) * n : n
        }
        return i
    }]};

    function Kn() {
        return setTimeout(function () {
            Xn = t
        }), Xn = b.now()
    }

    function Zn(e, t) {
        b.each(t, function (t, n) {
            var r = (Qn[t] || []).concat(Qn["*"]), i = 0, o = r.length;
            for (; o > i; i++)if (r[i].call(e, t, n))return
        })
    }

    function er(e, t, n) {
        var r, i, o = 0, a = Gn.length, s = b.Deferred().always(function () {
            delete u.elem
        }), u = function () {
            if (i)return!1;
            var t = Xn || Kn(), n = Math.max(0, l.startTime + l.duration - t), r = n / l.duration || 0, o = 1 - r, a = 0, u = l.tweens.length;
            for (; u > a; a++)l.tweens[a].run(o);
            return s.notifyWith(e, [l, o, n]), 1 > o && u ? n : (s.resolveWith(e, [l]), !1)
        }, l = s.promise({elem: e, props: b.extend({}, t), opts: b.extend(!0, {specialEasing: {}}, n), originalProperties: t, originalOptions: n, startTime: Xn || Kn(), duration: n.duration, tweens: [], createTween: function (t, n) {
            var r = b.Tween(e, l.opts, t, n, l.opts.specialEasing[t] || l.opts.easing);
            return l.tweens.push(r), r
        }, stop: function (t) {
            var n = 0, r = t ? l.tweens.length : 0;
            if (i)return this;
            for (i = !0; r > n; n++)l.tweens[n].run(1);
            return t ? s.resolveWith(e, [l, t]) : s.rejectWith(e, [l, t]), this
        }}), c = l.props;
        for (tr(c, l.opts.specialEasing); a > o; o++)if (r = Gn[o].call(l, e, c, l.opts))return r;
        return Zn(l, c), b.isFunction(l.opts.start) && l.opts.start.call(e, l), b.fx.timer(b.extend(u, {elem: e, anim: l, queue: l.opts.queue})), l.progress(l.opts.progress).done(l.opts.done, l.opts.complete).fail(l.opts.fail).always(l.opts.always)
    }

    function tr(e, t) {
        var n, r, i, o, a;
        for (i in e)if (r = b.camelCase(i), o = t[r], n = e[i], b.isArray(n) && (o = n[1], n = e[i] = n[0]), i !== r && (e[r] = n, delete e[i]), a = b.cssHooks[r], a && "expand"in a) {
            n = a.expand(n), delete e[r];
            for (i in n)i in e || (e[i] = n[i], t[i] = o)
        } else t[r] = o
    }

    b.Animation = b.extend(er, {tweener: function (e, t) {
        b.isFunction(e) ? (t = e, e = ["*"]) : e = e.split(" ");
        var n, r = 0, i = e.length;
        for (; i > r; r++)n = e[r], Qn[n] = Qn[n] || [], Qn[n].unshift(t)
    }, prefilter: function (e, t) {
        t ? Gn.unshift(e) : Gn.push(e)
    }});
    function nr(e, t, n) {
        var r, i, o, a, s, u, l, c, p, f = this, d = e.style, h = {}, g = [], m = e.nodeType && nn(e);
        n.queue || (c = b._queueHooks(e, "fx"), null == c.unqueued && (c.unqueued = 0, p = c.empty.fire, c.empty.fire = function () {
            c.unqueued || p()
        }), c.unqueued++, f.always(function () {
            f.always(function () {
                c.unqueued--, b.queue(e, "fx").length || c.empty.fire()
            })
        })), 1 === e.nodeType && ("height"in t || "width"in t) && (n.overflow = [d.overflow, d.overflowX, d.overflowY], "inline" === b.css(e, "display") && "none" === b.css(e, "float") && (b.support.inlineBlockNeedsLayout && "inline" !== un(e.nodeName) ? d.zoom = 1 : d.display = "inline-block")), n.overflow && (d.overflow = "hidden", b.support.shrinkWrapBlocks || f.always(function () {
            d.overflow = n.overflow[0], d.overflowX = n.overflow[1], d.overflowY = n.overflow[2]
        }));
        for (i in t)if (a = t[i], Vn.exec(a)) {
            if (delete t[i], u = u || "toggle" === a, a === (m ? "hide" : "show"))continue;
            g.push(i)
        }
        if (o = g.length) {
            s = b._data(e, "fxshow") || b._data(e, "fxshow", {}), "hidden"in s && (m = s.hidden), u && (s.hidden = !m), m ? b(e).show() : f.done(function () {
                b(e).hide()
            }), f.done(function () {
                var t;
                b._removeData(e, "fxshow");
                for (t in h)b.style(e, t, h[t])
            });
            for (i = 0; o > i; i++)r = g[i], l = f.createTween(r, m ? s[r] : 0), h[r] = s[r] || b.style(e, r), r in s || (s[r] = l.start, m && (l.end = l.start, l.start = "width" === r || "height" === r ? 1 : 0))
        }
    }

    function rr(e, t, n, r, i) {
        return new rr.prototype.init(e, t, n, r, i)
    }

    b.Tween = rr, rr.prototype = {constructor: rr, init: function (e, t, n, r, i, o) {
        this.elem = e, this.prop = n, this.easing = i || "swing", this.options = t, this.start = this.now = this.cur(), this.end = r, this.unit = o || (b.cssNumber[n] ? "" : "px")
    }, cur: function () {
        var e = rr.propHooks[this.prop];
        return e && e.get ? e.get(this) : rr.propHooks._default.get(this)
    }, run: function (e) {
        var t, n = rr.propHooks[this.prop];
        return this.pos = t = this.options.duration ? b.easing[this.easing](e, this.options.duration * e, 0, 1, this.options.duration) : e, this.now = (this.end - this.start) * t + this.start, this.options.step && this.options.step.call(this.elem, this.now, this), n && n.set ? n.set(this) : rr.propHooks._default.set(this), this
    }}, rr.prototype.init.prototype = rr.prototype, rr.propHooks = {_default: {get: function (e) {
        var t;
        return null == e.elem[e.prop] || e.elem.style && null != e.elem.style[e.prop] ? (t = b.css(e.elem, e.prop, ""), t && "auto" !== t ? t : 0) : e.elem[e.prop]
    }, set: function (e) {
        b.fx.step[e.prop] ? b.fx.step[e.prop](e) : e.elem.style && (null != e.elem.style[b.cssProps[e.prop]] || b.cssHooks[e.prop]) ? b.style(e.elem, e.prop, e.now + e.unit) : e.elem[e.prop] = e.now
    }}}, rr.propHooks.scrollTop = rr.propHooks.scrollLeft = {set: function (e) {
        e.elem.nodeType && e.elem.parentNode && (e.elem[e.prop] = e.now)
    }}, b.each(["toggle", "show", "hide"], function (e, t) {
        var n = b.fn[t];
        b.fn[t] = function (e, r, i) {
            return null == e || "boolean" == typeof e ? n.apply(this, arguments) : this.animate(ir(t, !0), e, r, i)
        }
    }), b.fn.extend({fadeTo: function (e, t, n, r) {
        return this.filter(nn).css("opacity", 0).show().end().animate({opacity: t}, e, n, r)
    }, animate: function (e, t, n, r) {
        var i = b.isEmptyObject(e), o = b.speed(t, n, r), a = function () {
            var t = er(this, b.extend({}, e), o);
            a.finish = function () {
                t.stop(!0)
            }, (i || b._data(this, "finish")) && t.stop(!0)
        };
        return a.finish = a, i || o.queue === !1 ? this.each(a) : this.queue(o.queue, a)
    }, stop: function (e, n, r) {
        var i = function (e) {
            var t = e.stop;
            delete e.stop, t(r)
        };
        return"string" != typeof e && (r = n, n = e, e = t), n && e !== !1 && this.queue(e || "fx", []), this.each(function () {
            var t = !0, n = null != e && e + "queueHooks", o = b.timers, a = b._data(this);
            if (n)a[n] && a[n].stop && i(a[n]); else for (n in a)a[n] && a[n].stop && Jn.test(n) && i(a[n]);
            for (n = o.length; n--;)o[n].elem !== this || null != e && o[n].queue !== e || (o[n].anim.stop(r), t = !1, o.splice(n, 1));
            (t || !r) && b.dequeue(this, e)
        })
    }, finish: function (e) {
        return e !== !1 && (e = e || "fx"), this.each(function () {
            var t, n = b._data(this), r = n[e + "queue"], i = n[e + "queueHooks"], o = b.timers, a = r ? r.length : 0;
            for (n.finish = !0, b.queue(this, e, []), i && i.cur && i.cur.finish && i.cur.finish.call(this), t = o.length; t--;)o[t].elem === this && o[t].queue === e && (o[t].anim.stop(!0), o.splice(t, 1));
            for (t = 0; a > t; t++)r[t] && r[t].finish && r[t].finish.call(this);
            delete n.finish
        })
    }});
    function ir(e, t) {
        var n, r = {height: e}, i = 0;
        for (t = t ? 1 : 0; 4 > i; i += 2 - t)n = Zt[i], r["margin" + n] = r["padding" + n] = e;
        return t && (r.opacity = r.width = e), r
    }

    b.each({slideDown: ir("show"), slideUp: ir("hide"), slideToggle: ir("toggle"), fadeIn: {opacity: "show"}, fadeOut: {opacity: "hide"}, fadeToggle: {opacity: "toggle"}}, function (e, t) {
        b.fn[e] = function (e, n, r) {
            return this.animate(t, e, n, r)
        }
    }), b.speed = function (e, t, n) {
        var r = e && "object" == typeof e ? b.extend({}, e) : {complete: n || !n && t || b.isFunction(e) && e, duration: e, easing: n && t || t && !b.isFunction(t) && t};
        return r.duration = b.fx.off ? 0 : "number" == typeof r.duration ? r.duration : r.duration in b.fx.speeds ? b.fx.speeds[r.duration] : b.fx.speeds._default, (null == r.queue || r.queue === !0) && (r.queue = "fx"), r.old = r.complete, r.complete = function () {
            b.isFunction(r.old) && r.old.call(this), r.queue && b.dequeue(this, r.queue)
        }, r
    }, b.easing = {linear: function (e) {
        return e
    }, swing: function (e) {
        return.5 - Math.cos(e * Math.PI) / 2
    }}, b.timers = [], b.fx = rr.prototype.init, b.fx.tick = function () {
        var e, n = b.timers, r = 0;
        for (Xn = b.now(); n.length > r; r++)e = n[r], e() || n[r] !== e || n.splice(r--, 1);
        n.length || b.fx.stop(), Xn = t
    }, b.fx.timer = function (e) {
        e() && b.timers.push(e) && b.fx.start()
    }, b.fx.interval = 13, b.fx.start = function () {
        Un || (Un = setInterval(b.fx.tick, b.fx.interval))
    }, b.fx.stop = function () {
        clearInterval(Un), Un = null
    }, b.fx.speeds = {slow: 600, fast: 200, _default: 400}, b.fx.step = {}, b.expr && b.expr.filters && (b.expr.filters.animated = function (e) {
        return b.grep(b.timers,function (t) {
            return e === t.elem
        }).length
    }), b.fn.offset = function (e) {
        if (arguments.length)return e === t ? this : this.each(function (t) {
            b.offset.setOffset(this, e, t)
        });
        var n, r, o = {top: 0, left: 0}, a = this[0], s = a && a.ownerDocument;
        if (s)return n = s.documentElement, b.contains(n, a) ? (typeof a.getBoundingClientRect !== i && (o = a.getBoundingClientRect()), r = or(s), {top: o.top + (r.pageYOffset || n.scrollTop) - (n.clientTop || 0), left: o.left + (r.pageXOffset || n.scrollLeft) - (n.clientLeft || 0)}) : o
    }, b.offset = {setOffset: function (e, t, n) {
        var r = b.css(e, "position");
        "static" === r && (e.style.position = "relative");
        var i = b(e), o = i.offset(), a = b.css(e, "top"), s = b.css(e, "left"), u = ("absolute" === r || "fixed" === r) && b.inArray("auto", [a, s]) > -1, l = {}, c = {}, p, f;
        u ? (c = i.position(), p = c.top, f = c.left) : (p = parseFloat(a) || 0, f = parseFloat(s) || 0), b.isFunction(t) && (t = t.call(e, n, o)), null != t.top && (l.top = t.top - o.top + p), null != t.left && (l.left = t.left - o.left + f), "using"in t ? t.using.call(e, l) : i.css(l)
    }}, b.fn.extend({position: function () {
        if (this[0]) {
            var e, t, n = {top: 0, left: 0}, r = this[0];
            return"fixed" === b.css(r, "position") ? t = r.getBoundingClientRect() : (e = this.offsetParent(), t = this.offset(), b.nodeName(e[0], "html") || (n = e.offset()), n.top += b.css(e[0], "borderTopWidth", !0), n.left += b.css(e[0], "borderLeftWidth", !0)), {top: t.top - n.top - b.css(r, "marginTop", !0), left: t.left - n.left - b.css(r, "marginLeft", !0)}
        }
    }, offsetParent: function () {
        return this.map(function () {
            var e = this.offsetParent || o.documentElement;
            while (e && !b.nodeName(e, "html") && "static" === b.css(e, "position"))e = e.offsetParent;
            return e || o.documentElement
        })
    }}), b.each({scrollLeft: "pageXOffset", scrollTop: "pageYOffset"}, function (e, n) {
        var r = /Y/.test(n);
        b.fn[e] = function (i) {
            return b.access(this, function (e, i, o) {
                var a = or(e);
                return o === t ? a ? n in a ? a[n] : a.document.documentElement[i] : e[i] : (a ? a.scrollTo(r ? b(a).scrollLeft() : o, r ? o : b(a).scrollTop()) : e[i] = o, t)
            }, e, i, arguments.length, null)
        }
    });
    function or(e) {
        return b.isWindow(e) ? e : 9 === e.nodeType ? e.defaultView || e.parentWindow : !1
    }

    b.each({Height: "height", Width: "width"}, function (e, n) {
        b.each({padding: "inner" + e, content: n, "": "outer" + e}, function (r, i) {
            b.fn[i] = function (i, o) {
                var a = arguments.length && (r || "boolean" != typeof i), s = r || (i === !0 || o === !0 ? "margin" : "border");
                return b.access(this, function (n, r, i) {
                    var o;
                    return b.isWindow(n) ? n.document.documentElement["client" + e] : 9 === n.nodeType ? (o = n.documentElement, Math.max(n.body["scroll" + e], o["scroll" + e], n.body["offset" + e], o["offset" + e], o["client" + e])) : i === t ? b.css(n, r, s) : b.style(n, r, i, s)
                }, n, a ? i : t, a, null)
            }
        })
    }), e.jQuery = e.$ = b, "function" == typeof define && define.amd && define.amd.jQuery && define("jquery", [], function () {
        return b
    })
})(window);
/**
 * See https://gist.github.com/jonathantneal/3748027
 */
!window.addEventListener && function (e, t, n, r, i, s, o) {
    e[r] = t[r] = n[r] = function (e, t) {
        var n = this;
        o.unshift([n, e, t, function (e) {
            e.currentTarget = n, e.preventDefault = function () {
                e.returnValue = !1
            }, e.stopPropagation = function () {
                e.cancelBubble = !0
            }, e.target = e.srcElement || n, t.call(n, e)
        }]), this.attachEvent("on" + e, o[0][3])
    }, e[i] = t[i] = n[i] = function (e, t) {
        for (var n = 0, r; r = o[n]; ++n)if (r[0] == this && r[1] == e && r[2] == t)return this.detachEvent("on" + e, o.splice(n, 1)[0][3])
    }, e[s] = t[s] = n[s] = function (e) {
        return this.fireEvent("on" + e.type, e)
    }
}(Window.prototype, HTMLDocument.prototype, Element.prototype, "addEventListener", "removeEventListener", "dispatchEvent", [])

//Drupal ('/misc/drupal.js')
// $Id: drupal.js,v 1.41.2.3 2008/06/25 09:06:57 goba Exp $
var Drupal = Drupal || { 'settings': {}, 'behaviors': {}, 'themes': {}, 'locale': {} };

/**
 * Parse a JSON response.
 *
 * The result is either the JSON object, or an object with 'status' 0 and 'data' an error message.
 */
Drupal.parseJson = function (data) {
    if ((data.substring(0, 1) != '{') && (data.substring(0, 1) != '['))
        return { status: 0, data: data.length ? data : Drupal.t('Unspecified error') };

    return eval('(' + data + ');');
};


// Code below for spb_advpoll only
Drupal.attachBehaviors = function (context) {
    context = context || document;
    //if (Drupal.jsEnabled) {
    // Execute all of them.
    jQuery.each(Drupal.behaviors, function () {
        this(context);
    });
    //}
};
// Global Killswitch on the <html> element
//if (Drupal.jsEnabled) {
// Global Killswitch on the <html> element
//$(document.documentElement).addClass('js');
// 'js enabled' cookie
//document.cookie = 'has_js=1; path=/';
// Attach all behaviors.
$(document).ready(function () {
    Drupal.attachBehaviors(this);
});
//}

//End drupal
/*

 Copyright (c) 2011-2014. Adobe Systems Incorporated.
 All rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are met:

 Redistributions of source code must retain the above copyright notice,
 this list of conditions and the following disclaimer.
 Redistributions in binary form must reproduce the above copyright notice,
 this list of conditions and the following disclaimer in the documentation
 and/or other materials provided with the distribution.
 Neither the name of Adobe Systems Incorporated nor the names of its
 contributors may be used to endorse or promote products derived from this
 software without specific prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 POSSIBILITY OF SUCH DAMAGE.

 //# sourceMappingURL=edge.6.0.0.min.map

 6.0.0.398
 */
(function (f, r, u) {
    function e(a) {
        return!a || "loaded" == a || "complete" == a || "uninitialized" == a
    }

    function p() {
        var a = c.shift();
        n = 1;
        a ? a.t ? s(function () {
            ("c" == a.t ? w.injectCss : w.injectJs)(a.s, 0, a.a, a.x, a.e, 1)
        }, 0) : (a(), p()) : n = 0
    }

    function h(g, d, m, t, v, f, h) {
        function l(a) {
            if (!z && e(y.readyState) && (q.r = z = 1, !n && p(), a)) {
                "img" != g && s(function () {
                    k.removeChild(y)
                }, 50);
                for (var b in B[d])if (B[d].hasOwnProperty(b))B[d][b].onload();
                y.onload = y.onreadystatechange = null
            }
        }

        h = h || w.errorTimeout;
        var y = r.createElement(g), z = 0, A = 0, q = {t: m, s: d,
            e: v, a: f, x: h};
        1 === B[d] && (A = 1, B[d] = []);
        "object" == g ? (y.data = d, y.setAttribute("type", "text/css")) : (y.src = d, y.type = g);
        y.width = y.height = "0";
        y.onerror = y.onload = y.onreadystatechange = function () {
            l.call(this, A)
        };
        c.splice(t, 0, q);
        "img" != g && (A || 2 === B[d] ? (P(), k.insertBefore(y, a ? null : b), s(l, h)) : B[d].push(y))
    }

    function l(a, b, g, d, k) {
        n = 0;
        b = b || "j";
        z(a) ? h("c" == b ? y : m, a, b, this.i++, g, d, k) : (c.splice(this.i++, 0, a), 1 == c.length && p());
        return this
    }

    function q() {
        var a = w;
        a.loader = {load: l, i: 0};
        return a
    }

    var x = r.documentElement, s = f.setTimeout,
        b = r.getElementsByTagName("script")[0], d = {}.toString, c = [], n = 0, v = function () {
        }, t = "MozAppearance"in x.style, a = t && !!r.createRange().compareNode, k = a ? x : b.parentNode, g = f.opera && "[object Opera]" == d.call(f.opera), g = !!r.attachEvent && !g, x = "webkitAppearance"in x.style && !("async"in r.createElement("script")), m = t ? "object" : g || x ? "script" : "img", y = g ? "script" : x ? "img" : m, A = Array.isArray || function (a) {
            return"[object Array]" == d.call(a)
        }, z = function (a) {
            return"string" == typeof a
        }, E = function (a) {
            return"[object Function]" == d.call(a)
        },
        P = function () {
            b && b.parentNode || (b = r.getElementsByTagName("script")[0])
        }, Q = [], B = {}, L = {timeout: function (a, b) {
            b.length && (a.timeout = b[0]);
            return a
        }}, M, w;
    w = function (a) {
        function b(a) {
            a = a.split("!");
            var g = Q.length, c = a.pop(), d = a.length, c = {url: c, origUrl: c, prefixes: a}, m, k, n;
            for (k = 0; k < d; k++)n = a[k].split("="), (m = L[n.shift()]) && (c = m(c, n));
            for (k = 0; k < g; k++)c = Q[k](c);
            return c
        }

        function g(a) {
            a = a.split("?")[0];
            return a.substr(a.lastIndexOf(".") + 1)
        }

        function c(a, d, m, k, n) {
            var t = b(a), e = t.autoCallback;
            g(t.url);
            if (!t.bypass) {
                d &&
                (d = E(d) ? d : d[a] || d[k] || d[a.split("/").pop().split("?")[0]]);
                if (t.instead)return t.instead(a, d, m, k, n);
                B[t.url] && !0 !== t.reexecute ? t.noexec = !0 : B[t.url] = 1;
                a && m.load(t.url, t.forceCSS || !t.forceJS && "css" == g(t.url) ? "c" : u, t.noexec, t.attrs, t.timeout);
                (E(d) || E(e)) && m.load(function () {
                    q();
                    d && d(t.origUrl, n, k);
                    e && e(t.origUrl, n, k);
                    B[t.url] = 2
                })
            }
        }

        function d(a, b) {
            function g(a, d) {
                if ("" !== a && !a)!d && e(); else if (z(a))d || (n = function () {
                    var a = [].slice.call(arguments);
                    t.apply(this, a);
                    e()
                }), c(a, n, b, 0, k); else if (Object(a) === a)for (h in f =
                    function () {
                        var b = 0, g;
                        for (g in a)a.hasOwnProperty(g) && b++;
                        return b
                    }(), a)a.hasOwnProperty(h) && (d || --f || (E(n) ? n = function () {
                    var a = [].slice.call(arguments);
                    t.apply(this, a);
                    e()
                } : n[h] = function (a) {
                    return function () {
                        var b = [].slice.call(arguments);
                        a && a.apply(this, b);
                        e()
                    }
                }(t[h])), c(a[h], n, b, h, k))
            }

            var k = !!a.test, m = a.load || a.both, n = a.callback || v, t = n, e = a.complete || v, f, h;
            g(k ? a.yep : a.nope, !!m || !!a.complete);
            m && g(m);
            !m && a.complete && g("")
        }

        var m, k, n = this.yepnope.loader;
        if (z(a))c(a, 0, n, 0); else if (A(a))for (m = 0; m < a.length; m++)k =
            a[m], z(k) ? c(k, 0, n, 0) : A(k) ? w(k) : Object(k) === k && d(k, n); else Object(a) === a && d(a, n)
    };
    w.addPrefix = function (a, b) {
        L[a] = b
    };
    w.addFilter = function (a) {
        Q.push(a)
    };
    w.errorTimeout = 1E4;
    null == r.readyState && r.addEventListener && (r.readyState = "loading", r.addEventListener("DOMContentLoaded", M = function () {
        r.removeEventListener("DOMContentLoaded", M, 0);
        r.readyState = "complete"
    }, 0));
    f.yepnope = q();
    f.yepnope.executeStack = p;
    f.yepnope.injectJs = function (a, g, c, d, m, k) {
        var n = r.createElement("script"), t, h;
        d = d || w.errorTimeout;
        n.src =
            a;
        for (h in c)n.setAttribute(h, c[h]);
        g = k ? p : g || v;
        n.onreadystatechange = n.onload = function () {
            !t && e(n.readyState) && (t = 1, g(), n.onload = n.onreadystatechange = null)
        };
        s(function () {
            t || (t = 1, g(1))
        }, d);
        P();
        m ? n.onload() : b.parentNode.insertBefore(n, b)
    };
    f.yepnope.injectCss = function (a, g, c, d, m, k) {
        d = r.createElement("link");
        var n;
        g = k ? p : g || v;
        d.href = a;
        d.rel = "stylesheet";
        d.type = "text/css";
        for (n in c)d.setAttribute(n, c[n]);
        m || (P(), b.parentNode.insertBefore(d, b), s(g, 0))
    }
})(this, document);
"function" != typeof Array.prototype.forEach && (Array.prototype.forEach = function (f) {
    for (var r = 0; r < this.length; r++)f.apply(this, [this[r], r, this])
});
"function" !== typeof String.prototype.trim && (String.prototype.trim = function () {
    return this.replace(/^\s+|\s+$/g, "")
});
var aBootcompsLoaded = [];
window.AdobeEdge = window.AdobeEdge || {};
(function (f) {
    function r(a) {
        return"[object Array]" === Object.prototype.toString.call(a)
    }

    function u(a, b) {
        var g;
        for (g = 0; a && g < a.length; g++)b[b.length++] = a[g]
    }

    function e(a, b) {
        var g, c;
        if (r(a))for (c = a.length, g = 0; g < c; g++)b(g, a[g]); else for (g in a)a.hasOwnProperty(g) && b(g, a[g])
    }

    function p(a) {
        var b = V.style, g, c;
        for (c = 0; c < a.length; c++)if (g = a[c], void 0 !== b[g])return!0;
        return!1
    }

    function h(a) {
        a = "" + a;
        if (!G.rgba && 0 == a.indexOf("rgba")) {
            var b = a.lastIndexOf(",");
            0 < b && (a = "rgb(" + a.substring(5, b) + ")")
        }
        return a
    }

    function l(a) {
        var b;
        e(a, function (a, g) {
            null !== g && (b = !0)
        });
        return!b
    }

    function q(a, b) {
        e(b, function (b, g) {
            a[b] = g
        });
        return a
    }

    function x(a) {
        var b = {};
        b.num = parseFloat(a);
        b.units = String(a).match(/[a-zA-Z%]+$/);
        r(b.units) && (b.units = b.units[0]);
        return b
    }

    function s(a) {
        return a.replace(/^-ms-/, "ms-").replace(/-([a-z]|[0-9])/ig, function (a, b) {
            return String(b).toUpperCase()
        })
    }

    function b(a) {
        var g;
        AdobeEdge.Notifier.call(this);
        this.length = 0;
        if (!a)return this;
        if (a instanceof b)return a;
        if ("string" === typeof a)if (a = a.trim(), /^#([\w\-]+)$/.test(a))(g =
            D.getElementById(a.substring(1))) && (this[this.length++] = g); else if (/<|&#?\w+;/.test(a)) {
            g = this.length++;
            var c = a;
            a = document.createElement("div");
            var d = (ma.exec(c) || ["", ""])[1].toLowerCase(), d = da[d] || da._default;
            a.innerHTML = d[1] + c.replace(na, "<$1></$2>") + d[2];
            for (c = d[0]; c--;)a = a.lastChild;
            this[g] = a
        } else u(D.querySelectorAll(a), this); else {
            g = a;
            c = g.length;
            g = null !== g && g === g.window ? !1 : 1 === g.nodeType && c ? !0 : r(g) || "function" !== typeof g && (0 === c || "number" === typeof c && 0 < c && c - 1 in g);
            if (g)return u(a, this);
            a.nodeType ?
                this[this.length++] = a : oa.call(this, a)
        }
        return this
    }

    function d(a) {
        return new b(a)
    }

    function c(a) {
        return a.parent().hasClass("center-wrapper")
    }

    function n(a) {
        c(a) || a.wrap("<div class='flow-wrapper' style='width:1px'><div class='center-wrapper'></div></div>")
    }

    function v(a, b, g, m, k, t) {
        function e() {
            var k = c(a), n = k ? a.parent().parent().parent() : a.parent(), h = n.width(), v = n.height(), f = a.width(), l = a.height(), y = d(window).height(), s = 1;
            (n = "body" === n[0].nodeName.toLowerCase()) && (v = y);
            t || (v = d(window).height(), h = d(window).width());
            h = Math.round(h);
            v = Math.round(v);
            h /= f;
            v /= l;
            "both" === b ? s = Math.min(h, v) : "height" === b ? s = v : "width" === b && (s = h);
            void 0 !== m && (s = Math.min(s, m / f));
            void 0 !== g && (s = Math.max(s, g / f));
            a.css("-o-transform-origin", "0 0");
            a.css("-ms-transform-origin", "0 0");
            a.css("-webkit-transform-origin", "0 0");
            a.css("-moz-transform-origin", "0 0");
            a.css("-o-transform-origin", "0 0");
            a.css("transform-origin", "0 0");
            v = "scale(" + s + ")";
            a.css("-o-transform", v);
            a.css("-ms-transform", v);
            a.css("-webkit-transform", v);
            a.css("-moz-transform",
                v);
            a.css("-o-transform", v);
            a.css("transform", v);
            n && !k || a.parent().height(Math.round(l * s)).width(Math.round(f * s));
            k && (k = a.parent().parent(), k.height(Math.round(l * s + a.offset().top - k.offset().top)))
        }

        k ? d.data(a[0], "alreadyWrapped") || (d.data(a[0], "alreadyWrapped", !0), d(window).bind("resize", function () {
            e()
        }), W(function () {
            e()
        })) : c(a) || (n(a), d(window).bind("resize", function () {
            e()
        }), e())
    }

    function t(a, b) {
        var g = d(a);
        c(g) && (g = g.parent());
        if ("both" === b || "horizontal" === b)g.css("position", "absolute"), g.css("margin-left",
            "auto"), g.css("margin-right", "auto"), g.css("left", "0"), g.css("right", "0");
        if ("both" === b || "vertical" === b)g.css("position", "absolute"), g.css("margin-top", "auto"), g.css("margin-bottom", "auto"), g.css("top", "0"), g.css("bottom", "0")
    }

    function a() {
        var a = this.notifier = {};
        a.obs = [];
        a.lvl = 0
    }

    function k(a, b, g) {
        if (b) {
            g || (g = {});
            g.methodName = b;
            var c = a.notifier, d = c.obs, k, m;
            c.lvl++;
            for (k = 0; k < d.length; k++)if (m = (m = d[k]) && !m.deleted ? m.o : void 0)if ("function" === typeof m)m(b, a, g); else if (m[b])m[b](a, g);
            c.lvl--;
            if (0 === c.lvl)for (a =
                                     d.length, k = a - 1; 0 <= k; k--)d[k].deleted && d.splice(k, 1)
        }
    }

    function g(a, b, g) {
        var c, d, k, m, n = g ? "" : " ", t = /\S+/g, e = /[\t\r\n\f]/g;
        if (g ? "undefined" === typeof b || "string" === typeof b && b : "string" === typeof b && b)c = (b || "").match(t) || [], a.each(function (a, t) {
            if (d = 1 === t.nodeType && (t.className ? (" " + t.className + " ").replace(e, " ") : n)) {
                for (m = 0; k = c[m++];)if (g)for (; 0 <= d.indexOf(" " + k + " ");)d = d.replace(" " + k + " ", " "); else 0 > d.indexOf(" " + k + " ") && (d += k + " ");
                t.className = g ? b ? d.trim() : "" : d.trim()
            }
        })
    }

    function m(a, b) {
        var g, c = "#" ==
            b[0], d = !c && "." == b[0], k = c || d ? b.slice(1) : b, m = /^[\w-]*$/.test(k);
        return null != a && a.nodeType == a.DOCUMENT_NODE && m && c ? (g = a.getElementById(k)) ? [g] : [] : 1 !== a.nodeType && 9 !== a.nodeType ? [] : Array.prototype.slice.call(m && !c ? d ? a.getElementsByClassName(k) : a.getElementsByTagName(b) : a.querySelectorAll(b))
    }

    function y(a, b) {
        b = b.replace(/=#\]/g, '="#"]');
        var g, c, d = pa.exec(b);
        d && d[2]in fa && (g = fa[d[2]], c = d[3], b = d[1], c && (d = Number(c), c = isNaN(d) ? c.replace(/^["']|["']$/g, "") : d));
        if (!b)return!g || g.call(a, null, c) === a;
        if (!b || !a ||
            1 !== a.nodeType)return!1;
        if (g = a.webkitMatchesSelector || a.mozMatchesSelector || a.oMatchesSelector || a.matchesSelector)return g.call(a, b);
        c = a.parentNode;
        (g = !c) && (c = tempParent).appendChild(a);
        d = ~m(c, b).indexOf(a);
        g && tempParent.removeChild(a);
        return d
    }

    function A(a) {
        a = d(a);
        return!(!a.width() && !a.height()) && "none" !== a.css("display")
    }

    function z(a, b, g) {
        function c(a) {
            g._l[b] = null;
            l(g._l) && k(g, "assetsLoaded", {inst: a.target})
        }

        if (!AdobeEdge.supported.addEventListener)return b;
        if (g && "string" === typeof b && !g._l[b])switch (a) {
            case "image":
                a =
                    new Image;
                a.addEventListener("error", c);
                a.addEventListener("load", c);
                a.src = b;
                g._l[b] = a;
                break;
            case "audio":
                a = new Audio;
                a.addEventListener("error", c);
                a.addEventListener("canplaythrough", c);
                a.src = b;
                g._l[b] = a;
                break;
            case "video":
                a = document.createElement("video"), a.addEventListener("error", c), a.addEventListener("canplaythrough", c), a.src = b, g._l[b] = a
        }
    }

    function E(a, b) {
        var g = q({name: a, conf: b, apply: function (a, b) {
            1 === this.conf.a ? a.attr(this.name, b) : (1 === this.conf.cb && (a.css("-webkit-" + this.name, b), a.css("-ms-" +
                this.name, b), a.css("-moz-" + this.name, b), a.css("-o-" + this.name, b)), a.css(this.name, b))
        }, units: function (a) {
            var b;
            "auto" !== a && this.conf.u && ("string" === typeof a && (b = x(a)), b && b.units || (a += this.conf.u));
            return a
        }, prep: function (a, b, g, c, d, k, m) {
            void 0 !== c && b[g] ? (void 0 === b[g][c] && k && (c = k), void 0 !== d && b[g][c] ? a = b[g][c][d] : (a = b[g][c], void 0 === a && (a = this.conf.d))) : a = b[g];
            void 0 !== a && (a = this.units(a), 1 === this.conf.p && z(b.type, m._getFullURL(a), m), this.conf.t && (a = this.conf.t.replace("@@0", a)));
            return a
        }, render: function (a, b, g) {
            var c = this.conf.f || this.name;
            void 0 === b[c] || void 0 !== this.conf.o && this.conf.o !== b.tag || void 0 !== this.conf.e && this.conf.e === b.tag || (c = this.prep(a, b, c, this.conf.i, this.conf.j, this.conf.ii, g), null !== c && void 0 !== c && this.apply(a, c, b, g))
        }}, E.prototype);
        E.splitUnits = x;
        b.x && (g = q(g, b.x));
        return g
    }

    function P(a) {
        e(a, function (a, b) {
            S[a] = new E(a, b)
        })
    }

    function Q(a, b, g, c, m, n, t, v) {
        var h = d(document.createElement(g.tag || "div")), f = h[0];
        AdobeEdge.$.data(f, "domDef", g);
        h.attr("id", g.id);
        h.css("position", "absolute");
        h.css("margin", "0px");
        b && g.symbolName && b._applyBaseStyles(h, g.symbolName);
        e(S, function (b, c) {
            c.render(h, g, a)
        });
        h.css("-webkit-tap-highlight-color", "rgba(0, 0, 0, 0)");
        b && b.register(f, g, b.ele ? b.ele.id : "");
        h.addClass(h.attr("id") + "_id");
        v || k(AdobeEdge, "beginEle", {sym: b, ele: f, defn: {dom: g, style: c}});
        n && h.addClass(n);
        (c = document.getElementById(f.id)) && (n = d(c).parent()) && n[0] == m && m.removeChild(c);
        m.children && 0 <= t && t < m.children.length ? m.insertBefore(f, m.children[t]) : m.appendChild(f);
        AdobeEdge.$.data(f, "originalId",
            g.id);
        AdobeEdge.$.data(f, "symParent", b);
        b && (m = f.style.webkitTransform, b.gpuAccelerate && f.style && ("undefined" === typeof m || "" === m || "none" === m) ? window.edge_authoring_mode && "BODY" === f.nodeName || (f.style.webkitTransform = "translateZ(0)") : !f.style.zIndex && window.edge_authoring_mode && (f.style.zIndex = 0));
        b && (v || k(b, "newEle", {ele: f, defn: g}));
        return h
    }

    function B(a) {
        a.t && (a.t = a.t.toLowerCase(), a.type = a.t);
        a.cs && (a.className = a.cs);
        for (var b in Y)null != a[b] && (a[Y[b]] = a[b], a[b] = null);
        a.rect || (a.rect = []);
        for (; 4 >
                   a.rect.length;)a.rect[a.rect.length] = 0;
        a.transform && (1 > a.transform.length && (a.transform[0] = [0, 0, 0]), 2 > a.transform.length && (a.transform[1] = [0, 0, 0]), 3 > a.transform.length && (a.transform[2] = [0, 0, 0]), 4 > a.transform.length && (a.transform[3] = [1, 1, 1]));
        a.children && (a.c = a.children, e(a.children, function (a, b) {
            B(b)
        }))
    }

    function L(a, b, g, c, m, n, t) {
        if (m || b || b.id)m = m || d("." + b.id)[0], e(g, function (g, d) {
            var e = Q(a, b, d, c, m, n, t++), h = {sym: b, ele: e[0], defn: d};
            d.c && L(a, b, d.c, void 0, e[0], n, 0);
            k(AdobeEdge, "endEle", h)
        })
    }

    function M(b, g, c, d, m) {
        a.call(this);
        c._s.push(this);
        q(this, {name: g, composition: c, data: b, prnt: d, tl: [], variables: m || {}});
        k(c, "newSymbol", {symbol: this, parent: d});
        return this
    }

    function w(a, b) {
        if (b && a.ci)for (var g = 0; g < a.ci.length; ++g) {
            var c = a.ci[g];
            c && w(c, b)
        }
        g = a._getTimeline() ? a._getTimeline().getState() : {playing: void 0};
        void 0 == a.autoPlay || a.autoPlay ? void 0 == g.playing && a.play(0) : void 0 == g.playing && a.stop(-1, !1)
    }

    function F(a, b) {
        var g, c;
        for (g in b)if (b.hasOwnProperty(g)) {
            c = b[g];
            c.typeName = g;
            c.v && (c.version = c.v);
            c.mv &&
            (c.minimumCompatibleVersion = c.mv);
            c.b && (c.build = c.b);
            c.bS && (c.baseState = c.bS);
            c.iS && (c.initialState = c.iS);
            null != c.gpu && (c.gpuAccelerate = c.gpu);
            null != c.rI && (c.resizeInstances = c.rI);
            c.cn && (c.content = c.cn);
            if (c.content) {
                var d = c.content;
                null != d.sI && (d.symbolInstances = c.content.sI);
                if (d.symbolInstances)for (var m = 0; m < d.symbolInstances.length; m++) {
                    var k = d.symbolInstances[m];
                    null != k.sN && (k.symbolName = k.sN);
                    null != k.a && (k.autoPlay = k.a);
                    null != k.x && (k.variables = k.x)
                }
            }
            e(c.content.dom, function (a, b) {
                B(b)
            });
            for (var n in c.content.style)c.content.style.hasOwnProperty(n) &&
            B(c.content.style[n]);
            c.cg && (c.centerStage = c.cg);
            c.stf && (c.scaleToFit = c.stf);
            c.x && (c.variables = c.x);
            c.tt && (c.timeline = c.tt);
            d = c.timeline;
            if (null != d)for (null != d.d && (d.duration = d.d), null != d.a && (d.autoPlay = d.a), d.l && (d.labels = d.l), c = 0; c < d.data.length; c++)d.data[c] && d.data[c][8] && d.data[c][8].vt && (d.data[c][8].valueTemplate = d.data[c][8].vt), d.data[c] && d.data[c][1] && "tr" === d.data[c][1] && (d.data[c][1] = Y.tr)
        }
        a.sym = b
    }

    function I(b, c) {
        a.call(this);
        this.$ = d;
        q(this, {id: b, opts: q(c || {}, aa), _urlRegExp: /^(?:[a-z]+:)?\/\//i,
            _l: {}, _d: {}, _s: [], loaded: function (a, b, c) {
                this._d[a] = null;
                l(this._d) && this.ready()
            }, load: function (a, b) {
                b || (this._d[a] = !0);
                var c = this;
                yepnope({load: this._getFullURL(a), callback: function (g, d, m) {
                    b ? b(a, d, m) : c.loaded(a, d, m)
                }})
            }, define: function (a, b, c, g, d, m) {
                F(this, b);
                this.fnt = c;
                this.res = d;
                this.fx = m;
                ja(b);
                this.registerFonts(c);
                var k = this;
                g && 0 < g.length && g.forEach(function (a) {
                    k.load(a)
                })
            }, _getFullURL: function (a) {
                return this._urlRegExp.test(a) ? a : (this.opts.htmlRoot || "") + a
            }, definePreloader: function (a) {
                this.preloaderDOM =
                    a
            }, defineDownLevelStage: function (a) {
                this.downLevelStageDOM = a
            }, getStage: function () {
                return this.stage
            }, registerFonts: function (a) {
                if (a) {
                    var b, c, g, m, k, n, t;
                    f.fonts = f.fonts || {};
                    for (n in a)if (a.hasOwnProperty(n) && !f.fonts[n] && (g = a[n]) && "" !== g) {
                        b = !1;
                        for (t in f.fonts)f.fonts.hasOwnProperty(t) && f.fonts[t] === g && (b = !0);
                        if (!b)if (f.fonts[n] = g, b = g.indexOf("//use.typekit.com/"), 0 > b && (b = g.indexOf("//use.typekit.net/")), 0 > b && (b = g.indexOf("//use.edgefonts.net/"), k = 0 < b, window._adobewebfontsappname_ = "Animate"), 0 < b)c =
                            g.indexOf('"', b + 1), 0 < c && (b = g.substring(b, c), k && "file:" === window.location.protocol && (b = "http:" + b), g = document.createElement("script"), g.src = this._getFullURL(b), g.type = "text/javascript", document.getElementsByTagName("head")[0].appendChild(g), k || (m = function () {
                            try {
                                window.Typekit.load()
                            } catch (a) {
                                window.setTimeout(m, 100)
                            }
                        }, window.setTimeout(m, 100))); else if (0 > g.indexOf("<script") && 0 > g.indexOf("<link"))d("head").append(document.createTextNode(g)); else if (0 > g.indexOf("<script"))d("head").append(g); else if (b =
                            g.indexOf(">"), c = g.indexOf("\x3c/script>"), 0 < b && 0 < c) {
                            g = g.substring(b + 1, c);
                            try {
                                window.eval(g)
                            } catch (e) {
                            }
                        }
                    }
                }
            }, getSymbols: function (a) {
                if (!a)return this._s;
                var b = [];
                e(this._s, function (g, c) {
                    c.name === a && b.push(c)
                });
                return b
            }, rC: function (a) {
                return a
            }, rR: function (a) {
                this.stage && O(this.stage, a)
            }, ready: function () {
                var a = this;
                AdobeEdge.ready(function () {
                    a.preloaderDOM && a.preloaderDOM.script && (new Function("e", a.preloaderDOM.script.loading))({event: "done", progress: 1, reason: "complete"});
                    C.AdobeEdge && C.AdobeEdge.bootstrapLoading &&
                    (c = c || {}, c.bootstrapLoading = !0);
                    window.edge_authoring_mode || (c && c.framework$ && (f.$ = c.framework$), window.jQuery && (f.$ = window.jQuery));
                    AdobeEdge.addTouchSupport();
                    a.bindingFn && a.bindingFn(f.$);
                    var b = a.stage = new M(a.sym, "stage", a), g, m = "." + a.id, k = d(m);
                    k[0] || (k = d("body").addClass(m));
                    b.init(k[0], "edgeLoad-" + a.id);
                    b._applyBaseStyles(k, "stage");
                    k.css("position", "relative");
                    if (!window.edge_authoring_mode || c.sym)if (k = b.data.stage, !k || "height" !== k.scaleToFit && "width" !== k.scaleToFit && "both" !== k.scaleToFit ||
                        n(d(m)), !k || "vertical" !== k.centerStage && "horizontal" !== k.centerStage && "both" !== k.centerStage || t(b.ele, k.centerStage), "height" === k.scaleToFit || "width" === k.scaleToFit || "both" === k.scaleToFit) {
                        var m = k.content.style["${stage}"] || k.content.style["${Stage}"], e, h, ca = /px|^0$/;
                        m && m.sizeRange && (e = m.sizeRange[0], e = ca.test(e) ? parseInt(e, 10) : void 0, h = m.sizeRange[1], h = ca.test(h) ? parseInt(h, 10) : void 0);
                        v(b.$("stage"), k.scaleToFit, e, h, !0, a.opts.bScaleToParent)
                    }
                    g = function () {
                        if (a.launchCalled || a.opts.bootstrapLoading && !f.doPlayWhenReady)f.readyAndWaiting.push(g); else {
                            a.launchCalled = !0;
                            d(".edgePreload-" + a.id).css("display", "none");
                            d(".edgeLoad-" + a.id).removeClass("edgeLoad-" + a.id);
                            aBootcompsLoaded.push(a.id);
                            for (var c = window.AdobeEdge.bootstrapListeners.length, k = 0; k < c; k++)try {
                                window.AdobeEdge.bootstrapListeners[k](a.id)
                            } catch (m) {
                                console.log("bootstrap error " + m)
                            }
                            c = d.Event("compositionReady");
                            c.compId = a.id;
                            d(document).trigger(c);
                            a.readyCalled = !0;
                            window.edge_authoring_mode ? b.stopAll(0) : w(b, !0)
                        }
                    };
                    l(a._l) ? g() : a.addObserver({assetsLoaded: function (a, b) {
                        g()
                    }})
                })
            }, getCompId: function () {
                return this.id
            }});
        return this
    }

    function N(a) {
        e(H, function (b, g) {
            a = Math.min(g.rC(a), a)
        });
        return a
    }

    function J(a, b) {
        e(H, function (g, c) {
            var d = c[b];
            d && d.call(c, a)
        })
    }

    function O(a, b) {
        if (a.ci)for (var g = 0; g < a.ci.length; ++g) {
            var c = a.ci[g];
            c && O(c, b)
        }
        a && a._getTimeline().tick(b)
    }

    function K(a) {
        a({event: "begin"})
    }

    function W(a) {
        if (U || "complete" === D.readyState)a(); else if (D.addEventListener) {
            var b = !1;
            D.addEventListener("DOMContentLoaded", function (g) {
                U = !0;
                b || (a(), b = !0)
            }, !1);
            D.onreadystatechange =
                function () {
                    "complete" == document.readyState && (U = !0);
                    D.onreadystatechange = null;
                    b || (a(), b = !0)
                }
        } else D.attachEvent && D.attachEvent("onreadystatechange", function (b) {
            U = !0;
            a(b)
        })
    }

    function R(a) {
        return a && "string" === typeof a && (0 < a.indexOf("%") || 0 < a.indexOf("em") || "auto" === a || "null" === a) ? !1 : !0
    }

    function $(a) {
        if (!a)return 0;
        if ("number" === typeof a)return a;
        var b = a.indexOf("px").val;
        return 0 < b ? (val = a.substring(0, b), parseFloat(val)) : parseFloat(a)
    }

    function X(a, b, g, c, d) {
        var k, m, n;
        for (k = 0; k < a.length; k++)m = a[k], n = "${" +
            m.id + "}", g[n] && (b[n] = !0, m.rect || (m.rect = m.r, m.r = void 0, m.rect || (m.rect = [0, 0, 0, 0])), m.rect && (m.transform || (m.transform = m.tf, m.tf = void 0, m.transform || (m.transform = [])), m.transform[0] || (m.transform[0] = [0, 0]), R(m.rect[0]) && (m.transform[0][0] = $(m.rect[0]), c[n] = m.transform[0][0], m.rect[0] = "0px"), R(m.rect[1]) && (m.transform[0][1] = $(m.rect[1]), d[n] = m.transform[0][1], m.rect[1] = "0px"))), m.children ? X(m.children, b, g, c, d) : m.c && X(m.c, b, g, c, d)
    }

    function ja(a) {
        if (!window.edge_authoring_mode)for (var b in a)if (a.hasOwnProperty(b)) {
            var g =
                a[b], c = void 0, d = void 0, m = void 0, k = void 0, n = {}, t = {}, e = {}, h = {};
            if (g.timeline)for (m = g.timeline, c = 0; c < m.data.length; c++)(k = m.data[c]) && ("left" == k[1] || "top" == k[1]) && R(k[7]) && (h[k[5]] = !0);
            g.content && g.content.dom && X(g.content.dom, e, h, n, t);
            if (g.timeline)for (m = g.timeline, c = 0; c < m.data.length; c++)(k = m.data[c]) && ("left" == k[1] || "top" == k[1]) && R(k[7]) && e[k[5]] && ("left" === k[1] ? d = "translateX" : "top" === k[1] && (d = "translateY"), k[1] = d)
        }
    }

    var D = document, C = window, S = {}, H = {}, aa = {imagesDir: "images/"}, ba, la = Array.prototype.forEach,
        T, U, ka = [], V, oa = [].push, ga = {}, da = {option: [1, "<select multiple='multiple'>", "</select>"], thead: [1, "<table>", "</table>"], col: [2, "<table><colgroup>", "</colgroup></table>"], tr: [2, "<table><tbody>", "</tbody></table>"], td: [3, "<table><tbody><tr>", "</tr></tbody></table>"], _default: [1, "", ""]}, ma = /<([\w:]+)/, na = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi, G = {}, Z = {};
    f.doPlayWhenReady = !1;
    f.readyAndWaiting = [];
    var qa = {columnCount: !0, fillOpacity: !0, fontWeight: !0, lineHeight: !0, opacity: !0,
        order: !0, orphans: !0, widows: !0, zIndex: !0, zoom: !0}, ha = {letterSpacing: 0, fontWeight: 400};
    V = document.createElement("div");
    ba = p(["transformProperty", "WebkitTransform", "MozTransform", "OTransform", "msTransform"]);
    d.each = e;
    d.extend = q;
    d.data = function (a, b, g) {
        var c = "an_" + b;
        2 < arguments.length && (a[c] = g);
        return a[c]
    };
    q(a.prototype, {addObserver: function (a) {
        if (a) {
            var b = this.notifier.obs, g, c;
            g = b.length;
            for (c = 0; c < g; c++)if (b[c].o === a)return;
            b[g] = {o: a}
        }
    }, removeObserver: function (a) {
        if (a) {
            var b = this.notifier, g = b.obs, c;
            for (c = 0; c < g.length; c++)if (g[c].o === a)if (0 === b.lvl) {
                g.splice(c, 1);
                break
            } else g[c].deleted = !0
        }
    }, notifyObservers: function (a, b) {
        return k(this, a, b)
    }, removeObservers: function () {
        var a = this.notifier ? this.notifier.obs : null;
        a && a.splice(0, a.length)
    }});
    b.expr = {};
    var fa = b.expr[":"] = {visible: function () {
        if (A(this))return this
    }, hidden: function () {
        if (!A(this))return this
    }, selected: function () {
        if (this.selected)return this
    }, checked: function () {
        if (this.checked)return this
    }, parent: function () {
        return this.parentNode
    }, first: function (a) {
        if (0 ===
            a)return this
    }, last: function (a, b) {
        if (a === b.length - 1)return this
    }, eq: function (a, b, c) {
        if (a === c)return this
    }, has: function (a, b, c) {
        if (m(this, c).length)return this
    }}, pa = /(.*):(\w+)(?:\(([^)]+)\))?$\s*/, ra = {tabindex: "tabIndex", readonly: "readOnly", "for": "htmlFor", "class": "className", maxlength: "maxLength", cellspacing: "cellSpacing", cellpadding: "cellPadding", rowspan: "rowSpan", colspan: "colSpan", usemap: "useMap", frameborder: "frameBorder", contenteditable: "contentEditable"};
    q(b.prototype, {css: function (a, b) {
        if (!(1 >
            this.length)) {
            if ("string" == typeof a) {
                var c, g = s(a);
                if (1 < arguments.length) {
                    isNaN(parseFloat(b)) || !isFinite(b) || qa[g] || (b += "px");
                    for (c = 0; c < this.length; c++)this[c].style[g] = b;
                    return this
                }
                c = C.getComputedStyle ? C.getComputedStyle(this[0])[g] || this[0].style[g] : this[0].style[g];
                "normal" === c && g in ha && (c = ha[g]);
                return c
            }
            if (r(a)) {
                var m = {}, k = this[0];
                d.each(r(a) ? a : [a], function (a, b) {
                    var c = s(b);
                    m[b] = k.style[c] || C.computedStyle.getPropertyValue(k)[c]
                });
                return m
            }
            for (g in a)this.css(g, a[g]);
            return this
        }
    }, prop: function (a, b) {
        a = ra[a] || a;
        return 1 in arguments ? this.each(function (c, g) {
            this[a] = "function" == typeof b ? b.call(this, g, this[a]) : b
        }) : this[0] && this[0][a]
    }, addClass: function (a) {
        g(this, a);
        return this
    }, removeClass: function (a) {
        g(this, a, !0);
        return this
    }, hasClass: function (a) {
        a = " " + a + " ";
        for (var b = 0, c = this.length, g = /[\t\r\n\f]/g; b < c; b++)if (1 === this[b].nodeType && 0 <= (" " + this[b].className + " ").replace(g, " ").indexOf(a))return!0;
        return!1
    }, attr: function (a, b) {
        if ("string" !== typeof a || !this.length)return null;
        if (void 0 === b)return this[0].getAttribute(a);
        this.each(function (c, g) {
            b ? this.setAttribute(a, b) : this.removeAttribute(a)
        });
        return this
    }, removeAttr: function (a) {
        if ("string" !== typeof a || !this.length)return null;
        this.each(function (b, c) {
            c.removeAttribute(a)
        });
        return this
    }, each: function (a) {
        la.call(this, function (b, c) {
            a.call(b, c, b)
        });
        return this
    }, get: function (a) {
        if (this.length && a < this.length)return this[a]
    }, _s: function (a, b) {
        if (this.length) {
            if (void 0 === a)return this[0][b];
            this.each(function (c, g) {
                this[b] = a
            });
            return this
        }
    }, parent: function () {
        var a = this[0].parentNode;
        return a && 11 !== a.nodeType ? d(a) : null
    }, parents: function () {
        for (var a = this[0], b = []; (a = a.parentNode) && 9 !== a.nodeType;)1 === a.nodeType && b.push(a);
        return b
    }, text: function (a) {
        return this._s(a, "textContent")
    }, html: function (a) {
        return this._s(a, "innerHTML")
    }, show: function () {
        return this.each(function () {
            "none" == this.style.display && (this.style.display = "");
            if ("none" == getComputedStyle(this, "").getPropertyValue("display")) {
                var a = this.style, b = this.nodeName, c, g;
                Z[b] || (c = document.createElement(b), document.body.appendChild(c),
                    g = getComputedStyle(c, "").getPropertyValue("display"), c.parentNode.removeChild(c), "none" == g && (g = "block"), Z[b] = g);
                a.display = Z[b]
            }
        })
    }, hide: function () {
        return this.css("display", "none")
    }, wrap: function (a) {
        var b = "function" == typeof a;
        if (this[0] && !b)var c = d(a).get(0), g = c.parentNode || 1 < this.length;
        return this.each(function (m) {
            d(this).wrapAll(b ? a.call(this, m) : g ? c.cloneNode(!0) : c)
        })
    }, wrapAll: function (a) {
        if (this[0]) {
            for (this[0].parentElement.insertBefore(a, this[0]); a.firstElementChild;)a = a.firstElementChild;
            d(a).append(this)
        }
        return this
    },
        dimension: function (a) {
            var b = this[0], c = a[0] ? a[0].toUpperCase() + a.substr(1) : "";
            if (b === b.window)return b.document.documentElement["client" + c];
            if (9 === b.nodeType)return Math.max(b.body["scroll" + c], D["scroll" + c], b.body["offset" + c], D["offset" + c], D["client" + c]);
            c = this.css(a) || "";
            if ("auto" != c && (c = x(c), !c.units || "px" == c.units))return c.num;
            b = b.getBoundingClientRect();
            if ("width" === a)return Math.round(b.width);
            if ("height" === a)return Math.round(b.height)
        }, width: function (a) {
            return void 0 != a ? this.css("width", a) :
                this.dimension("width")
        }, height: function (a) {
            return void 0 != a ? this.css("height", a) : this.dimension("height")
        }, offset: function () {
            if (!this.length)return null;
            var a = this[0].getBoundingClientRect();
            return{left: a.left + window.pageXOffset, top: a.top + window.pageYOffset, width: Math.round(a.width), height: Math.round(a.height)}
        }, is: function (a) {
            return 0 < this.length && y(this[0], a)
        }});
    P({opacity: {}, left: {f: "rect", i: 0, u: "px"}, top: {f: "rect", i: 1, u: "px"}, width: {f: "rect", i: 2, u: "px"}, height: {f: "rect", i: 3, u: "px"}, right: {f: "rect",
        i: 4, u: "px"}, bottom: {f: "rect", i: 5, u: "px"}, src: {o: "img", f: "fill", i: 1, a: 1, p: 1, x: {apply: function (a, b, c, g) {
        b = g ? g._getFullURL(b) : b;
        a.attr("src", b)
    }}}, poster: {f: "poster", o: "video", a: 1}, preload: {f: "preload", a: 1}, medsrc: {e: "img", f: "source", a: 1, x: {apply: function (a, b, c, g) {
        var m;
        a:{
            m = c.type;
            var k = c.preload;
            if (!AdobeEdge.isIOS) {
                var n, t;
                for (n = 0; n < b.length; n++)if (t = b[n].split("."), t = t[t.length - 1].toLowerCase(), AdobeEdge.supported[m][t]) {
                    t = !1;
                    (t = null === k || "" == k ? "auto" == ("audio" == m ? g.opts.gAudioPreloadPreference :
                        g.opts.gVideoPreloadPreference) : "auto" == k) && z(m, g._getFullURL(b[n]), g);
                    m = g._getFullURL(b[n]);
                    break a
                }
            }
            m = void 0
        }
        if (d.isArray(b) && 1 != b.length)for (m = 0; m < b.length; m++)k = document.createElement("source"), d(k).attr("src", g._getFullURL(b[m])), a.get(0).appendChild(k); else m ? a.attr("src", m) : a.attr("src", d.isArray(b) ? g._getFullURL(b[0]) : g._getFullURL(b));
        "audio" == c.tag && a.attr("controls", "block" == c.display)
    }}}, "background-image": {e: "img", f: "fill", i: 1, t: "url(@@0)", p: 1, x: {prep: function (a, b, c, g, d, m, k) {
        var n;
        b[c] &&
        (n = b[c][g]);
        void 0 !== n && (n = k._getFullURL(n), z(b.type, n, k), n = this.conf.t.replace("@@0", n));
        return n
    }}}, "background-color": {f: "fill", i: 0, x: {apply: function (a, b) {
        a.css("background-color", h(b))
    }}}, text: {x: {apply: function (a, b) {
        a.html(b)
    }}}, "min-width": {f: "sizeRange", i: 0}, "max-width": {f: "sizeRange", i: 1}, "min-height": {f: "sizeRange", i: 2}, "max-height": {f: "sizeRange", i: 3}, overflow: {x: {apply: function (a, b) {
        a.css("overflow", b);
        "hidden" !== b && "scroll" !== b || a.css("text-overflow", "clip")
    }}}, "background-repeat": {e: "img",
        f: "fill", x: {apply: function (a, b) {
            b && 1 != b.length && (d.isArray(b[1]) || a.css("background-repeat", b[6] || "no-repeat"))
        }}}, "background-attachment": {f: "fill", i: 7, x: {apply: function (a, b) {
        "scroll" !== b && a.css("background-attachment", b)
    }}}, "background-size": {f: "fill", i: 4, d: "100% 100%"}, autoOrient: {x: {apply: function (a, b) {
        AdobeEdge.$.data(a[0], "doAutoOrient", b)
    }}}, clip: {}, display: {}, "border-top-left-radius": {f: "borderRadius", i: 0}, "border-top-right-radius": {f: "borderRadius", i: 1, ii: 0}, "border-bottom-right-radius": {f: "borderRadius",
        i: 2, ii: 0}, "border-bottom-left-radius": {f: "borderRadius", i: 3, ii: 0}, "border-width": {f: "stroke", i: 0, d: 0, u: "px"}, "border-color": {f: "stroke", i: 1, d: "rgba(0,0,0,0)"}, "border-style": {f: "stroke", i: 2, d: "none"}, cursor: {f: "cursor"}, "transform-origin": {cb: 1, f: "transform", i: 4, x: {prep: function (a, b, c, g, d, m) {
        if (b.transform && void 0 != b.transform[4])return 1 == b.transform[4].length ? b.transform[4][0] + " 50%" : b.transform[4][0] + " " + b.transform[4][1]
    }}}, "font-family": {f: "font", i: 0}, "font-size": {f: "font", i: 1, u: "px", x: {prep: function (a, b, c, g, d, m, k) {
        if ("text" == b.type)return g = this.conf.i, d = 0, c = this.conf.f, a = b[c][g][d], b = b[c][g][d + 1], b && "" != b || (b = this.conf.u), a + b
    }}}, "font-weight": {f: "font", i: 3}, "letter-spacing": {f: "textStyle", i: 0}, "word-spacing": {f: "textStyle", i: 1}, "line-height": {f: "textStyle", i: 2}, "text-indent": {f: "textStyle", i: 3}, "text-transform": {f: "textStyle", i: 4}, color: {f: "font", i: 2, x: {apply: function (a, b) {
        a.css("color", h(b))
    }}}, "text-decoration": {f: "font", i: 4}, "font-style": {f: "font", i: 5}, "word-wrap": {f: "font", i: 6}, "text-align": {f: "align"},
        "white-space": {f: "rect", x: {prep: function (a, b) {
            if (b.font)return 7 < b.font.length ? b.font[7] : b.rect
        }, apply: function (a, b) {
            d.isArray(b) ? (!b[2] || 0 >= b[2] || "auto" == b[2]) && (!b[3] || 0 >= b[3] || "auto" == b[3]) && (a.css("white-space", "nowrap"), a.css("wordWrap", "break-word")) : (a.css("white-space", b), "nowrap" == b && a.css("wordWrap", "break-word"))
        }}}, volume: {f: "volume", x: {apply: function (a, b) {
            a.get(0).volume = b
        }}}, className: {f: "uc", x: {apply: function (a, b) {
            a.addClass(b)
        }}}, controls: {a: 1}, alt: {a: 1}, title: {a: 1}, tabindex: {a: 1},
        autoplay: {a: 1}, loop: {a: 1}, linkURL: {f: "linkURL", a: 1, x: {prep: function (a, b) {
            ga[a[0].id] = b;
            a[0].onclick = function () {
                var a = ga[this.id];
                a.linkTarget ? window.open(a.linkURL, a.linkTarget) : window.location.href = a.linkURL
            };
            a[0].style.cursor = "pointer"
        }}}});
    var Y = {c: "children", r: "rect", zr: "sizeRange", br: "borderRadius", cl: "clip", al: "alt", tt: "title", ti: "tabindex", cn: "controls", sr: "source", ps: "poster", pr: "preload", cu: "cursor", ap: "autoplay", lp: "loop", n: "font", tf: "transform", sh: "boxShadow", ts: "textStyle", o: "opacity",
        uc: "userClass", s: "stroke", f: "fill", v: "display", fi: "filter", sN: "symbolName", tr: "trigger"};
    q(M.prototype, a.prototype);
    q(M.prototype, {init: function (a, b) {
        var c = this.data[this.name];
        c && L(this.composition, this, c.content.dom, c.content.style, a, b)
    }, register: function (a, b) {
    }, play: function (a) {
    }});
    q(I.prototype, a.prototype);
    I._playAuto = w;
    (function () {
        var a;
        T || (a = C.requestAnimationFrame || C.webkitRequestAnimationFrame || C.mozRequestAnimationFrame || C.msRequestAnimationFrame || C.oRequestAnimationFrame || function (a) {
            C.setTimeout(a,
                17)
        }, T = function () {
            var b;
            b = N(0);
            J(b, "rP");
            J(b, "rR");
            J(b, "rA");
            a.call(C, T)
        }, a.call(C, T))
    })();
    G.cssTransform = p(["transformProperty", "WebkitTransform", "MozTransform", "OTransform", "msTransform"]);
    G.cssTransform3d = p(["perspectiveProperty", "WebkitPerspective", "MozPerspective", "OPerspective", "msPerspective"]);
    G.audio = function () {
        var a = document.createElement("audio"), b = {};
        a.canPlayType && (b.m4a = !!a.canPlayType('audio/mp4; codecs="mp4a.40.2"').replace(/no/, ""), b.aac = b.m4a, b.mp3 = !!a.canPlayType("audio/mpeg;").replace(/no/,
            ""), b.wav = !!a.canPlayType('audio/wav; codecs="1"').replace(/no/, ""), b.ogg = !!a.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/, ""), b.oga = b.ogg);
        return b
    }();
    G.video = function () {
        var a = document.createElement("video"), b = {};
        a.canPlayType && (b.webm = !!a.canPlayType("video/webm").replace(/no/, ""), b.mp4 = !!a.canPlayType("video/mp4;").replace(/no/, ""), b.ogv = !!a.canPlayType('video/ogg; codecs="theora, vorbis"').replace(/no/, ""), b.ogg = !!a.canPlayType('video/ogg; codecs="theora, vorbis"').replace(/no/, ""));
        return b
    }();
    G.customEvent = function () {
        if (!window.CustomEvent)return!1;
        try {
            return void 0 !== new CustomEvent("testCustomEvent", !1, !1)
        } catch (a) {
        }
        return!1
    }();
    G.addEventListener = void 0 !== window.addEventListener;
    var sa = G, ia;
    V.style.cssText = "background-color:rgba(150,255,150,.5)";
    ia = 0 == ("" + V.style.backgroundColor).indexOf("rgba") ? !0 : !1;
    sa.rgba = ia;
    q(f, {version: "5.0.0", Composition: I, defaultOpt: aa, $: d, An$: b, renderDOM: L, ready: W, camelize: s, splitUnits: x, loadComposition: function (a, b, c, g, m) {
        function n(a, g) {
            W(function () {
                var m =
                    d("." + b), k = /px|^0$/, n = c.scaleToFit, e = c.centerStage, h = c.minW, f = c.maxW, l = c.width, s = c.height, y = m[0] || document.getElementsByTagName("body")[0];
                "absolute" != y.style.position && "relative" != y.style.position && (y.style.position = "relative");
                s && (y.style.height = s);
                l && (y.style.width = l);
                /^height$|^width$|^both$/.test(n) && (h = k.test(h) ? parseInt(h, 10) : void 0, f = k.test(f) ? parseInt(f, 10) : void 0, v(d(y), n, h, f, !1, c.bScaleToParent));
                /^vertical$|^horizontal$|^both$/.test(e) && t(y, e);
                a && L(H[b], null, a.dom, a.style, m[0], g + b);
                m.removeClass("edgeLoad-" +
                    b)
            })
        }

        function e() {
            K(function ea(a) {
                a ? ea && setTimeout(ea, 20) : a = {event: "loading", progress: 0};
                f.preloaderDOM.script && (new Function("e", f.preloaderDOM.script.loading))(a)
            });
            n(f.preloaderDOM, "edgePreload-")
        }

        function h() {
            n(f.downLevelStageDOM, "edgeDownLevel-")
        }

        var f = H[b] = AdobeEdge.compositions[b] = new I(b, c);
        k(AdobeEdge, "newComp", {comp: f});
        ba ? (window.edge_authoring_mode || (g ? (f.definePreloader(g), e()) : f.load(a + "_edgePreload.js", e)), a && (c && c.bootstrapLoading ? ka.push(a) : window.edge_authoring_mode && c.sym ? f.load(a +
            "_edge.js?symbol=" + c.sym) : f.load(a + "_edge.js"))) : window.edge_authoring_mode || (m ? (f.defineDownLevelStage(m), h()) : f.load(a + "_edgePreload.js", h))
    }, registerCompositionDefn: function (a, b, c, g, d, m) {
        H[a].define(m, b, c, g, d)
    }, registerEventBinding: function (a, b) {
        H[a].bindingFn = b
    }, getComposition: function (a) {
        return H[a]
    }, defineProps: P, props: S, Symbol: M, Notifier: a, isSupported: p, supported: G, isIOS: function () {
        var a = navigator.userAgent;
        return"webkitAppearance"in document.documentElement.style && (/iPad/.test(a) || /iPod/.test(a) ||
            /iPhone/.test(a))
    }(), isOpera: /Opera/.test(navigator.userAgent), registerFonts: function (a) {
        AdobeEdge.getCurrentComposition().registerFonts(a)
    }, playWhenReady: function () {
        f.doPlayWhenReady = !0;
        for (var a = 0; a < f.readyAndWaiting.length; a++)f.readyAndWaiting[a]()
    }, _: {c: H, P: E, p: S, rE: Q, nO: k, nDN: B}});
    q(f, a.prototype);
    a.call(f)
})(window.AdobeEdge);
window.AdobeEdge.bootstrapListeners || (window.AdobeEdge.bootstrapListeners = []);
window.AdobeEdge.bootstrapCallback = function (f) {
    window.AdobeEdge.bootstrapListeners.push(f);
    if (0 < aBootcompsLoaded.length)for (var r = 0; r < aBootcompsLoaded.length; r++)f(aBootcompsLoaded[r])
};
window.AdobeEdge.compositions || (window.AdobeEdge.compositions = []);
window.AdobeEdge.yepnope = window.yepnope;
(function (f) {
    function r() {
        f.Notifier.call(this);
        this.animationID = "animID-" + r.nextID;
        r.nextID += 1
    }

    function u(b, d, c) {
        f.Animation.call(this);
        "function" === typeof b ? this.handler = b : "string" === typeof b && (this.eventType = b);
        this.handlerContext = c;
        this.data = d;
        this.isTrigger = !0
    }

    function e(b, d, c, n, h) {
        f.Notifier.call(this);
        this.animation = b;
        this.position = 0;
        this.duration = -1;
        this.opts = {};
        l.extend(this.opts, h);
        this.easing = "function" === typeof n ? n : n && l.easing[n] ? n : e.defaultEasing;
        void 0 !== d && (this.position = d);
        void 0 !==
            c && (this.duration = c);
        this.timeline = null;
        this.dScale = 1;
        this.dDuration = 0;
        this.done = !1
    }

    function p(b) {
        f.Animation.call(this);
        l.extend(this, f.Timeline.config);
        l.extend(this, b);
        this.startPosition = this.timerStart = this.timer = 0;
        this.currentPosition = -1;
        this.playing = void 0;
        this.iteration = this.duration = 0;
        this.interval = 1E3 / this.fps;
        this.objects = []
    }

    function h(b) {
        return s.test(b[1])
    }

    var l = f.$, q = {}, x = {}, s = /^(trigger|@)$/;
    l.isArray = function (b) {
        return"[object Array]" === Object.prototype.toString.call(b)
    };
    l.easing = l.easing ||
    {};
    l.extend(l.easing, {linear: function (b, d, c, n) {
        return c + n * b
    }, swing: function (b, d, c, n) {
        return(-Math.cos(b * Math.PI) / 2 + 0.5) * n + c
    }});
    r.nextID = 1;
    l.extend(r.prototype, f.Notifier.prototype);
    l.extend(r.prototype, {constructor: r, setup: function () {
    }, update: function (b, d) {
    }, getDuration: function () {
        return 0
    }});
    l.extend(u.prototype, r.prototype);
    l.extend(u.prototype, {constructor: u, update: function (b) {
        this.fired || (this.fired = !0, this.handler ? this.handler.call(this.handlerContext, b, this.data) : this.eventType && this.timeline &&
            this.timeline.notifyObservers(this.eventType, {elapsed: b, data: this.data}))
    }, setup: function (b, d) {
        var c = void 0 === b.executeTriggers || null === b.executeTriggers;
        this.fired = b.startingFromCurrent && c || !c && !b.executeTriggers ? "reverse" !== b.playDirection ? b.currentPosition >= d : b.currentPosition <= d : "reverse" !== b.playDirection ? b.currentPosition > d : b.currentPosition < d;
        this.timeline = b
    }});
    e.defaultEasing = "linear";
    l.extend(e.prototype, f.Notifier.prototype);
    l.extend(e.prototype, {constructor: e, setup: function (b) {
        this.timeline =
            b;
        var d = this.duration, c = null;
        this.animation && this.animation.getDuration && (c = this.animation.getDuration());
        this.dScale = -1 !== d && 0 !== d ? c / d : 1;
        this.dDuration = -1 !== d ? d : c;
        this.done = !1;
        this.animation && this.animation.setup && this.animation.setup(b, this.position)
    }, update: function (b) {
        if (!this.done) {
            var d = this.dDuration, c;
            this.animation && (0 === d ? c = 0 <= b ? 1 : 0 : (b >= d && (b = d), 0 >= b && (b = 0), c = l.easing[this.easing](b / d, b, 0, 1, d)), this.animation.update(b * this.dScale, c));
            ("reverse" === this.timeline.playDirection ? 0 >= b : b >= d) &&
            this.complete()
        }
    }, complete: function () {
        this.done = !0;
        this.timeline && this.timeline.updateComplete(this)
    }, getPosition: function () {
        return this.position
    }, setPosition: function (b) {
        this.position = b
    }, getDuration: function () {
        return-1 !== this.duration ? this.duration : this.animation && this.animation.getDuration ? this.animation.getDuration() : 0
    }, setDuration: function (b) {
        this.duration = 0 <= b ? b : -1
    }});
    p.config = {dropFrames: !0, fps: 60, pauseThreshold: 250};
    p.prototype.tick = function (b) {
        this._handleTimer(b)
    };
    l.extend(p.prototype, r.prototype);
    l.extend(p.prototype, {constructor: p, play: function (b) {
        b = b || {};
        this.notifyObservers("play");
        this.playing = !0;
        this._stop({});
        if ("undefined" === typeof b.pos || null === b.pos)if ("reverse" == b.playDirection)b.pos = this.currentPosition, 0 >= b.pos && (b.pos = this.getDuration()); else if (0 > this.currentPosition || this.currentPosition >= this.getDuration())b.pos = 0;
        l.extend(this, b);
        this.seek(b.pos, b);
        this.iteration = 0;
        this.timerStart = (new Date).getTime();
        this.startPosition = this.currentPosition;
        this.lastUpdateTime = this.timerStart;
        this.firstUpdate = !0;
        this._handleTimer();
        this.firstUpdate = !1;
        return this
    }, stop: function (b) {
        this.playing = !1;
        b && b.bSeek ? this.seek(b.pos, b) : this._stop(b)
    }, seek: function (b, d) {
        this.notifyObservers("seek");
        this.sort(d);
        var c = this.currentPosition;
        this._stop(d);
        l.extend(this, d);
        void 0 !== b && (this.currentPosition = b);
        this.startingFromCurrent = "number" === typeof b && c !== this.currentPosition ? !1 : !0;
        this.setup(this);
        this.firstUpdate = !0;
        this.updateSeek(this.currentPosition, 1, c);
        this.firstUpdate = !1;
        return this
    }, add: function (b, d, c, n, h) {
        b = new e(b, d, c, n, h);
        this.objects.push(b);
        this.sorted = !1
    }, sort: function (b) {
        var d = {width: 1, height: 2, "-webkit-transform-origin": 3, "transform-origin": 4, "-moz-transform-origin": 5, "-ms-transform-origin": 6, left: 7, top: 8, bottom: 9, right: 10, motion: 11};
        this.sorted || (this.objects.sort(function (b, c) {
            var a = b.animation, k = c.animation;
            if (a || k) {
                if (!a)return-1;
                if (!k)return 1
            } else return b.position - c.position;
            if (a.property || k.property) {
                if (!a.property)return-1;
                if (!k.property)return 1
            } else return b.position - c.position;
            var g = d[a.property], m = d[k.property];
            return a.sourceElements !== k.sourceElements ? a.sourceElements > k.sourceElements ? 1 : -1 : g && (!m || m < g) ? 1 : m && (!g || m > g) ? -1 : b.position - c.position
        }), this.sorted = !0);
        for (b = 1; b < this.objects.length; b++) {
            var c = this.objects[b - 1], n = this.objects[b];
            c.animation && n.animation && c.animation.property === n.animation.property && c.animation.sourceElements === n.animation.sourceElements ? (c.animation._nextObj = n.animation, n.animation._prevObj = c.animation) : (c.animation && (c.animation._nextObj = null),
                n.animation && (n.animation._prevObj = null))
        }
    }, getDuration: function () {
        var b = this.duration, d = this.objects, c = this.objects.length, n = Math.max, e, t;
        for (e = 0; e < c; e += 1)t = d[e], b = n(b, t.position + t.getDuration());
        return b
    }, getCurrentPosition: function () {
        return this.currentPosition
    }, update: function (b, d) {
        this.sort();
        this.notifyObservers("preUpdate", {elapsed: b, easingConst: d});
        var c = this.objects, n = this.triggers, e = c.length, t = n.length, a = "reverse" !== this.playDirection, k = !1, g = !0, m = !window.edge_authoring_mode && this.executeTriggers,
            h = !window.edge_authoring_mode && (void 0 === this.executeTriggers || null === this.executeTriggers), f, l, s, q, p, r;
        this.currentDirection = a ? "forward" : "reverse";
        for (s = 0; s < t; s += 1)if (q = n[a ? s : t - s - 1], p = q.animation.isTrigger && !(this.startingFromCurrent && this.firstUpdate), (h && p || m || !this.firstUpdate) && !q.animation.fired && (a ? b >= q.position : b <= q.position + q.duration)) {
            p = this.currentPosition = q.position;
            r = this.getState();
            for (k = 0; k < e; k += 1)f = c[a ? k : e - k - 1], (l = a && !f.opts.reverseOnly || !a && !f.opts.forwardOnly) && !f.animation.isTrigger &&
                (a ? p >= f.position : p <= f.position + f.duration) && ((l = p - f.position) || f.duration || a || (l -= 1), f.update(l));
            k = !0;
            q.animation.update(p);
            if (!this.equalState(r)) {
                g = !1;
                break
            }
        }
        if (!k)for (k = 0; k < e; k += 1)f = c[a ? k : e - k - 1], (l = a && !f.opts.reverseOnly || !a && !f.opts.forwardOnly) && !f.animation.isTrigger && (a ? b >= f.position : b <= f.position + f.duration) && ((l = b - f.position) || f.duration || a || (l -= 1), f.update(l));
        this.notifyObservers("fxUpdate", {elapsed: b});
        this.notifyObservers("postUpdate", {elapsed: b, easingConst: d});
        this.notifyObservers("update",
            {elapsed: b, easingConst: d});
        return g
    }, setLoop: function (b) {
        this.loopCount = b
    }, getState: function () {
        return{pos: this.currentPosition, dir: this.playDirection, playing: this.playing}
    }, equalState: function (b) {
        var d = !!b.playing, c = !!this.playing;
        return b.pos === this.currentPosition && b.dir === this.playDirection && d === c
    }, _handleTimer: function (b) {
        b = b || (new Date).getTime();
        var d = "reverse" === this.playDirection, c = b - this.timerStart - this.iteration * (d ? this.startPosition : this.duration - this.startPosition), d = this.startPosition +
            (d ? -c : c);
        b - this.lastUpdateTime > this.pauseThreshold && (this.timerStart += b - this.lastUpdateTime + this.interval, c = b - this.timerStart);
        if (this.playing) {
            if (this.currentPosition = d = Math.max(0, Math.min(d, this.duration)), this.update(d, 1), this.lastUpdateTime = b, b = (d = "reverse" === this.playDirection) ? 0 < this.currentPosition : this.currentPosition < this.duration, !b) {
                if (this.loopCount && (this.iteration += 1, this.notifyObservers("iterationComplete", {elapsed: c, count: this.iteration}), "forever" === this.loopCount || this.iteration <
                    this.loopCount)) {
                    c = this.objects;
                    b = c.length;
                    for (d = 0; d < b; d += 1)c[d].done = !1;
                    this.tick();
                    return
                }
                this.stop();
                this.notifyObservers("complete", {elapsed: c})
            }
        } else this.notifyObservers("fxUpdate", {elapsed: c})
    }, setup: function (b) {
        f.Animation.prototype.setup.call(this, b);
        this.triggers = [];
        b = this.objects;
        var d = this.objects.length, c, n;
        for (c = 0; c < d; c += 1)n = b[c], n.done = !1, n.setup(this), n.animation.isTrigger && this.triggers.push(n);
        this.duration = this.getDuration()
    }, updateComplete: function (b) {
        b.done = !0
    }, _stop: function (b) {
        b &&
            b.dontNotify || this.notifyObservers("stop");
        this.timer && clearTimeout(this.timer);
        this.timerStart = this.timer = 0;
        return this
    }});
    p.prototype.updateSeek = p.prototype.update;
    f.Animation = r;
    f.TimelineObject = e;
    f.Timeline = p;
    f.Timeline.createTimeline = function (b) {
        return new f.Timeline(b)
    };
    f.Timeline.createTween = function (b) {
        var d = q[b];
        return d ? d.func.apply(d.context, Array.prototype.slice.call(arguments, 1)) : null
    };
    f.Timeline.addTweenType = function (b, d, c) {
        q[b] = {func: d, context: c}
    };
    f.Timeline.addTweenProperty = function (b, d) {
        x[b] = d
    };
    f.Timeline.getTweenType = function (b) {
        return x[b] || "style"
    };
    f.Timeline.createTrigger = function (b, d) {
        return new u(b, d, arguments[arguments.length - 1])
    };
    f.Timeline.isTrigger = h;
    f.Timeline.isTween = function (b) {
        return!h(b)
    };
    f.Timeline.createTL = function (b, d, c) {
        var n = f.Timeline.createTimeline(), e = b.length, t, a, k, g;
        k = b.duration ? b.duration : 0;
        var m;
        n.duration = k;
        c && c.loop && n.setLoop(c.loop);
        for (c = 0; c < e; c += 1)t = b[c], a = null, k = -1, h(t) ? (g = t.slice(3, 5), g.push(d), a = f.Timeline.createTrigger.apply(null, g), g = t[5],
            m = "none") : t[1] && (k = x[t[1]] || "style", g = [k, t[1]].concat(t.slice(5)), a = f.Timeline.createTween.apply(null, g), k = t[3], m = t[4], g = t[8]), a && (a.id = t[0], n.add(a, t[2], k, m, g));
        return n
    }
})(window.AdobeEdge);
(function (f) {
    var r = f.$;
    r.easing.jswing = r.easing.swing;
    r.extend(r.easing, {def: "easeOutQuad", swing: function (f, e, p, h, l) {
        return r.easing[r.easing.def](f, e, p, h, l)
    }, easeInQuad: function (f, e, p, h, l) {
        return h * (e /= l) * e + p
    }, easeOutQuad: function (f, e, p, h, l) {
        return-h * (e /= l) * (e - 2) + p
    }, easeInOutQuad: function (f, e, p, h, l) {
        return 1 > (e /= l / 2) ? h / 2 * e * e + p : -h / 2 * (--e * (e - 2) - 1) + p
    }, easeInCubic: function (f, e, p, h, l) {
        return h * (e /= l) * e * e + p
    }, easeOutCubic: function (f, e, p, h, l) {
        return h * ((e = e / l - 1) * e * e + 1) + p
    }, easeInOutCubic: function (f, e, p, h, l) {
        return 1 > (e /= l / 2) ? h / 2 * e * e * e + p : h / 2 * ((e -= 2) * e * e + 2) + p
    }, easeInQuart: function (f, e, p, h, l) {
        return h * (e /= l) * e * e * e + p
    }, easeOutQuart: function (f, e, p, h, l) {
        return-h * ((e = e / l - 1) * e * e * e - 1) + p
    }, easeInOutQuart: function (f, e, p, h, l) {
        return 1 > (e /= l / 2) ? h / 2 * e * e * e * e + p : -h / 2 * ((e -= 2) * e * e * e - 2) + p
    }, easeInQuint: function (f, e, p, h, l) {
        return h * (e /= l) * e * e * e * e + p
    }, easeOutQuint: function (f, e, p, h, l) {
        return h * ((e = e / l - 1) * e * e * e * e + 1) + p
    }, easeInOutQuint: function (f, e, p, h, l) {
        return 1 > (e /= l / 2) ? h / 2 * e * e * e * e * e + p : h / 2 * ((e -= 2) * e * e * e * e + 2) + p
    }, easeInSine: function (f, e, p, h, l) {
        return-h * Math.cos(e / l * (Math.PI / 2)) + h + p
    }, easeOutSine: function (f, e, p, h, l) {
        return h * Math.sin(e / l * (Math.PI / 2)) + p
    }, easeInOutSine: function (f, e, p, h, l) {
        return-h / 2 * (Math.cos(Math.PI * e / l) - 1) + p
    }, easeInExpo: function (f, e, p, h, l) {
        return 0 == e ? p : h * Math.pow(2, 10 * (e / l - 1)) + p
    }, easeOutExpo: function (f, e, p, h, l) {
        return e == l ? p + h : h * (-Math.pow(2, -10 * e / l) + 1) + p
    }, easeInOutExpo: function (f, e, p, h, l) {
        return 0 == e ? p : e == l ? p + h : 1 > (e /= l / 2) ? h / 2 * Math.pow(2, 10 * (e - 1)) + p : h / 2 * (-Math.pow(2, -10 * --e) + 2) + p
    }, easeInCirc: function (f, e, p, h, l) {
        return-h *
            (Math.sqrt(1 - (e /= l) * e) - 1) + p
    }, easeOutCirc: function (f, e, p, h, l) {
        return h * Math.sqrt(1 - (e = e / l - 1) * e) + p
    }, easeInOutCirc: function (f, e, p, h, l) {
        return 1 > (e /= l / 2) ? -h / 2 * (Math.sqrt(1 - e * e) - 1) + p : h / 2 * (Math.sqrt(1 - (e -= 2) * e) + 1) + p
    }, easeInElastic: function (f, e, p, h, l) {
        f = 1.70158;
        var q = 0, r = h;
        if (0 == e)return p;
        if (1 == (e /= l))return p + h;
        q || (q = 0.3 * l);
        r < Math.abs(h) ? (r = h, f = q / 4) : f = q / (2 * Math.PI) * Math.asin(h / r);
        return-(r * Math.pow(2, 10 * (e -= 1)) * Math.sin(2 * (e * l - f) * Math.PI / q)) + p
    }, easeOutElastic: function (f, e, p, h, l) {
        f = 1.70158;
        var q = 0, r = h;
        if (0 == e)return p;
        if (1 == (e /= l))return p + h;
        q || (q = 0.3 * l);
        r < Math.abs(h) ? (r = h, f = q / 4) : f = q / (2 * Math.PI) * Math.asin(h / r);
        return r * Math.pow(2, -10 * e) * Math.sin(2 * (e * l - f) * Math.PI / q) + h + p
    }, easeInOutElastic: function (f, e, p, h, l) {
        f = 1.70158;
        var q = 0, r = h;
        if (0 == e)return p;
        if (2 == (e /= l / 2))return p + h;
        q || (q = 0.3 * l * 1.5);
        r < Math.abs(h) ? (r = h, f = q / 4) : f = q / (2 * Math.PI) * Math.asin(h / r);
        return 1 > e ? -0.5 * r * Math.pow(2, 10 * (e -= 1)) * Math.sin(2 * (e * l - f) * Math.PI / q) + p : r * Math.pow(2, -10 * (e -= 1)) * Math.sin(2 * (e * l - f) * Math.PI / q) * 0.5 + h + p
    }, easeInBack: function (f, e, p, h, l, q) {
        void 0 == q && (q = 1.70158);
        return h * (e /= l) * e * ((q + 1) * e - q) + p
    }, easeOutBack: function (f, e, p, h, l, q) {
        void 0 == q && (q = 1.70158);
        return h * ((e = e / l - 1) * e * ((q + 1) * e + q) + 1) + p
    }, easeInOutBack: function (f, e, p, h, l, q) {
        void 0 == q && (q = 1.70158);
        return 1 > (e /= l / 2) ? h / 2 * e * e * (((q *= 1.525) + 1) * e - q) + p : h / 2 * ((e -= 2) * e * (((q *= 1.525) + 1) * e + q) + 2) + p
    }, easeInBounce: function (f, e, p, h, l) {
        return h - r.easing.easeOutBounce(f, l - e, 0, h, l) + p
    }, easeOutBounce: function (f, e, p, h, l) {
        return(e /= l) < 1 / 2.75 ? 7.5625 * h * e * e + p : e < 2 / 2.75 ? h * (7.5625 * (e -= 1.5 / 2.75) * e + 0.75) +
            p : e < 2.5 / 2.75 ? h * (7.5625 * (e -= 2.25 / 2.75) * e + 0.9375) + p : h * (7.5625 * (e -= 2.625 / 2.75) * e + 0.984375) + p
    }, easeInOutBounce: function (f, e, p, h, l) {
        return e < l / 2 ? 0.5 * r.easing.easeInBounce(f, 2 * e, 0, h, l) + p : 0.5 * r.easing.easeOutBounce(f, 2 * e - l, 0, h, l) + 0.5 * h + p
    }})
})(window.AdobeEdge);
(function (f) {
    function r(a, b) {
        return b ? b + "_" + a : a + "_" + k++
    }

    function u(a) {
        a.length && (a = a[0]);
        return a ? a.edgeSymbol : null
    }

    function e(a, b) {
        a.length && (a = a[0]);
        a && (a.edgeSymbol = b)
    }

    function p(a) {
        var b, c, d, k = a.length;
        if (n.isArray(a))for (b = [], d = 0; d < k; d++)c = a[d], b[d] = null != c && "object" === typeof c ? p(c) : c; else for (d in b = {}, a)a.hasOwnProperty(d) && "prototype" !== d && (c = a[d], b[d] = null != c && "object" === typeof c ? p(c) : c);
        return b
    }

    function h(a) {
        a = a.data[a.name];
        return a.timeline ? a.timeline.data : null
    }

    function l(a) {
        a = a.data[a.name];
        return a.timeline ? a.timeline.duration : 0
    }

    function q(a, b, c) {
        function d(a, b) {
            for (k = 0; k < a.length; k += 1) {
                if (a[k].id === b)return a[k];
                if (a[k].children)return d(a[k].children, b)
            }
            return null
        }

        b = b.replace(/[\{\}\$]/g, "");
        a = a.data[a.name];
        var k;
        if (a = a.content ? a.content.dom : null)if (b = d(a, b))if (a = f.props[c])return a.prep(null, b, c, a.i, a.j);
        return null
    }

    function x(a, b, c, d, k) {
        return["generated", "location", d, k, "linear", a, [
            [b.x, b.y, 0, 0],
            [c.x, c.y, 0, 0]
        ]]
    }

    function s(b, c) {
        var d, k;
        c && (b.tlCached = void 0);
        var n = h(b);
        if (!n)return null;
        n.duration = l(b);
        n.dirty && b.tlCached && (d = b.tlCached.currentPosition, k = b.tlCached.notifier.obs, b.tlCached = void 0);
        if (!b.tlCached) {
            var e, v = b.data[b.name].timeline, s, p = {}, r = {}, u, w, F = n.duration, I;
            e = b.data[b.name];
            var N;
            s = n.length;
            for (w = n.length - 1; 0 <= w; w--)"injected" === n[w][0] && n.splice(w, 1);
            s = n.length;
            "number" !== typeof e.timeline.duration && (e.timeline.duration = 0);
            for (N = 0; N < s; N++)(w = n[N]) && a(w) && (u = w[5], p[u] || (p[u] = []), p[u].push(w), u = u + ":" + ("motion" === w[1] ? "location" : w[1]), r[u] || (r[u] = []), r[u].push(w)),
                w && a(w) && (I = w[3] || 0, F = Math.max(F, w[2] + I));
            p = Math.max(e.timeline.duration, F);
            w = function (a, b) {
                return a[2] - b[2]
            };
            for (u in r)r.hasOwnProperty(u) && r[u].sort(w);
            for (u in r)r.hasOwnProperty(u) && (w = r[u][0], 0 < w[2] && (e = q(b, w[5], w[1]), null == e && (e = w[6]), "location" === w[1] ? (w = r[u][0], s = {x: w[6][0][0], y: w[6][0][1]}, e = x(w[5], s, s, 0, Math.max(0, w[2] - 1)), e[0] = "injected", n.push(e)) : void 0 !== e && (w = f.cloneJSONObject(r[u][0]), w[6] = w[7] = e, w[3] = w[2], w[2] = 0, w[0] = "injected", w[8] && "" != w[8].valueTemplate && "string" == typeof e && (w[8].valueTemplate =
                ""), n.push(w))), s = r[u].length - 1, 0 <= s && (w = r[u][s], e = w[2] + w[3], e < F && ("location" === w[1] ? (s = w[6].length - 1, s = {x: w[6][s][0], y: w[6][s][1]}, e = x(w[5], s, s, e, p - e), e[0] = "injected") : (e = f.cloneJSONObject(r[u][s]), e[6] = w[7], e[2] = p, e[3] = 0, e[0] = "injected", e[8] = e[8] || {}, e[8].reverseOnly = !0), n.push(e))));
            F < p && (w = ["injected", "-an_resting", F, p - F, "linear", "${stage}", "0", "100"], n.push(w));
            b.tlCached = t.createTL(n, b, {loop: v.loop});
            n.dirty && (b.tlCached.currentPosition = d, b.tlCached.notifier.obs = k || b.tlCached.notifier.obs);
            b.tlCached.sort()
        }
    }

    function b(a, b) {
        if ("string" === typeof b) {
            var c = a.data ? a.data[a.name] : 0;
            return(c = c ? c.timeline : 0) && c.labels ? c.labels[b] : 0
        }
        return b
    }

    function d(a) {
        var b = a, c;
        "string" === typeof a && -1 !== a.search(/\$\{/) && (b = a.search(/\$\{/), c = a.search(/\}/), b = a.slice(b + 2, c), "string" === typeof b && (b = f.trimString(b), b = b.replace(/["']/g, "")));
        return b
    }

    function c(a, b) {
        for (var c = a, k; b && "string" === typeof c && -1 !== c.search(/\$\{/);)k = d(c), c = void 0 === b[k] ? void 0 : c.replace(/\$\{[^\}]*\}/, b[k]);
        return c
    }

    var n = window.jQuery ?
        window.jQuery : f.$, v = f.Symbol, t = f.Timeline, a = t.isTween, k = 0;
    v._makeUniqueID = r;
    f.symbol = v;
    v.get = v.getSymbol = u;
    v.setSymbol = e;
    f.addObserver({newComp: function (a, b) {
        b.comp.addObserver({newSymbol: function (a, b) {
            b.symbol.addObserver({newEle: function (a, b) {
                var c = n(b.ele), g = b.defn, d = a.composition;
                g.userClass && c.addClass(g.userClass);
                f.$.data(c[0], "defn", g);
                g.symbolName && (g = new v(d.sym, g.symbolName, d, a), g.init(c[0]), a.ci = a.ci || [], a.ci.push(g), g.prnt = a)
            }})
        }})
    }});
    f.cloneJSONObject = p;
    v.bldTL = s;
    v.p2n = b;
    f.trimString =
        function (a) {
            return a.replace(/^\s+|\s+$/g, "")
        };
    v.parseVariableName = d;
    v.substituteVariables = c;
    n.extend(v.prototype, {init: function (a, b) {
        var c = this.data[this.name], d = n(a), k = d[0].id, t;
        this.gpuAccelerate = c.gpuAccelerate;
        "undefined" === typeof this.gpuAccelerate && (this.gpuAccelerate = !0);
        this.gpuAccelerate = this.gpuAccelerate && f.supported.cssTransform3d;
        this.variables = this.variables || {};
        this._variables = this._variables || {};
        a = a || n("." + b)[0];
        this.autoPlay = c.timeline ? c.timeline.autoPlay : !1;
        e(a, this);
        if (this.ele =
            a)k && "" !== k || (k = r("stage"), d[0].id = k), t = "#" + k, this._variables[k] = this._variables.stage = t, this._variables.symbolStage = t, this._variables.symbolSelector = t, d.css("position", "absolute"), d.css("z-index", "0");
        if (c) {
            f.renderDOM(this.composition, this, c.content.dom, c.content.style, a, b);
            var c = c.content.style, h, v;
            for (h in c)if ("${symbolSelector}" != h && c.hasOwnProperty(h) && (d = h, k = /^\$\{/, k.test(d) ? (d = d.replace(k, ""), d = d.replace(/\}/, ""), d = this.find$(d)) : d = f.$(d), d))for (v in f._.p)f._.p.hasOwnProperty(v) && f._.p[v].render(d,
                c[h], this.composition)
        }
        h = {Symbol: this, element: this.ele, performDefaultAction: !0};
        n.extend(h, void 0);
        this.notifyObservers("creationComplete", h)
    }, lookupSelector: function (a) {
        if ("string" === typeof a)try {
            return c("${"+a+"}", this._variables)
        } catch (b) {
        }
    }, getSymbolTypeName: function () {
        return this.name
    }, getComposition: function () {
        return this.composition
    }, find$: function (a) {
        a = a.split(" ");
        var b = this._variables[a[0]];
        if (2 > a.length || !b)return b ? f.$(b) : null;
        b = f.$(b);
        if (!b || !b.length)return null;
        a.splice(0, 1);
        a = a.join(" ");
        return(b = u(b)) ? b.find$(a) : void 0
    }, $: function (a) {
        var b = a;
        if ("string" === typeof a)try {
            -1 === a.search(/\$\{/) ? (b = this.lookupSelector(a), "undefined" === typeof b && (b = a)) : b = c(a, this._variables)
        } catch (k) {
        }
        void 0 === b && (b = d(a));
        return f.$(b)
    }, register: function (a, b, c) {
        var d = b.id;
        c = r(d, c);
        this._variables[d] = "#" + c;
        b.oldId = b.id;
        a.id = c
    }, seek: function (a, b) {
        s(this);
        this.tlCached.seek(a, b)
    }, play: function (a, c, d) {
        s(this);
        this.tlCached && (a = b(this, a), this.tlCached.play({pos: a, variables: this._variables, executeTriggers: c,
            playDirection: d}))
    }, stop: function (a, c) {
        s(this);
        this.tlCached && (a = b(this, a), this.tlCached.stop({pos: a, variables: this._variables, executeTriggers: c, bSeek: void 0 != a}))
    }, playReverse: function (a, b) {
        this.play(a, b, "reverse")
    }, isPlaying: function () {
        var a = this._getTimeline();
        return a && !!a.playing
    }, isPlayDirectionReverse: function () {
        var a = this._getTimeline();
        return a && "reverse" === a.currentDirection ? !0 : !1
    }, getTimelinePosition: function () {
        return this.getPosition()
    }, getPosition: function () {
        s(this);
        return this.tlCached ?
            this.tlCached.getCurrentPosition() : 0
    }, getDuration: function () {
        s(this);
        if (this.tlCached)return this.tlCached.getDuration()
    }, getLabelPosition: function (a) {
        return b(this, a)
    }, _getTimeline: function () {
        s(this);
        return this.tlCached
    }, _rebuild: function () {
        s(this, !0)
    }, getTimelineData: function () {
        return h(this)
    }, getTLD: function () {
        return this.getTimelineData()
    }, _applyBaseStyles: function (a, b) {
        var c = this.data[b];
        if (c.content && c.content.style && c.content.style["${symbolSelector}"]) {
            var c = c.content.style["${symbolSelector}"],
                d;
            if (a && a[0])for (d in f._.p)if (f._.p.hasOwnProperty(d)) {
                if ("width" == d || "height" == d) {
                    var k = a[0].style[d];
                    if (null != k && "" != k && "auto" != k)continue
                }
                f._.p[d].render(a, c, this.composition)
            }
        }
    }, getAutoPlay: function () {
        return this.autoPlay
    }, setAutoPlay: function (a) {
        this.autoPlay = a
    }})
})(window.AdobeEdge);
(function (f) {
    function r(h, l, q, p, s, b) {
        f.Animation.call(this);
        this.name = "prop tween";
        this.sourceElements = this.elements = q;
        this.deferElementResolution = !0;
        this.tweenType = e[h];
        this.updateTriggered = !1;
        this.property = l;
        this.fromValue = p;
        this.toValue = s;
        this.duration = 1E3;
        this.fromValues = this.tokens = this.valueTemplate = null;
        b && u.extend(this, b);
        this.deferElementResolution = this.deferElementResolution || "string" === typeof q && -1 !== q.search(/\$\{[^\{\}]+\}/);
        this.deferElementResolution || (this.elements = this.resolveElementSelector(q));
        q = this.toValues = [];
        p = this.parseValue(s);
        var d;
        u.isArray(s) || (s = [s]);
        p && 0 !== p.length || (p = s);
        h = p.length;
        for (s = 0; s < h; s += 1)b = p[s], f.props[l] && (b = f.props[l].units(b)), d = {}, "string" === typeof b ? (d.value = parseFloat(b.replace(/[a-zA-Z%]+$/, "")), d.unit = b.replace(/^-?[0-9]*(\.[0-9]+)?/, ""), isNaN(d.value) && (d.value = b, d.unit = "")) : ("number" === typeof b && (b = parseFloat(b)), d.value = b, d.unit = ""), q.push(d);
        if (null != this.fromValue)for (l = this.fromValues = [], (s = this.parseValue(this.fromValue)) && 0 < s.length ? this.fromValue =
            s : u.isArray(this.fromValue) || (this.fromValue = [this.fromValue]), h = this.fromValue.length, s = 0; s < h; s += 1)b = this.fromValue[s], "string" === typeof b ? (l[s] = parseFloat(b.replace(/[a-zA-Z%]+$/, "")), isNaN(l[s]) && (l[s] = b)) : ("number" === typeof b && (b = parseFloat(b)), l[s] = b);
        if (this.filter)for (u.isArray(this.filter) || (this.filter = [this.filter]), l = this.filter, h = l.length, s = 0; s < h; s += 1)"string" === typeof l[s] && (l[s] = Math[l[s]]), "function" !== typeof l[s] && (l[s] = null);
        this.valueTemplate && (this.tokens = this.parseTemplate(this.valueTemplate))
    }

    var u = f.$, e = {style: 0, attribute: 1, property: 2}, p = "webkitAppearance"in document.documentElement.style;
    f.trimString = function (e) {
        return e.replace(/^\s+|\s+$/g, "")
    };
    r.Token = function (e, f) {
        this.value = e;
        this.isPlaceholder = f
    };
    r.parseVariableName = function (e) {
        var l = e, q;
        "string" === typeof e && -1 !== e.search(/\$\{/) && (l = e.search(/\$\{/), q = e.search(/\}/), l = e.slice(l + 2, q), "string" === typeof l && (l = f.trimString(l), l = l.replace(/["']/g, "")));
        return l
    };
    r.substituteVariables = function (e, f) {
        for (var q = e, p; f && "string" === typeof q &&
            -1 !== q.search(/\$\{/);)p = r.parseVariableName(q), q = void 0 === f[p] ? void 0 : q.replace(/\$\{[^\}]*\}/, f[p]);
        return q
    };
    u.extend(r.prototype, f.Animation.prototype);
    u.extend(r.prototype, {constructor: r, setup: function (e) {
        this.updateTriggered = !1;
        this.timeline = e;
        this.animData = void 0
    }, update: function (e, f) {
        var q = this.getElementSet(), p = this, s = this.tweenType, b = this.property, d;
        this.updateTriggered || (this.updateTriggered = !0, this.setupForAnimation());
        q.each(function (c, n) {
            var v = p.getPropertyTweenData(n, s, b), t, a, k, g, m,
                q, r;
            if (v.animationID === p.animationID) {
                t = v.fromValues;
                a = v.toValues;
                v = v.tokens;
                k = p.filter;
                g = t.length;
                m = [];
                for (d = 0; d < g; d += 1)q = t[d], r = a[d], q = "string" === typeof q ? 0 === f && 0 < p.duration ? q : r.value : q + (r.value - q) * f, k && k[d] && (q = k[d](q, p, this, b, r.unit, e)), "number" === typeof q && 1 > q && (q = q.toFixed(6)), m.push(q + r.unit);
                t = p.formatValue(m);
                if (0 < t.length)v = t; else if (v) {
                    t = v.length;
                    a = [];
                    for (d = 0; d < t; d += 1)k = v[d], k.isPlaceholder ? a.push(m[k.value]) : a.push(k.value);
                    v = a.join("")
                } else v = m.join("");
                p.setValue.call(this, s, b, v);
                p.notifyObservers("onUpdate",
                    {elapsed: e, easingConst: f, property: b, value: v, element: this})
            }
        })
    }, setValue: function (e, f, q) {
        switch (e) {
            case 0:
                e = u(this);
                e.css(f, q);
                p && "background-size" === f ? e.css("-webkit-background-size", q) : "display" === f && "AUDIO" == this.nodeName && e.attr("controls", "none" === q ? null : "controls");
                break;
            case 1:
                this.setAttribute(f, q);
                break;
            case 2:
                this[f] = q
        }
    }, getDuration: function () {
        return this.duration
    }, resolveElementSelector: function () {
        var e = r.substituteVariables(this.elements, this.timeline.variables);
        e || (e = this.elements);
        /^\$\{/.test(e) &&
        (e = "bad_selector");
        return u(e)
    }, getElementSet: function () {
        var e = this.animationID, f;
        this.timeline.animData = this.timeline.animData || {};
        (f = this.timeline.animData[e]) || (f = this.timeline.animData[e] = this.deferElementResolution ? this.resolveElementSelector() : this.elements);
        return f
    }, getValue: function (e, f) {
        var q;
        switch (f) {
            case 0:
                q = u(this).css(e);
                break;
            case 1:
                q = this.getAttribute(e);
                break;
            case 2:
                q = String(this[e])
        }
        return q
    }, setupForAnimation: function () {
        var e = this, f = this.tweenType, q = this.property;
        this.getElementSet().each(function (p, s) {
            var b = e.getPropertyTweenData(s, f, q), d, c, n, v;
            b.animationID = e.animationID;
            b.toValues = e.toValues;
            b.tokens = e.tokens;
            if (e.fromValues)b.fromValues = e.fromValues; else if (d = e.getValue.call(this, q, f), void 0 === d && (d = "0"), (c = e.parseValue(d)) && 0 < c.length)for (b = b.fromValues = [], d = c.length, n = 0; n < d; n += 1)v = c[n], b[n] = "string" === typeof v ? parseFloat(v.replace(/[a-zA-Z%]+$/, "")) : v, isNaN(b[n]) && (b[n] = v); else b.fromValues = [parseFloat(d.replace(/[a-zA-Z%]+$/, ""))]
        })
    }, parseTemplate: function (e) {
        var f = e.length, q = [], p = 0, s =
            /@@[0-9]+@@/g, b = null;
        for (p < f && (b = s.exec(e)); b;)b.index !== p && q.push(new r.Token(e.substring(p, b.index), !1)), q.push(new r.Token(parseInt(b[0].replace(/@@/g, ""), 10), !0)), p = s.lastIndex, b = null, p < f && (b = s.exec(e));
        p < f && q.push(new r.Token(e.substring(p, f), !1));
        return q
    }, parseValue: function (e) {
        return[]
    }, formatValue: function (e) {
        return""
    }, getPropertyTweenData: function (e, l, q) {
        var p = f.$.data(e, "tweenData");
        p || (p = {}, f.$.data(e, "tweenData", p));
        (e = p[l]) || (e = p[l] = {});
        (l = e[q]) || (l = e[q] = {animationID: -1});
        return l
    }});
    f.PropertyTween = r;
    f.Timeline.addTweenType("style", function (e, f, p, u, s) {
        return new r("style", e, f, p, u, s)
    });
    AdobeEdge.Timeline.addTweenType("attribute", function (e, f, p, u, s) {
        return new r("attribute", e, f, p, u, s)
    });
    AdobeEdge.Timeline.addTweenType("property", function (e, f, p, u, s) {
        return new r("property", e, f, p, u, s)
    });
    f.Timeline.addTweenProperty("volume", "property")
})(window.AdobeEdge);
(function (f) {
    var r = f.$, u = function (e) {
        this.handlers = {};
        this.timeline = e
    };
    u.Register = function (e, f, h) {
        var l = e.updateFinalizer;
        "undefined" === typeof l && (l = new u(e), e.updateFinalizer = l, e.addObserver(l));
        l.handlers[f] = h
    };
    u.unRegister = function (e, f) {
        var h = e.updateFinalizer;
        "undefined" !== typeof h && delete h.handlers[f]
    };
    r.extend(u.prototype, {_finalizeUpdate: function (e, f) {
        var h = {elapsed: e, context: f}, l;
        for (l in this.handlers)if (this.handlers.hasOwnProperty(l)) {
            var q = this.handlers[l];
            if (q.onFinalUpdate)q.onFinalUpdate(h)
        }
        this.handlers =
        {}
    }, postUpdate: function (e, f) {
        this._finalizeUpdate(f.elapsed, f.context)
    }, complete: function (e) {
        this.timeline && this.timeline.removeObserver(this);
        this.timeline.updateFinalizer = void 0
    }});
    f.UpdateFinalizer = u
})(window.AdobeEdge);
(function (f) {
    function r(b, d, e) {
        var f = l.event.special[d];
        f && f.teardown && f.teardown.call(b, d, e);
        var f = b.AnListeners = b.AnListeners || {}, a, k;
        a = f[d] = f[d] || [];
        if (null != e)for (b.removeEventListener ? b.removeEventListener(d, e) : b.detachEvent && b.detachEvent(d, e), k = f.length - 1; 0 <= k; k--)a[k] === e && f.splice(k, 1); else d && (f[d].forEach(function (a) {
            b.removeEventListener ? b.removeEventListener(d, a) : b.detachEvent && b.detachEvent(d, a)
        }), f[d] = [])
    }

    function u(b, d, e, f) {
        function a(a) {
            if (2 <= a.length && "object" === typeof a[0] && "object" === typeof a[1] && "onError" !== a[1].type) {
                var g;
                g = l.Event("onError");
                b && (g.compId = b.getComposition().compId);
                g.originalEvent = a[1];
                document.dispatchEvent(g)
            }
            window.console.log("Javascript error in event handler! Event Type = " + d)
        }

        var k = b[f[0]], g;
        return"function" === typeof k ? ("element" === d ? g = function () {
            var d;
            d = Array.prototype.slice.call(arguments);
            d.unshift(b);
            if (2 <= d.length && "object" === typeof d[0] && "object" === typeof d[1] && "compositionReady" === d[1].type && "string" === typeof d[1].compId && "object" === typeof d[0].composition &&
                d[1].compId !== d[0].composition.id)return null;
            try {
                return k.apply(b, d)
            } catch (g) {
                a(d)
            }
        } : "timeline" === d ? g = function (g, e) {
            var f, t;
            t = e && e.methodName && /^trig_/.test(e.methodName) ? l.Event("trigger") : l.Event(d);
            e && l.extend(t, e);
            t.timeline = g;
            f = Array.prototype.slice.call(arguments);
            f.splice(0, 0, t);
            f.unshift(b);
            try {
                return k.apply(b, f)
            } catch (v) {
                a(f)
            }
        } : "symbol" === d && (g = function (b, c) {
            var g, e, f;
            e = c && c.methodName ? l.Event(c.methodName) : l.Event(d);
            c && (l.extend(e, c), c.variableValue && (f = c.variableValue));
            g = Array.prototype.slice.call(arguments);
            g.splice(0, 0, e, f);
            g.unshift(b);
            try {
                return k.apply(b, g)
            } catch (t) {
                a(g)
            }
        }), g) : null
    }

    function e(b, d) {
        var e = d[0], f = s[e[0]], a;
        f && (a = u(b, e[0], e[1], d.slice(1))) && f.apply(b, [a].concat(e.slice(1)))
    }

    function p(b, d) {
        d = d || b.data[b.name].actions || {};
        l.extend(b, d)
    }

    function h(b, n, v, t, a, k) {
        var g = f.getComposition(b).sym[n], m = x("binding");
        v = [
            [k, v, t],
            m
        ];
        var h;
        if (g && (g.actions = g.actions || {}, g.actions[m] = a, g.bindings = g.bindings || [], g.bindings.push(v), b = f.getComposition(b)) && (b.addObserver(d), b = b.getSymbols()))for (g = b.length,
                                                                                                                                                                                                k = 0; k < g; k++)t = b[k], h = t.name, n === h && (h = {}, h[m] = a, p(t, h), e(t, v))
    }

    var l = f.$, q = f.Symbol, x = f.Symbol._makeUniqueID, s = f.triggerDict = {timeline: function (b, d, e) {
        if (b) {
            d = {};
            var f = this._getTimeline();
            d[e] = b;
            f.addObserver(d)
        }
    }, element: function (b, d, e) {
        if (b)if ("document" === d)l(document).bind(e, b); else if ("window" === d)l(window).bind(e, b); else {
            var f = /^\$\{/;
            f.test(d) && (d = d.replace(f, ""), d = d.replace(/\}/, ""));
            (d = this.find$(d)) && d.bind(e, b)
        }
    }, symbol: function (b, d, e) {
        b && (d = {}, d[e] = b, this.addObserver(d))
    }}, b, d;
    l.Event =
        function (b) {
            if (f.supported.customEvent)return new CustomEvent(b, {bubbles: !0, cancelable: !0});
            var d = document.createEvent("Event");
            d.initEvent(b, !0, !0);
            return d
        };
    l.event = {};
    l.event.special = {};
    l.extend(f.An$.prototype, {bind: function (b, d) {
        this.each(function (e, f) {
            var a = l.event.special[b];
            a && a.setup && a.setup.call(f, b, d);
            f.addEventListener ? f.addEventListener(b, d) : f.attachEvent && f.attachEvent(b, d);
            a = f.AnListeners = f.AnListeners || {};
            a[b] = a[b] || [];
            a[b].push(d)
        });
        return this
    }, unbind: function (b, d) {
        this.each(function (e, f) {
            r(f, b, d)
        });
        return this
    }, trigger: function (b) {
        var d = document;
        this[0] && (d = this[0]);
        d.dispatchEvent(b);
        return this
    }});
    b = {creationComplete: function (b, d) {
        p(b);
        var f;
        f = b.data[b.name].bindings || [];
        var t = f.length, a, k;
        for (a = 0; a < t; a++)k = f[a], e(b, k)
    }};
    d = {newSymbol: function (c, d) {
        d.symbol.addObserver(b)
    }};
    q.bindElementAction = function (b, d, e, f, a) {
        h(b, d, e, f, a, "element")
    };
    q.bindTimelineAction = function (b, d, e, f, a) {
        h(b, d, e, f, a, "timeline")
    };
    q.bindTriggerAction = function (b, d, e, t, a) {
        var k = f.getComposition(b).sym[d], g;
        k && (k = k.timeline ? k.timeline.data : null) && (g = x("trig"), t = [g, "trigger", t, g], k.push(t), k.dirty = !0, h(b, d, e, g, a, "timeline"), k.dirty = !1)
    };
    q.bindSymbolAction = function (b, d, e, f) {
        h(b, d, "", e, f, "symbol")
    };
    q.bindVariableAction = function (b, d, e, f) {
        h(b, d, "", "variableChanged:" + e, f, "symbol")
    };
    l.extend(q.prototype, {executeSymbolAction: function (b, d) {
        if (!("object" !== typeof d || 3 > d.length)) {
            var e = d[0], f = this.$(d[1]), a = d[2];
            !f || 1 > f.length || (f = q.getSymbol(f[0])) && e && (a && "object" === typeof a || (a = null), f[e].apply(f, a))
        }
    }, eSA: function (b, d) {
        this.executeSymbolAction(b, d)
    }})
})(window.AdobeEdge);
(function (f, r, u) {
    document.createEvent && (f.addTouchSupport = function () {
        var e = f.$, p = f.An$;
        e.fn = e.fn || {};
        e.each("touchstart touchmove touchend swipe swipeleft swiperight ".split(" "), function (b, d) {
            p.prototype[d] = e.fn[d] = function (b) {
                return b ? this.bind(d, b) : this.trigger(d)
            };
            e.attrFn && (e.attrFn[d] = !0)
        });
        var h = "ontouchend"in document, l = !h && r.navigator.msPointerEnabled, q = h ? "touchstart" : "mousedown", x = h ? "touchend" : "mouseup", s = h ? "touchmove" : "mousemove";
        e.event.special.swipe = {scrollSupressionThreshold: 30, durationThreshold: 1E3,
            horizontalDistanceThreshold: 30, verticalDistanceThreshold: 75, swipeEvent: e.Event("swipe"), swipeLeftEvent: e.Event("swipeleft"), swipeRightEvent: e.Event("swiperight"), setup: function () {
                if (!this.setupDone) {
                    var b = e(this);
                    l && b.css("-ms-touch-action", "pan-y pinch-zoom double-tap-zoom");
                    b.bind(q, function (d) {
                        function c(d) {
                            b.unbind(x, c);
                            b.unbind(s, f);
                            t && a && a.time - t.time < e.event.special.swipe.durationThreshold && Math.abs(t.coords[0] - a.coords[0]) > e.event.special.swipe.horizontalDistanceThreshold && Math.abs(t.coords[1] -
                                a.coords[1]) < e.event.special.swipe.verticalDistanceThreshold && b.trigger(e.event.special.swipe.swipeEvent).trigger(t.coords[0] > a.coords[0] ? e.event.special.swipe.swipeLeftEvent : e.event.special.swipe.swipeRightEvent);
                            t = a = u
                        }

                        function f(b) {
                            if (t) {
                                var c = b.touches ? b.touches[0] : b.originalEvent.touches ? b.originalEvent.touches[0] : b;
                                a = {time: (new Date).getTime(), coords: [c.pageX, c.pageY]};
                                Math.abs(t.coords[0] - a.coords[0]) > e.event.special.swipe.scrollSupressionThreshold && b.preventDefault()
                            }
                        }

                        var h = d.touches ? d.touches[0] :
                            d.originalEvent.touches ? d.originalEvent.touches[0] : d, t = {time: (new Date).getTime(), coords: [h.pageX, h.pageY], origin: e(d.target)}, a;
                        b.bind(s, f).bind(x, c)
                    });
                    this.setupDone = !0
                }
            }};
        e.each({swipeleft: "swipe", swiperight: "swipe"}, function (b, d) {
            e.event.special[b] = {setup: function () {
                e(this).bind(d, e.noop)
            }, teardown: function (b, f, h) {
                e(b).unbind(d)
            }}
        })
    })
})(AdobeEdge, window);
(function (f) {
    function r(b, c, a, k, g, e) {
        null !== s[c] && (this.superProperty = s[c].cssProp, b = s[c].type, "color" === b ? f.ColorTween && (p.extend(this, f.ColorTween.prototype), p.extend(this, d), f.ColorTween.call(this, b, c, a, k, g, e)) : (p.extend(this, h.prototype), p.extend(this, d), f.PropertyTween.call(this, b, c, a, k, g, e)));
        this.name = "subpropertyTween"
    }

    function u() {
        var b = f.$.data(this.element, this.prop);
        b && r.applySubproperty(this.element, b, b.tween)
    }

    function e(b, c) {
        var a = b[0], k = this.name, g = f.$.data(a, s[k].cssProp);
        g || (g = d.buildProp.call({superProperty: s[k].cssProp},
            a), f.$.data(a, s[k].cssProp, g));
        g[k] = c;
        g.onFinalUpdate.call({element: a, prop: s[k].cssProp})
    }

    var p = f.$, h = f.PropertyTween, l = f.UpdateFinalizer, q, x = {"box-shadow": {def: "box-shadow", "-webkit-box-shadow": "boxShadow.color boxShadow.offsetH boxShadow.offsetV boxShadow.blur boxShadow.spread boxShadow.inset".split(" "), "-moz-box-shadow": "boxShadow.color boxShadow.offsetH boxShadow.offsetV boxShadow.blur boxShadow.spread boxShadow.inset".split(" "), "box-shadow": "boxShadow.color boxShadow.offsetH boxShadow.offsetV boxShadow.blur boxShadow.spread boxShadow.inset".split(" ")},
        "text-shadow": {def: "text-shadow", "text-shadow": ["textShadow.color", "textShadow.offsetH", "textShadow.offsetV", "textShadow.blur"]}, filter: {def: "-webkit-filter", "-webkit-filter": "filter.invert filter.hue-rotate filter.contrast filter.saturate filter.brightness filter.sepia filter.grayscale filter.blur filter.drop-shadow.color filter.drop-shadow.offsetH filter.drop-shadow.offsetV filter.drop-shadow.blur".split(" "), "-moz-filter": "filter.invert filter.hue-rotate filter.contrast filter.saturate filter.brightness filter.sepia filter.grayscale filter.blur filter.drop-shadow.color filter.drop-shadow.offsetH filter.drop-shadow.offsetV filter.drop-shadow.blur".split(" "),
            filter: "filter.invert filter.hue-rotate filter.contrast filter.saturate filter.brightness filter.sepia filter.grayscale filter.blur filter.drop-shadow.color filter.drop-shadow.offsetH filter.drop-shadow.offsetV filter.drop-shadow.blur".split(" ")}, "background-size": {def: "background-size", "background-size": ["background-size.x", "background-size.y"]}, "background-position": {def: "background-position", "background-position": ["background-position.x", "background-position.y"]}}, s = {"boxShadow.offsetH": {cssProp: "box-shadow",
        type: "style", def: "0px", u: "px", i: 1}, "boxShadow.offsetV": {cssProp: "box-shadow", type: "style", def: "0px", u: "px", i: 2}, "boxShadow.blur": {cssProp: "box-shadow", type: "style", def: "0px", u: "px", i: 3}, "boxShadow.spread": {cssProp: "box-shadow", type: "style", def: "0px", u: "px", i: 4}, "boxShadow.color": {cssProp: "box-shadow", type: "color", def: "rgba(0,0,0,0)", i: 5}, "boxShadow.inset": {cssProp: "box-shadow", def: "", i: 0}, "textShadow.offsetH": {cssProp: "text-shadow", type: "style", def: "0px", u: "px", i: 1}, "textShadow.offsetV": {cssProp: "text-shadow",
        type: "style", def: "0px", u: "px", i: 2}, "textShadow.blur": {cssProp: "text-shadow", type: "style", def: "0px", u: "px", i: 3}, "textShadow.color": {cssProp: "text-shadow", type: "color", def: "rgba(0,0,0,0)", i: 0}, "filter.drop-shadow.color": {cssProp: "filter", type: "color", def: "rgba(0,0,0,0)", strReplace: "drop-shadow(%1", combinedNum: 4, i: 8}, "filter.drop-shadow.offsetH": {cssProp: "filter", type: "style", def: "0px", u: "px", i: 9}, "filter.drop-shadow.offsetV": {cssProp: "filter", type: "style", def: "0px", u: "px", i: 10}, "filter.drop-shadow.blur": {cssProp: "filter",
        type: "style", def: "0px", strReplace: "%1)", u: "px", i: 11}, "filter.grayscale": {cssProp: "filter", type: "style", def: "0", strReplace: "grayscale(%1)", i: 6}, "filter.sepia": {cssProp: "filter", type: "style", def: "0", strReplace: "sepia(%1)", i: 5}, "filter.saturate": {cssProp: "filter", type: "style", def: "1", strReplace: "saturate(%1)", i: 3}, "filter.hue-rotate": {cssProp: "filter", type: "style", def: "0deg", strReplace: "hue-rotate(%1)", u: "deg", i: 1}, "filter.invert": {cssProp: "filter", type: "style", def: "0", strReplace: "invert(%1)", i: 0}, "filter.brightness": {cssProp: "filter",
        type: "style", def: "0", strReplace: "brightness(%1)", i: 4}, "filter.contrast": {cssProp: "filter", type: "style", def: "1", strReplace: "contrast(%1)", i: 2}, "filter.blur": {cssProp: "filter", type: "style", def: "0px", strReplace: "blur(%1)", u: "px", i: 7}, "background-position.x": {cssProp: "background-position", type: "style", def: "0px", u: "px", i: 2, domProp: "fill"}, "background-position.y": {cssProp: "background-position", type: "style", def: "0px", u: "px", i: 3, domProp: "fill"}, "background-size.x": {cssProp: "background-size", type: "style",
        def: "100%", u: "%", i: 4, domProp: "fill"}, "background-size.y": {cssProp: "background-size", type: "style", def: "100%", u: "%", i: 5, domProp: "fill"}}, b = 1, d = {setValue: function (b, c, a) {
        f.$.data(this, s[c].cssProp)[c] = a
    }, getValue: function (b, c) {
        f.$.data(this, s[b].cssProp)
    }, setupForAnimation: function () {
        var b = this;
        this.getElementSet().each(function () {
            var c = f.$.data(this, b.superProperty);
            c || (c = b.buildProp(this), f.$.data(this, b.superProperty, c))
        });
        h.prototype.setupForAnimation.call(this)
    }, buildProp: function (c) {
        var d, a = {},
            k = this.superProperty, g = f.getSubProps(c, k);
        for (d in g)g.hasOwnProperty(d) && (a[d] = g[d]);
        a.id = this.superProperty + b;
        b += 1;
        a.element = c;
        a.prop = k;
        a.onFinalUpdate = u;
        return a
    }, update: function (b, c) {
        h.prototype.update.call(this, b, c);
        var a = this.getElementSet(), d = this, g = this.property, e = this.tweenType;
        a.each(function () {
            if (d.getPropertyTweenData(this, e, g).animationID === d.animationID) {
                var a = f.$.data(this, d.superProperty);
                a.timeline = d.timeline;
                a.tween = d;
                l.Register(d.timeline, a.id, a)
            }
        })
    }};
    r.prototype.constructor = r;
    f.getSubProps = function (b, c) {
        var a = p(b), d, g;
        for (g in x[c])if (x[c].hasOwnProperty(g) && (d = a.css(g)) && "" !== d && "none" !== d) {
            if ("filter" == c) {
                g = x[c][g];
                d = d.replace(/,\s*/g, ",");
                var a = [], e = void 0;
                a["filter.invert"] = (e = d.match(/invert\((.*?)\)/)) ? e[1] : null;
                a["filter.hue-rotate"] = (e = d.match(/hue-rotate\((.*?)\)/)) ? e[1] : null;
                a["filter.contrast"] = (e = d.match(/contrast\((.*?)\)/)) ? e[1] : null;
                a["filter.saturate"] = (e = d.match(/saturate\((.*?)\)/)) ? e[1] : null;
                a["filter.brightness"] = (e = d.match(/brightness\((.*?)\)/)) ?
                    e[1] : null;
                a["filter.sepia"] = (e = d.match(/sepia\((.*?)\)/)) ? e[1] : null;
                a["filter.grayscale"] = (e = d.match(/grayscale\((.*?)\)/)) ? e[1] : null;
                a["filter.blur"] = (e = d.match(/blur\((.*?)\)/)) ? e[1] : null;
                d = (e = d.match(/drop-shadow\((.*?\)\s*.*?)\)/)) ? e[1].split(" ") : [null, null, null, null];
                a["filter.drop-shadow.color"] = d[0];
                a["filter.drop-shadow.offsetH"] = d[1];
                a["filter.drop-shadow.offsetV"] = d[2];
                a["filter.drop-shadow.blur"] = d[3];
                d = [];
                e = void 0;
                for (e = 0; e < g.length; e += 1)d[g[e]] = a[g[e]] || s[g[e]].def;
                return d
            }
            a = d;
            g = x[c][g];
            a = a.replace(/,\s*/g, ",");
            a = a.split(" ");
            d = [];
            e = void 0;
            for (e = 0; e < g.length; e += 1)d[g[e]] = a[e] || s[g[e]].def;
            return d
        }
        return[]
    };
    r.getSubType = function (b) {
        return s[b] ? s[b].type : void 0
    };
    r.getStyle = function (b) {
        return s[b] ? s[b].cssProp : void 0
    };
    r.applySubproperty = function (b, c, a) {
        var d, g, e, f = p(b);
        for (g in x[c.prop])if ("def" !== g && x[c.prop].hasOwnProperty(g)) {
            d = "";
            var n = !0;
            for (b = 0; b < x[c.prop][g].length; b += 1) {
                e = c[x[c.prop][g][b]];
                void 0 === e && (e = s[x[c.prop][g][b]].def);
                if ("combinedNum"in s[x[c.prop][g][b]])for (var n =
                    !0, h = b; h < b + s[x[c.prop][g][b]].combinedNum; h++)void 0 !== c[x[c.prop][g][h]] && c[x[c.prop][g][h]] != s[x[c.prop][g][h]].def && (n = !1);
                x[c.prop][g][b].match(/^filter./) && e == s[x[c.prop][g][b]].def && n || ("strReplace"in s[x[c.prop][g][b]] && (e = s[x[c.prop][g][b]].strReplace.replace("%1", e)), d += e, b !== x[c.prop][g].length - 1 && (d += " "))
            }
            (window.edge_authoring_mode && g === x[c.prop].def || !window.edge_authoring_mode) && f.css(g, d)
        }
        a && a.notifier.obs.length && a.notifyObservers("onUpdate", {elapsed: 0, easingConst: 0, property: g, value: d,
            element: f[0]})
    };
    f.SubpropertyTween = r;
    f.Timeline.addTweenType("subproperty", function (b, c, a, d, g) {
        return new r("subproperty", b, c, a, d, g)
    });
    var c, n;
    for (q in s)c = {}, s.hasOwnProperty(q) && (f.Timeline.addTweenProperty(q, "subproperty"), n = s[q], c[q] = {f: n.domProp || f.camelize(n.cssProp), i: n.i, j: n.j, def: n.def}, s[q].u && (c[q].u = s[q].u), f.defineProps(c), f._.p[q].apply = e)
})(window.AdobeEdge);
(function (f) {
    function r(b, a, c, d, e, n) {
        f.PropertyTween.call(this, b, a, c, d, e, n);
        this.name = "transformTween"
    }

    function u(b) {
        var a = 0;
        "string" === typeof b ? a = parseFloat(b.replace(/[a-zA-Z%]+$/, "")) : "number" === typeof b && (a = b);
        return a
    }

    function e(b, a, c) {
        if (void 0 === a)return c;
        if (void 0 === c)return a;
        var d = u(a), e = u(c), n;
        if (!d)return c;
        if (!e)return a;
        a = f.splitUnits(a).units;
        c = f.splitUnits(c).units;
        n = a;
        a !== c && ("%" === a && (n = c, d = d / 100 * b), "%" === c && (e = e / 100 * b));
        return d + e + n
    }

    function p() {
    }

    var h = f.$, l = f.PropertyTween, q =
        f.UpdateFinalizer, x = Math.cos, s = Math.PI / 180, b, d = "translateX translateY translateZ scaleX scaleY rotateX rotateY rotateZ skewX skewY".split(" ");
    b = f.supported = f.supported || {};
    var c = 1, n = {translate3d: 0, translate: 0, translateX: 0, translateY: 0, translateZ: 0, rotate: 1, rotateZ: 1, rotateX: 1, rotateY: 1, rotate3d: 1, skew: 2, skewX: 2, skewY: 2, scale3d: 3, scale: 3, scaleX: 3, scaleY: 3, scaleZ: 3, perspective: 4}, v = "webkitAppearance"in document.documentElement.style;
    b.cssTransform = f.isSupported(["transformProperty", "WebkitTransform",
        "MozTransform", "OTransform", "msTransform"]);
    b.cssTransform3d = f.isSupported(["perspectiveProperty", "WebkitPerspective", "MozPerspective", "OPerspective", "msPerspective"]);
    f.An$.prototype.hasClass = f.An$.prototype.hasClass || function (b) {
        if (this[0]) {
            var a = (this[0].className || "").split(/\s+/), c;
            for (c = 0; c < a.length; c += 1)if (b === a[c])return!0
        }
        return!1
    };
    r.removeData = function (b) {
        var a = f.$.data(b, r.dataName);
        a && (a.timeline && q.unRegister(a.timeline, a.id), f.$.data(b, r.dataName, void 0))
    };
    r.getNumber = u;
    r.splitUnits =
        f.splitUnits;
    r.applyTransform = function (b, a, c, d) {
        void 0 !== f.applyCount && (f.applyCount += 1);
        b = h(b);
        var m, n = !0, l, p;
        d && (n = !d.dontForceZ);
        m = e(1, a.translateX, a.motionTranslateX);
        l = e(1, a.translateY, a.motionTranslateY);
        d = e(1, a.rotateZ, a.motionRotateZ);
        p = f.supported.cssTransform3d;
        v ? (m = "translate(" + m + "," + l + ")", l = u(a.translateZ), (0 !== l || n) && p && (m += " translateZ(" + a.translateZ + ")"), m += " rotate(" + d + ") ", p && (l = u(a.rotateY), 0 !== l && (m += " rotateY(" + a.rotateY + ")"), l = u(a.rotateX), 0 !== l && (m += " rotateX(" + a.rotateX + ")")),
            a.skewX && "0deg" !== a.skewX && (m += " skewX(" + a.skewX + ") "), a.skewY && "0deg" !== a.skewY && (m += " skewY(" + a.skewY + ") "), m += " scale(" + a.scaleX + "," + a.scaleY + ") ", l = u(a.scaleZ), 1 !== l && p && (m += " scaleZ(" + a.scaleZ + ")"), !window.edge_authoring_mode && p && b.css("-webkit-transform-style", "preserve-3d"), b.css("-webkit-transform", m)) : (p = u(a.rotateX), n = u(a.rotateY), n = a.scaleX * x(s * n), p = a.scaleY * x(s * p), m = "translate(" + m + "," + l + ")" + (" rotate(" + d + ")"), a.skewX && "0deg" !== a.skewX && (m += " skewX(" + a.skewX + ") "), a.skewY && "0deg" !== a.skewY &&
            (m += " skewY(" + a.skewY + ") "), m += " scale(" + n + "," + p + ")", b.css("-moz-transform", m), b.css("-o-transform", m), b.css("-ms-transform", m), b.css("msTransform", m));
        c && c.notifier.obs.length && c.notifyObservers("onUpdate", {elapsed: 0, easingConst: 0, property: "transform", value: m, element: b[0]});
        b.css("transform", m)
    };
    r.dataName = "EdgeTransformData";
    h.extend(r.prototype, l.prototype);
    h.extend(r.prototype, {constructor: r, setup: function (b) {
        this.timeline = b;
        this.updateTriggered = !1
    }, setValue: function (b, a, c) {
        f.$.data(this, r.dataName)[a] =
            c
    }, getValue: function (b, a) {
        f.$.data(this, r.dataName)
    }, setupForAnimation: function () {
        var b = this, a;
        this.getElementSet().each(function () {
            a = f.$.data(this, r.dataName);
            a || (a = b.buildTransformData(this), f.$.data(this, r.dataName, a))
        });
        l.prototype.setupForAnimation.call(this)
    }, update: function (b, a) {
        l.prototype.update.call(this, b, a);
        var c = this.getElementSet(), d = this, e = this.property, n = this.tweenType;
        c.each(function () {
            var a;
            d.getPropertyTweenData(this, n, e).animationID === d.animationID && (a = f.$.data(this, r.dataName),
                a.timeline = d.timeline, a.tween = d, q.Register(d.timeline, a.id, a))
        })
    }, buildTransformData: function (b) {
        var a = f.parseCanonicalTransform(b);
        a || (a = {translateX: "0px", translateY: "0px", translateZ: "0px", scaleX: 1, scaleY: 1, scaleZ: 1, rotateX: "0deg", rotateY: "0deg", rotateZ: "0deg", skewXZ: 0, skewXY: 0, skewYZ: 0, skewX: "0deg", skewY: "0deg"}, a.matrix && delete a.matrix);
        null === a && (a = {});
        a.id = "transform_" + c;
        c += 1;
        a.element = b;
        a.onFinalUpdate = q.prototype.applyTransform;
        return a
    }, buildDefaultTransformData: function (b) {
        var a = {translateX: "0px",
            translateY: "0px", translateZ: "0px", scaleX: 1, scaleY: 1, scaleZ: 1, rotateX: "0deg", rotateY: "0deg", rotateZ: "0deg", skewXZ: 0, skewXY: 0, skewYZ: 0, skewX: "0deg", skewY: "0deg"};
        a.id = "transform_" + c;
        c += 1;
        a.element = b;
        a.onFinalUpdate = q.prototype.applyTransform;
        return a
    }});
    f.getTransform = function (b) {
        b = h(b);
        var a = b[0].style, c;
        v && ((c = b[0].style.webkitTransform) || (c = b.css("-webkit-transform")));
        if (c)return c;
        (c = b[0].style.msTransform) || (c = b.css("-ms-transform"));
        c || (c = b.css("msTransform"));
        c || (c = a.MozTransform);
        c || (c = a["-moz-transform"]);
        c || (c = b.css("-moz-transform"));
        c || (c = a.oTransform);
        c || (c = b.css("-o-transform"));
        c || (c = a.transform);
        c || (c = b.css("transform"));
        return c || ""
    };
    f.parseCanonicalTransform = function (b, a) {
        var c = ("string" === typeof a ? a : f.getTransform(b)).match(/(\w+\s*\([^\)]*\))/g), d = {}, e = {}, h, s, l;
        if (!c)return null;
        e.translateX = "0px";
        e.translateY = "0px";
        e.translateZ = "0px";
        e.scaleX = 1;
        e.scaleY = 1;
        e.scaleZ = 1;
        e.rotateX = "0deg";
        e.rotateY = "0deg";
        e.rotateZ = "0deg";
        e.skewXZ = 0;
        e.skewXY = 0;
        e.skewYZ = 0;
        e.skewX = "0deg";
        e.skewY = "0deg";
        for (h = 0; h <
            c.length; h += 1) {
            s = c[h].match(/\w+/);
            if (d[s[0]] || 0 > n[s[0]])return null;
            l = c[h].match(/\([^\)]*\)/);
            l = l[0].replace(/[\(\)]/g, "");
            l = l.split(",");
            switch (s[0]) {
                case "matrix":
                    return null;
                case "translate3d":
                    e.translateX = l[0];
                    e.translateY = 1 < l.length ? l[1] : "0px";
                    e.translateZ = 2 < l.length ? l[2] : "0px";
                    d.translate3d = d.translate = d.translateX = d.translateY = d.translateZ = !0;
                    break;
                case "translate":
                    e.translateX = l[0];
                    e.translateY = 1 < l.length ? l[1] : "0px";
                    d.translate3d = d.translate = d.translateX = d.translateY = !0;
                    break;
                case "translateX":
                    e.translateX =
                        l[0];
                    d.translate3d = d.translate = d.translateX = !0;
                    break;
                case "translateY":
                    e.translateY = l[0];
                    d.translate3d = d.translate = d.translateY = !0;
                    break;
                case "translateZ":
                    e.translateZ = l[0];
                    d.translate3d = d.translateZ = !0;
                    break;
                case "rotate3d":
                    return d.rotate3d = d.rotate = d.rotateX = d.rotateY = d.rotateZ = !0, null;
                case "rotateX":
                    e.rotateX = l[0];
                    d.rotate3d = d.rotateX = !0;
                    break;
                case "rotateY":
                    e.rotateY = l[0];
                    d.rotate3d = d.rotateY = !0;
                    break;
                case "rotateZ":
                case "rotate":
                    e.rotateZ = l[0];
                    d.rotate3d = d.rotate = d.rotateZ = !0;
                    break;
                case "skew":
                    e.skewX =
                        l[0];
                    e.skewY = 1 < l.length ? l[1] : "0px";
                    d.skew = d.skewX = d.skewY = !0;
                    break;
                case "skewX":
                    e.skewX = l[0];
                    d.skew = d.skewX = !0;
                    break;
                case "skewY":
                    e.skewY = l[0];
                    d.skew = d.skewY = !0;
                    break;
                case "scale3d":
                    e.scaleX = l[0];
                    e.scaleY = 1 < l.length ? l[1] : 1;
                    e.scaleZ = 2 < l.length ? l[2] : 1;
                    d.scale3d = d.scale = d.scaleX = d.scaleY = d.scaleZ = !0;
                    break;
                case "scale":
                    e.scaleX = l[0];
                    e.scaleY = 1 < l.length ? l[1] : l[0];
                    d.scale = d.scaleX = d.scaleY = !0;
                    break;
                case "scaleX":
                    e.scaleX = l[0];
                    d.scale3d = d.scale = d.scaleX = !0;
                    break;
                case "scaleY":
                    e.scaleY = l[0];
                    d.scale3d = d.scale =
                        d.scaleY = !0;
                    break;
                case "scaleZ":
                    e.scaleZ = l[0];
                    d.scale3d = d.scaleZ = !0;
                    break;
                case "perspective":
                    d.perspective = !0
            }
        }
        return e
    };
    f.TransformTween = r;
    h.extend(q.prototype, {applyTransform: function (b) {
        var a = f.$.data(this.element, r.dataName);
        a && b && r.applyTransform(this.element, a, a.tween, b.context)
    }});
    p.applySubprop = function (b, a) {
        var c = b[0], d = this.name, e = r.prototype.buildTransformData(c);
        e[d] = a;
        r.applyTransform(c, e, null, {})
    };
    f.Timeline.addTweenType("transform", function (b, a, c, d, e) {
        return new r("transform", b, a, c,
            d, e)
    });
    for (b = 0; b < d.length; b += 1)f.Timeline.addTweenProperty(d[b], "transform");
    f.defineProps({translateX: {f: "transform", i: 0, j: 0, u: "px"}, translateY: {f: "transform", i: 0, j: 1, u: "px"}, translateZ: {f: "transform", i: 0, j: 2, u: "px"}, rotateZ: {f: "transform", i: 1, j: 0, u: "deg"}, rotateX: {f: "transform", i: 1, j: 1, u: "deg"}, rotateY: {f: "transform", i: 1, j: 2, u: "deg"}, skewX: {f: "transform", i: 2, j: 0, u: "deg"}, skewY: {f: "transform", i: 2, j: 1, u: "deg"}, scaleX: {f: "transform", i: 3, j: 0}, scaleY: {f: "transform", i: 3, j: 1}, scaleZ: {f: "transform", i: 3,
        j: 2}});
    for (b = 0; b < d.length; b += 1)f._.p[d[b]].apply = p.applySubprop
})(window.AdobeEdge);
(function (f) {
    function r() {
        if (!x) {
            var a = document.createElement("div"), a = h(a), e, g;
            a.css("background-color", "transparent");
            g = a.css("background-color");
            a.css("background-color", "rgb(100, 100, 100)");
            e = a.css("background-color");
            s = e !== g;
            a.css("background-color", "transparent");
            a.css("background-color", "hsl(100, 100%, 100%)");
            e = a.css("background-color");
            b = e !== g;
            a.css("background-color", "transparent");
            a.css("background-color", "rgba(100, 100, 100,.5)");
            e = a.css("background-color");
            d = e !== g;
            a.css("background-color",
                "transparent");
            a.css("background-color", "hsla(100, 100%, 100%, .5)");
            e = a.css("background-color");
            c = e !== g;
            x = !0
        }
    }

    function u(a, b, c, d, e, n) {
        f.PropertyTween.call(this, a, b, c, d, e, n);
        this.name = "colorTween";
        r()
    }

    function e(a) {
        return 0 > a ? a + 1 : 1 < a ? a - 1 : a
    }

    function p(a, b, c, d) {
        return d < v ? a + c * d : 0.5 > d ? b : d < t ? a + c * (t - d) : a
    }

    var h = f.$, l = ["color", "background-color", "border-color"], q, x = !1, s = !1, b = !1, d = !1, c = !1, n = 1 / 3, v = 1 / 6, t = 2 / 3;
    h.extend(u.prototype, f.PropertyTween.prototype);
    h.extend(u.prototype, {constructor: u, getValue: function (a, b) {
        return h(this).css(a)
    }, setValue: function (a, b, c) {
        h(this).css(b, c)
    }, parseValue: function (a) {
        var b = f.parseColorValue(a), c = /rgb/gi, d = /hsl/gi;
        if (b && b.colorFunction && b.values) {
            a = b.values;
            b = b.colorFunction;
            if (b.match(c))if (this.animationColorSpace && "HSL" === this.animationColorSpace)c = {r: a[0], g: a[1], b: a[2]}, (c = f.rgbToHSL(c)) ? 3 < a.length ? (a = a[3], a = [c.h, c.s, c.l, a]) : a = [c.h, c.s, c.l] : a = []; else if (!this.animationColorSpace)this.animationColorSpace = "RGB"; else {
                if ("RGB" !== this.animationColorSpace)return a
            } else if (b.match(d))if (this.animationColorSpace &&
                "RGB" === this.animationColorSpace)c = {h: a[0], s: a[1], l: a[2]}, (c = f.hslToRGB(c)) ? 3 < a.length ? (a = a[3], a = [c.r, c.g, c.b, a]) : a = [c.r, c.g, c.b] : a = []; else if (!this.animationColorSpace)this.animationColorSpace = "HSL"; else if ("HSL" !== this.animationColorSpace)return a;
            3 === a.length && (a[3] = 1);
            return a
        }
    }, formatValue: function (a) {
        r();
        if (a) {
            var b, e, n;
            "HSL" === this.animationColorSpace && c ? (b = "hsl", a = 4 === a.length && c ? b + "a(" + a[0] + "," + a[1] + "%," + a[2] + "%," + a[3] + ")" : b + "(" + a[0] + "," + a[1] + "%," + a[2] + "%)") : d ? (b = "rgb", a = 4 === a.length && d ?
                b + "a(" + a[0] + "%," + a[1] + "%," + a[2] + "%," + a[3] + ")" : b + "(" + a[0] + "%," + a[1] + "%," + a[2] + "%)") : (b = a[0], e = a[1], n = a[2], "HSL" === this.animationColorSpace && (a = f.hslToRGB({h: a[0], g: a[1], b: a[2]}), b = a.r, e = a.g, n = a.b), a = 65536 * Math.floor(2.55 * b) + 256 * Math.floor(2.55 * e) + Math.floor(2.55 * n), a = "#" + a.toString(16));
            return a
        }
    }});
    f.ColorTween = u;
    f.Color = {formatValue: u.prototype.formatValue, parseValue: u.prototype.parseValue};
    f.parseColorValue = function (a) {
        if (a) {
            var b = [], c, d, e = /^\s*#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])\s*$/, f = /rgb/gi,
                n = /hsl/gi;
            (d = /^\s*#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})\s*$/.exec(a)) ? (b = [parseInt(d[1], 16) / 255 * 100, parseInt(d[2], 16) / 255 * 100, parseInt(d[3], 16) / 255 * 100], c = "rgb") : (d = e.exec(a)) ? (b = [parseInt(d[1] + d[1], 16) / 255 * 100, parseInt(d[2] + d[2], 16) / 255 * 100, parseInt(d[3] + d[3], 16) / 255 * 100], c = "rgb") : "transparent" === a && (b = [0, 0, 0, 0], c = "rgb");
            c || (c = a.toString().match(/\w+/), h.isArray(c) ? c = c[0] : c || (c = ""), (d = a.toString().match(/\([\d%,\.\s]*\)/)) && 0 < d.length && (d = d[0].replace(/[\(\)]/g, "")));
            if (0 === b.length)if (c.match(f))if ((e =
                /^\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*(?:,\s*([0-9](?:\.[0-9]+)?)\s*)?$/.exec(d)) && 4 <= e.length) {
                for (a = 0; 3 > a; a += 1)b[a] = e[a + 1] / 255 * 100;
                4 < e.length && (e[4] || (e[4] = 1), b[3] = e[4])
            } else {
                if ((d = /^\s*([0-9]{1,3}(?:\.[0-9]+)?)\s*%\s*,\s*([0-9]{1,3}(?:\.[0-9]+)?)\s*%\s*,\s*([0-9]{1,3}(?:\.[0-9]+)?)\s*%\s*(?:,\s*([0-9](?:\.[0-9]+)?)\s*)?$/.exec(d)) && 4 <= d.length)for (5 <= d.length && (d.length = 5, d[4] || (d[4] = 1)), a = 0; a < d.length - 1; a += 1)b[a] = d[a + 1]
            } else if (c.match(n) && (d = /^\s*([0-9]{1,3}(?:\.[0-9]+)?)\s*,\s*([0-9]{1,3}(?:\.[0-9]+)?)\s*%\s*,\s*([0-9]{1,3}(?:\.[0-9]+)?)\s*%\s*(?:,\s*([0-9](?:\.[0-9]+)?)\s*)?$/.exec(d)) &&
                4 <= d.length)for (5 <= d.length && (d.length = 5, d[4] || (d[4] = 1)), a = 0; a < d.length - 1; a += 1)b[a] = d[a + 1];
            if (b)for (a = 0; a < b.length; a += 1)b[a] = Math.round(1E4 * b[a]) / 1E4;
            return{colorFunction: c, values: b}
        }
    };
    f.hslToRGB = function (a) {
        if (null === a || 0 > a.s || 100 < a.s || 0 > a.l || 100 < a.l)return null;
        for (; 360 < a.h;)a.h -= 360;
        for (; 0 > a.h;)a.h = 360 + a.h;
        var b = {}, c = a.h / 360, d = a.s / 100;
        a = a.l / 100;
        var f, h, l;
        0 === d ? b.r = b.g = b.b = a : (d = 0.5 >= a ? a * (1 + d) : a + d - a * d, a = 2 * a - d, f = e(c + n), h = e(c), c = e(c - n), l = 6 * (d - a), b.r = p(a, d, l, f), b.g = p(a, d, l, h), b.b = p(a, d, l, c));
        b.r = Math.min(100 *
            b.r, 100);
        b.g = Math.min(100 * b.g, 100);
        b.b = Math.min(100 * b.b, 100);
        b.r = Math.round(1E4 * b.r) / 1E4;
        b.g = Math.round(1E4 * b.g) / 1E4;
        b.b = Math.round(1E4 * b.b) / 1E4;
        return b
    };
    f.rgbToHSL = function (a) {
        if (null === a || 0 > a.r || 100 < a.r || 0 > a.g || 100 < a.g || 0 > a.b || 100 < a.b)return null;
        var b = {h: 0, s: 0, l: 0}, c = a.r / 100, d = a.g / 100;
        a = a.b / 100;
        var e = Math.max(c, d, a), f = Math.min(c, d, a), n;
        b.l = (e + f) / 2;
        e > f && 0 < b.l && (n = e - f, b.s = 0.5 >= b.l ? n / (e + f) : n / (2 - e - f), b.h = e === a ? 4 + (c - d) / n : e === d ? 2 + (a - c) / n : (d - a) / n, b.h *= 60, 360 < b.h ? b.h -= 360 : 0 > b.h && (b.h = 360 + b.h));
        b.s = Math.min(100 *
            b.s, 100);
        b.l = Math.min(100 * b.l, 100);
        b.h = Math.round(1E4 * b.h) / 1E4;
        b.s = Math.round(1E4 * b.s) / 1E4;
        b.l = Math.round(1E4 * b.l) / 1E4;
        return b
    };
    f.colorToSupported = function (a) {
        r();
        if (!d && /rgba/.test(a) || !s && /rgb/.test(a) || !c && /hsla/.test(a) || !b && /hsl/.test(a)) {
            var e = f.parseColorValue(a).values, g, n, h;
            if (4 <= e.length && 0.5 > e[3])return"transparent";
            g = e[0];
            n = e[1];
            h = e[2];
            /hsl/.test(a) && (a = f.hslToRGB({h: e[0], g: e[1], b: e[2]}), g = a.r, n = a.g, h = a.b);
            g = Math.floor(2.55 * g);
            n = Math.floor(2.55 * n);
            h = Math.floor(2.55 * h);
            g = (15 < g ? "" : "0") +
                g.toString(16);
            n = (15 < n ? "" : "0") + n.toString(16);
            h = (15 < h ? "" : "0") + h.toString(16);
            a = "#" + g + n + h
        }
        return a
    };
    f.Timeline.addTweenType("color", function (a, b, c, d, e) {
        return new u("color", a, b, c, d, e)
    });
    for (q = 0; q < l.length; q += 1)f.Timeline.addTweenProperty(l[q], "color")
})(window.AdobeEdge);
(function (f) {
    function r(b) {
        if (document.documentElement.style.hasOwnProperty("webkitAppearance")) {
            var d = e(b).css("-webkit-transform");
            d.match(/translateZ/) || d.match(/matrix3d/) || e(b).css("-webkit-transform", d + " translateZ(0)")
        }
    }

    function u(b, d, c, n, l, s) {
        var a = null, k, g;
        2 <= l.length && e.isArray(l[1]) && 2 <= n.length && e.isArray(n[1]) ? a = 1 : 2 <= l.length && e.isArray(l[4]) && 2 <= n.length && e.isArray(n[4]) && (a = 4);
        if (a)for (k = n[a].length < l[a].length ? n[a] : l[a], g = k === l[a] ? n[a] : l[a], a = k.length; a < g.length; a += 1)k[a] = k[a - 1];
        f.PropertyTween.call(this,
            b, d, c, n, l, s);
        this.name = "GradientTween";
        this.tweenType = h[b]
    }

    var e = f.$, p = f.PropertyTween, h = {gradient: 0}, l = {"background-image": {cssProp: "background-image", def: "0px", u: "px", i: 1}}, q, x = f._.p["background-image"].apply, s = f._.p["background-image"].prep;
    f.forceGPU = r;
    e.extend(u.prototype, p.prototype);
    e.extend(u.prototype, {constructor: u, setupForAnimation: function () {
        this.getElementSet().each(function () {
            r(this)
        });
        p.prototype.setupForAnimation.call(this)
    }, getValue: function (b, d) {
        return e(this).css(b)
    }, setValuePre: function (b, d, c) {
        e(this).css(d, "-webkit-" + c);
        e(this).css(d, "-moz-" + c);
        e(this).css(d, "-ms-" + c);
        e(this).css(d, "-o-" + c)
    }, setValue: function (b, d, c) {
        e(this).css(d, c)
    }, update: function (b, d) {
        var c = this.getElementSet(), e = this, f = this.tweenType, h, a, k, g, m, s;
        q = l[this.property].cssProp;
        this.updateTriggered || (this.updateTriggered = !0, this.setupForAnimation());
        c.each(function () {
            var c = e.getPropertyTweenData(this, f, e.property), l;
            if (c.animationID === e.animationID) {
                a = c.fromValues;
                k = c.toValues;
                g = e.filter;
                m = a.length;
                s = [];
                for (h = 0; h < m; h +=
                    1)l = a[h], c = k[h], l = "string" === typeof l ? 0 === d && 0 < e.duration ? l : c.value : l + (c.value - l) * d, g && g[h] && (l = g[h](l, e, this, q, c.unit, b)), "number" === typeof l && 1 > l && (l = l.toFixed(6)), s.push(l + c.unit);
                c = e.formatValuePre(s);
                l = e.formatValue(s);
                e.setValuePre.call(this, f, q, c);
                e.setValue.call(this, f, q, l);
                e.notifyObservers("onUpdate", {elapsed: b, easingConst: d, property: q, value: l, element: this})
            }
        })
    }, parseValue: function (b) {
        function d(a, b) {
            if (1 < a[b].length)return a[b][1];
            var c;
            c = 0 === b ? 0 : b === a.length - 1 ? 100 : (d(a, b - 1) + d(a, b + 1)) /
                2;
            a[b].push(c);
            return c
        }

        if (b && !(2 > b.length)) {
            "string" === typeof b && (b = JSON.parse(b));
            var c = null, n = null, h = null, l = null, a = null, k = [], g = !1, m = [], s;
            e.isArray(b[1]) ? (c = b[0], n = b[1], b[2] && (g = b[2])) : (h = [b[0], b[1]], l = b[2], a = b[3], n = b[4], b[5] && (g = b[5]));
            for (b = 0; b < n.length; b += 1)if (s = f.Color.parseValue(n[b][0], b))k = k.concat(s), k.push(d(n, b));
            if ((c = {angle: c, colorstops: k, centerPoint: h, ellipse: l, extent: a, repeating: g}) && c.colorstops)return null !== c.angle ? m = m.concat(c.angle) : c.centerPoint && (m = m.concat(c.centerPoint), m =
                m.concat([c.ellipse, c.extent])), m = m.concat(c.colorstops), m.concat(c.repeating)
        }
    }, formatValue: function (b) {
        return f.formatGradient(b, !1)
    }, formatValuePre: function (b) {
        return f.formatGradient(b, !0)
    }});
    f.GradientTween = u;
    f.Gradient = {parseValue: u.prototype.parseValue};
    f.formatGradient = function (b, d) {
        if (b) {
            var c = "", e = null, h, l, a;
            2 === b.length % 5 ? (e = 1, c = c + "linear-gradient(" + ((d ? b[0] : (450 - b[0]) % 360) + "deg,")) : (e = 4, c += "radial-gradient(", c = d ? c + (b[0] + "% " + b[1] + "%," + (1 == b[2] ? "ellipse" : "circle") + " " + b[3] + ",") : c + (b[3] +
                " " + (1 == b[2] ? "ellipse" : "circle") + " at " + b[0] + "% " + b[1] + "%,"));
            1 == b[b.length - 1] && (c = "repeating-" + c);
            if (!(12 > b.length || 0 !== (b.length - e - 1) % 5)) {
                a = Math.floor((b.length - e - 1) / 5);
                for (h = 0; h < a; h += 1)l = 5 * h + e, c += f.Color.formatValue(b.slice(l, l + 4)), -1 !== b[l + 4] && (c += " " + b[l + 4] + "%"), h !== a - 1 && (c += ",");
                return c += ")"
            }
        }
    };
    f.Timeline.addTweenType("gradient", function (b, d, c, e, f) {
        return new u("gradient", b, d, c, e, f)
    });
    f._.p["background-image"].apply = function (b, d) {
        var c, e;
        if ("string" === typeof d)return x.call(f._.p["background-image"],
            b, d);
        c = f.Gradient.parseValue(d);
        e = f.formatGradient(c, !1);
        c = f.formatGradient(c, !0);
        b.css("background-image", "-webkit-" + c);
        b.css("background-image", "-moz-" + c);
        b.css("background-image", "-ms-" + c);
        b.css("background-image", "-o-" + c);
        b.css("background-image", e)
    };
    f._.p["background-image"].prep = function (b, d, c, e, h, l, a) {
        return void 0 == d[c] || "string" === typeof d[c][e] ? s.call(f._.p["background-image"], b, d, c, e, h, l, a) : d[c][e]
    };
    for (q in l)l.hasOwnProperty(q) && f.Timeline.addTweenProperty(q, "gradient")
})(window.AdobeEdge);
(function (f) {
    function r(b, d, c, e, f, h) {
        x.call(this, b, "motion", c, void 0, void 0, h);
        this.name = "motionTween";
        (this.path = e) && 1 < e.length && 6 > e[0].length && (e[0][4] = e[0][5] = 0, e[e.length - 1].splice(2, 0, 0, 0));
        this.keyframes = [];
        b = document.createElement("div");
        c = q(b);
        null !== document.body && document.body.appendChild(b);
        c.css("left", "-9999px").css("width", "100px");
        c.css("transform-origin", "50% 50%").css("-webkit-transform-origin", "50% 50%").css("-moz-transform-origin", "50% 50%").css("-ms-transform-origin", "50% 50%").css("-o-transform-origin",
            "50% 50%");
        d = c.css("transform-origin") || c.css("-webkit-transform-origin") || c.css("-moz-transform-origin") || c.css("-ms-transform-origin") || c.css("-o-transform-origin");
        c.css("border-width", "10px").css("border-style", "solid");
        c = c.css("transform-origin") || c.css("-webkit-transform-origin") || c.css("-moz-transform-origin") || c.css("-ms-transform-origin") || c.css("-o-transform-origin");
        null !== b.parentNode && b.parentNode.removeChild(b);
        this.originIncludesBorders = d !== c
    }

    function u(b, d, c) {
        try {
            if (b[0] === d[0] && b[1] ===
                d[1])return{x: d[0], y: d[1]}
        } catch (e) {
        }
        var f = {}, h = c * c, a = h * c, k = 2 * a - 3 * h + 1;
        c = a - 2 * h + c;
        var g = -2 * a + 3 * h, h = a - h;
        f.x = k * b[0] + c * b[2] + g * d[0] + h * d[4];
        f.y = k * b[1] + c * b[3] + g * d[1] + h * d[5];
        return f
    }

    function e(b, d, c) {
        if (b[0] === d[0] && b[1] === d[1])return{dx: 0, dy: 0};
        var e = {}, f = c * c, h = 6 * f - 6 * c, a = 3 * f - 4 * c + 1, k = -6 * f + 6 * c;
        c = 3 * f - 2 * c;
        var f = b[3], g = d[5];
        e.dx = h * b[0] + a * b[2] + k * d[0] + c * d[4];
        e.dy = h * b[1] + a * f + k * d[1] + c * g;
        return e
    }

    function p(b, d) {
        var c = b.x - d.x, e = b.y - d.y;
        return Math.sqrt(c * c + e * e)
    }

    function h(b, d, c, e, f) {
        var l = Math.floor(c[e].b), a = (c[e].b +
            c[e + 1].b) / 2 - l, k = u(b, d, a), g = 0;
        p({x: (c[e].x + c[e + 1].x) / 2, y: (c[e].y + c[e + 1].y) / 2}, k) > f && (k.b = a + l, c.splice(e + 1, 0, k), g = h(b, d, c, e + 1, f), g = g + h(b, d, c, e, f) + 1);
        return g
    }

    function l(b) {
        var d, c, e, f, l, a, k, g;
        for (d = 0; d < b.length - 1; d++) {
            f = [0, 0, 3 * b[d].upper.x, 3 * b[d].upper.y, 3 * b[d].lower.x, 3 * b[d].lower.y];
            l = [1, 1, 3 * b[d + 1].upper.x, 3 * b[d + 1].upper.y, 3 * (1 - b[d + 1].lower.x), 3 * (1 - b[d + 1].lower.y)];
            a = [];
            for (c = 0; 5 > c; c++)e = c / 4, k = {b: e}, g = u(f, l, e), k.x = g.x, k.y = g.y, k.b = e, a[c] = k;
            a:{
                c = a;
                e = p(c[c.length - 1], c[0]);
                var m = k = void 0, s = m = void 0;
                g =
                    c[c.length - 1].x - c[0].x;
                var q = c[c.length - 1].y - c[0].y;
                for (k = 1; k < c.length - 1; k++)if (m = {x: c[k].x - c[0].x, y: c[k].y - c[0].y}, m = m.x * g + m.y * q, s = e * p(c[k], c[0]), 0.005 < Math.abs(Math.acos(m / s))) {
                    c = !1;
                    break a
                }
                c = !0
            }
            if (c)a.splice(1, 3); else for (c = 0; 4 > c; c++)e = 3 - c, h(f, l, a, e, 0.01);
            f = b[d];
            l = 1;
            s = m = q = g = k = e = c = void 0;
            for (c = 0; c < a.length - 1; c++)0 < a[c + 1].x - a[c].x && (l = Math.min(l, a[c + 1].x - a[c].x));
            k = Math.ceil(1 / l);
            g = 1 / k;
            q = [];
            m = 0;
            q[0] = {t: 0, e: 0};
            for (c = 0; c < k; c++) {
                for (e = c * g; e > a[m + 1].x && m < a.length - 2;)m++;
                s = a[m + 1].y;
                0 < a[m + 1].x - a[m].x &&
                (s = a[m].y + (e - a[m].x) * (a[m + 1].y - a[m].y) / (a[m + 1].x - a[m].x));
                q[c] = {t: e, e: s}
            }
            1 > q[q.length - 1].t && (q[q.length] = {t: 1, e: 1});
            f.easingTable = q
        }
    }

    var q = f.$, x = f.TransformTween, s = f.UpdateFinalizer;
    q.extend(r.prototype, x.prototype);
    q.extend(r.prototype, {constructor: r, getValue: function (b, d) {
    }, setupForAnimation: function () {
        x.prototype.setupForAnimation.call(this);
        this.points || (this.setUpPoints(), this.setUpLen2bMap(), l(this.keyframes));
        this.deltas || window.edge_authoring_mode || (this.getElementSet().each(function () {
            var b =
                q(this), c = f.$.data(this, "p_x") || "left", e = f.$.data(this, "p_y") || "top", h = q(this.parentElement), l = +parseFloat(b.css(c)) || 0, a = +parseFloat(b.css(e)) || 0;
            "%" === f.$.data(this, "u_x") && (l = l / 100 * +h.width());
            "%" === f.$.data(this, "u_y") && (a = a / 100 * +h.height());
            f.$.data(this, "deltaX", l);
            f.$.data(this, "deltaY", a);
            b.css(c, "0px").css(e, "0px")
        }), this.deltas = !0);
        for (var b = this; b._prevObj && (2 != b._prevObj.path.length || b._prevObj.path[0][0] !== b._prevObj.path[1][0] || b._prevObj.path[0][1] !== b._prevObj.path[1][1]);)b = b._prevObj;
        b = e(b.path[0], b.path[1], 1E-6);
        this.deltaRotate = 180 * Math.atan2(b.dx, b.dy) / Math.PI
    }, computeEasing: function (b) {
        var d = this.keyframes;
        b /= this.getDuration();
        var c = 0, e, f, h;
        for (e = 0; e < d.length - 1 && !(c = e, b <= d[e + 1].t); e++);
        e = d[c].easingTable;
        f = d[c + 1].l - d[c].l;
        b = (b - d[c].t) / (d[c + 1].t - d[c].t);
        h = Math.floor(b / (e[1].t - e[0].t));
        h = Math.min(e.length - 2, Math.max(h, 0));
        return d[c].l + (e[h].e + (b - e[h].t) * (e[h + 1].e - e[h].e) / (e[h + 1].t - e[h].t)) * f
    }, originInPx: function (b) {
        var d, c = {}, e = b.width(), h = b.height(), l, a;
        d = (b.css("transform-origin") ||
            b.css("-webkit-transform-origin") || b.css("-moz-transform-origin") || b.css("-ms-transform-origin") || b.css("-o-transform-origin") || "50% 50%").split(" ");
        0 < d[0].indexOf("%") ? (l = parseFloat(d[0].substring(0, d[0].length - 1)) / 100, a = parseFloat(d[1].substring(0, d[1].length - 1)) / 100, c.x = e * l, c.y = h * a) : (c.x = parseFloat(d[0].substring(0, d[0].length - 2)), c.y = parseFloat(d[1].substring(0, d[1].length - 2)));
        this.originIncludesBorders || (l = l || c.x / e, a = a || c.y / h, d = f.splitUnits(b.css("border-left-width")).num + f.splitUnits(b.css("border-right-width")).num ||
            0, d *= l, b = f.splitUnits(b.css("border-top-width")).num + f.splitUnits(b.css("border-bottom-width")).num || 0, c.x += d, c.y += b * a);
        return c
    }, update: function (b, d, c) {
        this.updateTriggered || (this.updateTriggered = !0, this.setupForAnimation(c));
        c = this.getElementSet(c);
        var h = this, l = this.property, p = this.tweenType, a = this.findSegment(d), k = this.path, g = this.easeToB(d), m = this.points[this.points.length - 1].l, r, g = Math.min(1, Math.max(0, g - a));
        r = Math.max(1E-6, Math.min(0.999999, g));
        var A = u(k[a], k[a + 1], g), a = e(k[a], k[a + 1], r), g = 180 *
            Math.atan2(a.dx, a.dy) / Math.PI, z, E;
        this._prevObj && 2 === k.length && k[0][0] === k[1][0] && k[0][1] === k[1][1] ? (E = !0, z = 0) : z = this.deltaRotate - g;
        if (0 > d || 1 < d)k = Math.atan2(a.dy, a.dx), a = 1 < d ? d - 1 : d, A.x += Math.cos(k) * m * a, A.y += Math.sin(k) * m * a;
        c.each(function () {
            var a = q(this), c = h.getPropertyTweenData(this, p, l), e = f.$.data(this, x.dataName), g = this.parentElement, k;
            e.tween = h;
            if (c.animationID === h.animationID) {
                var a = h.originInPx(a), c = f.$.data(this, "p_x") || "left", m = f.$.data(this, "p_y") || "top", r = A.x, u = A.y, y = f.$.data(this, "u_x") ||
                    "px", J = f.$.data(this, "u_y") || "px", O = !window.edge_authoring_mode, K = f.$.data(this, "doAutoOrient"), K = "true" === K ? !0 : "false" === K ? !1 : K;
                O && (k = q(g), g = k.width(), k = k.height(), "%" === y && (r = r / 100 * g), "%" === J && (u = u / 100 * k));
                r += "right" === c ? a.x : -1 * a.x;
                u += "bottom" === m ? a.y : -1 * a.y;
                O && (r += 0, u += 0);
                r = 0 !== r && 1E-6 > Math.abs(r) ? r.toFixed(6) : r.toString();
                u = 0 !== u && 1E-6 > Math.abs(u) ? u.toFixed(6) : u.toString();
                E || (K || (z = 0), z = 0.01 < Math.abs(z) ? z : 0, f.$.data(this, "motionRotateZ", z + "deg"), h.setValue.call(this, void 0, "motionRotateZ", z +
                    "deg"), s.Register(h.timeline, e.id, e));
                O ? (h.setValue.call(this, void 0, "motionTranslateX", r + "px"), h.setValue.call(this, void 0, "motionTranslateY", u + "px"), s.Register(h.timeline, e.id, e)) : (q(this).css(c, r + y), h.notifyObservers("onUpdate", {elapsed: b, easingConst: d, property: c, value: r + y, element: e.tween}), q(this).css(m, u + J), h.notifyObservers("onUpdate", {elapsed: b, easingConst: d, property: m, value: u + J, element: this}))
            }
        })
    }, findSegment: function (b) {
        b = this.len2b(b * this.points[this.points.length - 1].l);
        b = Math.floor(b);
        return Math.min(Math.max(b, 0), this.path.length - 2)
    }, easeToB: function (b) {
        return this.len2b(b * this.points[this.points.length - 1].l)
    }, setUpLen2bMap: function () {
        var b = 0, d, c, e = 60 * this.getDuration() / 1E3, f = this.len2bMap = [], h = this.points, a;
        for (d = 0; d < h.length - 1; d++)h[d].l = b, b += p(h[d], h[d + 1]);
        c = h[h.length - 1].l = b;
        this.len2bStep = e = c / e;
        d = b = 0;
        if (0 < c) {
            for (; b <= c;) {
                for (; d < h.length - 1 && b > h[d + 1].l;)d += 1;
                if (d >= h.length - 1)break;
                a = h[d].b + (b - h[d].l) * (h[d + 1].b - h[d].b) / (h[d + 1].l - h[d].l);
                f.push({l: b, b: a});
                b += e
            }
            f[f.length - 1].b <
                h[h.length - 1].b && f.push({l: h[h.length - 1].l, b: h[h.length - 1].b})
        } else f.push({l: 0, b: h[0].b})
    }, setUpPoints: function () {
        var b = this.path, d, c, e, f;
        this.points = [];
        for (d = 0; d < b.length - 1; d++)for (c = 0; 5 > c; c++)if (4 > c || d === b.length - 2)f = c / 4, e = {b: d + f}, f = u(b[d], b[d + 1], f), e.x = f.x, e.y = f.y, this.points.push(e);
        for (d = 1; d < b.length; d++)for (f = b.length - d - 1, c = 0; 4 > c; c++)e = 3 - c + 4 * f, h(b[f], b[f + 1], this.points, e, 2);
        return this.points
    }, len2b: function (b) {
        this.len2bMap || this.setUpLen2bMap();
        var d = this.len2bMap, c = Math.min(Math.max(0, Math.floor(b /
            this.len2bStep)), this.len2bMap.length - 2);
        return 0 === d.length ? 0 : 1 === d.length ? d[0].b : (b - d[c].l) * (d[c + 1].b - d[c].b) / (d[c + 1].l - d[c].l) + d[c].b
    }});
    f.MotionTween = r;
    f.Timeline.addTweenType("motion", function (b, d, c, e, f, h) {
        return new r("motion", b, d, c, e, f, h)
    });
    f.Timeline.addTweenProperty("motion", "motion");
    f.Timeline.addTweenProperty("location", "motion")
})(window.AdobeEdge);
(function (f) {
    function r(e, b, d, c, f, l) {
        if (d && c && e && e._s && e.sym && e.sym[d]) {
            var p = [], a;
            "object" == typeof c ? a = c : (a = b.find$(c)) || (a = b.$(c));
            a.each(function () {
                var a = h(this), b = document.createElement("div"), c = a._children(), r = {}, u, x;
                x = q.getParentSymbol(this, !0);
                if (u = new q(e.sym, d, e, x, l))(f || 0 === f) && a._children().eq(f)[0] ? 0 > f ? c.get(f).insertAfter(b) : c.get(f).insertBefore(b) : a.append(b), u.opts = u.opts || {}, h.extend(u.opts, r), u.init(b), u._applyBaseStyles(h(b), d), (x.ci = x.ci || []).push(u), p.push(u)
            });
            e.readyCalled &&
            p.forEach(function (a) {
                x._playAuto(a, !0);
                a.getSymbolElement().css("position", "relative")
            });
            return p
        }
    }

    function u(e, b) {
        var d, c = b.getSymbolElementNode().id;
        for (d = e.length - 1; 0 <= d; d--)e[d].getSymbolElementNode().id === c && e.splice(d, 1)
    }

    function e(f, b) {
        b = b || [];
        var d = f.parentNode;
        f && 1 === f.nodeType && (b.push(d), e(d, b));
        return b
    }

    function p(e, b) {
        b = b || {};
        var d = e.composition ? e.composition._s : null, c = {}, f = h.Event("beforeDeletion");
        h.extend(f, {Symbol: e, element: e.ele, performDefaultAction: !0});
        c && h.extend(f, c);
        c = e.ci;
        if (d && (e.notifyObservers("beforeDeletion", f), f.performDefaultAction)) {
            e.stop(0);
            if (c)for (; 0 < c.length;)p(c[0], b);
            e.prnt && e.prnt.ci && u(e.prnt.ci, e);
            u(e.composition._s, e);
            e.composition = void 0;
            e.prnt = void 0;
            d = e.ele;
            q.setSymbol(h(d)[0], void 0);
            b._keepElement ? h(d).empty() : h(d).remove();
            e.tlCached = null;
            e.ele = null;
            e.removeObservers()
        }
    }

    var h = f.$, l = f.An$, q = f.Symbol, x = f.Composition;
    h.extend(l.prototype, {_parents: function () {
        var f = [];
        this.each(function (b, d) {
            e(d, f)
        });
        return h(f)
    }, _children: function () {
        var e = [];
        this.each(function (b, d) {
            for (var c = e, c = c || [], f = d.firstElementChild; f;)c.push(f), f = f.nextElementSibling
        });
        return h(e)
    }, eq: function (e) {
        return h(this[e])
    }, append: function (e) {
        var b = this;
        h(e).each(function (d, c) {
            b.each(function (b, d) {
                d.appendChild(c)
            })
        })
    }});
    q.getParentSymbol = function (e, b) {
        var d = h(e), c = d._parents(), f = c.length, l;
        if ((l = q.getSymbol(d[0])) && b)return l;
        for (d = 0; d < f; d++)if (l = q.getSymbol(c[d]))return l;
        return null
    };
    h.extend(l.prototype, {empty: function () {
        var e;
        this.each(function (b, d) {
            for (e = d.firstChild; e;)d.removeChild(e),
                e = d.firstChild
        })
    }, remove: function () {
        var e;
        this.empty();
        this.each(function (b, d) {
            (e = d.parentNode) && e.removeChild(d)
        })
    }});
    h.extend(q.prototype, {deleteSymbol: function (e) {
        return p(this, e)
    }, createChildSymbol: function (e, b, d, c) {
        if (e && b) {
            var f;
            "object" == typeof b ? f = b : (f = this.find$(b)) || (f = this.$(b));
            if (f && f[0] && (e = r(this.composition, this, e, b, d, c)))return e.forEach(function (b) {
            }), e[0]
        }
    }, getVariable: function (e) {
        return this.variables[e]
    }, setVariable: function (e, b) {
        this.variables[e] = b;
        window.edge_authoring_mode &&
        (this._variables[e] = b);
        if (e) {
            var d = this.getVariable(e), c = "variableChanged:" + e, d = {variableValue: d}, f = h.Event(c);
            h.extend(f, {Symbol: this, element: this.ele, performDefaultAction: !0});
            h.extend(f, d);
            this.notifyObservers(c, f)
        }
        return this
    }, getSymbol: function (e) {
        e = this.$(e);
        return q.getSymbol(e)
    }, getParentSymbol: function () {
        return q.getParentSymbol(this.ele, !1)
    }, getChildSymbols: function () {
        return this.ci ? this.ci.slice(0) : []
    }, playAll: function () {
        this.play();
        for (var e = this.getChildSymbols(), b = 0; b < e.length; b++)e[b].playAll()
    },
        stopAll: function (e, b) {
            this.stop(e, b);
            for (var d = this.getChildSymbols(), c = 0; c < d.length; c++)d[c].stopAll(e, b)
        }, getSymbolElementNode: function () {
            return this.ele
        }, getSymbolElement: function () {
            return f.$(this.ele)
        }, _executeMediaAction: function (e, b) {
            if (!("object" !== typeof b || 3 > b.length)) {
                var d = b[0], c = this.$(b[1])[0];
                if (c && d) {
                    var f = b[2];
                    f && "object" === typeof f || (f = null);
                    "play" === d ? (f && 0 < f.length && "number" === typeof f[0] && (c.currentTime = f[0]), c.play()) : "pause" === d && c.pause()
                }
            }
        }, _executeSymbolAction: function (e, b) {
            if (!("object" !== typeof b || 3 > b.length)) {
                var d = b[0], c = f.Symbol.get(this.$(b[1]));
                if (c && d) {
                    var h = b[2];
                    h && "object" === typeof h || (h = null);
                    c[d].apply(c, h)
                }
            }
        }, eMA: function (e, b) {
            this._executeMediaAction(e, b)
        }});
    q.prototype.getParameter = q.prototype.getVariable;
    q.prototype.setParameter = q.prototype.setVariable;
    h.extend(x.prototype, {createSymbolChild: function (e, b, d, c) {
        return r(this, this.stage, e, b, d, c)
    }, removeSymbol: function (e, b) {
        if (this.symbolInstances) {
            var d = q.get(e);
            d && d.deleteSymbol(b)
        }
    }})
})(window.AdobeEdge);

/* ADFOX plugins (adfox.asyn.code.ver3.js, adfox.asyn.code.scroll.js) */
function AdFox_SetLayerVis(spritename, state) {
    document.getElementById(spritename).style.visibility = state;
}

function AdFox_Open(AF_id) {
    AdFox_SetLayerVis('AdFox_DivBaseFlash_' + AF_id, "hidden");
    AdFox_SetLayerVis('AdFox_DivOverFlash_' + AF_id, "visible");
}

function AdFox_Close(AF_id) {
    AdFox_SetLayerVis('AdFox_DivOverFlash_' + AF_id, "hidden");
    AdFox_SetLayerVis('AdFox_DivBaseFlash_' + AF_id, "visible");
}

function AdFox_getCodeScript(AF_n, AF_id, AF_src) {
    var AF_doc;
    if (AF_n < 10) {
        try {
            if (document.all && !window.opera) {
                AF_doc = window.frames['AdFox_iframe_' + AF_id].document;
            } else if (document.getElementById) {
                AF_doc = document.getElementById('AdFox_iframe_' + AF_id).contentDocument;
            }
        } catch (e) {
        }
        if (AF_doc) {
            AF_doc.write('<scr' + 'ipt type="text/javascript" src="' + AF_src + '"><\/scr' + 'ipt>');
        } else {
            setTimeout('AdFox_getCodeScript(' + (++AF_n) + ',' + AF_id + ',"' + AF_src + '");', 100);
        }
    }
}

function adfoxSdvigContent(banID, flashWidth, flashHeight) {
    var obj = document.getElementById('adfoxBanner' + banID).style;
    if (flashWidth == '100%') obj.width = flashWidth;
    else obj.width = flashWidth + "px";
    if (flashHeight == '100%') obj.height = flashHeight;
    else obj.height = flashHeight + "px";
}

function adfoxVisibilityFlash(banName, flashWidth, flashHeight) {
    var obj = document.getElementById(banName).style;
    if (flashWidth == '100%') obj.width = flashWidth;
    else obj.width = flashWidth + "px";
    if (flashHeight == '100%') obj.height = flashHeight;
    else obj.height = flashHeight + "px";
}

function adfoxStart(banID, FirShowFlNum, constVisFlashFir, sdvigContent, flash1Width, flash1Height, flash2Width, flash2Height) {
    if (FirShowFlNum == 1) adfoxVisibilityFlash('adfoxFlash1' + banID, flash1Width, flash1Height);
    else if (FirShowFlNum == 2) {
        adfoxVisibilityFlash('adfoxFlash2' + banID, flash2Width, flash2Height);
        if (constVisFlashFir == 'yes') adfoxVisibilityFlash('adfoxFlash1' + banID, flash1Width, flash1Height);
        if (sdvigContent == 'yes') adfoxSdvigContent(banID, flash2Width, flash2Height);
        else adfoxSdvigContent(banID, flash1Width, flash1Height);
    }
}

function adfoxOpen(banID, constVisFlashFir, sdvigContent, flash2Width, flash2Height) {
    var aEventOpenClose = new Image();
    var obj = document.getElementById("aEventOpen" + banID);
    if (obj) aEventOpenClose.src = obj.title + '&rand=' + Math.random() * 1000000 + '&prb=' + Math.random() * 1000000;
    adfoxVisibilityFlash('adfoxFlash2' + banID, flash2Width, flash2Height);
    if (constVisFlashFir != 'yes') adfoxVisibilityFlash('adfoxFlash1' + banID, 1, 1);
    if (sdvigContent == 'yes') adfoxSdvigContent(banID, flash2Width, flash2Height);
}

function adfoxClose(banID, constVisFlashFir, sdvigContent, flash1Width, flash1Height) {
    var aEventOpenClose = new Image();
    var obj = document.getElementById("aEventClose" + banID);
    if (obj) aEventOpenClose.src = obj.title + '&rand=' + Math.random() * 1000000 + '&prb=' + Math.random() * 1000000;
    adfoxVisibilityFlash('adfoxFlash2' + banID, 1, 1);
    if (constVisFlashFir != 'yes') adfoxVisibilityFlash('adfoxFlash1' + banID, flash1Width, flash1Height);
    if (sdvigContent == 'yes') adfoxSdvigContent(banID, flash1Width, flash1Height);
}

function AdFox_getWindowSize() {
    var winWidth, winHeight;
    if (typeof( window.innerWidth ) == 'number') {
        //Non-IE
        winWidth = window.innerWidth;
        winHeight = window.innerHeight;
    } else if (document.documentElement && ( document.documentElement.clientWidth || document.documentElement.clientHeight )) {
        //IE 6+ in 'standards compliant mode'
        winWidth = document.documentElement.clientWidth;
        winHeight = document.documentElement.clientHeight;
    } else if (document.body && ( document.body.clientWidth || document.body.clientHeight )) {
        //IE 4 compatible
        winWidth = document.body.clientWidth;
        winHeight = document.body.clientHeight;
    }
    return {"width": winWidth, "height": winHeight};
}//END function AdFox_getWindowSize

function AdFox_getElementPosition(elemId) {
    var elem;

    if (document.getElementById) {
        elem = document.getElementById(elemId);
    }
    else if (document.layers) {
        elem = document.elemId;
    }
    else if (document.all) {
        elem = document.all.elemId;
    }
    var w = elem.offsetWidth;
    var h = elem.offsetHeight;
    var l = 0;
    var t = 0;

    while (elem) {
        l += elem.offsetLeft;
        t += elem.offsetTop;
        elem = elem.offsetParent;
    }

    return {"left": l, "top": t, "width": w, "height": h};
} //END function AdFox_getElementPosition

function AdFox_getBodyScrollTop() {
    return self.pageYOffset || (document.documentElement && document.documentElement.scrollTop) || (document.body && document.body.scrollTop);
} //END function AdFox_getBodyScrollTop

function AdFox_getBodyScrollLeft() {
    return self.pageXOffset || (document.documentElement && document.documentElement.scrollLeft) || (document.body && document.body.scrollLeft);
}//END function AdFox_getBodyScrollLeft

function AdFox_Scroll(elemId, elemSrc) {
    var winPos = AdFox_getWindowSize();
    var winWidth = winPos.width;
    var winHeight = winPos.height;
    var scrollY = AdFox_getBodyScrollTop();
    var scrollX = AdFox_getBodyScrollLeft();
    var divId = 'AdFox_banner_' + elemId;
    var ltwhPos = AdFox_getElementPosition(divId);
    var lPos = ltwhPos.left;
    var tPos = ltwhPos.top;

    if (scrollY + winHeight + 5 >= tPos && scrollX + winWidth + 5 >= lPos) {
        AdFox_getCodeScript(1, elemId, elemSrc);
    } else {
        setTimeout('AdFox_Scroll(' + elemId + ',"' + elemSrc + '");', 100);
    }
}//End function AdFox_Scroll
/* End ADFOX plugins (adfox.asyn.code.ver3.js, adfox.asyn.code.scroll.js) */


function receiveMessage(event) {
    if (event.data.adfox_branding) {
        var background_color = event.data.adfox_branding.background_color || "";
        $("body").css("background", background_color + " url(" + event.data.adfox_branding.background_url + ") no-repeat 0 0");
        $("body").prepend('<a href="' + event.data.adfox_branding.href + '" style="position: fixed; top: 0px; left: 0px; right: 0px; bottom: 0px;" target="_blank" />');
    }

    if (event.data.SPB_AdFox_Adriver_Init_banners) {
        new adriver(event.data.SPB_AdFox_Adriver_Init_banners.banner_id, event.data.SPB_AdFox_Adriver_Init_banners.banner_param);
    }

    if (event.data.SPB_AdFox_HTML_Init_banners) {
        if (typeof AdobeEdge == 'undefined') {
            var edge_script = document.createElement('script');
            var edge_style = document.createElement('style');
            edge_script.onload = function () {
                setTimeout(function () {
                    AdobeEdge.loadComposition(
                        event.data.SPB_AdFox_HTML_Init_banners.banner_param[0],
                        event.data.SPB_AdFox_HTML_Init_banners.banner_param[1],
                        event.data.SPB_AdFox_HTML_Init_banners.banner_param[2],
                        event.data.SPB_AdFox_HTML_Init_banners.banner_param[3],
                        event.data.SPB_AdFox_HTML_Init_banners.banner_param[4]
                    );
                }, 1000);
            };
            edge_script.src = 'http://animate.adobe.com/runtime/6.0.0/edge.6.0.0.min.js';
            edge_style.innerHTML = '[class*="edgeLoad-EDGE"] {visibility:hidden;}';
            document.getElementsByTagName('head')[0].appendChild(edge_script);
            document.getElementsByTagName('head')[0].appendChild(edge_style);
        } else {
            //setTimeout(function(){
            AdobeEdge.loadComposition(
                event.data.SPB_AdFox_HTML_Init_banners.banner_param[0],
                event.data.SPB_AdFox_HTML_Init_banners.banner_param[1],
                event.data.SPB_AdFox_HTML_Init_banners.banner_param[2],
                event.data.SPB_AdFox_HTML_Init_banners.banner_param[3],
                event.data.SPB_AdFox_HTML_Init_banners.banner_param[4]
            );
            //}, 1000);
        }
    }
}

addEventListener("message", receiveMessage, false);

function AdFox() {
    var instance;
    if (!adfox) instance = this;
    else return adfox;
    /* 
     *@SETTINGS
     */
    this.phoneWidth = 480;				// Макс. ширина экрана телефона
    this.tabletWidth = 830;				// Макс. ширина экрана планшета
    this.minWidth = 200;				// Минимальная ширина баннера при resize & scale 
    this.autoReloads = false;			// Автоматическая перегрузка баннера
    /*
     *@END SETTINGS
     */
    this.pc = 'display';	  			// Имя для мониторв
    this.pad = 'tablet';	 			// Имя для планшетов
    this.phone = 'phone';    			// Имя для телефонов
    this.rnd = function () {
        return Math.floor(Math.random() * 1000000);
    }
    this.pr = window.pr || this.rnd();
    window.pr = window.pr || this.pr;
    this.ref = escape(document.referrer);
    this.dl = escape(document.location);
    this.banners = [];
    this.state = '';
    this.prev = '';
    this.screen = function () {
        var w = this.getWidth();
        if (w > this.tabletWidth) {
            this.prev = this.state;
            this.state = this.pc;
        }
        else if ((w < this.tabletWidth || w == this.tabletWidth) && w > this.phoneWidth) {
            this.prev = this.state;
            this.state = this.pad;
        }
        else if (w < this.phoneWidth || w == this.phoneWidth) {
            this.prev = this.state;
            this.state = this.phone;
        }
    }
    this.getWidth = function () {
        var win = window,
            d = document,
            e = d.documentElement,
            g = d.getElementsByTagName('body')[0],
            w = win.innerWidth || e.clientWidth || g.clientWidth;
        return w;
    }
    this.removeBanner = function (e) {
        for (var i = 0; i < adfox.banners.length; i++) {
            if (adfox.banners[i] == e) {
                adfox.banners[i].ph.innerHTML = '';
                adfox.banners.splice(i, 1);
            }
        }
    }
    /* ENTER FRAME*/
    this.enterframe = function () {
        var pc = this.pc,
            pad = this.pad,
            phone = this.phone,
            ds = this.displaysSize;

        function update() {
            var winSize = adfox.getWidth();
            adfox.screen();
            for (var i = 0; i < adfox.banners.length; i++) {
                var b = adfox.banners[i];
                if (b.settings != 'none') {
                    /* VISIBILITY */
                    if (adfox.parse(pc, b.settings) || adfox.parse(pad, b.settings) || adfox.parse(phone, b.settings)) {
                        if (adfox.parse(adfox.state, b.settings)) {
                            b.ph.style.display = 'none';
                        }
                        else {
                            b.ph.style.display = 'block';
                        }
                    }

                    /* RESIZE BANNER */
                    if (adfox.parse('scale', b.settings) && b.w != '') {
                        var wid = (b.ph.parentNode.clientWidth / b.w < 1) ? b.ph.parentNode.clientWidth / b.w : 1;
                        b.ph.style.width = Math.floor(wid * b.w) + 'px';
                        if (parseInt(b.ph.style.width) < adfox.minWidth)
                            b.ph.style.width = Math.floor(adfox.minWidth) + 'px';
                    }

                }
                /* RELOAD */
                if (adfox.autoReloads == true && (b.ph.style.display == 'block' || b.ph.style.display == '')) {
                    if (adfox.state != adfox.prev) {
                        adfox.removeBanner(b);
                        b.createBanner();
                    }
                }
            }
            setTimeout(update, 200);
        }

        update();
    }
    this.parse = function (srch, str) {
        var res = false;
        var f = srch.toLowerCase();
        var s = str.toLowerCase();
        if (s.indexOf(f) != -1) {
            res = true;
        }
        return res;
    }
}
var adfox = new AdFox();
adfox.enterframe();
var afHeightAuto = document.createElement('style');
afHeightAuto.type = 'text/css';
afHeightAuto[(afHeightAuto.innerText ? 'innerText' : 'textContent')] = 'img{height:auto;}';
document.getElementsByTagName('head')[0].appendChild(afHeightAuto);

function AdFoxBanner(link, settings) {
    this.pr1 = adfox.rnd();
    this.ph = null;
    this.date;
    this.iframe;
    this.settings = (settings) ? settings : 'none';
    this.link;
    this.w = '';
    this.getCode = function (n) {
        var link = this.link;
        var pr1 = this.pr1;
        var set = this.settings;
        var n = n;
        var getWid = function () {
            if (adfox.banners[n].ph != null) {
                var img = adfox.banners[n].ph.getElementsByTagName('img');
                if (img.length == 1)
                    adfox.banners[n].w = parseInt(img[0].getAttribute('width'));
                else
                    adfox.banners[n].w = adfox.banners[n].ph.clientWidth;
            }
            else {
                setTimeout(getWid, 1000);
            }
        }
        var timer = function () {
            if (set != '') {
                if (adfox.parse(adfox.state, set)) {
                    //No request.  
                    setTimeout(timer, 30);
                }
                else {
                    AdFox_getCodeScript(1, pr1, link);
                    setTimeout(getWid, 1000);
                }
            }
            else {
                AdFox_getCodeScript(1, pr1, link);
                setTimeout(getWid, 1000);
            }
        }
        timer();
    }

    this.createBanner = function (callback, params) {
        var f = true;
        var curIndex;
        this.date = new Date();
        this.link = link;
        this.secParams = '&pr=' + adfox.pr + '&pt=b&pd=' + this.date.getDate() + '&pw=' + this.date.getDay() + '&pv=' + this.date.getHours() + '&prr=' + adfox.ref + '&dl=' + adfox.dl + '&pr1=' + this.pr1 + '&phid=AdFox_banner_' + this.pr1;
        for (var i = 0; i < adfox.banners.length; i++) {
            if (adfox.banners[i] == this) {
                f = false;
                break;
            }
        }
        if (f) {
            adfox.banners.push(this);
            curIndex = adfox.banners.length - 1;
        }
        ;
        if (this.ph == '' || this.ph == null && document.readyState != 'complete') {
            document.write('<div id="AdFox_banner_' + this.pr1 + '"><\/div>');
            document.write('<div style="visibility:hidden; position:absolute;"><iframe id="AdFox_iframe_' + this.pr1 + '" width=1 height=1 marginwidth=0 marginheight=0 scrolling=no frameborder=0><\/iframe><\/div>');
        }
        this.ph = document.getElementById('AdFox_banner_' + this.pr1);
        this.iframe = document.getElementById('AdFox_iframe_' + this.pr1);
        if (this.ph != null) {
            this.link = this.link.replace(/&amp;/g, '&');
            this.link += this.secParams;
            this.getCode(curIndex);
        }
        if (typeof(callback) !== 'undefined') {
            callback(params);
        }
    }
}
//old async v3
function AdFox_SetLayerVis(spritename, state) {
    document.getElementById(spritename).style.visibility = state;
}

function AdFox_Open(AF_id) {
    AdFox_SetLayerVis('AdFox_DivBaseFlash_' + AF_id, "hidden");
    AdFox_SetLayerVis('AdFox_DivOverFlash_' + AF_id, "visible");
}

function AdFox_Close(AF_id) {
    AdFox_SetLayerVis('AdFox_DivOverFlash_' + AF_id, "hidden");
    AdFox_SetLayerVis('AdFox_DivBaseFlash_' + AF_id, "visible");
}

function AdFox_getCodeScript(AF_n, AF_id, AF_src) {
    var AF_doc;
    if (AF_n < 10) {

        try {
            if (document.all && !window.opera) {
                AF_doc = window.frames['AdFox_iframe_' + AF_id].document;
            } else if (document.getElementById) {
                AF_doc = document.getElementById('AdFox_iframe_' + AF_id).contentDocument;
            }
        } catch (e) {
        }
        if (AF_doc && AF_doc.readyState == 'complete') {
            var s = document.createElement('script');
            AF_doc.write('<html><head></head><body marginwidth="0" marginheight="0"></body></html>');
            if (typeof(window.chrome) != 'undefined' || navigator.userAgent.indexOf('iPhone') >= 0 || navigator.userAgent.indexOf('iPad') >= 0 || navigator.userAgent.indexOf('iPod') >= 0 || navigator.userAgent.indexOf('AppleWebKit') >= 0) {
                AF_doc.location.hash = 'AdFox_fix';
            }
            s.src = AF_src;
            if (AF_doc.getElementsByTagName('head')[0])
                AF_doc.getElementsByTagName('head')[0].appendChild(s);
            else
                AF_doc.appendChild(s);
        } else {
            setTimeout('AdFox_getCodeScript(' + (++AF_n) + ',' + AF_id + ',"' + AF_src + '");', 100);
        }
    }
}
function adfoxSdvigContent(banID, flashWidth, flashHeight) {
    var obj = document.getElementById('adfoxBanner' + banID).style;
    if (flashWidth == '100%') obj.width = flashWidth;
    else obj.width = flashWidth + "px";
    if (flashHeight == '100%') obj.height = flashHeight;
    else obj.height = flashHeight + "px";
}
function adfoxVisibilityFlash(banName, flashWidth, flashHeight) {
    var obj = document.getElementById(banName).style;
    if (flashWidth == '100%') obj.width = flashWidth;
    else obj.width = flashWidth + "px";
    if (flashHeight == '100%') obj.height = flashHeight;
    else obj.height = flashHeight + "px";
}
function adfoxStart(banID, FirShowFlNum, constVisFlashFir, sdvigContent, flash1Width, flash1Height, flash2Width, flash2Height) {
    if (FirShowFlNum == 1) adfoxVisibilityFlash('adfoxFlash1' + banID, flash1Width, flash1Height);
    else if (FirShowFlNum == 2) {
        adfoxVisibilityFlash('adfoxFlash2' + banID, flash2Width, flash2Height);
        if (constVisFlashFir == 'yes') adfoxVisibilityFlash('adfoxFlash1' + banID, flash1Width, flash1Height);
        if (sdvigContent == 'yes') adfoxSdvigContent(banID, flash2Width, flash2Height);
        else adfoxSdvigContent(banID, flash1Width, flash1Height);
    }
}
function adfoxOpen(banID, constVisFlashFir, sdvigContent, flash2Width, flash2Height) {
    var aEventOpenClose = new Image();
    var obj = document.getElementById("aEventOpen" + banID);
    if (obj) aEventOpenClose.src = obj.title + '&rand=' + Math.random() * 1000000 + '&prb=' + Math.random() * 1000000;
    adfoxVisibilityFlash('adfoxFlash2' + banID, flash2Width, flash2Height);
    if (constVisFlashFir != 'yes') adfoxVisibilityFlash('adfoxFlash1' + banID, 1, 1);
    if (sdvigContent == 'yes') adfoxSdvigContent(banID, flash2Width, flash2Height);
}
function adfoxClose(banID, constVisFlashFir, sdvigContent, flash1Width, flash1Height) {
    var aEventOpenClose = new Image();
    var obj = document.getElementById("aEventClose" + banID);
    if (obj) aEventOpenClose.src = obj.title + '&rand=' + Math.random() * 1000000 + '&prb=' + Math.random() * 1000000;
    adfoxVisibilityFlash('adfoxFlash2' + banID, 1, 1);
    if (constVisFlashFir != 'yes') adfoxVisibilityFlash('adfoxFlash1' + banID, flash1Width, flash1Height);
    if (sdvigContent == 'yes') adfoxSdvigContent(banID, flash1Width, flash1Height);
}
/* AdRiver lib (begin) */
function adriver(ph, prm, defer) {
    var my = this, p = ph;
    if (this instanceof adriver) {
        if (typeof(p) == 'string')p = document.getElementById(ph);
        else ph = p.id;

        if (!p) {
            if (!adriver.isDomReady)adriver.onDomReady(function () {
                new adriver(ph, prm, defer)
            });
            return null
        }
        if (adriver(ph))return adriver(ph);

        my.p = p;
        my.defer = defer;
        my.prm = adriver.extend(prm, {ph: ph});

        my.loadCompleteQueue = new adriver.queue();
        my.domReadyQueue = new adriver.queue(adriver.isDomReady);

        adriver.initQueue.push(function () {
            my.init()
        });
        return adriver.items[ph] = my;
    } else {
        return ph ? adriver.items[ph] : adriver.items;
    }
}

adriver.prototype = {
    isLoading: 0,

    init: function () {
    },
    loadComplete: function () {
    },
    domReady: function () {
    },

    onLoadComplete: function (f) {
        var my = this;
        my.loadCompleteQueue.push(function () {
            f.call(my)
        });
        return my
    },
    onDomReady: function (f) {
        this.domReadyQueue.push(f);
        return this
    },
    reset: function () {
        this.loadCompleteQueue.flush();
        this.domReadyQueue.flush(adriver.isDomReady);
        return this
    }
}

adriver.extend = function () {
    for (var l = arguments[0], i = 1, len = arguments.length, r, j; i < len; i++) {
        r = arguments[i];
        for (j in r) {
            if (r.hasOwnProperty(j)) {
                if (r[j] instanceof Function) {
                    l[j] = r[j]
                }
                else if (r[j] instanceof Object) {
                    if (l[j]) {
                        adriver.extend(l[j], r[j])
                    } else {
                        l[j] = adriver.extend(r[j] instanceof Array ? [] : {}, r[j])
                    }
                }
                else {
                    l[j] = r[j]
                }
            }
        }
    }
    return l
}

adriver.extend(adriver, {
    version: '2.3.7',

    defaults: {tail256: escape(document.referrer || 'unknown')},
    items: {},
    options: {},
    plugins: {},
    pluginPath: {},

    redirectHost: '//ad.adriver.ru',
    defaultMirror: '//content.adriver.ru',

    loadScript: function (req) {
        try {
            var head = document.getElementsByTagName('head')[0],
                s = document.createElement('script');
            s.setAttribute('type', 'text/javascript');
            s.setAttribute('charset', 'windows-1251');
            s.setAttribute('src', req.split('![rnd]').join(Math.round(Math.random() * 9999999)));
            s.onreadystatechange = function () {
                if (/loaded|complete/.test(this.readyState)) {
                    head.removeChild(s);
                    s.onload = null
                }
            };
            s.onload = function () {
                head.removeChild(s)
            };
            head.insertBefore(s, head.firstChild);
        } catch (e) {
        }
    },

    isDomReady: false,
    onDomReady: function (f) {
        adriver.domReadyQueue.push(f)
    },
    onBeforeDomReady: function (f) {
        adriver.domReadyQueue.unshift(f)
    },
    domReady: function () {
        adriver.isDomReady = true;
        adriver.domReadyQueue.execute()
    },
    checkDomReady: function (f) {
        try {
            var d = document, oldOnload = window.onload;

            function ready() {
                if (adriver.isDomReady) {
                    return;
                }
                f()
            }

            if (d.addEventListener) {
                d.addEventListener("DOMContentLoaded", ready, false)
            }
            else if (document.attachEvent) {
                var doScrollCheck = function () {
                    try {
                        document.documentElement.doScroll("left");
                    } catch (e) {
                        setTimeout(doScrollCheck, 1);
                        return;
                    }
                    ready();
                }
                try {
                    toplevel = window.frameElement == null;
                } catch (e) {
                }
                if (document.documentElement.doScroll && toplevel) {
                    doScrollCheck()
                }
                var DOMContentLoaded = function () {
                    if (document.readyState === "complete") {
                        document.detachEvent("onreadystatechange", DOMContentLoaded);
                        ready();
                    }
                }
                document.attachEvent("onreadystatechange", DOMContentLoaded);
            }
            else if (/WebKit/i.test(navigator.userAgent)) {
                (function () {
                    /loaded|complete/.test(d.readyState) ? ready() : setTimeout(arguments.callee, 100)
                })()
            }
            if (window.addEventListener) {
                window.addEventListener('load', ready, false)
            }
            else if (window.attachEvent) {
                window.attachEvent('onload', ready)
            }
            else window.onload = function () {
                    if (oldOnload) {
                        oldOnload();
                    }
                    ready()
                }
        } catch (e) {
        }
    },

    onLoadComplete: function (f) {
        adriver.loadCompleteQueue.push(f);
        return adriver
    },
    loadComplete: function () {
        adriver.loadCompleteQueue.execute();
        return adriver
    },

    setDefaults: function (o) {
        adriver.extend(adriver.defaults, o)
    },
    setOptions: function (o) {
        adriver.extend(adriver.options, o)
    },
    setPluginPath: function (o) {
        adriver.extend(adriver.pluginPath, o)
    },

    queue: function (flag) {
        this.q = [];
        this.flag = flag ? true : false
    },
    Plugin: function (id) {
        if (this instanceof adriver.Plugin) {
            if (id && !adriver.plugins[id]) {
                this.id = id;
                this.q = new adriver.queue();
                adriver.plugins[id] = this;
            }
        }
        return adriver.plugins[id]
    }
});
adriver.sync = function (pair, N) {
    if (!adriver.syncFlag) {
        adriver.syncFlag = 1;
        var ar_duo = [];
        while (N--) {
            ar_duo[N] = N + 1
        }
        ;
        ar_duo.sort(function () {
            return 0.5 - Math.random()
        });
        adriver.synchArray = ar_duo;
    }
    return adriver.synchArray[(!pair || pair <= 0 ? 1 : pair) - 1];
}
adriver.queue.prototype = {
    push: function (f) {
        this.flag ? f() : this.q.push(f)
    },
    unshift: function (f) {
        this.flag ? f() : this.q.unshift(f)
    },
    execute: function (flag) {
        var f;
        var undefined;
        while (f = this.q.shift())f();
        if (flag == undefined)flag = true;
        this.flag = flag ? true : false
    },
    flush: function (flag) {
        this.q.length = 0;
        this.flag = flag ? true : false
    }
}
adriver.Plugin.prototype = {
    loadingStatus: 0,
    load: function () {
        this.loadingStatus = 1;
        adriver.loadScript((adriver.pluginPath[this.id.split('.').pop()] || (adriver.defaultMirror + '/plugins/')) + this.id + '.js')
    },
    loadComplete: function () {
        this.loadingStatus = 2;
        this.q.execute();
        return this
    },
    onLoadComplete: function (f) {
        this.q.push(f);
        return this
    }
}
adriver.Plugin.require = function () {
    var my = this, counter = 0;
    my.q = new adriver.queue();

    for (var i = 0, len = arguments.length, p; i < len; i++) {
        p = new adriver.Plugin(arguments[i]);
        if (p.loadingStatus != 2) {
            counter++;
            p.onLoadComplete(function () {
                if (counter-- == 1)my.q.execute();
            });
            if (!p.loadingStatus)p.load();
        }
    }
    if (!counter) {
        my.q.execute()
    }
}
adriver.Plugin.require.prototype.onLoadComplete = function (f) {
    this.q.push(f);
    return this
}

adriver.domReadyQueue = new adriver.queue();
adriver.loadCompleteQueue = new adriver.queue();
adriver.initQueue = new adriver.queue();

adriver.checkDomReady(adriver.domReady);

new adriver.Plugin.require('autoUpdate.adriver').onLoadComplete(function () {
    adriver.initQueue.execute()
});
/* AdRiver lib (end) */

/*!
 * jQuery Cookie Plugin v1.4.0
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function (c) {
    "function" === typeof define && define.amd ? define(["jquery"], c) : c(jQuery)
})(function (c) {
    function n(b) {
        b = f.json ? JSON.stringify(b) : String(b);
        return f.raw ? b : encodeURIComponent(b)
    }

    function m(b, e) {
        var a;
        if (f.raw)a = b; else a:{
            var d = b;
            0 === d.indexOf('"') && (d = d.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, "\\"));
            try {
                d = decodeURIComponent(d.replace(l, " "));
                a = f.json ? JSON.parse(d) : d;
                break a
            } catch (g) {
            }
            a = void 0
        }
        return c.isFunction(e) ? e(a) : a
    }

    var l = /\+/g, f = c.cookie = function (b, e, a) {
        if (void 0 !== e && !c.isFunction(e)) {
            a =
                c.extend({}, f.defaults, a);
            if ("number" === typeof a.expires) {
                var d = a.expires, g = a.expires = new Date;
                g.setTime(+g + 864E5 * d)
            }
            return document.cookie = [f.raw ? b : encodeURIComponent(b), "=", n(e), a.expires ? "; expires=" + a.expires.toUTCString() : "", a.path ? "; path=" + a.path : "", a.domain ? "; domain=" + a.domain : "", a.secure ? "; secure" : ""].join("")
        }
        a = b ? void 0 : {};
        for (var d = document.cookie ? document.cookie.split("; ") : [], g = 0, l = d.length; g < l; g++) {
            var h = d[g].split("="), k;
            k = h.shift();
            k = f.raw ? k : decodeURIComponent(k);
            h = h.join("=");
            if (b &&
                b === k) {
                a = m(h, e);
                break
            }
            b || void 0 === (h = m(h)) || (a[k] = h)
        }
        return a
    };
    f.defaults = {};
    c.removeCookie = function (b, e) {
        if (void 0 === c.cookie(b))return!1;
        c.cookie(b, "", c.extend({}, e, {expires: -1}));
        return!c.cookie(b)
    }
});

/*
 SlidesJS 3.0.4 http://slidesjs.com
 (c) 2013 by Nathan Searles http://nathansearles.com
 Updated: June 26th, 2013
 Apache License: http://www.apache.org/licenses/LICENSE-2.0
 */
(function () {
    (function (e, t, n) {
        var r, i, s;
        s = "slidesjs";
        i = {width: 940, height: 528, start: 1, navigation: {active: !0, effect: "slide"}, pagination: {active: !0, effect: "slide"}, play: {active: !1, effect: "slide", interval: 5e3, auto: !1, swap: !0, pauseOnHover: !1, restartDelay: 2500}, effect: {slide: {speed: 500}, fade: {speed: 300, crossfade: !0}}, callback: {loaded: function () {
        }, start: function () {
        }, complete: function () {
        }}};
        r = function () {
            function t(t, n) {
                this.element = t;
                this.options = e.extend(!0, {}, i, n);
                this._defaults = i;
                this._name = s;
                this.init()
            }

            return t
        }();
        r.prototype.init = function () {
            var n, r, i, s, o, u, a = this;
            n = e(this.element);
            this.data = e.data(this);
            e.data(this, "animating", !1);
            e.data(this, "total", n.children().not(".slidesjs-navigation", n).length);
            e.data(this, "current", this.options.start - 1);
            e.data(this, "vendorPrefix", this._getVendorPrefix());
            if (typeof TouchEvent != "undefined") {
                e.data(this, "touch", !0);
                this.options.effect.slide.speed = this.options.effect.slide.speed / 2
            }
            n.css({overflow: "hidden"});
            n.slidesContainer = n.children().not(".slidesjs-navigation", n).wrapAll("<div class='slidesjs-container'>", n).parent().css({overflow: "hidden", position: "relative"});
            e(".slidesjs-container", n).wrapInner("<div class='slidesjs-control'>", n).children();
            e(".slidesjs-control", n).css({position: "relative", left: 0});
            e(".slidesjs-control", n).children().addClass("slidesjs-slide").css({position: "absolute", top: 0, left: 0, width: "100%", zIndex: 0, display: "none", webkitBackfaceVisibility: "hidden"});
            e.each(e(".slidesjs-control", n).children(), function (t) {
                var n;
                n = e(this);
                return n.attr("slidesjs-index", t)
            });
            if (this.data.touch) {
                e(".slidesjs-control", n).on("touchstart", function (e) {
                    return a._touchstart(e)
                });
                e(".slidesjs-control", n).on("touchmove", function (e) {
                    return a._touchmove(e)
                });
                e(".slidesjs-control", n).on("touchend", function (e) {
                    return a._touchend(e)
                })
            }
            n.fadeIn(0);
            this.update();
            this.data.touch && this._setuptouch();
            e(".slidesjs-control", n).children(":eq(" + this.data.current + ")").eq(0).fadeIn(0, function () {
                return e(this).css({zIndex: 10})
            });
            if (this.options.navigation.active) {
                o = e("<a>", {"class": "slidesjs-previous slidesjs-navigation", href: "#", title: "Previous", text: "Previous"}).appendTo(n);
                r = e("<a>", {"class": "slidesjs-next slidesjs-navigation", href: "#", title: "Next", text: "Next"}).appendTo(n)
            }
            e(".slidesjs-next", n).click(function (e) {
                e.preventDefault();
                a.stop(!0);
                return a.next(a.options.navigation.effect)
            });
            e(".slidesjs-previous", n).click(function (e) {
                e.preventDefault();
                a.stop(!0);
                return a.previous(a.options.navigation.effect)
            });
            if (this.options.play.active) {
                s = e("<a>", {"class": "slidesjs-play slidesjs-navigation", href: "#", title: "Play", text: "Play"}).appendTo(n);
                u = e("<a>", {"class": "slidesjs-stop slidesjs-navigation", href: "#", title: "Stop", text: "Stop"}).appendTo(n);
                s.click(function (e) {
                    e.preventDefault();
                    return a.play(!0)
                });
                u.click(function (e) {
                    e.preventDefault();
                    return a.stop(!0)
                });
                this.options.play.swap && u.css({display: "none"})
            }
            if (this.options.pagination.active) {
                i = e("<ul>", {"class": "slidesjs-pagination"}).appendTo(n);
                e.each(new Array(this.data.total), function (t) {
                    var n, r;
                    n = e("<li>", {"class": "slidesjs-pagination-item"}).appendTo(i);
                    r = e("<a>", {href: "#", "data-slidesjs-item": t, html: t + 1}).appendTo(n);
                    return r.click(function (t) {
                        t.preventDefault();
                        a.stop(!0);
                        return a.goto(e(t.currentTarget).attr("data-slidesjs-item") * 1 + 1)
                    })
                })
            }
            e(t).bind("resize", function () {
                return a.update()
            });
            this._setActive();
            this.options.play.auto && this.play();
            return this.options.callback.loaded(this.options.start)
        };
        r.prototype._setActive = function (t) {
            var n, r;
            n = e(this.element);
            this.data = e.data(this);
            r = t > -1 ? t : this.data.current;
            e(".active", n).removeClass("active");
            return e(".slidesjs-pagination li:eq(" + r + ") a", n).addClass("active")
        };
        r.prototype.update = function () {
            var t, n, r;
            t = e(this.element);
            this.data = e.data(this);
            e(".slidesjs-control", t).children(":not(:eq(" + this.data.current + "))").css({display: "none", left: 0, zIndex: 0});
            r = t.width();
            n = this.options.height / this.options.width * r;
            this.options.width = r;
            this.options.height = n;
            return e(".slidesjs-control, .slidesjs-container", t).css({width: r, height: n})
        };
        r.prototype.next = function (t) {
            var n;
            n = e(this.element);
            this.data = e.data(this);
            e.data(this, "direction", "next");
            t === void 0 && (t = this.options.navigation.effect);
            return t === "fade" ? this._fade() : this._slide()
        };
        r.prototype.previous = function (t) {
            var n;
            n = e(this.element);
            this.data = e.data(this);
            e.data(this, "direction", "previous");
            t === void 0 && (t = this.options.navigation.effect);
            return t === "fade" ? this._fade() : this._slide()
        };
        r.prototype.goto = function (t) {
            var n, r;
            n = e(this.element);
            this.data = e.data(this);
            r === void 0 && (r = this.options.pagination.effect);
            t > this.data.total ? t = this.data.total : t < 1 && (t = 1);
            if (typeof t == "number")return r === "fade" ? this._fade(t) : this._slide(t);
            if (typeof t == "string") {
                if (t === "first")return r === "fade" ? this._fade(0) : this._slide(0);
                if (t === "last")return r === "fade" ? this._fade(this.data.total) : this._slide(this.data.total)
            }
        };
        r.prototype._setuptouch = function () {
            var t, n, r, i;
            t = e(this.element);
            this.data = e.data(this);
            i = e(".slidesjs-control", t);
            n = this.data.current + 1;
            r = this.data.current - 1;
            r < 0 && (r = this.data.total - 1);
            n > this.data.total - 1 && (n = 0);
            i.children(":eq(" + n + ")").css({display: "block", left: this.options.width});
            return i.children(":eq(" + r + ")").css({display: "block", left: -this.options.width})
        };
        r.prototype._touchstart = function (t) {
            var n, r;
            n = e(this.element);
            this.data = e.data(this);
            r = t.originalEvent.touches[0];
            this._setuptouch();
            e.data(this, "touchtimer", Number(new Date));
            e.data(this, "touchstartx", r.pageX);
            e.data(this, "touchstarty", r.pageY);
            return t.stopPropagation()
        };
        r.prototype._touchend = function (t) {
            var n, r, i, s, o, u, a, f = this;
            n = e(this.element);
            this.data = e.data(this);
            u = t.originalEvent.touches[0];
            s = e(".slidesjs-control", n);
            if (s.position().left > this.options.width * .5 || s.position().left > this.options.width * .1 && Number(new Date) - this.data.touchtimer < 250) {
                e.data(this, "direction", "previous");
                this._slide()
            } else if (s.position().left < -(this.options.width * .5) || s.position().left < -(this.options.width * .1) && Number(new Date) - this.data.touchtimer < 250) {
                e.data(this, "direction", "next");
                this._slide()
            } else {
                i = this.data.vendorPrefix;
                a = i + "Transform";
                r = i + "TransitionDuration";
                o = i + "TransitionTimingFunction";
                s[0].style[a] = "translateX(0px)";
                s[0].style[r] = this.options.effect.slide.speed * .85 + "ms"
            }
            s.on("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd", function () {
                i = f.data.vendorPrefix;
                a = i + "Transform";
                r = i + "TransitionDuration";
                o = i + "TransitionTimingFunction";
                s[0].style[a] = "";
                s[0].style[r] = "";
                return s[0].style[o] = ""
            });
            return t.stopPropagation()
        };
        r.prototype._touchmove = function (t) {
            var n, r, i, s, o;
            n = e(this.element);
            this.data = e.data(this);
            s = t.originalEvent.touches[0];
            r = this.data.vendorPrefix;
            i = e(".slidesjs-control", n);
            o = r + "Transform";
            e.data(this, "scrolling", Math.abs(s.pageX - this.data.touchstartx) < Math.abs(s.pageY - this.data.touchstarty));
            if (!this.data.animating && !this.data.scrolling) {
                t.preventDefault();
                this._setuptouch();
                i[0].style[o] = "translateX(" + (s.pageX - this.data.touchstartx) + "px)"
            }
            return t.stopPropagation()
        };
        r.prototype.play = function (t) {
            var n, r, i, s = this;
            n = e(this.element);
            this.data = e.data(this);
            if (!this.data.playInterval) {
                if (t) {
                    r = this.data.current;
                    this.data.direction = "next";
                    this.options.play.effect === "fade" ? this._fade() : this._slide()
                }
                e.data(this, "playInterval", setInterval(function () {
                    r = s.data.current;
                    s.data.direction = "next";
                    return s.options.play.effect === "fade" ? s._fade() : s._slide()
                }, this.options.play.interval));
                i = n;
                if (this.options.play.pauseOnHover) {
                    i.unbind();
                    i.bind("mouseenter", function () {
                        return s.stop()
                    });
                    i.bind("mouseleave", function () {
                        return s.options.play.restartDelay ? e.data(s, "restartDelay", setTimeout(function () {
                            return s.play(!0)
                        }, s.options.play.restartDelay)) : s.play()
                    })
                }
                e.data(this, "playing", !0);
                e(".slidesjs-play", n).addClass("slidesjs-playing");
                if (this.options.play.swap) {
                    e(".slidesjs-play", n).hide();
                    return e(".slidesjs-stop", n).show()
                }
            }
        };
        r.prototype.stop = function (t) {
            var n;
            n = e(this.element);
            this.data = e.data(this);
            clearInterval(this.data.playInterval);
            this.options.play.pauseOnHover && t && e(".slidesjs-container", n).unbind();
            e.data(this, "playInterval", null);
            e.data(this, "playing", !1);
            e(".slidesjs-play", n).removeClass("slidesjs-playing");
            if (this.options.play.swap) {
                e(".slidesjs-stop", n).hide();
                return e(".slidesjs-play", n).show()
            }
        };
        r.prototype._slide = function (t) {
            var n, r, i, s, o, u, a, f, l, c, h = this;
            n = e(this.element);
            this.data = e.data(this);
            if (!this.data.animating && t !== this.data.current + 1) {
                e.data(this, "animating", !0);
                r = this.data.current;
                if (t > -1) {
                    t -= 1;
                    c = t > r ? 1 : -1;
                    i = t > r ? -this.options.width : this.options.width;
                    o = t
                } else {
                    c = this.data.direction === "next" ? 1 : -1;
                    i = this.data.direction === "next" ? -this.options.width : this.options.width;
                    o = r + c
                }
                o === -1 && (o = this.data.total - 1);
                o === this.data.total && (o = 0);
                this._setActive(o);
                a = e(".slidesjs-control", n);
                t > -1 && a.children(":not(:eq(" + r + "))").css({display: "none", left: 0, zIndex: 0});
                a.children(":eq(" + o + ")").css({display: "block", left: c * this.options.width, zIndex: 10});
                this.options.callback.start(r + 1);
                if (this.data.vendorPrefix) {
                    u = this.data.vendorPrefix;
                    l = u + "Transform";
                    s = u + "TransitionDuration";
                    f = u + "TransitionTimingFunction";
                    a[0].style[l] = "translateX(" + i + "px)";
                    a[0].style[s] = this.options.effect.slide.speed + "ms";
                    return a.on("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd", function () {
                        a[0].style[l] = "";
                        a[0].style[s] = "";
                        a.children(":eq(" + o + ")").css({left: 0});
                        a.children(":eq(" + r + ")").css({display: "none", left: 0, zIndex: 0});
                        e.data(h, "current", o);
                        e.data(h, "animating", !1);
                        a.unbind("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd");
                        a.children(":not(:eq(" + o + "))").css({display: "none", left: 0, zIndex: 0});
                        h.data.touch && h._setuptouch();
                        return h.options.callback.complete(o + 1)
                    })
                }
                return a.stop().animate({left: i}, this.options.effect.slide.speed, function () {
                    a.css({left: 0});
                    a.children(":eq(" + o + ")").css({left: 0});
                    return a.children(":eq(" + r + ")").css({display: "none", left: 0, zIndex: 0}, e.data(h, "current", o), e.data(h, "animating", !1), h.options.callback.complete(o + 1))
                })
            }
        };
        r.prototype._fade = function (t) {
            var n, r, i, s, o, u = this;
            n = e(this.element);
            this.data = e.data(this);
            if (!this.data.animating && t !== this.data.current + 1) {
                e.data(this, "animating", !0);
                r = this.data.current;
                if (t) {
                    t -= 1;
                    o = t > r ? 1 : -1;
                    i = t
                } else {
                    o = this.data.direction === "next" ? 1 : -1;
                    i = r + o
                }
                i === -1 && (i = this.data.total - 1);
                i === this.data.total && (i = 0);
                this._setActive(i);
                s = e(".slidesjs-control", n);
                s.children(":eq(" + i + ")").css({display: "none", left: 0, zIndex: 10});
                this.options.callback.start(r + 1);
                if (this.options.effect.fade.crossfade) {
                    s.children(":eq(" + this.data.current + ")").stop().fadeOut(this.options.effect.fade.speed);
                    return s.children(":eq(" + i + ")").stop().fadeIn(this.options.effect.fade.speed, function () {
                        s.children(":eq(" + i + ")").css({zIndex: 0});
                        e.data(u, "animating", !1);
                        e.data(u, "current", i);
                        return u.options.callback.complete(i + 1)
                    })
                }
                return s.children(":eq(" + r + ")").stop().fadeOut(this.options.effect.fade.speed, function () {
                    s.children(":eq(" + i + ")").stop().fadeIn(u.options.effect.fade.speed, function () {
                        return s.children(":eq(" + i + ")").css({zIndex: 10})
                    });
                    e.data(u, "animating", !1);
                    e.data(u, "current", i);
                    return u.options.callback.complete(i + 1)
                })
            }
        };
        r.prototype._getVendorPrefix = function () {
            var e, t, r, i, s;
            e = n.body || n.documentElement;
            r = e.style;
            i = "transition";
            s = ["Moz", "Webkit", "Khtml", "O", "ms"];
            i = i.charAt(0).toUpperCase() + i.substr(1);
            t = 0;
            while (t < s.length) {
                if (typeof r[s[t] + i] == "string")return s[t];
                t++
            }
            return!1
        };
        return e.fn[s] = function (t) {
            return this.each(function () {
                if (!e.data(this, "plugin_" + s))return e.data(this, "plugin_" + s, new r(this, t))
            })
        }
    })(jQuery, window, document)
}).call(this);

/* https://raw.github.com/websanova/js-url/master/url.min.js */
/*! url - v1.8.6 - 2013-11-22 */
window.url = function () {
    function a(a) {
        return!isNaN(parseFloat(a)) && isFinite(a)
    }

    return function (b, c) {
        var d = c || window.location.toString();
        if (!b)return d;
        b = b.toString(), "//" === d.substring(0, 2) ? d = "http:" + d : 1 === d.split("://").length && (d = "http://" + d), c = d.split("/");
        var e = {auth: ""}, f = c[2].split("@");
        1 === f.length ? f = f[0].split(":") : (e.auth = f[0], f = f[1].split(":")), e.protocol = c[0], e.hostname = f[0], e.port = f[1] || ("https" === e.protocol.split(":")[0].toLowerCase() ? "443" : "80"), e.pathname = (c.length > 3 ? "/" : "") + c.slice(3, c.length).join("/").split("?")[0].split("#")[0];
        var g = e.pathname;
        "/" === g.charAt(g.length - 1) && (g = g.substring(0, g.length - 1));
        var h = e.hostname, i = h.split("."), j = g.split("/");
        if ("hostname" === b)return h;
        if ("domain" === b)return/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/.test(h) ? h : i.slice(-2).join(".");
        if ("sub" === b)return i.slice(0, i.length - 2).join(".");
        if ("port" === b)return e.port;
        if ("protocol" === b)return e.protocol.split(":")[0];
        if ("auth" === b)return e.auth;
        if ("user" === b)return e.auth.split(":")[0];
        if ("pass" === b)return e.auth.split(":")[1] || "";
        if ("path" === b)return e.pathname;
        if ("." === b.charAt(0)) {
            if (b = b.substring(1), a(b))return b = parseInt(b, 10), i[0 > b ? i.length + b : b - 1] || ""
        } else {
            if (a(b))return b = parseInt(b, 10), j[0 > b ? j.length + b : b] || "";
            if ("file" === b)return j.slice(-1)[0];
            if ("filename" === b)return j.slice(-1)[0].split(".")[0];
            if ("fileext" === b)return j.slice(-1)[0].split(".")[1] || "";
            if ("?" === b.charAt(0) || "#" === b.charAt(0)) {
                var k = d, l = null;
                if ("?" === b.charAt(0) ? k = (k.split("?")[1] || "").split("#")[0] : "#" === b.charAt(0) && (k = k.split("#")[1] || ""), !b.charAt(1))return k;
                b = b.substring(1), k = k.split("&");
                for (var m = 0, n = k.length; n > m; m++)if (l = k[m].split("="), l[0] === b)return l[1] || "";
                return null
            }
        }
        return""
    }
}(), "undefined" != typeof jQuery && jQuery.extend({url: function (a, b) {
    return window.url(a, b)
}});

/*! Lazy Load 1.9.3 - MIT license - Copyright 2010-2013 Mika Tuupola */
!function (a, b, c, d) {
    var e = a(b);
    a.fn.lazyload = function (f) {
        function g() {
            var b = 0;
            i.each(function () {
                var c = a(this);
                if (!j.skip_invisible || c.is(":visible"))if (a.abovethetop(this, j) || a.leftofbegin(this, j)); else if (a.belowthefold(this, j) || a.rightoffold(this, j)) {
                    if (++b > j.failure_limit)return!1
                } else c.trigger("appear"), b = 0
            })
        }

        var h, i = this, j = {threshold: 0, failure_limit: 0, event: "scroll", effect: "show", container: b, data_attribute: "original", skip_invisible: !0, appear: null, load: null, placeholder: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};
        return f && (d !== f.failurelimit && (f.failure_limit = f.failurelimit, delete f.failurelimit), d !== f.effectspeed && (f.effect_speed = f.effectspeed, delete f.effectspeed), a.extend(j, f)), h = j.container === d || j.container === b ? e : a(j.container), 0 === j.event.indexOf("scroll") && h.bind(j.event, function () {
            return g()
        }), this.each(function () {
            var b = this, c = a(b);
            b.loaded = !1, (c.attr("src") === d || c.attr("src") === !1) && c.is("img") && c.attr("src", j.placeholder), c.one("appear", function () {
                if (!this.loaded) {
                    if (j.appear) {
                        var d = i.length;
                        j.appear.call(b, d, j)
                    }
                    a("<img />").bind("load",function () {
                        var d = c.attr("data-" + j.data_attribute);
                        c.hide(), c.is("img") ? c.attr("src", d) : c.css("background-image", "url('" + d + "')"), c[j.effect](j.effect_speed), b.loaded = !0;
                        var e = a.grep(i, function (a) {
                            return!a.loaded
                        });
                        if (i = a(e), j.load) {
                            var f = i.length;
                            j.load.call(b, f, j)
                        }
                    }).attr("src", c.attr("data-" + j.data_attribute))
                }
            }), 0 !== j.event.indexOf("scroll") && c.bind(j.event, function () {
                b.loaded || c.trigger("appear")
            })
        }), e.bind("resize", function () {
            g()
        }), /(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion) && e.bind("pageshow", function (b) {
            b.originalEvent && b.originalEvent.persisted && i.each(function () {
                a(this).trigger("appear")
            })
        }), a(c).ready(function () {
            g()
        }), this
    }, a.belowthefold = function (c, f) {
        var g;
        return g = f.container === d || f.container === b ? (b.innerHeight ? b.innerHeight : e.height()) + e.scrollTop() : a(f.container).offset().top + a(f.container).height(), g <= a(c).offset().top - f.threshold
    }, a.rightoffold = function (c, f) {
        var g;
        return g = f.container === d || f.container === b ? e.width() + e.scrollLeft() : a(f.container).offset().left + a(f.container).width(), g <= a(c).offset().left - f.threshold
    }, a.abovethetop = function (c, f) {
        var g;
        return g = f.container === d || f.container === b ? e.scrollTop() : a(f.container).offset().top, g >= a(c).offset().top + f.threshold + a(c).height()
    }, a.leftofbegin = function (c, f) {
        var g;
        return g = f.container === d || f.container === b ? e.scrollLeft() : a(f.container).offset().left, g >= a(c).offset().left + f.threshold + a(c).width()
    }, a.inviewport = function (b, c) {
        return!(a.rightoffold(b, c) || a.leftofbegin(b, c) || a.belowthefold(b, c) || a.abovethetop(b, c))
    }, a.extend(a.expr[":"], {"below-the-fold": function (b) {
        return a.belowthefold(b, {threshold: 0})
    }, "above-the-top": function (b) {
        return!a.belowthefold(b, {threshold: 0})
    }, "right-of-screen": function (b) {
        return a.rightoffold(b, {threshold: 0})
    }, "left-of-screen": function (b) {
        return!a.rightoffold(b, {threshold: 0})
    }, "in-viewport": function (b) {
        return a.inviewport(b, {threshold: 0})
    }, "above-the-fold": function (b) {
        return!a.belowthefold(b, {threshold: 0})
    }, "right-of-fold": function (b) {
        return a.rightoffold(b, {threshold: 0})
    }, "left-of-fold": function (b) {
        return!a.rightoffold(b, {threshold: 0})
    }})
}(jQuery, window, document);
/*
 *
 * TableSorter 2.0 - Client-side table sorting with ease!
 * Version 2.0.3
 * @requires jQuery v1.2.3
 *
 * Copyright (c) 2007 Christian Bach
 * Examples and docs at: http://tablesorter.com
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 */

/*!
 * TableSorter 2.10.8 min - Client-side table sorting with ease!
 * Copyright (c) 2007 Christian Bach
 */
!function (f) {
    f.extend({tablesorter: new function () {
        function c(d) {
            "undefined" !== typeof console && "undefined" !== typeof console.log ? console.log(d) : alert(d)
        }

        function t(d, b) {
            c(d + " (" + ((new Date).getTime() - b.getTime()) + "ms)")
        }

        function r(d, b, a) {
            if (!b)return"";
            var e = d.config, c = e.textExtraction, l = "", l = "simple" === c ? e.supportsTextContent ? b.textContent : f(b).text() : "function" === typeof c ? c(b, d, a) : "object" === typeof c && c.hasOwnProperty(a) ? c[a](b, d, a) : e.supportsTextContent ? b.textContent : f(b).text();
            return f.trim(l)
        }

        function j(d) {
            var b = d.config, a = b.$tbodies = b.$table.children("tbody:not(." + b.cssInfoBlock + ")"), e, u, l, p, n, k, h = "";
            if (0 === a.length)return b.debug ? c("*Empty table!* Not building a parser cache") : "";
            a = a[0].rows;
            if (a[0]) {
                e = [];
                u = a[0].cells.length;
                for (l = 0; l < u; l++) {
                    p = b.$headers.filter(":not([colspan])");
                    p = p.add(b.$headers.filter('[colspan="1"]')).filter('[data-column="' + l + '"]:last');
                    n = b.headers[l];
                    k = g.getParserById(g.getData(p, n, "sorter"));
                    b.empties[l] = g.getData(p, n, "empty") || b.emptyTo || (b.emptyToBottom ? "bottom" : "top");
                    b.strings[l] = g.getData(p, n, "string") || b.stringTo || "max";
                    if (!k)a:{
                        p = d;
                        n = a;
                        k = -1;
                        for (var f = l, m = void 0, t = g.parsers.length, F = !1, D = "", m = !0; "" === D && m;)k++, n[k] ? (F = n[k].cells[f], D = r(p, F, f), p.config.debug && c("Checking if value was empty on row " + k + ", column: " + f + ': "' + D + '"')) : m = !1;
                        for (; 0 <= --t;)if ((m = g.parsers[t]) && "text" !== m.id && m.is && m.is(D, p, F)) {
                            k = m;
                            break a
                        }
                        k = g.getParserById("text")
                    }
                    b.debug && (h += "column:" + l + "; parser:" + k.id + "; string:" + b.strings[l] + "; empty: " + b.empties[l] + "\n");
                    e.push(k)
                }
            }
            b.debug && c(h);
            b.parsers = e
        }

        function v(d) {
            var b = d.tBodies, a = d.config, e, u, l = a.parsers, p, n, k, h, q, m, H, j = [];
            a.cache = {};
            if (!l)return a.debug ? c("*Empty table!* Not building a cache") : "";
            a.debug && (H = new Date);
            a.showProcessing && g.isProcessing(d, !0);
            for (h = 0; h < b.length; h++)if (a.cache[h] = {row: [], normalized: []}, !f(b[h]).hasClass(a.cssInfoBlock)) {
                e = b[h] && b[h].rows.length || 0;
                u = b[h].rows[0] && b[h].rows[0].cells.length || 0;
                for (n = 0; n < e; ++n)if (q = f(b[h].rows[n]), m = [], q.hasClass(a.cssChildRow))a.cache[h].row[a.cache[h].row.length - 1] = a.cache[h].row[a.cache[h].row.length - 1].add(q); else {
                    a.cache[h].row.push(q);
                    for (k = 0; k < u; ++k)if (p = r(d, q[0].cells[k], k), p = l[k].format(p, d, q[0].cells[k], k), m.push(p), "numeric" === (l[k].type || "").toLowerCase())j[k] = Math.max(Math.abs(p) || 0, j[k] || 0);
                    m.push(a.cache[h].normalized.length);
                    a.cache[h].normalized.push(m)
                }
                a.cache[h].colMax = j
            }
            a.showProcessing && g.isProcessing(d);
            a.debug && t("Building cache for " + e + " rows", H)
        }

        function x(d, b) {
            var a = d.config, e = d.tBodies, c = [], l = a.cache, p, n, k, h, q, m, r, j, D, s, v;
            if (l[0]) {
                a.debug && (v = new Date);
                for (j = 0; j < e.length; j++)if (p = f(e[j]), p.length && !p.hasClass(a.cssInfoBlock)) {
                    q = g.processTbody(d, p, !0);
                    p = l[j].row;
                    n = l[j].normalized;
                    h = (k = n.length) ? n[0].length - 1 : 0;
                    for (m = 0; m < k; m++)if (s = n[m][h], c.push(p[s]), !a.appender || !a.removeRows) {
                        D = p[s].length;
                        for (r = 0; r < D; r++)q.append(p[s][r])
                    }
                    g.processTbody(d, q, !1)
                }
                a.appender && a.appender(d, c);
                a.debug && t("Rebuilt table", v);
                b || g.applyWidget(d);
                f(d).trigger("sortEnd", d)
            }
        }

        function A(d) {
            var b = [], a = {}, e = 0, u = f(d).find("thead:eq(0), tfoot").children("tr"), l, p, n, k, h, q, m, j, r, s;
            for (l = 0; l < u.length; l++) {
                h = u[l].cells;
                for (p = 0; p < h.length; p++) {
                    k = h[p];
                    q = k.parentNode.rowIndex;
                    m = q + "-" + k.cellIndex;
                    j = k.rowSpan || 1;
                    r = k.colSpan || 1;
                    "undefined" === typeof b[q] && (b[q] = []);
                    for (n = 0; n < b[q].length + 1; n++)if ("undefined" === typeof b[q][n]) {
                        s = n;
                        break
                    }
                    a[m] = s;
                    e = Math.max(s, e);
                    f(k).attr({"data-column": s});
                    for (n = q; n < q + j; n++) {
                        "undefined" === typeof b[n] && (b[n] = []);
                        m = b[n];
                        for (k = s; k < s + r; k++)m[k] = "x"
                    }
                }
            }
            d.config.columns = e;
            var v, B, x, A, z, y, C, w = d.config;
            w.headerList = [];
            w.headerContent = [];
            w.debug && (C = new Date);
            A = w.cssIcon ? '<i class="' + w.cssIcon + '"></i>' : "";
            w.$headers = f(d).find(w.selectorHeaders).each(function (d) {
                B = f(this);
                v = w.headers[d];
                w.headerContent[d] = this.innerHTML;
                z = w.headerTemplate.replace(/\{content\}/g, this.innerHTML).replace(/\{icon\}/g, A);
                w.onRenderTemplate && (x = w.onRenderTemplate.apply(B, [d, z])) && "string" === typeof x && (z = x);
                this.innerHTML = '<div class="tablesorter-header-inner">' + z + "</div>";
                w.onRenderHeader && w.onRenderHeader.apply(B, [d]);
                this.column = a[this.parentNode.rowIndex + "-" + this.cellIndex];
                var b = g.getData(B, v, "sortInitialOrder") || w.sortInitialOrder;
                this.order = /^d/i.test(b) || 1 === b ? [1, 0, 2] : [0, 1, 2];
                this.count = -1;
                this.lockedOrder = !1;
                y = g.getData(B, v, "lockedOrder") || !1;
                "undefined" !== typeof y && !1 !== y && (this.order = this.lockedOrder = /^d/i.test(y) || 1 === y ? [1, 1, 1] : [0, 0, 0]);
                B.addClass(w.cssHeader);
                w.headerList[d] = this;
                B.parent().addClass(w.cssHeaderRow);
                B.attr("tabindex", 0)
            });
            E(d);
            w.debug && (t("Built headers:", C), c(w.$headers))
        }

        function y(d, b, a) {
            var e = d.config;
            e.$table.find(e.selectorRemove).remove();
            j(d);
            v(d);
            G(e.$table, b, a)
        }

        function E(d) {
            var b, a = d.config;
            a.$headers.each(function (d, c) {
                b = "false" === g.getData(c, a.headers[d], "sorter");
                c.sortDisabled = b;
                f(c)[b ? "addClass" : "removeClass"]("sorter-false")
            })
        }

        function C(d) {
            var b, a, e, c = d.config, l = c.sortList, p = [c.cssAsc, c.cssDesc], g = f(d).find("tfoot tr").children().removeClass(p.join(" "));
            c.$headers.removeClass(p.join(" "));
            e = l.length;
            for (b = 0; b < e; b++)if (2 !== l[b][1] && (d = c.$headers.not(".sorter-false").filter('[data-column="' + l[b][0] + '"]' + (1 === e ? ":last" : "")), d.length))for (a = 0; a < d.length; a++)d[a].sortDisabled || (d.eq(a).addClass(p[l[b][1]]), g.length && g.filter('[data-column="' + l[b][0] + '"]').eq(a).addClass(p[l[b][1]]))
        }

        function z(d) {
            var b = 0, a = d.config, e = a.sortList, c = e.length, l = d.tBodies.length, p, g, k, h, q, m, j, r, s;
            if (!a.serverSideSorting && a.cache[0]) {
                a.debug && (p = new Date);
                for (k = 0; k < l; k++)q = a.cache[k].colMax, s = (m = a.cache[k].normalized) && m[0] ? m[0].length - 1 : 0, m.sort(function (l, p) {
                    for (g = 0; g < c; g++) {
                        h = e[g][0];
                        r = e[g][1];
                        j = /n/i.test(a.parsers && a.parsers[h] ? a.parsers[h].type || "" : "") ? "Numeric" : "Text";
                        j += 0 === r ? "" : "Desc";
                        /Numeric/.test(j) && a.strings[h] && (b = "boolean" === typeof a.string[a.strings[h]] ? (0 === r ? 1 : -1) * (a.string[a.strings[h]] ? -1 : 1) : a.strings[h] ? a.string[a.strings[h]] || 0 : 0);
                        var k = f.tablesorter["sort" + j](d, l[h], p[h], h, q[h], b);
                        if (k)return k
                    }
                    return l[s] - p[s]
                });
                a.debug && t("Sorting on " + e.toString() + " and dir " + r + " time", p)
            }
        }

        function I(d, b) {
            d.trigger("updateComplete");
            "function" === typeof b && b(d[0])
        }

        function G(d, b, a) {
            !1 !== b && !d[0].isProcessing ? d.trigger("sorton", [d[0].config.sortList, function () {
                I(d, a)
            }]) : I(d, a)
        }

        function J(d) {
            var b = d.config, a = b.$table, e, c;
            b.$headers.find(b.selectorSort).add(b.$headers.filter(b.selectorSort)).unbind("mousedown.tablesorter mouseup.tablesorter sort.tablesorter keypress.tablesorter").bind("mousedown.tablesorter mouseup.tablesorter sort.tablesorter keypress.tablesorter", function (a, e) {
                if (1 !== (a.which || a.button) && !/sort|keypress/.test(a.type) || "keypress" === a.type && 13 !== a.which || "mouseup" === a.type && !0 !== e && 250 < (new Date).getTime() - c)return!1;
                if ("mousedown" === a.type)return c = (new Date).getTime(), "INPUT" === a.target.tagName ? "" : !b.cancelSelection;
                b.delayInit && !b.cache && v(d);
                var n = (/TH|TD/.test(this.tagName) ? f(this) : f(this).parents("th, td").filter(":first"))[0];
                if (!n.sortDisabled) {
                    var k, h, q, m = d.config, j = !a[m.sortMultiSortKey], r = f(d);
                    r.trigger("sortStart", d);
                    n.count = a[m.sortResetKey] ? 2 : (n.count + 1) % (m.sortReset ? 3 : 2);
                    m.sortRestart && (h = n, m.$headers.each(function () {
                        if (this !== h && (j || !f(this).is("." + m.cssDesc + ",." + m.cssAsc)))this.count = -1
                    }));
                    h = n.column;
                    if (j) {
                        m.sortList = [];
                        if (null !== m.sortForce) {
                            k = m.sortForce;
                            for (q = 0; q < k.length; q++)k[q][0] !== h && m.sortList.push(k[q])
                        }
                        k = n.order[n.count];
                        if (2 > k && (m.sortList.push([h, k]), 1 < n.colSpan))for (q = 1; q < n.colSpan; q++)m.sortList.push([h + q, k])
                    } else if (m.sortAppend && 1 < m.sortList.length && g.isValueInArray(m.sortAppend[0][0], m.sortList) && m.sortList.pop(), g.isValueInArray(h, m.sortList))for (q = 0; q < m.sortList.length; q++)n = m.sortList[q], k = m.headerList[n[0]], n[0] === h && (n[1] = k.order[k.count], 2 === n[1] && (m.sortList.splice(q, 1), k.count = -1)); else if (k = n.order[n.count], 2 > k && (m.sortList.push([h, k]), 1 < n.colSpan))for (q = 1; q < n.colSpan; q++)m.sortList.push([h + q, k]);
                    if (null !== m.sortAppend) {
                        k = m.sortAppend;
                        for (q = 0; q < k.length; q++)k[q][0] !== h && m.sortList.push(k[q])
                    }
                    r.trigger("sortBegin", d);
                    setTimeout(function () {
                        C(d);
                        z(d);
                        x(d)
                    }, 1)
                }
            });
            b.cancelSelection && b.$headers.attr("unselectable", "on").bind("selectstart", !1).css({"user-select": "none", MozUserSelect: "none"});
            a.unbind("sortReset update updateRows updateCell updateAll addRows sorton appendCache applyWidgetId applyWidgets refreshWidgets destroy mouseup mouseleave ".split(" ").join(".tablesorter ")).bind("sortReset.tablesorter",function (a) {
                a.stopPropagation();
                b.sortList = [];
                C(d);
                z(d);
                x(d)
            }).bind("updateAll.tablesorter",function (a, b, e) {
                a.stopPropagation();
                g.refreshWidgets(d, !0, !0);
                g.restoreHeaders(d);
                A(d);
                J(d);
                y(d, b, e)
            }).bind("update.tablesorter updateRows.tablesorter",function (a, b, e) {
                a.stopPropagation();
                E(d);
                y(d, b, e)
            }).bind("updateCell.tablesorter",function (e, c, g, k) {
                e.stopPropagation();
                a.find(b.selectorRemove).remove();
                var h, q, m;
                h = a.find("tbody");
                e = h.index(f(c).parents("tbody").filter(":first"));
                var u = f(c).parents("tr").filter(":first");
                c = f(c)[0];
                h.length && 0 <= e && (q = h.eq(e).find("tr").index(u), m = c.cellIndex, h = b.cache[e].normalized[q].length - 1, b.cache[e].row[d.config.cache[e].normalized[q][h]] = u, b.cache[e].normalized[q][m] = b.parsers[m].format(r(d, c, m), d, c, m), G(a, g, k))
            }).bind("addRows.tablesorter",function (c, g, f, k) {
                c.stopPropagation();
                var h = g.filter("tr").length, u = [], m = g[0].cells.length, t = a.find("tbody").index(g.parents("tbody").filter(":first"));
                b.parsers || j(d);
                for (c = 0; c < h; c++) {
                    for (e = 0; e < m; e++)u[e] = b.parsers[e].format(r(d, g[c].cells[e], e), d, g[c].cells[e], e);
                    u.push(b.cache[t].row.length);
                    b.cache[t].row.push([g[c]]);
                    b.cache[t].normalized.push(u);
                    u = []
                }
                G(a, f, k)
            }).bind("sorton.tablesorter",function (b, e, c, g) {
                b.stopPropagation();
                a.trigger("sortStart", this);
                var h, u, m, j = d.config;
                b = e || j.sortList;
                j.sortList = [];
                f.each(b, function (a, b) {
                    h = [parseInt(b[0], 10), parseInt(b[1], 10)];
                    if (m = j.headerList[h[0]])j.sortList.push(h), u = f.inArray(h[1], m.order), m.count = 0 <= u ? u : h[1] % (j.sortReset ? 3 : 2)
                });
                C(d);
                a.trigger("sortBegin", this);
                z(d);
                x(d, g);
                "function" === typeof c && c(d)
            }).bind("appendCache.tablesorter",function (a, b, e) {
                a.stopPropagation();
                x(d, e);
                "function" === typeof b && b(d)
            }).bind("applyWidgetId.tablesorter",function (a, e) {
                a.stopPropagation();
                g.getWidgetById(e).format(d, b, b.widgetOptions)
            }).bind("applyWidgets.tablesorter",function (a, b) {
                a.stopPropagation();
                g.applyWidget(d, b)
            }).bind("refreshWidgets.tablesorter",function (a, b, e) {
                a.stopPropagation();
                g.refreshWidgets(d, b, e)
            }).bind("destroy.tablesorter", function (a, b, e) {
                a.stopPropagation();
                g.destroy(d, b, e)
            })
        }

        var g = this;
        g.version = "2.10.8";
        g.parsers = [];
        g.widgets = [];
        g.defaults = {theme: "default", widthFixed: !1, showProcessing: !1, headerTemplate: "{content}", onRenderTemplate: null, onRenderHeader: null, cancelSelection: !0, dateFormat: "mmddyyyy", sortMultiSortKey: "shiftKey", sortResetKey: "ctrlKey", usNumberFormat: !0, delayInit: !1, serverSideSorting: !1, headers: {}, ignoreCase: !0, sortForce: null, sortList: [], sortAppend: null, sortInitialOrder: "asc", sortLocaleCompare: !1, sortReset: !1, sortRestart: !1, emptyTo: "bottom", stringTo: "max", textExtraction: "simple", textSorter: null, widgets: [], widgetOptions: {zebra: ["even", "odd"]}, initWidgets: !0, initialized: null, tableClass: "tablesorter", cssAsc: "tablesorter-headerAsc", cssChildRow: "tablesorter-childRow", cssDesc: "tablesorter-headerDesc", cssHeader: "tablesorter-header", cssHeaderRow: "tablesorter-headerRow", cssIcon: "tablesorter-icon", cssInfoBlock: "tablesorter-infoOnly", cssProcessing: "tablesorter-processing", selectorHeaders: "> thead th, > thead td", selectorSort: "th, td", selectorRemove: ".remove-me", debug: !1, headerList: [], empties: {}, strings: {}, parsers: []};
        g.log = c;
        g.benchmark = t;
        g.construct = function (d) {
            return this.each(function () {
                if (!this.tHead || 0 === this.tBodies.length || !0 === this.hasInitialized)return this.config && this.config.debug ? c("stopping initialization! No thead, tbody or tablesorter has already been initialized") : "";
                var b = f(this), a = this, e, u = "", l = f.metadata;
                a.hasInitialized = !1;
                a.isProcessing = !0;
                a.config = {};
                e = f.extend(!0, a.config, g.defaults, d);
                f.data(a, "tablesorter", e);
                e.debug && f.data(a, "startoveralltimer", new Date);
                e.supportsTextContent = "x" === f("<span>x</span>")[0].textContent;
                e.supportsDataObject = 1.4 <= parseFloat(f.fn.jquery);
                e.string = {max: 1, min: -1, "max+": 1, "max-": -1, zero: 0, none: 0, "null": 0, top: !0, bottom: !1};
                /tablesorter\-/.test(b.attr("class")) || (u = "" !== e.theme ? " tablesorter-" + e.theme : "");
                e.$table = b.addClass(e.tableClass + u);
                e.$tbodies = b.children("tbody:not(." + e.cssInfoBlock + ")");
                A(a);
                if (a.config.widthFixed && 0 === f(a).find("colgroup").length) {
                    var p = f("<colgroup>"), n = f(a).width();
                    f(a.tBodies[0]).find("tr:first").children("td").each(function () {
                        p.append(f("<col>").css("width", parseInt(1E3 * (f(this).width() / n), 10) / 10 + "%"))
                    });
                    f(a).prepend(p)
                }
                j(a);
                e.delayInit || v(a);
                J(a);
                e.supportsDataObject && "undefined" !== typeof b.data().sortlist ? e.sortList = b.data().sortlist : l && (b.metadata() && b.metadata().sortlist) && (e.sortList = b.metadata().sortlist);
                g.applyWidget(a, !0);
                0 < e.sortList.length ? b.trigger("sorton", [e.sortList, {}, !e.initWidgets]) : e.initWidgets && g.applyWidget(a);
                e.showProcessing && b.unbind("sortBegin.tablesorter sortEnd.tablesorter").bind("sortBegin.tablesorter sortEnd.tablesorter", function (b) {
                    g.isProcessing(a, "sortBegin" === b.type)
                });
                a.hasInitialized = !0;
                a.isProcessing = !1;
                e.debug && g.benchmark("Overall initialization time", f.data(a, "startoveralltimer"));
                b.trigger("tablesorter-initialized", a);
                "function" === typeof e.initialized && e.initialized(a)
            })
        };
        g.isProcessing = function (d, b, a) {
            d = f(d);
            var e = d[0].config;
            d = a || d.find("." + e.cssHeader);
            b ? (0 < e.sortList.length && (d = d.filter(function () {
                return this.sortDisabled ? !1 : g.isValueInArray(parseFloat(f(this).attr("data-column")), e.sortList)
            })), d.addClass(e.cssProcessing)) : d.removeClass(e.cssProcessing)
        };
        g.processTbody = function (d, b, a) {
            if (a)return d.isProcessing = !0, b.before('<span class="tablesorter-savemyplace"/>'), a = f.fn.detach ? b.detach() : b.remove();
            a = f(d).find("span.tablesorter-savemyplace");
            b.insertAfter(a);
            a.remove();
            d.isProcessing = !1
        };
        g.clearTableBody = function (d) {
            f(d)[0].config.$tbodies.empty()
        };
        g.restoreHeaders = function (d) {
            var b = d.config;
            b.$table.find(b.selectorHeaders).each(function (a) {
                f(this).find(".tablesorter-header-inner").length && f(this).html(b.headerContent[a])
            })
        };
        g.destroy = function (d, b, a) {
            d = f(d)[0];
            if (d.hasInitialized) {
                g.refreshWidgets(d, !0, !0);
                var e = f(d), c = d.config, l = e.find("thead:first"), p = l.find("tr." + c.cssHeaderRow).removeClass(c.cssHeaderRow), n = e.find("tfoot:first > tr").children("th, td");
                l.find("tr").not(p).remove();
                e.removeData("tablesorter").unbind("sortReset update updateAll updateRows updateCell addRows sorton appendCache applyWidgetId applyWidgets refreshWidgets destroy mouseup mouseleave keypress sortBegin sortEnd ".split(" ").join(".tablesorter "));
                c.$headers.add(n).removeClass(c.cssHeader + " " + c.cssAsc + " " + c.cssDesc).removeAttr("data-column");
                p.find(c.selectorSort).unbind("mousedown.tablesorter mouseup.tablesorter keypress.tablesorter");
                g.restoreHeaders(d);
                !1 !== b && e.removeClass(c.tableClass + " tablesorter-" + c.theme);
                d.hasInitialized = !1;
                "function" === typeof a && a(d)
            }
        };
        g.regex = [/(^([+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi, /(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/, /^0x[0-9a-f]+$/i];
        g.sortText = function (d, b, a, e) {
            if (b === a)return 0;
            var c = d.config, l = c.string[c.empties[e] || c.emptyTo], f = g.regex;
            if ("" === b && 0 !== l)return"boolean" === typeof l ? l ? -1 : 1 : -l || -1;
            if ("" === a && 0 !== l)return"boolean" === typeof l ? l ? 1 : -1 : l || 1;
            if ("function" === typeof c.textSorter)return c.textSorter(b, a, d, e);
            d = b.replace(f[0], "\\0$1\\0").replace(/\\0$/, "").replace(/^\\0/, "").split("\\0");
            e = a.replace(f[0], "\\0$1\\0").replace(/\\0$/, "").replace(/^\\0/, "").split("\\0");
            b = parseInt(b.match(f[2]), 16) || 1 !== d.length && b.match(f[1]) && Date.parse(b);
            if (a = parseInt(a.match(f[2]), 16) || b && a.match(f[1]) && Date.parse(a) || null) {
                if (b < a)return-1;
                if (b > a)return 1
            }
            c = Math.max(d.length, e.length);
            for (b = 0; b < c; b++) {
                a = isNaN(d[b]) ? d[b] || 0 : parseFloat(d[b]) || 0;
                f = isNaN(e[b]) ? e[b] || 0 : parseFloat(e[b]) || 0;
                if (isNaN(a) !== isNaN(f))return isNaN(a) ? 1 : -1;
                typeof a !== typeof f && (a += "", f += "");
                if (a < f)return-1;
                if (a > f)return 1
            }
            return 0
        };
        g.sortTextDesc = function (d, b, a, e) {
            if (b === a)return 0;
            var c = d.config, f = c.string[c.empties[e] || c.emptyTo];
            return"" === b && 0 !== f ? "boolean" === typeof f ? f ? -1 : 1 : f || 1 : "" === a && 0 !== f ? "boolean" === typeof f ? f ? 1 : -1 : -f || -1 : "function" === typeof c.textSorter ? c.textSorter(a, b, d, e) : g.sortText(d, a, b)
        };
        g.getTextValue = function (d, b, a) {
            if (b) {
                var c = d ? d.length : 0, g = b + a;
                for (b = 0; b < c; b++)g += d.charCodeAt(b);
                return a * g
            }
            return 0
        };
        g.sortNumeric = function (d, b, a, c, f, l) {
            if (b === a)return 0;
            d = d.config;
            c = d.string[d.empties[c] || d.emptyTo];
            if ("" === b && 0 !== c)return"boolean" === typeof c ? c ? -1 : 1 : -c || -1;
            if ("" === a && 0 !== c)return"boolean" === typeof c ? c ? 1 : -1 : c || 1;
            isNaN(b) && (b = g.getTextValue(b, f, l));
            isNaN(a) && (a = g.getTextValue(a, f, l));
            return b - a
        };
        g.sortNumericDesc = function (d, b, a, c, f, l) {
            if (b === a)return 0;
            d = d.config;
            c = d.string[d.empties[c] || d.emptyTo];
            if ("" === b && 0 !== c)return"boolean" === typeof c ? c ? -1 : 1 : c || 1;
            if ("" === a && 0 !== c)return"boolean" === typeof c ? c ? 1 : -1 : -c || -1;
            isNaN(b) && (b = g.getTextValue(b, f, l));
            isNaN(a) && (a = g.getTextValue(a, f, l));
            return a - b
        };
        g.characterEquivalents = {a: "\u00e1\u00e0\u00e2\u00e3\u00e4\u0105\u00e5", A: "\u00c1\u00c0\u00c2\u00c3\u00c4\u0104\u00c5", c: "\u00e7\u0107\u010d", C: "\u00c7\u0106\u010c", e: "\u00e9\u00e8\u00ea\u00eb\u011b\u0119", E: "\u00c9\u00c8\u00ca\u00cb\u011a\u0118", i: "\u00ed\u00ec\u0130\u00ee\u00ef\u0131", I: "\u00cd\u00cc\u0130\u00ce\u00cf", o: "\u00f3\u00f2\u00f4\u00f5\u00f6", O: "\u00d3\u00d2\u00d4\u00d5\u00d6", ss: "\u00df", SS: "\u1e9e", u: "\u00fa\u00f9\u00fb\u00fc\u016f", U: "\u00da\u00d9\u00db\u00dc\u016e"};
        g.replaceAccents = function (d) {
            var b, a = "[", c = g.characterEquivalents;
            if (!g.characterRegex) {
                g.characterRegexArray = {};
                for (b in c)"string" === typeof b && (a += c[b], g.characterRegexArray[b] = RegExp("[" + c[b] + "]", "g"));
                g.characterRegex = RegExp(a + "]")
            }
            if (g.characterRegex.test(d))for (b in c)"string" === typeof b && (d = d.replace(g.characterRegexArray[b], b));
            return d
        };
        g.isValueInArray = function (d, b) {
            var a, c = b.length;
            for (a = 0; a < c; a++)if (b[a][0] === d)return!0;
            return!1
        };
        g.addParser = function (d) {
            var b, a = g.parsers.length, c = !0;
            for (b = 0; b < a; b++)g.parsers[b].id.toLowerCase() === d.id.toLowerCase() && (c = !1);
            c && g.parsers.push(d)
        };
        g.getParserById = function (d) {
            var b, a = g.parsers.length;
            for (b = 0; b < a; b++)if (g.parsers[b].id.toLowerCase() === d.toString().toLowerCase())return g.parsers[b];
            return!1
        };
        g.addWidget = function (d) {
            g.widgets.push(d)
        };
        g.getWidgetById = function (d) {
            var b, a, c = g.widgets.length;
            for (b = 0; b < c; b++)if ((a = g.widgets[b]) && a.hasOwnProperty("id") && a.id.toLowerCase() === d.toLowerCase())return a
        };
        g.applyWidget = function (d, b) {
            d = f(d)[0];
            var a = d.config, c = a.widgetOptions, j = [], l, p, n;
            a.debug && (l = new Date);
            a.widgets.length && (a.widgets = f.grep(a.widgets, function (b, d) {
                return f.inArray(b, a.widgets) === d
            }), f.each(a.widgets || [], function (a, b) {
                if ((n = g.getWidgetById(b)) && n.id)n.priority || (n.priority = 10), j[a] = n
            }), j.sort(function (a, b) {
                return a.priority < b.priority ? -1 : a.priority === b.priority ? 0 : 1
            }), f.each(j, function (g, h) {
                h && (b ? (h.hasOwnProperty("options") && (c = d.config.widgetOptions = f.extend(!0, {}, h.options, c)), h.hasOwnProperty("init") && h.init(d, h, a, c)) : !b && h.hasOwnProperty("format") && h.format(d, a, c, !1))
            }));
            a.debug && (p = a.widgets.length, t("Completed " + (!0 === b ? "initializing " : "applying ") + p + " widget" + (1 !== p ? "s" : ""), l))
        };
        g.refreshWidgets = function (d, b, a) {
            d = f(d)[0];
            var e, j = d.config, l = j.widgets, p = g.widgets, n = p.length;
            for (e = 0; e < n; e++)if (p[e] && p[e].id && (b || 0 > f.inArray(p[e].id, l)))j.debug && c("Refeshing widgets: Removing " + p[e].id), p[e].hasOwnProperty("remove") && p[e].remove(d, j, j.widgetOptions);
            !0 !== a && g.applyWidget(d, b)
        };
        g.getData = function (d, b, a) {
            var c = "";
            d = f(d);
            var g, l;
            if (!d.length)return"";
            g = f.metadata ? d.metadata() : !1;
            l = " " + (d.attr("class") || "");
            "undefined" !== typeof d.data(a) || "undefined" !== typeof d.data(a.toLowerCase()) ? c += d.data(a) || d.data(a.toLowerCase()) : g && "undefined" !== typeof g[a] ? c += g[a] : b && "undefined" !== typeof b[a] ? c += b[a] : " " !== l && l.match(" " + a + "-") && (c = l.match(RegExp("\\s" + a + "-([\\w-]+)"))[1] || "");
            return f.trim(c)
        };
        g.formatFloat = function (c, b) {
            if ("string" !== typeof c || "" === c)return c;
            var a;
            c = (b && b.config ? !1 !== b.config.usNumberFormat : "undefined" !== typeof b ? b : 1) ? c.replace(/,/g, "") : c.replace(/[\s|\.]/g, "").replace(/,/g, ".");
            /^\s*\([.\d]+\)/.test(c) && (c = c.replace(/^\s*\(/, "-").replace(/\)/, ""));
            a = parseFloat(c);
            return isNaN(a) ? f.trim(c) : a
        };
        g.isDigit = function (c) {
            return isNaN(c) ? /^[\-+(]?\d+[)]?$/.test(c.toString().replace(/[,.'"\s]/g, "")) : !0
        }
    }});
    var j = f.tablesorter;
    f.fn.extend({tablesorter: j.construct});
    j.addParser({id: "text", is: function () {
        return!0
    }, format: function (c, t) {
        var r = t.config;
        c && (c = f.trim(r.ignoreCase ? c.toLocaleLowerCase() : c), c = r.sortLocaleCompare ? j.replaceAccents(c) : c);
        return c
    }, type: "text"});
    j.addParser({id: "digit", is: function (c) {
        return j.isDigit(c)
    }, format: function (c, t) {
        var r = j.formatFloat((c || "").replace(/[^\w,. \-()]/g, ""), t);
        return c && "number" === typeof r ? r : c ? f.trim(c && t.config.ignoreCase ? c.toLocaleLowerCase() : c) : c
    }, type: "numeric"});
    j.addParser({id: "currency", is: function (c) {
        return/^\(?\d+[\u00a3$\u20ac\u00a4\u00a5\u00a2?.]|[\u00a3$\u20ac\u00a4\u00a5\u00a2?.]\d+\)?$/.test((c || "").replace(/[,. ]/g, ""))
    }, format: function (c, t) {
        var r = j.formatFloat((c || "").replace(/[^\w,. \-()]/g, ""), t);
        return c && "number" === typeof r ? r : c ? f.trim(c && t.config.ignoreCase ? c.toLocaleLowerCase() : c) : c
    }, type: "numeric"});
    j.addParser({id: "ipAddress", is: function (c) {
        return/^\d{1,3}[\.]\d{1,3}[\.]\d{1,3}[\.]\d{1,3}$/.test(c)
    }, format: function (c, f) {
        var r, s = c ? c.split(".") : "", v = "", x = s.length;
        for (r = 0; r < x; r++)v += ("00" + s[r]).slice(-3);
        return c ? j.formatFloat(v, f) : c
    }, type: "numeric"});
    j.addParser({id: "url", is: function (c) {
        return/^(https?|ftp|file):\/\//.test(c)
    }, format: function (c) {
        return c ? f.trim(c.replace(/(https?|ftp|file):\/\//, "")) : c
    }, type: "text"});
    j.addParser({id: "isoDate", is: function (c) {
        return/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}/.test(c)
    }, format: function (c, f) {
        return c ? j.formatFloat("" !== c ? (new Date(c.replace(/-/g, "/"))).getTime() || "" : "", f) : c
    }, type: "numeric"});
    j.addParser({id: "percent", is: function (c) {
        return/(\d\s*?%|%\s*?\d)/.test(c) && 15 > c.length
    }, format: function (c, f) {
        return c ? j.formatFloat(c.replace(/%/g, ""), f) : c
    }, type: "numeric"});
    j.addParser({id: "usLongDate", is: function (c) {
        return/^[A-Z]{3,10}\.?\s+\d{1,2},?\s+(\d{4})(\s+\d{1,2}:\d{2}(:\d{2})?(\s+[AP]M)?)?$/i.test(c) || /^\d{1,2}\s+[A-Z]{3,10}\s+\d{4}/i.test(c)
    }, format: function (c, f) {
        return c ? j.formatFloat((new Date(c.replace(/(\S)([AP]M)$/i, "$1 $2"))).getTime() || "", f) : c
    }, type: "numeric"});
    j.addParser({id: "shortDate", is: function (c) {
        return/(^\d{1,2}[\/\s]\d{1,2}[\/\s]\d{4})|(^\d{4}[\/\s]\d{1,2}[\/\s]\d{1,2})/.test((c || "").replace(/\s+/g, " ").replace(/[\-.,]/g, "/"))
    }, format: function (c, f, r, s) {
        if (c) {
            r = f.config;
            var v = r.headerList[s];
            s = v.dateFormat || j.getData(v, r.headers[s], "dateFormat") || r.dateFormat;
            c = c.replace(/\s+/g, " ").replace(/[\-.,]/g, "/");
            "mmddyyyy" === s ? c = c.replace(/(\d{1,2})[\/\s](\d{1,2})[\/\s](\d{4})/, "$3/$1/$2") : "ddmmyyyy" === s ? c = c.replace(/(\d{1,2})[\/\s](\d{1,2})[\/\s](\d{4})/, "$3/$2/$1") : "yyyymmdd" === s && (c = c.replace(/(\d{4})[\/\s](\d{1,2})[\/\s](\d{1,2})/, "$1/$2/$3"))
        }
        return c ? j.formatFloat((new Date(c)).getTime() || "", f) : c
    }, type: "numeric"});
    j.addParser({id: "time", is: function (c) {
        return/^(([0-2]?\d:[0-5]\d)|([0-1]?\d:[0-5]\d\s?([AP]M)))$/i.test(c)
    }, format: function (c, f) {
        return c ? j.formatFloat((new Date("2000/01/01 " + c.replace(/(\S)([AP]M)$/i, "$1 $2"))).getTime() || "", f) : c
    }, type: "numeric"});
    j.addParser({id: "metadata", is: function () {
        return!1
    }, format: function (c, j, r) {
        c = j.config;
        c = !c.parserMetadataName ? "sortValue" : c.parserMetadataName;
        return f(r).metadata()[c]
    }, type: "numeric"});
    j.addWidget({id: "zebra", priority: 90, format: function (c, t, r) {
        var s, v, x, A, y, E, C = RegExp(t.cssChildRow, "i"), z = t.$tbodies;
        t.debug && (y = new Date);
        for (c = 0; c < z.length; c++)s = z.eq(c), E = s.children("tr").length, 1 < E && (x = 0, s = s.children("tr:visible"), s.each(function () {
            v = f(this);
            C.test(this.className) || x++;
            A = 0 === x % 2;
            v.removeClass(r.zebra[A ? 1 : 0]).addClass(r.zebra[A ? 0 : 1])
        }));
        t.debug && j.benchmark("Applying Zebra widget", y)
    }, remove: function (c, j, r) {
        var s;
        j = j.$tbodies;
        var v = (r.zebra || ["even", "odd"]).join(" ");
        for (r = 0; r < j.length; r++)s = f.tablesorter.processTbody(c, j.eq(r), !0), s.children().removeClass(v), f.tablesorter.processTbody(c, s, !1)
    }})
}(jQuery);

/*
 * jQuery FlexSlider v2.5.0
 * Copyright 2012 WooThemes
 * Contributing Author: Tyler Smith
 */
!function ($) {
    $.flexslider = function (e, t) {
        var a = $(e);
        a.vars = $.extend({}, $.flexslider.defaults, t);
        var n = a.vars.namespace, i = window.navigator && window.navigator.msPointerEnabled && window.MSGesture, s = ("ontouchstart"in window || i || window.DocumentTouch && document instanceof DocumentTouch) && a.vars.touch, r = "click touchend MSPointerUp keyup", o = "", l, c = "vertical" === a.vars.direction, d = a.vars.reverse, u = a.vars.itemWidth > 0, v = "fade" === a.vars.animation, p = "" !== a.vars.asNavFor, m = {}, f = !0;
        $.data(e, "flexslider", a), m = {init: function () {
            a.animating = !1, a.currentSlide = parseInt(a.vars.startAt ? a.vars.startAt : 0, 10), isNaN(a.currentSlide) && (a.currentSlide = 0), a.animatingTo = a.currentSlide, a.atEnd = 0 === a.currentSlide || a.currentSlide === a.last, a.containerSelector = a.vars.selector.substr(0, a.vars.selector.search(" ")), a.slides = $(a.vars.selector, a), a.container = $(a.containerSelector, a), a.count = a.slides.length, a.syncExists = $(a.vars.sync).length > 0, "slide" === a.vars.animation && (a.vars.animation = "swing"), a.prop = c ? "top" : "marginLeft", a.args = {}, a.manualPause = !1, a.stopped = !1, a.started = !1, a.startTimeout = null, a.transitions = !a.vars.video && !v && a.vars.useCSS && function () {
                var e = document.createElement("div"), t = ["perspectiveProperty", "WebkitPerspective", "MozPerspective", "OPerspective", "msPerspective"];
                for (var n in t)if (void 0 !== e.style[t[n]])return a.pfx = t[n].replace("Perspective", "").toLowerCase(), a.prop = "-" + a.pfx + "-transform", !0;
                return!1
            }(), a.ensureAnimationEnd = "", "" !== a.vars.controlsContainer && (a.controlsContainer = $(a.vars.controlsContainer).length > 0 && $(a.vars.controlsContainer)), "" !== a.vars.manualControls && (a.manualControls = $(a.vars.manualControls).length > 0 && $(a.vars.manualControls)), "" !== a.vars.customDirectionNav && (a.customDirectionNav = 2 === $(a.vars.customDirectionNav).length && $(a.vars.customDirectionNav)), a.vars.randomize && (a.slides.sort(function () {
                return Math.round(Math.random()) - .5
            }), a.container.empty().append(a.slides)), a.doMath(), a.setup("init"), a.vars.controlNav && m.controlNav.setup(), a.vars.directionNav && m.directionNav.setup(), a.vars.keyboard && (1 === $(a.containerSelector).length || a.vars.multipleKeyboard) && $(document).bind("keyup", function (e) {
                var t = e.keyCode;
                if (!a.animating && (39 === t || 37 === t)) {
                    var n = 39 === t ? a.getTarget("next") : 37 === t ? a.getTarget("prev") : !1;
                    a.flexAnimate(n, a.vars.pauseOnAction)
                }
            }), a.vars.mousewheel && a.bind("mousewheel", function (e, t, n, i) {
                e.preventDefault();
                var s = a.getTarget(0 > t ? "next" : "prev");
                a.flexAnimate(s, a.vars.pauseOnAction)
            }), a.vars.pausePlay && m.pausePlay.setup(), a.vars.slideshow && a.vars.pauseInvisible && m.pauseInvisible.init(), a.vars.slideshow && (a.vars.pauseOnHover && a.hover(function () {
                a.manualPlay || a.manualPause || a.pause()
            }, function () {
                a.manualPause || a.manualPlay || a.stopped || a.play()
            }), a.vars.pauseInvisible && m.pauseInvisible.isHidden() || (a.vars.initDelay > 0 ? a.startTimeout = setTimeout(a.play, a.vars.initDelay) : a.play())), p && m.asNav.setup(), s && a.vars.touch && m.touch(), (!v || v && a.vars.smoothHeight) && $(window).bind("resize orientationchange focus", m.resize), a.find("img").attr("draggable", "false"), setTimeout(function () {
                a.vars.start(a)
            }, 200)
        }, asNav: {setup: function () {
            a.asNav = !0, a.animatingTo = Math.floor(a.currentSlide / a.move), a.currentItem = a.currentSlide, a.slides.removeClass(n + "active-slide").eq(a.currentItem).addClass(n + "active-slide"), i ? (e._slider = a, a.slides.each(function () {
                var e = this;
                e._gesture = new MSGesture, e._gesture.target = e, e.addEventListener("MSPointerDown", function (e) {
                    e.preventDefault(), e.currentTarget._gesture && e.currentTarget._gesture.addPointer(e.pointerId)
                }, !1), e.addEventListener("MSGestureTap", function (e) {
                    e.preventDefault();
                    var t = $(this), n = t.index();
                    $(a.vars.asNavFor).data("flexslider").animating || t.hasClass("active") || (a.direction = a.currentItem < n ? "next" : "prev", a.flexAnimate(n, a.vars.pauseOnAction, !1, !0, !0))
                })
            })) : a.slides.on(r, function (e) {
                e.preventDefault();
                var t = $(this), i = t.index(), s = t.offset().left - $(a).scrollLeft();
                0 >= s && t.hasClass(n + "active-slide") ? a.flexAnimate(a.getTarget("prev"), !0) : $(a.vars.asNavFor).data("flexslider").animating || t.hasClass(n + "active-slide") || (a.direction = a.currentItem < i ? "next" : "prev", a.flexAnimate(i, a.vars.pauseOnAction, !1, !0, !0))
            })
        }}, controlNav: {setup: function () {
            a.manualControls ? m.controlNav.setupManual() : m.controlNav.setupPaging()
        }, setupPaging: function () {
            var e = "thumbnails" === a.vars.controlNav ? "control-thumbs" : "control-paging", t = 1, i, s;
            if (a.controlNavScaffold = $('<ol class="' + n + "control-nav " + n + e + '"></ol>'), a.pagingCount > 1)for (var l = 0; l < a.pagingCount; l++) {
                if (s = a.slides.eq(l), i = "thumbnails" === a.vars.controlNav ? '<img src="' + s.attr("data-thumb") + '"/>' : "<a>" + t + "</a>", "thumbnails" === a.vars.controlNav && !0 === a.vars.thumbCaptions) {
                    var c = s.attr("data-thumbcaption");
                    "" !== c && void 0 !== c && (i += '<span class="' + n + 'caption">' + c + "</span>")
                }
                a.controlNavScaffold.append("<li>" + i + "</li>"), t++
            }
            a.controlsContainer ? $(a.controlsContainer).append(a.controlNavScaffold) : a.append(a.controlNavScaffold), m.controlNav.set(), m.controlNav.active(), a.controlNavScaffold.delegate("a, img", r, function (e) {
                if (e.preventDefault(), "" === o || o === e.type) {
                    var t = $(this), i = a.controlNav.index(t);
                    t.hasClass(n + "active") || (a.direction = i > a.currentSlide ? "next" : "prev", a.flexAnimate(i, a.vars.pauseOnAction))
                }
                "" === o && (o = e.type), m.setToClearWatchedEvent()
            })
        }, setupManual: function () {
            a.controlNav = a.manualControls, m.controlNav.active(), a.controlNav.bind(r, function (e) {
                if (e.preventDefault(), "" === o || o === e.type) {
                    var t = $(this), i = a.controlNav.index(t);
                    t.hasClass(n + "active") || (a.direction = i > a.currentSlide ? "next" : "prev", a.flexAnimate(i, a.vars.pauseOnAction))
                }
                "" === o && (o = e.type), m.setToClearWatchedEvent()
            })
        }, set: function () {
            var e = "thumbnails" === a.vars.controlNav ? "img" : "a";
            a.controlNav = $("." + n + "control-nav li " + e, a.controlsContainer ? a.controlsContainer : a)
        }, active: function () {
            a.controlNav.removeClass(n + "active").eq(a.animatingTo).addClass(n + "active")
        }, update: function (e, t) {
            a.pagingCount > 1 && "add" === e ? a.controlNavScaffold.append($("<li><a>" + a.count + "</a></li>")) : 1 === a.pagingCount ? a.controlNavScaffold.find("li").remove() : a.controlNav.eq(t).closest("li").remove(), m.controlNav.set(), a.pagingCount > 1 && a.pagingCount !== a.controlNav.length ? a.update(t, e) : m.controlNav.active()
        }}, directionNav: {setup: function () {
            var e = $('<ul class="' + n + 'direction-nav"><li class="' + n + 'nav-prev"><a class="' + n + 'prev" href="#">' + a.vars.prevText + '</a></li><li class="' + n + 'nav-next"><a class="' + n + 'next" href="#">' + a.vars.nextText + "</a></li></ul>");
            a.customDirectionNav ? a.directionNav = a.customDirectionNav : a.controlsContainer ? ($(a.controlsContainer).append(e), a.directionNav = $("." + n + "direction-nav li a", a.controlsContainer)) : (a.append(e), a.directionNav = $("." + n + "direction-nav li a", a)), m.directionNav.update(), a.directionNav.bind(r, function (e) {
                e.preventDefault();
                var t;
                ("" === o || o === e.type) && (t = a.getTarget($(this).hasClass(n + "next") ? "next" : "prev"), a.flexAnimate(t, a.vars.pauseOnAction)), "" === o && (o = e.type), m.setToClearWatchedEvent()
            })
        }, update: function () {
            var e = n + "disabled";
            1 === a.pagingCount ? a.directionNav.addClass(e).attr("tabindex", "-1") : a.vars.animationLoop ? a.directionNav.removeClass(e).removeAttr("tabindex") : 0 === a.animatingTo ? a.directionNav.removeClass(e).filter("." + n + "prev").addClass(e).attr("tabindex", "-1") : a.animatingTo === a.last ? a.directionNav.removeClass(e).filter("." + n + "next").addClass(e).attr("tabindex", "-1") : a.directionNav.removeClass(e).removeAttr("tabindex")
        }}, pausePlay: {setup: function () {
            var e = $('<div class="' + n + 'pauseplay"><a></a></div>');
            a.controlsContainer ? (a.controlsContainer.append(e), a.pausePlay = $("." + n + "pauseplay a", a.controlsContainer)) : (a.append(e), a.pausePlay = $("." + n + "pauseplay a", a)), m.pausePlay.update(a.vars.slideshow ? n + "pause" : n + "play"), a.pausePlay.bind(r, function (e) {
                e.preventDefault(), ("" === o || o === e.type) && ($(this).hasClass(n + "pause") ? (a.manualPause = !0, a.manualPlay = !1, a.pause()) : (a.manualPause = !1, a.manualPlay = !0, a.play())), "" === o && (o = e.type), m.setToClearWatchedEvent()
            })
        }, update: function (e) {
            "play" === e ? a.pausePlay.removeClass(n + "pause").addClass(n + "play").html(a.vars.playText) : a.pausePlay.removeClass(n + "play").addClass(n + "pause").html(a.vars.pauseText)
        }}, touch: function () {
            function t(t) {
                t.stopPropagation(), a.animating ? t.preventDefault() : (a.pause(), e._gesture.addPointer(t.pointerId), w = 0, p = c ? a.h : a.w, f = Number(new Date), l = u && d && a.animatingTo === a.last ? 0 : u && d ? a.limit - (a.itemW + a.vars.itemMargin) * a.move * a.animatingTo : u && a.currentSlide === a.last ? a.limit : u ? (a.itemW + a.vars.itemMargin) * a.move * a.currentSlide : d ? (a.last - a.currentSlide + a.cloneOffset) * p : (a.currentSlide + a.cloneOffset) * p)
            }

            function n(t) {
                t.stopPropagation();
                var a = t.target._slider;
                if (a) {
                    var n = -t.translationX, i = -t.translationY;
                    return w += c ? i : n, m = w, y = c ? Math.abs(w) < Math.abs(-n) : Math.abs(w) < Math.abs(-i), t.detail === t.MSGESTURE_FLAG_INERTIA ? void setImmediate(function () {
                        e._gesture.stop()
                    }) : void((!y || Number(new Date) - f > 500) && (t.preventDefault(), !v && a.transitions && (a.vars.animationLoop || (m = w / (0 === a.currentSlide && 0 > w || a.currentSlide === a.last && w > 0 ? Math.abs(w) / p + 2 : 1)), a.setProps(l + m, "setTouch"))))
                }
            }

            function s(e) {
                e.stopPropagation();
                var t = e.target._slider;
                if (t) {
                    if (t.animatingTo === t.currentSlide && !y && null !== m) {
                        var a = d ? -m : m, n = t.getTarget(a > 0 ? "next" : "prev");
                        t.canAdvance(n) && (Number(new Date) - f < 550 && Math.abs(a) > 50 || Math.abs(a) > p / 2) ? t.flexAnimate(n, t.vars.pauseOnAction) : v || t.flexAnimate(t.currentSlide, t.vars.pauseOnAction, !0)
                    }
                    r = null, o = null, m = null, l = null, w = 0
                }
            }

            var r, o, l, p, m, f, g, h, S, y = !1, x = 0, b = 0, w = 0;
            i ? (e.style.msTouchAction = "none", e._gesture = new MSGesture, e._gesture.target = e, e.addEventListener("MSPointerDown", t, !1), e._slider = a, e.addEventListener("MSGestureChange", n, !1), e.addEventListener("MSGestureEnd", s, !1)) : (g = function (t) {
                a.animating ? t.preventDefault() : (window.navigator.msPointerEnabled || 1 === t.touches.length) && (a.pause(), p = c ? a.h : a.w, f = Number(new Date), x = t.touches[0].pageX, b = t.touches[0].pageY, l = u && d && a.animatingTo === a.last ? 0 : u && d ? a.limit - (a.itemW + a.vars.itemMargin) * a.move * a.animatingTo : u && a.currentSlide === a.last ? a.limit : u ? (a.itemW + a.vars.itemMargin) * a.move * a.currentSlide : d ? (a.last - a.currentSlide + a.cloneOffset) * p : (a.currentSlide + a.cloneOffset) * p, r = c ? b : x, o = c ? x : b, e.addEventListener("touchmove", h, !1), e.addEventListener("touchend", S, !1))
            }, h = function (e) {
                x = e.touches[0].pageX, b = e.touches[0].pageY, m = c ? r - b : r - x, y = c ? Math.abs(m) < Math.abs(x - o) : Math.abs(m) < Math.abs(b - o);
                var t = 500;
                (!y || Number(new Date) - f > t) && (e.preventDefault(), !v && a.transitions && (a.vars.animationLoop || (m /= 0 === a.currentSlide && 0 > m || a.currentSlide === a.last && m > 0 ? Math.abs(m) / p + 2 : 1), a.setProps(l + m, "setTouch")))
            }, S = function (t) {
                if (e.removeEventListener("touchmove", h, !1), a.animatingTo === a.currentSlide && !y && null !== m) {
                    var n = d ? -m : m, i = a.getTarget(n > 0 ? "next" : "prev");
                    a.canAdvance(i) && (Number(new Date) - f < 550 && Math.abs(n) > 50 || Math.abs(n) > p / 2) ? a.flexAnimate(i, a.vars.pauseOnAction) : v || a.flexAnimate(a.currentSlide, a.vars.pauseOnAction, !0)
                }
                e.removeEventListener("touchend", S, !1), r = null, o = null, m = null, l = null
            }, e.addEventListener("touchstart", g, !1))
        }, resize: function () {
            !a.animating && a.is(":visible") && (u || a.doMath(), v ? m.smoothHeight() : u ? (a.slides.width(a.computedW), a.update(a.pagingCount), a.setProps()) : c ? (a.viewport.height(a.h), a.setProps(a.h, "setTotal")) : (a.vars.smoothHeight && m.smoothHeight(), a.newSlides.width(a.computedW), a.setProps(a.computedW, "setTotal")))
        }, smoothHeight: function (e) {
            if (!c || v) {
                var t = v ? a : a.viewport;
                e ? t.animate({height: a.slides.eq(a.animatingTo).height()}, e) : t.height(a.slides.eq(a.animatingTo).height())
            }
        }, sync: function (e) {
            var t = $(a.vars.sync).data("flexslider"), n = a.animatingTo;
            switch (e) {
                case"animate":
                    t.flexAnimate(n, a.vars.pauseOnAction, !1, !0);
                    break;
                case"play":
                    t.playing || t.asNav || t.play();
                    break;
                case"pause":
                    t.pause()
            }
        }, uniqueID: function (e) {
            return e.filter("[id]").add(e.find("[id]")).each(function () {
                var e = $(this);
                e.attr("id", e.attr("id") + "_clone")
            }), e
        }, pauseInvisible: {visProp: null, init: function () {
            var e = m.pauseInvisible.getHiddenProp();
            if (e) {
                var t = e.replace(/[H|h]idden/, "") + "visibilitychange";
                document.addEventListener(t, function () {
                    m.pauseInvisible.isHidden() ? a.startTimeout ? clearTimeout(a.startTimeout) : a.pause() : a.started ? a.play() : a.vars.initDelay > 0 ? setTimeout(a.play, a.vars.initDelay) : a.play()
                })
            }
        }, isHidden: function () {
            var e = m.pauseInvisible.getHiddenProp();
            return e ? document[e] : !1
        }, getHiddenProp: function () {
            var e = ["webkit", "moz", "ms", "o"];
            if ("hidden"in document)return"hidden";
            for (var t = 0; t < e.length; t++)if (e[t] + "Hidden"in document)return e[t] + "Hidden";
            return null
        }}, setToClearWatchedEvent: function () {
            clearTimeout(l), l = setTimeout(function () {
                o = ""
            }, 3e3)
        }}, a.flexAnimate = function (e, t, i, r, o) {
            if (a.vars.animationLoop || e === a.currentSlide || (a.direction = e > a.currentSlide ? "next" : "prev"), p && 1 === a.pagingCount && (a.direction = a.currentItem < e ? "next" : "prev"), !a.animating && (a.canAdvance(e, o) || i) && a.is(":visible")) {
                if (p && r) {
                    var l = $(a.vars.asNavFor).data("flexslider");
                    if (a.atEnd = 0 === e || e === a.count - 1, l.flexAnimate(e, !0, !1, !0, o), a.direction = a.currentItem < e ? "next" : "prev", l.direction = a.direction, Math.ceil((e + 1) / a.visible) - 1 === a.currentSlide || 0 === e)return a.currentItem = e, a.slides.removeClass(n + "active-slide").eq(e).addClass(n + "active-slide"), !1;
                    a.currentItem = e, a.slides.removeClass(n + "active-slide").eq(e).addClass(n + "active-slide"), e = Math.floor(e / a.visible)
                }
                if (a.animating = !0, a.animatingTo = e, t && a.pause(), a.vars.before(a), a.syncExists && !o && m.sync("animate"), a.vars.controlNav && m.controlNav.active(), u || a.slides.removeClass(n + "active-slide").eq(e).addClass(n + "active-slide"), a.atEnd = 0 === e || e === a.last, a.vars.directionNav && m.directionNav.update(), e === a.last && (a.vars.end(a), a.vars.animationLoop || a.pause()), v)s ? (a.slides.eq(a.currentSlide).css({opacity: 0, zIndex: 1}), a.slides.eq(e).css({opacity: 1, zIndex: 2}), a.wrapup(f)) : (a.slides.eq(a.currentSlide).css({zIndex: 1}).animate({opacity: 0}, a.vars.animationSpeed, a.vars.easing), a.slides.eq(e).css({zIndex: 2}).animate({opacity: 1}, a.vars.animationSpeed, a.vars.easing, a.wrapup)); else {
                    var f = c ? a.slides.filter(":first").height() : a.computedW, g, h, S;
                    u ? (g = a.vars.itemMargin, S = (a.itemW + g) * a.move * a.animatingTo, h = S > a.limit && 1 !== a.visible ? a.limit : S) : h = 0 === a.currentSlide && e === a.count - 1 && a.vars.animationLoop && "next" !== a.direction ? d ? (a.count + a.cloneOffset) * f : 0 : a.currentSlide === a.last && 0 === e && a.vars.animationLoop && "prev" !== a.direction ? d ? 0 : (a.count + 1) * f : d ? (a.count - 1 - e + a.cloneOffset) * f : (e + a.cloneOffset) * f, a.setProps(h, "", a.vars.animationSpeed), a.transitions ? (a.vars.animationLoop && a.atEnd || (a.animating = !1, a.currentSlide = a.animatingTo), a.container.unbind("webkitTransitionEnd transitionend"), a.container.bind("webkitTransitionEnd transitionend", function () {
                        clearTimeout(a.ensureAnimationEnd), a.wrapup(f)
                    }), clearTimeout(a.ensureAnimationEnd), a.ensureAnimationEnd = setTimeout(function () {
                        a.wrapup(f)
                    }, a.vars.animationSpeed + 100)) : a.container.animate(a.args, a.vars.animationSpeed, a.vars.easing, function () {
                        a.wrapup(f)
                    })
                }
                a.vars.smoothHeight && m.smoothHeight(a.vars.animationSpeed)
            }
        }, a.wrapup = function (e) {
            v || u || (0 === a.currentSlide && a.animatingTo === a.last && a.vars.animationLoop ? a.setProps(e, "jumpEnd") : a.currentSlide === a.last && 0 === a.animatingTo && a.vars.animationLoop && a.setProps(e, "jumpStart")), a.animating = !1, a.currentSlide = a.animatingTo, a.vars.after(a)
        }, a.animateSlides = function () {
            !a.animating && f && a.flexAnimate(a.getTarget("next"))
        }, a.pause = function () {
            clearInterval(a.animatedSlides), a.animatedSlides = null, a.playing = !1, a.vars.pausePlay && m.pausePlay.update("play"), a.syncExists && m.sync("pause")
        }, a.play = function () {
            a.playing && clearInterval(a.animatedSlides), a.animatedSlides = a.animatedSlides || setInterval(a.animateSlides, a.vars.slideshowSpeed), a.started = a.playing = !0, a.vars.pausePlay && m.pausePlay.update("pause"), a.syncExists && m.sync("play")
        }, a.stop = function () {
            a.pause(), a.stopped = !0
        }, a.canAdvance = function (e, t) {
            var n = p ? a.pagingCount - 1 : a.last;
            return t ? !0 : p && a.currentItem === a.count - 1 && 0 === e && "prev" === a.direction ? !0 : p && 0 === a.currentItem && e === a.pagingCount - 1 && "next" !== a.direction ? !1 : e !== a.currentSlide || p ? a.vars.animationLoop ? !0 : a.atEnd && 0 === a.currentSlide && e === n && "next" !== a.direction ? !1 : a.atEnd && a.currentSlide === n && 0 === e && "next" === a.direction ? !1 : !0 : !1
        }, a.getTarget = function (e) {
            return a.direction = e, "next" === e ? a.currentSlide === a.last ? 0 : a.currentSlide + 1 : 0 === a.currentSlide ? a.last : a.currentSlide - 1
        }, a.setProps = function (e, t, n) {
            var i = function () {
                var n = e ? e : (a.itemW + a.vars.itemMargin) * a.move * a.animatingTo, i = function () {
                    if (u)return"setTouch" === t ? e : d && a.animatingTo === a.last ? 0 : d ? a.limit - (a.itemW + a.vars.itemMargin) * a.move * a.animatingTo : a.animatingTo === a.last ? a.limit : n;
                    switch (t) {
                        case"setTotal":
                            return d ? (a.count - 1 - a.currentSlide + a.cloneOffset) * e : (a.currentSlide + a.cloneOffset) * e;
                        case"setTouch":
                            return d ? e : e;
                        case"jumpEnd":
                            return d ? e : a.count * e;
                        case"jumpStart":
                            return d ? a.count * e : e;
                        default:
                            return e
                    }
                }();
                return-1 * i + "px"
            }();
            a.transitions && (i = c ? "translate3d(0," + i + ",0)" : "translate3d(" + i + ",0,0)", n = void 0 !== n ? n / 1e3 + "s" : "0s", a.container.css("-" + a.pfx + "-transition-duration", n), a.container.css("transition-duration", n)), a.args[a.prop] = i, (a.transitions || void 0 === n) && a.container.css(a.args), a.container.css("transform", i)
        }, a.setup = function (e) {
            if (v)a.slides.css({width: "100%", "float": "left", marginRight: "-100%", position: "relative"}), "init" === e && (s ? a.slides.css({opacity: 0, display: "block", webkitTransition: "opacity " + a.vars.animationSpeed / 1e3 + "s ease", zIndex: 1}).eq(a.currentSlide).css({opacity: 1, zIndex: 2}) : 0 == a.vars.fadeFirstSlide ? a.slides.css({opacity: 0, display: "block", zIndex: 1}).eq(a.currentSlide).css({zIndex: 2}).css({opacity: 1}) : a.slides.css({opacity: 0, display: "block", zIndex: 1}).eq(a.currentSlide).css({zIndex: 2}).animate({opacity: 1}, a.vars.animationSpeed, a.vars.easing)), a.vars.smoothHeight && m.smoothHeight(); else {
                var t, i;
                "init" === e && (a.viewport = $('<div class="' + n + 'viewport"></div>').css({overflow: "hidden", position: "relative"}).appendTo(a).append(a.container), a.cloneCount = 0, a.cloneOffset = 0, d && (i = $.makeArray(a.slides).reverse(), a.slides = $(i), a.container.empty().append(a.slides))), a.vars.animationLoop && !u && (a.cloneCount = 2, a.cloneOffset = 1, "init" !== e && a.container.find(".clone").remove(), a.container.append(m.uniqueID(a.slides.first().clone().addClass("clone")).attr("aria-hidden", "true")).prepend(m.uniqueID(a.slides.last().clone().addClass("clone")).attr("aria-hidden", "true"))), a.newSlides = $(a.vars.selector, a), t = d ? a.count - 1 - a.currentSlide + a.cloneOffset : a.currentSlide + a.cloneOffset, c && !u ? (a.container.height(200 * (a.count + a.cloneCount) + "%").css("position", "absolute").width("100%"), setTimeout(function () {
                    a.newSlides.css({display: "block"}), a.doMath(), a.viewport.height(a.h), a.setProps(t * a.h, "init")
                }, "init" === e ? 100 : 0)) : (a.container.width(200 * (a.count + a.cloneCount) + "%"), a.setProps(t * a.computedW, "init"), setTimeout(function () {
                    a.doMath(), a.newSlides.css({width: a.computedW, "float": "left", display: "block"}), a.vars.smoothHeight && m.smoothHeight()
                }, "init" === e ? 100 : 0))
            }
            u || a.slides.removeClass(n + "active-slide").eq(a.currentSlide).addClass(n + "active-slide"), a.vars.init(a)
        }, a.doMath = function () {
            var e = a.slides.first(), t = a.vars.itemMargin, n = a.vars.minItems, i = a.vars.maxItems;
            a.w = void 0 === a.viewport ? a.width() : a.viewport.width(), a.h = e.height(), a.boxPadding = e.outerWidth() - e.width(), u ? (a.itemT = a.vars.itemWidth + t, a.minW = n ? n * a.itemT : a.w, a.maxW = i ? i * a.itemT - t : a.w, a.itemW = a.minW > a.w ? (a.w - t * (n - 1)) / n : a.maxW < a.w ? (a.w - t * (i - 1)) / i : a.vars.itemWidth > a.w ? a.w : a.vars.itemWidth, a.visible = Math.floor(a.w / a.itemW), a.move = a.vars.move > 0 && a.vars.move < a.visible ? a.vars.move : a.visible, a.pagingCount = Math.ceil((a.count - a.visible) / a.move + 1), a.last = a.pagingCount - 1, a.limit = 1 === a.pagingCount ? 0 : a.vars.itemWidth > a.w ? a.itemW * (a.count - 1) + t * (a.count - 1) : (a.itemW + t) * a.count - a.w - t) : (a.itemW = a.w, a.pagingCount = a.count, a.last = a.count - 1), a.computedW = a.itemW - a.boxPadding
        }, a.update = function (e, t) {
            a.doMath(), u || (e < a.currentSlide ? a.currentSlide += 1 : e <= a.currentSlide && 0 !== e && (a.currentSlide -= 1), a.animatingTo = a.currentSlide), a.vars.controlNav && !a.manualControls && ("add" === t && !u || a.pagingCount > a.controlNav.length ? m.controlNav.update("add") : ("remove" === t && !u || a.pagingCount < a.controlNav.length) && (u && a.currentSlide > a.last && (a.currentSlide -= 1, a.animatingTo -= 1), m.controlNav.update("remove", a.last))), a.vars.directionNav && m.directionNav.update()
        }, a.addSlide = function (e, t) {
            var n = $(e);
            a.count += 1, a.last = a.count - 1, c && d ? void 0 !== t ? a.slides.eq(a.count - t).after(n) : a.container.prepend(n) : void 0 !== t ? a.slides.eq(t).before(n) : a.container.append(n), a.update(t, "add"), a.slides = $(a.vars.selector + ":not(.clone)", a), a.setup(), a.vars.added(a)
        }, a.removeSlide = function (e) {
            var t = isNaN(e) ? a.slides.index($(e)) : e;
            a.count -= 1, a.last = a.count - 1, isNaN(e) ? $(e, a.slides).remove() : c && d ? a.slides.eq(a.last).remove() : a.slides.eq(e).remove(), a.doMath(), a.update(t, "remove"), a.slides = $(a.vars.selector + ":not(.clone)", a), a.setup(), a.vars.removed(a)
        }, m.init()
    }, $(window).blur(function (e) {
        focused = !1
    }).focus(function (e) {
        focused = !0
    }), $.flexslider.defaults = {namespace: "flex-", selector: ".slides > li", animation: "fade", easing: "swing", direction: "horizontal", reverse: !1, animationLoop: !0, smoothHeight: !1, startAt: 0, slideshow: !0, slideshowSpeed: 7e3, animationSpeed: 600, initDelay: 0, randomize: !1, fadeFirstSlide: !0, thumbCaptions: !1, pauseOnAction: !0, pauseOnHover: !1, pauseInvisible: !0, useCSS: !0, touch: !0, video: !1, controlNav: !0, directionNav: !0, prevText: "Previous", nextText: "Next", keyboard: !0, multipleKeyboard: !1, mousewheel: !1, pausePlay: !1, pauseText: "Pause", playText: "Play", controlsContainer: "", manualControls: "", customDirectionNav: "", sync: "", asNavFor: "", itemWidth: 0, itemMargin: 0, minItems: 1, maxItems: 0, move: 0, allowOneSlide: !0, start: function () {
    }, before: function () {
    }, after: function () {
    }, end: function () {
    }, added: function () {
    }, removed: function () {
    }, init: function () {
    }}, $.fn.flexslider = function (e) {
        if (void 0 === e && (e = {}), "object" == typeof e)return this.each(function () {
            var t = $(this), a = e.selector ? e.selector : ".slides > li", n = t.find(a);
            1 === n.length && e.allowOneSlide === !0 || 0 === n.length ? (n.fadeIn(400), e.start && e.start(t)) : void 0 === t.data("flexslider") && new $.flexslider(this, e)
        });
        var t = $(this).data("flexslider");
        switch (e) {
            case"play":
                t.play();
                break;
            case"pause":
                t.pause();
                break;
            case"stop":
                t.stop();
                break;
            case"next":
                t.flexAnimate(t.getTarget("next"), !0);
                break;
            case"prev":
            case"previous":
                t.flexAnimate(t.getTarget("prev"), !0);
                break;
            default:
                "number" == typeof e && t.flexAnimate(e, !0)
        }
    }
}(jQuery);
/*!
 * Bootstrap v3.3.2 (http://getbootstrap.com)
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */

/*!
 * Generated using the Bootstrap Customizer (http://getbootstrap.com/customize/?id=de00013db422f428081b)
 * Config saved to config.json and https://gist.github.com/de00013db422f428081b
 */
if ("undefined" == typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");
+function (t) {
    "use strict";
    var e = t.fn.jquery.split(" ")[0].split(".");
    if (e[0] < 2 && e[1] < 9 || 1 == e[0] && 9 == e[1] && e[2] < 1)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher")
}(jQuery), +function (t) {
    "use strict";
    function e(e) {
        return this.each(function () {
            var i = t(this), s = i.data("bs.alert");
            s || i.data("bs.alert", s = new o(this)), "string" == typeof e && s[e].call(i)
        })
    }

    var i = '[data-dismiss="alert"]', o = function (e) {
        t(e).on("click", i, this.close)
    };
    o.VERSION = "3.3.2", o.TRANSITION_DURATION = 150, o.prototype.close = function (e) {
        function i() {
            a.detach().trigger("closed.bs.alert").remove()
        }

        var s = t(this), n = s.attr("data-target");
        n || (n = s.attr("href"), n = n && n.replace(/.*(?=#[^\s]*$)/, ""));
        var a = t(n);
        e && e.preventDefault(), a.length || (a = s.closest(".alert")), a.trigger(e = t.Event("close.bs.alert")), e.isDefaultPrevented() || (a.removeClass("in"), t.support.transition && a.hasClass("fade") ? a.one("bsTransitionEnd", i).emulateTransitionEnd(o.TRANSITION_DURATION) : i())
    };
    var s = t.fn.alert;
    t.fn.alert = e, t.fn.alert.Constructor = o, t.fn.alert.noConflict = function () {
        return t.fn.alert = s, this
    }, t(document).on("click.bs.alert.data-api", i, o.prototype.close)
}(jQuery), +function (t) {
    "use strict";
    function e(e) {
        return this.each(function () {
            var o = t(this), s = o.data("bs.button"), n = "object" == typeof e && e;
            s || o.data("bs.button", s = new i(this, n)), "toggle" == e ? s.toggle() : e && s.setState(e)
        })
    }

    var i = function (e, o) {
        this.$element = t(e), this.options = t.extend({}, i.DEFAULTS, o), this.isLoading = !1
    };
    i.VERSION = "3.3.2", i.DEFAULTS = {loadingText: "loading..."}, i.prototype.setState = function (e) {
        var i = "disabled", o = this.$element, s = o.is("input") ? "val" : "html", n = o.data();
        e += "Text", null == n.resetText && o.data("resetText", o[s]()), setTimeout(t.proxy(function () {
            o[s](null == n[e] ? this.options[e] : n[e]), "loadingText" == e ? (this.isLoading = !0, o.addClass(i).attr(i, i)) : this.isLoading && (this.isLoading = !1, o.removeClass(i).removeAttr(i))
        }, this), 0)
    }, i.prototype.toggle = function () {
        var t = !0, e = this.$element.closest('[data-toggle="buttons"]');
        if (e.length) {
            var i = this.$element.find("input");
            "radio" == i.prop("type") && (i.prop("checked") && this.$element.hasClass("active") ? t = !1 : e.find(".active").removeClass("active")), t && i.prop("checked", !this.$element.hasClass("active")).trigger("change")
        } else this.$element.attr("aria-pressed", !this.$element.hasClass("active"));
        t && this.$element.toggleClass("active")
    };
    var o = t.fn.button;
    t.fn.button = e, t.fn.button.Constructor = i, t.fn.button.noConflict = function () {
        return t.fn.button = o, this
    }, t(document).on("click.bs.button.data-api", '[data-toggle^="button"]',function (i) {
        var o = t(i.target);
        o.hasClass("btn") || (o = o.closest(".btn")), e.call(o, "toggle"), i.preventDefault()
    }).on("focus.bs.button.data-api blur.bs.button.data-api", '[data-toggle^="button"]', function (e) {
        t(e.target).closest(".btn").toggleClass("focus", /^focus(in)?$/.test(e.type))
    })
}(jQuery), +function (t) {
    "use strict";
    function e(e) {
        return this.each(function () {
            var o = t(this), s = o.data("bs.carousel"), n = t.extend({}, i.DEFAULTS, o.data(), "object" == typeof e && e), a = "string" == typeof e ? e : n.slide;
            s || o.data("bs.carousel", s = new i(this, n)), "number" == typeof e ? s.to(e) : a ? s[a]() : n.interval && s.pause().cycle()
        })
    }

    var i = function (e, i) {
        this.$element = t(e), this.$indicators = this.$element.find(".carousel-indicators"), this.options = i, this.paused = this.sliding = this.interval = this.$active = this.$items = null, this.options.keyboard && this.$element.on("keydown.bs.carousel", t.proxy(this.keydown, this)), "hover" == this.options.pause && !("ontouchstart"in document.documentElement) && this.$element.on("mouseenter.bs.carousel", t.proxy(this.pause, this)).on("mouseleave.bs.carousel", t.proxy(this.cycle, this))
    };
    i.VERSION = "3.3.2", i.TRANSITION_DURATION = 600, i.DEFAULTS = {interval: 5e3, pause: "hover", wrap: !0, keyboard: !0}, i.prototype.keydown = function (t) {
        if (!/input|textarea/i.test(t.target.tagName)) {
            switch (t.which) {
                case 37:
                    this.prev();
                    break;
                case 39:
                    this.next();
                    break;
                default:
                    return
            }
            t.preventDefault()
        }
    }, i.prototype.cycle = function (e) {
        return e || (this.paused = !1), this.interval && clearInterval(this.interval), this.options.interval && !this.paused && (this.interval = setInterval(t.proxy(this.next, this), this.options.interval)), this
    }, i.prototype.getItemIndex = function (t) {
        return this.$items = t.parent().children(".item"), this.$items.index(t || this.$active)
    }, i.prototype.getItemForDirection = function (t, e) {
        var i = this.getItemIndex(e), o = "prev" == t && 0 === i || "next" == t && i == this.$items.length - 1;
        if (o && !this.options.wrap)return e;
        var s = "prev" == t ? -1 : 1, n = (i + s) % this.$items.length;
        return this.$items.eq(n)
    }, i.prototype.to = function (t) {
        var e = this, i = this.getItemIndex(this.$active = this.$element.find(".item.active"));
        return t > this.$items.length - 1 || 0 > t ? void 0 : this.sliding ? this.$element.one("slid.bs.carousel", function () {
            e.to(t)
        }) : i == t ? this.pause().cycle() : this.slide(t > i ? "next" : "prev", this.$items.eq(t))
    }, i.prototype.pause = function (e) {
        return e || (this.paused = !0), this.$element.find(".next, .prev").length && t.support.transition && (this.$element.trigger(t.support.transition.end), this.cycle(!0)), this.interval = clearInterval(this.interval), this
    }, i.prototype.next = function () {
        return this.sliding ? void 0 : this.slide("next")
    }, i.prototype.prev = function () {
        return this.sliding ? void 0 : this.slide("prev")
    }, i.prototype.slide = function (e, o) {
        var s = this.$element.find(".item.active"), n = o || this.getItemForDirection(e, s), a = this.interval, r = "next" == e ? "left" : "right", l = this;
        if (n.hasClass("active"))return this.sliding = !1;
        var h = n[0], d = t.Event("slide.bs.carousel", {relatedTarget: h, direction: r});
        if (this.$element.trigger(d), !d.isDefaultPrevented()) {
            if (this.sliding = !0, a && this.pause(), this.$indicators.length) {
                this.$indicators.find(".active").removeClass("active");
                var p = t(this.$indicators.children()[this.getItemIndex(n)]);
                p && p.addClass("active")
            }
            var c = t.Event("slid.bs.carousel", {relatedTarget: h, direction: r});
            return t.support.transition && this.$element.hasClass("slide") ? (n.addClass(e), n[0].offsetWidth, s.addClass(r), n.addClass(r), s.one("bsTransitionEnd",function () {
                n.removeClass([e, r].join(" ")).addClass("active"), s.removeClass(["active", r].join(" ")), l.sliding = !1, setTimeout(function () {
                    l.$element.trigger(c)
                }, 0)
            }).emulateTransitionEnd(i.TRANSITION_DURATION)) : (s.removeClass("active"), n.addClass("active"), this.sliding = !1, this.$element.trigger(c)), a && this.cycle(), this
        }
    };
    var o = t.fn.carousel;
    t.fn.carousel = e, t.fn.carousel.Constructor = i, t.fn.carousel.noConflict = function () {
        return t.fn.carousel = o, this
    };
    var s = function (i) {
        var o, s = t(this), n = t(s.attr("data-target") || (o = s.attr("href")) && o.replace(/.*(?=#[^\s]+$)/, ""));
        if (n.hasClass("carousel")) {
            var a = t.extend({}, n.data(), s.data()), r = s.attr("data-slide-to");
            r && (a.interval = !1), e.call(n, a), r && n.data("bs.carousel").to(r), i.preventDefault()
        }
    };
    t(document).on("click.bs.carousel.data-api", "[data-slide]", s).on("click.bs.carousel.data-api", "[data-slide-to]", s), t(window).on("load", function () {
        t('[data-ride="carousel"]').each(function () {
            var i = t(this);
            e.call(i, i.data())
        })
    })
}(jQuery), +function (t) {
    "use strict";
    function e(e) {
        e && 3 === e.which || (t(s).remove(), t(n).each(function () {
            var o = t(this), s = i(o), n = {relatedTarget: this};
            s.hasClass("open") && (s.trigger(e = t.Event("hide.bs.dropdown", n)), e.isDefaultPrevented() || (o.attr("aria-expanded", "false"), s.removeClass("open").trigger("hidden.bs.dropdown", n)))
        }))
    }

    function i(e) {
        var i = e.attr("data-target");
        i || (i = e.attr("href"), i = i && /#[A-Za-z]/.test(i) && i.replace(/.*(?=#[^\s]*$)/, ""));
        var o = i && t(i);
        return o && o.length ? o : e.parent()
    }

    function o(e) {
        return this.each(function () {
            var i = t(this), o = i.data("bs.dropdown");
            o || i.data("bs.dropdown", o = new a(this)), "string" == typeof e && o[e].call(i)
        })
    }

    var s = ".dropdown-backdrop", n = '[data-toggle="dropdown"]', a = function (e) {
        t(e).on("click.bs.dropdown", this.toggle)
    };
    a.VERSION = "3.3.2", a.prototype.toggle = function (o) {
        var s = t(this);
        if (!s.is(".disabled, :disabled")) {
            var n = i(s), a = n.hasClass("open");
            if (e(), !a) {
                "ontouchstart"in document.documentElement && !n.closest(".navbar-nav").length && t('<div class="dropdown-backdrop"/>').insertAfter(t(this)).on("click", e);
                var r = {relatedTarget: this};
                if (n.trigger(o = t.Event("show.bs.dropdown", r)), o.isDefaultPrevented())return;
                s.trigger("focus").attr("aria-expanded", "true"), n.toggleClass("open").trigger("shown.bs.dropdown", r)
            }
            return!1
        }
    }, a.prototype.keydown = function (e) {
        if (/(38|40|27|32)/.test(e.which) && !/input|textarea/i.test(e.target.tagName)) {
            var o = t(this);
            if (e.preventDefault(), e.stopPropagation(), !o.is(".disabled, :disabled")) {
                var s = i(o), a = s.hasClass("open");
                if (!a && 27 != e.which || a && 27 == e.which)return 27 == e.which && s.find(n).trigger("focus"), o.trigger("click");
                var r = " li:not(.divider):visible a", l = s.find('[role="menu"]' + r + ', [role="listbox"]' + r);
                if (l.length) {
                    var h = l.index(e.target);
                    38 == e.which && h > 0 && h--, 40 == e.which && h < l.length - 1 && h++, ~h || (h = 0), l.eq(h).trigger("focus")
                }
            }
        }
    };
    var r = t.fn.dropdown;
    t.fn.dropdown = o, t.fn.dropdown.Constructor = a, t.fn.dropdown.noConflict = function () {
        return t.fn.dropdown = r, this
    }, t(document).on("click.bs.dropdown.data-api", e).on("click.bs.dropdown.data-api", ".dropdown form",function (t) {
        t.stopPropagation()
    }).on("click.bs.dropdown.data-api", n, a.prototype.toggle).on("keydown.bs.dropdown.data-api", n, a.prototype.keydown).on("keydown.bs.dropdown.data-api", '[role="menu"]', a.prototype.keydown).on("keydown.bs.dropdown.data-api", '[role="listbox"]', a.prototype.keydown)
}(jQuery), +function (t) {
    "use strict";
    function e(e, o) {
        return this.each(function () {
            var s = t(this), n = s.data("bs.modal"), a = t.extend({}, i.DEFAULTS, s.data(), "object" == typeof e && e);
            n || s.data("bs.modal", n = new i(this, a)), "string" == typeof e ? n[e](o) : a.show && n.show(o)
        })
    }

    var i = function (e, i) {
        this.options = i, this.$body = t(document.body), this.$element = t(e), this.$backdrop = this.isShown = null, this.scrollbarWidth = 0, this.options.remote && this.$element.find(".modal-content").load(this.options.remote, t.proxy(function () {
            this.$element.trigger("loaded.bs.modal")
        }, this))
    };
    i.VERSION = "3.3.2", i.TRANSITION_DURATION = 300, i.BACKDROP_TRANSITION_DURATION = 150, i.DEFAULTS = {backdrop: !0, keyboard: !0, show: !0}, i.prototype.toggle = function (t) {
        return this.isShown ? this.hide() : this.show(t)
    }, i.prototype.show = function (e) {
        var o = this, s = t.Event("show.bs.modal", {relatedTarget: e});
        this.$element.trigger(s), this.isShown || s.isDefaultPrevented() || (this.isShown = !0, this.checkScrollbar(), this.setScrollbar(), this.$body.addClass("modal-open"), this.escape(), this.resize(), this.$element.on("click.dismiss.bs.modal", '[data-dismiss="modal"]', t.proxy(this.hide, this)), this.backdrop(function () {
            var s = t.support.transition && o.$element.hasClass("fade");
            o.$element.parent().length || o.$element.appendTo(o.$body), o.$element.show().scrollTop(0), o.options.backdrop && o.adjustBackdrop(), o.adjustDialog(), s && o.$element[0].offsetWidth, o.$element.addClass("in").attr("aria-hidden", !1), o.enforceFocus();
            var n = t.Event("shown.bs.modal", {relatedTarget: e});
            s ? o.$element.find(".modal-dialog").one("bsTransitionEnd",function () {
                o.$element.trigger("focus").trigger(n)
            }).emulateTransitionEnd(i.TRANSITION_DURATION) : o.$element.trigger("focus").trigger(n)
        }))
    }, i.prototype.hide = function (e) {
        e && e.preventDefault(), e = t.Event("hide.bs.modal"), this.$element.trigger(e), this.isShown && !e.isDefaultPrevented() && (this.isShown = !1, this.escape(), this.resize(), t(document).off("focusin.bs.modal"), this.$element.removeClass("in").attr("aria-hidden", !0).off("click.dismiss.bs.modal"), t.support.transition && this.$element.hasClass("fade") ? this.$element.one("bsTransitionEnd", t.proxy(this.hideModal, this)).emulateTransitionEnd(i.TRANSITION_DURATION) : this.hideModal())
    }, i.prototype.enforceFocus = function () {
        t(document).off("focusin.bs.modal").on("focusin.bs.modal", t.proxy(function (t) {
            this.$element[0] === t.target || this.$element.has(t.target).length || this.$element.trigger("focus")
        }, this))
    }, i.prototype.escape = function () {
        this.isShown && this.options.keyboard ? this.$element.on("keydown.dismiss.bs.modal", t.proxy(function (t) {
            27 == t.which && this.hide()
        }, this)) : this.isShown || this.$element.off("keydown.dismiss.bs.modal")
    }, i.prototype.resize = function () {
        this.isShown ? t(window).on("resize.bs.modal", t.proxy(this.handleUpdate, this)) : t(window).off("resize.bs.modal")
    }, i.prototype.hideModal = function () {
        var t = this;
        this.$element.hide(), this.backdrop(function () {
            t.$body.removeClass("modal-open"), t.resetAdjustments(), t.resetScrollbar(), t.$element.trigger("hidden.bs.modal")
        })
    }, i.prototype.removeBackdrop = function () {
        this.$backdrop && this.$backdrop.remove(), this.$backdrop = null
    }, i.prototype.backdrop = function (e) {
        var o = this, s = this.$element.hasClass("fade") ? "fade" : "";
        if (this.isShown && this.options.backdrop) {
            var n = t.support.transition && s;
            if (this.$backdrop = t('<div class="modal-backdrop ' + s + '" />').prependTo(this.$element).on("click.dismiss.bs.modal", t.proxy(function (t) {
                t.target === t.currentTarget && ("static" == this.options.backdrop ? this.$element[0].focus.call(this.$element[0]) : this.hide.call(this))
            }, this)), n && this.$backdrop[0].offsetWidth, this.$backdrop.addClass("in"), !e)return;
            n ? this.$backdrop.one("bsTransitionEnd", e).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION) : e()
        } else if (!this.isShown && this.$backdrop) {
            this.$backdrop.removeClass("in");
            var a = function () {
                o.removeBackdrop(), e && e()
            };
            t.support.transition && this.$element.hasClass("fade") ? this.$backdrop.one("bsTransitionEnd", a).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION) : a()
        } else e && e()
    }, i.prototype.handleUpdate = function () {
        this.options.backdrop && this.adjustBackdrop(), this.adjustDialog()
    }, i.prototype.adjustBackdrop = function () {
        this.$backdrop.css("height", 0).css("height", this.$element[0].scrollHeight)
    }, i.prototype.adjustDialog = function () {
        var t = this.$element[0].scrollHeight > document.documentElement.clientHeight;
        this.$element.css({paddingLeft: !this.bodyIsOverflowing && t ? this.scrollbarWidth : "", paddingRight: this.bodyIsOverflowing && !t ? this.scrollbarWidth : ""})
    }, i.prototype.resetAdjustments = function () {
        this.$element.css({paddingLeft: "", paddingRight: ""})
    }, i.prototype.checkScrollbar = function () {
        this.bodyIsOverflowing = document.body.scrollHeight > document.documentElement.clientHeight, this.scrollbarWidth = this.measureScrollbar()
    }, i.prototype.setScrollbar = function () {
        var t = parseInt(this.$body.css("padding-right") || 0, 10);
        this.bodyIsOverflowing && this.$body.css("padding-right", t + this.scrollbarWidth)
    }, i.prototype.resetScrollbar = function () {
        this.$body.css("padding-right", "")
    }, i.prototype.measureScrollbar = function () {
        var t = document.createElement("div");
        t.className = "modal-scrollbar-measure", this.$body.append(t);
        var e = t.offsetWidth - t.clientWidth;
        return this.$body[0].removeChild(t), e
    };
    var o = t.fn.modal;
    t.fn.modal = e, t.fn.modal.Constructor = i, t.fn.modal.noConflict = function () {
        return t.fn.modal = o, this
    }, t(document).on("click.bs.modal.data-api", '[data-toggle="modal"]', function (i) {
        var o = t(this), s = o.attr("href"), n = t(o.attr("data-target") || s && s.replace(/.*(?=#[^\s]+$)/, "")), a = n.data("bs.modal") ? "toggle" : t.extend({remote: !/#/.test(s) && s}, n.data(), o.data());
        o.is("a") && i.preventDefault(), n.one("show.bs.modal", function (t) {
            t.isDefaultPrevented() || n.one("hidden.bs.modal", function () {
                o.is(":visible") && o.trigger("focus")
            })
        }), e.call(n, a, this)
    })
}(jQuery), +function (t) {
    "use strict";
    function e(e) {
        return this.each(function () {
            var o = t(this), s = o.data("bs.tooltip"), n = "object" == typeof e && e;
            (s || "destroy" != e) && (s || o.data("bs.tooltip", s = new i(this, n)), "string" == typeof e && s[e]())
        })
    }

    var i = function (t, e) {
        this.type = this.options = this.enabled = this.timeout = this.hoverState = this.$element = null, this.init("tooltip", t, e)
    };
    i.VERSION = "3.3.2", i.TRANSITION_DURATION = 150, i.DEFAULTS = {animation: !0, placement: "top", selector: !1, template: '<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>', trigger: "hover focus", title: "", delay: 0, html: !1, container: !1, viewport: {selector: "body", padding: 0}}, i.prototype.init = function (e, i, o) {
        this.enabled = !0, this.type = e, this.$element = t(i), this.options = this.getOptions(o), this.$viewport = this.options.viewport && t(this.options.viewport.selector || this.options.viewport);
        for (var s = this.options.trigger.split(" "), n = s.length; n--;) {
            var a = s[n];
            if ("click" == a)this.$element.on("click." + this.type, this.options.selector, t.proxy(this.toggle, this)); else if ("manual" != a) {
                var r = "hover" == a ? "mouseenter" : "focusin", l = "hover" == a ? "mouseleave" : "focusout";
                this.$element.on(r + "." + this.type, this.options.selector, t.proxy(this.enter, this)), this.$element.on(l + "." + this.type, this.options.selector, t.proxy(this.leave, this))
            }
        }
        this.options.selector ? this._options = t.extend({}, this.options, {trigger: "manual", selector: ""}) : this.fixTitle()
    }, i.prototype.getDefaults = function () {
        return i.DEFAULTS
    }, i.prototype.getOptions = function (e) {
        return e = t.extend({}, this.getDefaults(), this.$element.data(), e), e.delay && "number" == typeof e.delay && (e.delay = {show: e.delay, hide: e.delay}), e
    }, i.prototype.getDelegateOptions = function () {
        var e = {}, i = this.getDefaults();
        return this._options && t.each(this._options, function (t, o) {
            i[t] != o && (e[t] = o)
        }), e
    }, i.prototype.enter = function (e) {
        var i = e instanceof this.constructor ? e : t(e.currentTarget).data("bs." + this.type);
        return i && i.$tip && i.$tip.is(":visible") ? void(i.hoverState = "in") : (i || (i = new this.constructor(e.currentTarget, this.getDelegateOptions()), t(e.currentTarget).data("bs." + this.type, i)), clearTimeout(i.timeout), i.hoverState = "in", i.options.delay && i.options.delay.show ? void(i.timeout = setTimeout(function () {
            "in" == i.hoverState && i.show()
        }, i.options.delay.show)) : i.show())
    }, i.prototype.leave = function (e) {
        var i = e instanceof this.constructor ? e : t(e.currentTarget).data("bs." + this.type);
        return i || (i = new this.constructor(e.currentTarget, this.getDelegateOptions()), t(e.currentTarget).data("bs." + this.type, i)), clearTimeout(i.timeout), i.hoverState = "out", i.options.delay && i.options.delay.hide ? void(i.timeout = setTimeout(function () {
            "out" == i.hoverState && i.hide()
        }, i.options.delay.hide)) : i.hide()
    }, i.prototype.show = function () {
        var e = t.Event("show.bs." + this.type);
        if (this.hasContent() && this.enabled) {
            this.$element.trigger(e);
            var o = t.contains(this.$element[0].ownerDocument.documentElement, this.$element[0]);
            if (e.isDefaultPrevented() || !o)return;
            var s = this, n = this.tip(), a = this.getUID(this.type);
            this.setContent(), n.attr("id", a), this.$element.attr("aria-describedby", a), this.options.animation && n.addClass("fade");
            var r = "function" == typeof this.options.placement ? this.options.placement.call(this, n[0], this.$element[0]) : this.options.placement, l = /\s?auto?\s?/i, h = l.test(r);
            h && (r = r.replace(l, "") || "top"), n.detach().css({top: 0, left: 0, display: "block"}).addClass(r).data("bs." + this.type, this), this.options.container ? n.appendTo(this.options.container) : n.insertAfter(this.$element);
            var d = this.getPosition(), p = n[0].offsetWidth, c = n[0].offsetHeight;
            if (h) {
                var f = r, u = this.options.container ? t(this.options.container) : this.$element.parent(), g = this.getPosition(u);
                r = "bottom" == r && d.bottom + c > g.bottom ? "top" : "top" == r && d.top - c < g.top ? "bottom" : "right" == r && d.right + p > g.width ? "left" : "left" == r && d.left - p < g.left ? "right" : r, n.removeClass(f).addClass(r)
            }
            var v = this.getCalculatedOffset(r, d, p, c);
            this.applyPlacement(v, r);
            var m = function () {
                var t = s.hoverState;
                s.$element.trigger("shown.bs." + s.type), s.hoverState = null, "out" == t && s.leave(s)
            };
            t.support.transition && this.$tip.hasClass("fade") ? n.one("bsTransitionEnd", m).emulateTransitionEnd(i.TRANSITION_DURATION) : m()
        }
    }, i.prototype.applyPlacement = function (e, i) {
        var o = this.tip(), s = o[0].offsetWidth, n = o[0].offsetHeight, a = parseInt(o.css("margin-top"), 10), r = parseInt(o.css("margin-left"), 10);
        isNaN(a) && (a = 0), isNaN(r) && (r = 0), e.top = e.top + a, e.left = e.left + r, t.offset.setOffset(o[0], t.extend({using: function (t) {
            o.css({top: Math.round(t.top), left: Math.round(t.left)})
        }}, e), 0), o.addClass("in");
        var l = o[0].offsetWidth, h = o[0].offsetHeight;
        "top" == i && h != n && (e.top = e.top + n - h);
        var d = this.getViewportAdjustedDelta(i, e, l, h);
        d.left ? e.left += d.left : e.top += d.top;
        var p = /top|bottom/.test(i), c = p ? 2 * d.left - s + l : 2 * d.top - n + h, f = p ? "offsetWidth" : "offsetHeight";
        o.offset(e), this.replaceArrow(c, o[0][f], p)
    }, i.prototype.replaceArrow = function (t, e, i) {
        this.arrow().css(i ? "left" : "top", 50 * (1 - t / e) + "%").css(i ? "top" : "left", "")
    }, i.prototype.setContent = function () {
        var t = this.tip(), e = this.getTitle();
        t.find(".tooltip-inner")[this.options.html ? "html" : "text"](e), t.removeClass("fade in top bottom left right")
    }, i.prototype.hide = function (e) {
        function o() {
            "in" != s.hoverState && n.detach(), s.$element.removeAttr("aria-describedby").trigger("hidden.bs." + s.type), e && e()
        }

        var s = this, n = this.tip(), a = t.Event("hide.bs." + this.type);
        return this.$element.trigger(a), a.isDefaultPrevented() ? void 0 : (n.removeClass("in"), t.support.transition && this.$tip.hasClass("fade") ? n.one("bsTransitionEnd", o).emulateTransitionEnd(i.TRANSITION_DURATION) : o(), this.hoverState = null, this)
    }, i.prototype.fixTitle = function () {
        var t = this.$element;
        (t.attr("title") || "string" != typeof t.attr("data-original-title")) && t.attr("data-original-title", t.attr("title") || "").attr("title", "")
    }, i.prototype.hasContent = function () {
        return this.getTitle()
    }, i.prototype.getPosition = function (e) {
        e = e || this.$element;
        var i = e[0], o = "BODY" == i.tagName, s = i.getBoundingClientRect();
        null == s.width && (s = t.extend({}, s, {width: s.right - s.left, height: s.bottom - s.top}));
        var n = o ? {top: 0, left: 0} : e.offset(), a = {scroll: o ? document.documentElement.scrollTop || document.body.scrollTop : e.scrollTop()}, r = o ? {width: t(window).width(), height: t(window).height()} : null;
        return t.extend({}, s, a, r, n)
    }, i.prototype.getCalculatedOffset = function (t, e, i, o) {
        return"bottom" == t ? {top: e.top + e.height, left: e.left + e.width / 2 - i / 2} : "top" == t ? {top: e.top - o, left: e.left + e.width / 2 - i / 2} : "left" == t ? {top: e.top + e.height / 2 - o / 2, left: e.left - i} : {top: e.top + e.height / 2 - o / 2, left: e.left + e.width}
    }, i.prototype.getViewportAdjustedDelta = function (t, e, i, o) {
        var s = {top: 0, left: 0};
        if (!this.$viewport)return s;
        var n = this.options.viewport && this.options.viewport.padding || 0, a = this.getPosition(this.$viewport);
        if (/right|left/.test(t)) {
            var r = e.top - n - a.scroll, l = e.top + n - a.scroll + o;
            r < a.top ? s.top = a.top - r : l > a.top + a.height && (s.top = a.top + a.height - l)
        } else {
            var h = e.left - n, d = e.left + n + i;
            h < a.left ? s.left = a.left - h : d > a.width && (s.left = a.left + a.width - d)
        }
        return s
    }, i.prototype.getTitle = function () {
        var t, e = this.$element, i = this.options;
        return t = e.attr("data-original-title") || ("function" == typeof i.title ? i.title.call(e[0]) : i.title)
    }, i.prototype.getUID = function (t) {
        do t += ~~(1e6 * Math.random()); while (document.getElementById(t));
        return t
    }, i.prototype.tip = function () {
        return this.$tip = this.$tip || t(this.options.template)
    }, i.prototype.arrow = function () {
        return this.$arrow = this.$arrow || this.tip().find(".tooltip-arrow")
    }, i.prototype.enable = function () {
        this.enabled = !0
    }, i.prototype.disable = function () {
        this.enabled = !1
    }, i.prototype.toggleEnabled = function () {
        this.enabled = !this.enabled
    }, i.prototype.toggle = function (e) {
        var i = this;
        e && (i = t(e.currentTarget).data("bs." + this.type), i || (i = new this.constructor(e.currentTarget, this.getDelegateOptions()), t(e.currentTarget).data("bs." + this.type, i))), i.tip().hasClass("in") ? i.leave(i) : i.enter(i)
    }, i.prototype.destroy = function () {
        var t = this;
        clearTimeout(this.timeout), this.hide(function () {
            t.$element.off("." + t.type).removeData("bs." + t.type)
        })
    };
    var o = t.fn.tooltip;
    t.fn.tooltip = e, t.fn.tooltip.Constructor = i, t.fn.tooltip.noConflict = function () {
        return t.fn.tooltip = o, this
    }
}(jQuery), +function (t) {
    "use strict";
    function e(e) {
        return this.each(function () {
            var o = t(this), s = o.data("bs.popover"), n = "object" == typeof e && e;
            (s || "destroy" != e) && (s || o.data("bs.popover", s = new i(this, n)), "string" == typeof e && s[e]())
        })
    }

    var i = function (t, e) {
        this.init("popover", t, e)
    };
    if (!t.fn.tooltip)throw new Error("Popover requires tooltip.js");
    i.VERSION = "3.3.2", i.DEFAULTS = t.extend({}, t.fn.tooltip.Constructor.DEFAULTS, {placement: "right", trigger: "click", content: "", template: '<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}), i.prototype = t.extend({}, t.fn.tooltip.Constructor.prototype), i.prototype.constructor = i, i.prototype.getDefaults = function () {
        return i.DEFAULTS
    }, i.prototype.setContent = function () {
        var t = this.tip(), e = this.getTitle(), i = this.getContent();
        t.find(".popover-title")[this.options.html ? "html" : "text"](e), t.find(".popover-content").children().detach().end()[this.options.html ? "string" == typeof i ? "html" : "append" : "text"](i), t.removeClass("fade top bottom left right in"), t.find(".popover-title").html() || t.find(".popover-title").hide()
    }, i.prototype.hasContent = function () {
        return this.getTitle() || this.getContent()
    }, i.prototype.getContent = function () {
        var t = this.$element, e = this.options;
        return t.attr("data-content") || ("function" == typeof e.content ? e.content.call(t[0]) : e.content)
    }, i.prototype.arrow = function () {
        return this.$arrow = this.$arrow || this.tip().find(".arrow")
    }, i.prototype.tip = function () {
        return this.$tip || (this.$tip = t(this.options.template)), this.$tip
    };
    var o = t.fn.popover;
    t.fn.popover = e, t.fn.popover.Constructor = i, t.fn.popover.noConflict = function () {
        return t.fn.popover = o, this
    }
}(jQuery), +function (t) {
    "use strict";
    function e(e) {
        return this.each(function () {
            var o = t(this), s = o.data("bs.tab");
            s || o.data("bs.tab", s = new i(this)), "string" == typeof e && s[e]()
        })
    }

    var i = function (e) {
        this.element = t(e)
    };
    i.VERSION = "3.3.2", i.TRANSITION_DURATION = 150, i.prototype.show = function () {
        var e = this.element, i = e.closest("ul:not(.dropdown-menu)"), o = e.data("target");
        if (o || (o = e.attr("href"), o = o && o.replace(/.*(?=#[^\s]*$)/, "")), !e.parent("li").hasClass("active")) {
            var s = i.find(".active:last a"), n = t.Event("hide.bs.tab", {relatedTarget: e[0]}), a = t.Event("show.bs.tab", {relatedTarget: s[0]});
            if (s.trigger(n), e.trigger(a), !a.isDefaultPrevented() && !n.isDefaultPrevented()) {
                var r = t(o);
                this.activate(e.closest("li"), i), this.activate(r, r.parent(), function () {
                    s.trigger({type: "hidden.bs.tab", relatedTarget: e[0]}), e.trigger({type: "shown.bs.tab", relatedTarget: s[0]})
                })
            }
        }
    }, i.prototype.activate = function (e, o, s) {
        function n() {
            a.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded", !1), e.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded", !0), r ? (e[0].offsetWidth, e.addClass("in")) : e.removeClass("fade"), e.parent(".dropdown-menu") && e.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded", !0), s && s()
        }

        var a = o.find("> .active"), r = s && t.support.transition && (a.length && a.hasClass("fade") || !!o.find("> .fade").length);
        a.length && r ? a.one("bsTransitionEnd", n).emulateTransitionEnd(i.TRANSITION_DURATION) : n(), a.removeClass("in")
    };
    var o = t.fn.tab;
    t.fn.tab = e, t.fn.tab.Constructor = i, t.fn.tab.noConflict = function () {
        return t.fn.tab = o, this
    };
    var s = function (i) {
        i.preventDefault(), e.call(t(this), "show")
    };
    t(document).on("click.bs.tab.data-api", '[data-toggle="tab"]', s).on("click.bs.tab.data-api", '[data-toggle="pill"]', s)
}(jQuery), +function (t) {
    "use strict";
    function e(e) {
        return this.each(function () {
            var o = t(this), s = o.data("bs.affix"), n = "object" == typeof e && e;
            s || o.data("bs.affix", s = new i(this, n)), "string" == typeof e && s[e]()
        })
    }

    var i = function (e, o) {
        this.options = t.extend({}, i.DEFAULTS, o), this.$target = t(this.options.target).on("scroll.bs.affix.data-api", t.proxy(this.checkPosition, this)).on("click.bs.affix.data-api", t.proxy(this.checkPositionWithEventLoop, this)), this.$element = t(e), this.affixed = this.unpin = this.pinnedOffset = null, this.checkPosition()
    };
    i.VERSION = "3.3.2", i.RESET = "affix affix-top affix-bottom", i.DEFAULTS = {offset: 0, target: window}, i.prototype.getState = function (t, e, i, o) {
        var s = this.$target.scrollTop(), n = this.$element.offset(), a = this.$target.height();
        if (null != i && "top" == this.affixed)return i > s ? "top" : !1;
        if ("bottom" == this.affixed)return null != i ? s + this.unpin <= n.top ? !1 : "bottom" : t - o >= s + a ? !1 : "bottom";
        var r = null == this.affixed, l = r ? s : n.top, h = r ? a : e;
        return null != i && i >= s ? "top" : null != o && l + h >= t - o ? "bottom" : !1
    }, i.prototype.getPinnedOffset = function () {
        if (this.pinnedOffset)return this.pinnedOffset;
        this.$element.removeClass(i.RESET).addClass("affix");
        var t = this.$target.scrollTop(), e = this.$element.offset();
        return this.pinnedOffset = e.top - t
    }, i.prototype.checkPositionWithEventLoop = function () {
        setTimeout(t.proxy(this.checkPosition, this), 1)
    }, i.prototype.checkPosition = function () {
        if (this.$element.is(":visible")) {
            var e = this.$element.height(), o = this.options.offset, s = o.top, n = o.bottom, a = t("body").height();
            "object" != typeof o && (n = s = o), "function" == typeof s && (s = o.top(this.$element)), "function" == typeof n && (n = o.bottom(this.$element));
            var r = this.getState(a, e, s, n);
            if (this.affixed != r) {
                null != this.unpin && this.$element.css("top", "");
                var l = "affix" + (r ? "-" + r : ""), h = t.Event(l + ".bs.affix");
                if (this.$element.trigger(h), h.isDefaultPrevented())return;
                this.affixed = r, this.unpin = "bottom" == r ? this.getPinnedOffset() : null, this.$element.removeClass(i.RESET).addClass(l).trigger(l.replace("affix", "affixed") + ".bs.affix")
            }
            "bottom" == r && this.$element.offset({top: a - e - n})
        }
    };
    var o = t.fn.affix;
    t.fn.affix = e, t.fn.affix.Constructor = i, t.fn.affix.noConflict = function () {
        return t.fn.affix = o, this
    }, t(window).on("load", function () {
        t('[data-spy="affix"]').each(function () {
            var i = t(this), o = i.data();
            o.offset = o.offset || {}, null != o.offsetBottom && (o.offset.bottom = o.offsetBottom), null != o.offsetTop && (o.offset.top = o.offsetTop), e.call(i, o)
        })
    })
}(jQuery), +function (t) {
    "use strict";
    function e(e) {
        var i, o = e.attr("data-target") || (i = e.attr("href")) && i.replace(/.*(?=#[^\s]+$)/, "");
        return t(o)
    }

    function i(e) {
        return this.each(function () {
            var i = t(this), s = i.data("bs.collapse"), n = t.extend({}, o.DEFAULTS, i.data(), "object" == typeof e && e);
            !s && n.toggle && "show" == e && (n.toggle = !1), s || i.data("bs.collapse", s = new o(this, n)), "string" == typeof e && s[e]()
        })
    }

    var o = function (e, i) {
        this.$element = t(e), this.options = t.extend({}, o.DEFAULTS, i), this.$trigger = t(this.options.trigger).filter('[href="#' + e.id + '"], [data-target="#' + e.id + '"]'), this.transitioning = null, this.options.parent ? this.$parent = this.getParent() : this.addAriaAndCollapsedClass(this.$element, this.$trigger), this.options.toggle && this.toggle()
    };
    o.VERSION = "3.3.2", o.TRANSITION_DURATION = 350, o.DEFAULTS = {toggle: !0, trigger: '[data-toggle="collapse"]'}, o.prototype.dimension = function () {
        var t = this.$element.hasClass("width");
        return t ? "width" : "height"
    }, o.prototype.show = function () {
        if (!this.transitioning && !this.$element.hasClass("in")) {
            var e, s = this.$parent && this.$parent.children(".panel").children(".in, .collapsing");
            if (!(s && s.length && (e = s.data("bs.collapse"), e && e.transitioning))) {
                var n = t.Event("show.bs.collapse");
                if (this.$element.trigger(n), !n.isDefaultPrevented()) {
                    s && s.length && (i.call(s, "hide"), e || s.data("bs.collapse", null));
                    var a = this.dimension();
                    this.$element.removeClass("collapse").addClass("collapsing")[a](0).attr("aria-expanded", !0), this.$trigger.removeClass("collapsed").attr("aria-expanded", !0), this.transitioning = 1;
                    var r = function () {
                        this.$element.removeClass("collapsing").addClass("collapse in")[a](""), this.transitioning = 0, this.$element.trigger("shown.bs.collapse")
                    };
                    if (!t.support.transition)return r.call(this);
                    var l = t.camelCase(["scroll", a].join("-"));
                    this.$element.one("bsTransitionEnd", t.proxy(r, this)).emulateTransitionEnd(o.TRANSITION_DURATION)[a](this.$element[0][l])
                }
            }
        }
    }, o.prototype.hide = function () {
        if (!this.transitioning && this.$element.hasClass("in")) {
            var e = t.Event("hide.bs.collapse");
            if (this.$element.trigger(e), !e.isDefaultPrevented()) {
                var i = this.dimension();
                this.$element[i](this.$element[i]())[0].offsetHeight, this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded", !1), this.$trigger.addClass("collapsed").attr("aria-expanded", !1), this.transitioning = 1;
                var s = function () {
                    this.transitioning = 0, this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")
                };
                return t.support.transition ? void this.$element[i](0).one("bsTransitionEnd", t.proxy(s, this)).emulateTransitionEnd(o.TRANSITION_DURATION) : s.call(this)
            }
        }
    }, o.prototype.toggle = function () {
        this[this.$element.hasClass("in") ? "hide" : "show"]()
    }, o.prototype.getParent = function () {
        return t(this.options.parent).find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]').each(t.proxy(function (i, o) {
            var s = t(o);
            this.addAriaAndCollapsedClass(e(s), s)
        }, this)).end()
    }, o.prototype.addAriaAndCollapsedClass = function (t, e) {
        var i = t.hasClass("in");
        t.attr("aria-expanded", i), e.toggleClass("collapsed", !i).attr("aria-expanded", i)
    };
    var s = t.fn.collapse;
    t.fn.collapse = i, t.fn.collapse.Constructor = o, t.fn.collapse.noConflict = function () {
        return t.fn.collapse = s, this
    }, t(document).on("click.bs.collapse.data-api", '[data-toggle="collapse"]', function (o) {
        var s = t(this);
        s.attr("data-target") || o.preventDefault();
        var n = e(s), a = n.data("bs.collapse"), r = a ? "toggle" : t.extend({}, s.data(), {trigger: this});
        i.call(n, r)
    })
}(jQuery), +function (t) {
    "use strict";
    function e(i, o) {
        var s = t.proxy(this.process, this);
        this.$body = t("body"), this.$scrollElement = t(t(i).is("body") ? window : i), this.options = t.extend({}, e.DEFAULTS, o), this.selector = (this.options.target || "") + " .nav li > a", this.offsets = [], this.targets = [], this.activeTarget = null, this.scrollHeight = 0, this.$scrollElement.on("scroll.bs.scrollspy", s), this.refresh(), this.process()
    }

    function i(i) {
        return this.each(function () {
            var o = t(this), s = o.data("bs.scrollspy"), n = "object" == typeof i && i;
            s || o.data("bs.scrollspy", s = new e(this, n)), "string" == typeof i && s[i]()
        })
    }

    e.VERSION = "3.3.2", e.DEFAULTS = {offset: 10}, e.prototype.getScrollHeight = function () {
        return this.$scrollElement[0].scrollHeight || Math.max(this.$body[0].scrollHeight, document.documentElement.scrollHeight)
    }, e.prototype.refresh = function () {
        var e = "offset", i = 0;
        t.isWindow(this.$scrollElement[0]) || (e = "position", i = this.$scrollElement.scrollTop()), this.offsets = [], this.targets = [], this.scrollHeight = this.getScrollHeight();
        var o = this;
        this.$body.find(this.selector).map(function () {
            var o = t(this), s = o.data("target") || o.attr("href"), n = /^#./.test(s) && t(s);
            return n && n.length && n.is(":visible") && [
                [n[e]().top + i, s]
            ] || null
        }).sort(function (t, e) {
            return t[0] - e[0]
        }).each(function () {
            o.offsets.push(this[0]), o.targets.push(this[1])
        })
    }, e.prototype.process = function () {
        var t, e = this.$scrollElement.scrollTop() + this.options.offset, i = this.getScrollHeight(), o = this.options.offset + i - this.$scrollElement.height(), s = this.offsets, n = this.targets, a = this.activeTarget;
        if (this.scrollHeight != i && this.refresh(), e >= o)return a != (t = n[n.length - 1]) && this.activate(t);
        if (a && e < s[0])return this.activeTarget = null, this.clear();
        for (t = s.length; t--;)a != n[t] && e >= s[t] && (!s[t + 1] || e <= s[t + 1]) && this.activate(n[t])
    }, e.prototype.activate = function (e) {
        this.activeTarget = e, this.clear();
        var i = this.selector + '[data-target="' + e + '"],' + this.selector + '[href="' + e + '"]', o = t(i).parents("li").addClass("active");
        o.parent(".dropdown-menu").length && (o = o.closest("li.dropdown").addClass("active")), o.trigger("activate.bs.scrollspy")
    }, e.prototype.clear = function () {
        t(this.selector).parentsUntil(this.options.target, ".active").removeClass("active")
    };
    var o = t.fn.scrollspy;
    t.fn.scrollspy = i, t.fn.scrollspy.Constructor = e, t.fn.scrollspy.noConflict = function () {
        return t.fn.scrollspy = o, this
    }, t(window).on("load.bs.scrollspy.data-api", function () {
        t('[data-spy="scroll"]').each(function () {
            var e = t(this);
            i.call(e, e.data())
        })
    })
}(jQuery), +function (t) {
    "use strict";
    function e() {
        var t = document.createElement("bootstrap"), e = {WebkitTransition: "webkitTransitionEnd", MozTransition: "transitionend", OTransition: "oTransitionEnd otransitionend", transition: "transitionend"};
        for (var i in e)if (void 0 !== t.style[i])return{end: e[i]};
        return!1
    }

    t.fn.emulateTransitionEnd = function (e) {
        var i = !1, o = this;
        t(this).one("bsTransitionEnd", function () {
            i = !0
        });
        var s = function () {
            i || t(o).trigger(t.support.transition.end)
        };
        return setTimeout(s, e), this
    }, t(function () {
        t.support.transition = e(), t.support.transition && (t.event.special.bsTransitionEnd = {bindType: t.support.transition.end, delegateType: t.support.transition.end, handle: function (e) {
            return t(e.target).is(this) ? e.handleObj.handler.apply(this, arguments) : void 0
        }})
    })
}(jQuery);
/*!
 * Datepicker for Bootstrap v1.5.0-dev (https://github.com/eternicode/bootstrap-datepicker)
 *
 * Copyright 2012 Stefan Petre
 * Improvements by Andrew Rowls
 * Licensed under the Apache License v2.0 (http://www.apache.org/licenses/LICENSE-2.0)
 */
(function ($, undefined) {

    function UTCDate() {
        return new Date(Date.UTC.apply(Date, arguments));
    }

    function UTCToday() {
        var today = new Date();
        return UTCDate(today.getFullYear(), today.getMonth(), today.getDate());
    }

    function isUTCEquals(date1, date2) {
        return (
            date1.getUTCFullYear() === date2.getUTCFullYear() &&
                date1.getUTCMonth() === date2.getUTCMonth() &&
                date1.getUTCDate() === date2.getUTCDate()
            );
    }

    function alias(method) {
        return function () {
            return this[method].apply(this, arguments);
        };
    }

    var DateArray = (function () {
        var extras = {
            get: function (i) {
                return this.slice(i)[0];
            },
            contains: function (d) {
                // Array.indexOf is not cross-browser;
                // $.inArray doesn't work with Dates
                var val = d && d.valueOf();
                for (var i = 0, l = this.length; i < l; i++)
                    if (this[i].valueOf() === val)
                        return i;
                return -1;
            },
            remove: function (i) {
                this.splice(i, 1);
            },
            replace: function (new_array) {
                if (!new_array)
                    return;
                if (!$.isArray(new_array))
                    new_array = [new_array];
                this.clear();
                this.push.apply(this, new_array);
            },
            clear: function () {
                this.length = 0;
            },
            copy: function () {
                var a = new DateArray();
                a.replace(this);
                return a;
            }
        };

        return function () {
            var a = [];
            a.push.apply(a, arguments);
            $.extend(a, extras);
            return a;
        };
    })();


    // Picker object

    var Datepicker = function (element, options) {
        this._process_options(options);

        this.dates = new DateArray();
        this.viewDate = this.o.defaultViewDate;
        this.focusDate = null;

        this.element = $(element);
        this.isInline = false;
        this.isInput = this.element.is('input');
        this.component = this.element.hasClass('date') ? this.element.find('.add-on, .input-group-addon, .btn') : false;
        this.hasInput = this.component && this.element.find('input').length;
        if (this.component && this.component.length === 0)
            this.component = false;

        this.picker = $(DPGlobal.template);
        this._buildEvents();
        this._attachEvents();

        if (this.isInline) {
            this.picker.addClass('datepicker-inline').appendTo(this.element);
        }
        else {
            this.picker.addClass('datepicker-dropdown dropdown-menu');
        }

        if (this.o.rtl) {
            this.picker.addClass('datepicker-rtl');
        }

        this.viewMode = this.o.startView;

        if (this.o.calendarWeeks)
            this.picker.find('tfoot .today, tfoot .clear')
                .attr('colspan', function (i, val) {
                    return parseInt(val) + 1;
                });

        this._allow_update = false;

        this.setStartDate(this._o.startDate);
        this.setEndDate(this._o.endDate);
        this.setDaysOfWeekDisabled(this.o.daysOfWeekDisabled);
        this.setDatesDisabled(this.o.datesDisabled);

        this.fillDow();
        this.fillMonths();

        this._allow_update = true;

        this.update();
        this.showMode();

        if (this.isInline) {
            this.show();
        }
    };

    Datepicker.prototype = {
        constructor: Datepicker,

        _process_options: function (opts) {
            // Store raw options for reference
            this._o = $.extend({}, this._o, opts);
            // Processed options
            var o = this.o = $.extend({}, this._o);

            // Check if "de-DE" style date is available, if not language should
            // fallback to 2 letter code eg "de"
            var lang = o.language;
            if (!dates[lang]) {
                lang = lang.split('-')[0];
                if (!dates[lang])
                    lang = defaults.language;
            }
            o.language = lang;

            switch (o.startView) {
                case 2:
                case 'decade':
                    o.startView = 2;
                    break;
                case 1:
                case 'year':
                    o.startView = 1;
                    break;
                default:
                    o.startView = 0;
            }

            switch (o.minViewMode) {
                case 1:
                case 'months':
                    o.minViewMode = 1;
                    break;
                case 2:
                case 'years':
                    o.minViewMode = 2;
                    break;
                default:
                    o.minViewMode = 0;
            }

            o.startView = Math.max(o.startView, o.minViewMode);

            // true, false, or Number > 0
            if (o.multidate !== true) {
                o.multidate = Number(o.multidate) || false;
                if (o.multidate !== false)
                    o.multidate = Math.max(0, o.multidate);
            }
            o.multidateSeparator = String(o.multidateSeparator);

            o.weekStart %= 7;
            o.weekEnd = ((o.weekStart + 6) % 7);

            var format = DPGlobal.parseFormat(o.format);
            if (o.startDate !== -Infinity) {
                if (!!o.startDate) {
                    if (o.startDate instanceof Date)
                        o.startDate = this._local_to_utc(this._zero_time(o.startDate));
                    else
                        o.startDate = DPGlobal.parseDate(o.startDate, format, o.language);
                }
                else {
                    o.startDate = -Infinity;
                }
            }
            if (o.endDate !== Infinity) {
                if (!!o.endDate) {
                    if (o.endDate instanceof Date)
                        o.endDate = this._local_to_utc(this._zero_time(o.endDate));
                    else
                        o.endDate = DPGlobal.parseDate(o.endDate, format, o.language);
                }
                else {
                    o.endDate = Infinity;
                }
            }

            o.daysOfWeekDisabled = o.daysOfWeekDisabled || [];
            if (!$.isArray(o.daysOfWeekDisabled))
                o.daysOfWeekDisabled = o.daysOfWeekDisabled.split(/[,\s]*/);
            o.daysOfWeekDisabled = $.map(o.daysOfWeekDisabled, function (d) {
                return parseInt(d, 10);
            });

            o.datesDisabled = o.datesDisabled || [];
            if (!$.isArray(o.datesDisabled)) {
                var datesDisabled = [];
                datesDisabled.push(DPGlobal.parseDate(o.datesDisabled, format, o.language));
                o.datesDisabled = datesDisabled;
            }
            o.datesDisabled = $.map(o.datesDisabled, function (d) {
                return DPGlobal.parseDate(d, format, o.language);
            });

            var plc = String(o.orientation).toLowerCase().split(/\s+/g),
                _plc = o.orientation.toLowerCase();
            plc = $.grep(plc, function (word) {
                return /^auto|left|right|top|bottom$/.test(word);
            });
            o.orientation = {x: 'auto', y: 'auto'};
            if (!_plc || _plc === 'auto')
                ; // no action
            else if (plc.length === 1) {
                switch (plc[0]) {
                    case 'top':
                    case 'bottom':
                        o.orientation.y = plc[0];
                        break;
                    case 'left':
                    case 'right':
                        o.orientation.x = plc[0];
                        break;
                }
            }
            else {
                _plc = $.grep(plc, function (word) {
                    return /^left|right$/.test(word);
                });
                o.orientation.x = _plc[0] || 'auto';

                _plc = $.grep(plc, function (word) {
                    return /^top|bottom$/.test(word);
                });
                o.orientation.y = _plc[0] || 'auto';
            }
            if (o.defaultViewDate) {
                var year = o.defaultViewDate.year || new Date().getFullYear();
                var month = o.defaultViewDate.month || 0;
                var day = o.defaultViewDate.day || 1;
                o.defaultViewDate = UTCDate(year, month, day);
            } else {
                o.defaultViewDate = UTCToday();
            }
            o.showOnFocus = o.showOnFocus !== undefined ? o.showOnFocus : true;
        },
        _events: [],
        _secondaryEvents: [],
        _applyEvents: function (evs) {
            for (var i = 0, el, ch, ev; i < evs.length; i++) {
                el = evs[i][0];
                if (evs[i].length === 2) {
                    ch = undefined;
                    ev = evs[i][1];
                }
                else if (evs[i].length === 3) {
                    ch = evs[i][1];
                    ev = evs[i][2];
                }
                el.on(ev, ch);
            }
        },
        _unapplyEvents: function (evs) {
            for (var i = 0, el, ev, ch; i < evs.length; i++) {
                el = evs[i][0];
                if (evs[i].length === 2) {
                    ch = undefined;
                    ev = evs[i][1];
                }
                else if (evs[i].length === 3) {
                    ch = evs[i][1];
                    ev = evs[i][2];
                }
                el.off(ev, ch);
            }
        },
        _buildEvents: function () {
            var events = {
                keyup: $.proxy(function (e) {
                    if ($.inArray(e.keyCode, [27, 37, 39, 38, 40, 32, 13, 9]) === -1)
                        this.update();
                }, this),
                keydown: $.proxy(this.keydown, this),
                paste: $.proxy(this.paste, this)
            };

            if (this.o.showOnFocus === true) {
                events.focus = $.proxy(this.show, this);
            }

            if (this.isInput) { // single input
                this._events = [
                    [this.element, events]
                ];
            }
            else if (this.component && this.hasInput) { // component: input + button
                this._events = [
                    // For components that are not readonly, allow keyboard nav
                    [this.element.find('input'), events],
                    [this.component, {
                        click: $.proxy(this.show, this)
                    }]
                ];
            }
            else if (this.element.is('div')) {  // inline datepicker
                this.isInline = true;
            }
            else {
                this._events = [
                    [this.element, {
                        click: $.proxy(this.show, this)
                    }]
                ];
            }
            this._events.push(
                // Component: listen for blur on element descendants
                [this.element, '*', {
                    blur: $.proxy(function (e) {
                        this._focused_from = e.target;
                    }, this)
                }],
                // Input: listen for blur on element
                [this.element, {
                    blur: $.proxy(function (e) {
                        this._focused_from = e.target;
                    }, this)
                }]
            );

            if (this.o.immediateUpdates) {
                // Trigger input updates immediately on changed year/month
                this._events.push([this.element, {
                    'changeYear changeMonth': $.proxy(function (e) {
                        this.update(e.date);
                    }, this)
                }]);
            }

            this._secondaryEvents = [
                [this.picker, {
                    click: $.proxy(this.click, this)
                }],
                [$(window), {
                    resize: $.proxy(this.place, this)
                }],
                [$(document), {
                    mousedown: $.proxy(function (e) {
                        // Clicked outside the datepicker, hide it
                        if (!(
                            this.element.is(e.target) ||
                                this.element.find(e.target).length ||
                                this.picker.is(e.target) ||
                                this.picker.find(e.target).length
                            )) {
                            $(this.picker).hide();
                        }
                    }, this)
                }]
            ];
        },
        _attachEvents: function () {
            this._detachEvents();
            this._applyEvents(this._events);
        },
        _detachEvents: function () {
            this._unapplyEvents(this._events);
        },
        _attachSecondaryEvents: function () {
            this._detachSecondaryEvents();
            this._applyEvents(this._secondaryEvents);
        },
        _detachSecondaryEvents: function () {
            this._unapplyEvents(this._secondaryEvents);
        },
        _trigger: function (event, altdate) {
            var date = altdate || this.dates.get(-1),
                local_date = this._utc_to_local(date);

            this.element.trigger({
                type: event,
                date: local_date,
                dates: $.map(this.dates, this._utc_to_local),
                format: $.proxy(function (ix, format) {
                    if (arguments.length === 0) {
                        ix = this.dates.length - 1;
                        format = this.o.format;
                    }
                    else if (typeof ix === 'string') {
                        format = ix;
                        ix = this.dates.length - 1;
                    }
                    format = format || this.o.format;
                    var date = this.dates.get(ix);
                    return DPGlobal.formatDate(date, format, this.o.language);
                }, this)
            });
        },

        show: function () {
            if (this.element.attr('readonly') && this.o.enableOnReadonly === false)
                return;
            if (!this.isInline)
                this.picker.appendTo(this.o.container);
            this.place();
            this.picker.show();
            this._attachSecondaryEvents();
            this._trigger('show');
            if ((window.navigator.msMaxTouchPoints || 'ontouchstart' in document) && this.o.disableTouchKeyboard) {
                $(this.element).blur();
            }
            return this;
        },

        hide: function () {
            if (this.isInline)
                return this;
            if (!this.picker.is(':visible'))
                return this;
            this.focusDate = null;
            this.picker.hide().detach();
            this._detachSecondaryEvents();
            this.viewMode = this.o.startView;
            this.showMode();

            if (
                this.o.forceParse &&
                    (
                        this.isInput && this.element.val() ||
                            this.hasInput && this.element.find('input').val()
                        )
                )
                this.setValue();
            this._trigger('hide');
            return this;
        },

        remove: function () {
            this.hide();
            this._detachEvents();
            this._detachSecondaryEvents();
            this.picker.remove();
            delete this.element.data().datepicker;
            if (!this.isInput) {
                delete this.element.data().date;
            }
            return this;
        },

        paste: function (evt) {
            var dateString;
            if (evt.originalEvent.clipboardData && evt.originalEvent.clipboardData.types
                && $.inArray('text/plain', evt.originalEvent.clipboardData.types) !== -1) {
                dateString = evt.originalEvent.clipboardData.getData('text/plain');
            }
            else if (window.clipboardData) {
                dateString = window.clipboardData.getData('Text');
            }
            else {
                return;
            }
            this.setDate(dateString);
            this.update();
            evt.preventDefault();
        },

        _utc_to_local: function (utc) {
            return utc && new Date(utc.getTime() + (utc.getTimezoneOffset() * 60000));
        },
        _local_to_utc: function (local) {
            return local && new Date(local.getTime() - (local.getTimezoneOffset() * 60000));
        },
        _zero_time: function (local) {
            return local && new Date(local.getFullYear(), local.getMonth(), local.getDate());
        },
        _zero_utc_time: function (utc) {
            return utc && new Date(Date.UTC(utc.getUTCFullYear(), utc.getUTCMonth(), utc.getUTCDate()));
        },

        getDates: function () {
            return $.map(this.dates, this._utc_to_local);
        },

        getUTCDates: function () {
            return $.map(this.dates, function (d) {
                return new Date(d);
            });
        },

        getDate: function () {
            return this._utc_to_local(this.getUTCDate());
        },

        getUTCDate: function () {
            var selected_date = this.dates.get(-1);
            if (typeof selected_date !== 'undefined') {
                return new Date(selected_date);
            } else {
                return null;
            }
        },

        clearDates: function () {
            var element;
            if (this.isInput) {
                element = this.element;
            } else if (this.component) {
                element = this.element.find('input');
            }

            if (element) {
                element.val('').change();
            }

            this.update();
            this._trigger('changeDate');

            if (this.o.autoclose) {
                this.hide();
            }
        },
        setDates: function () {
            var args = $.isArray(arguments[0]) ? arguments[0] : arguments;
            this.update.apply(this, args);
            this._trigger('changeDate');
            this.setValue();
            return this;
        },

        setUTCDates: function () {
            var args = $.isArray(arguments[0]) ? arguments[0] : arguments;
            this.update.apply(this, $.map(args, this._utc_to_local));
            this._trigger('changeDate');
            this.setValue();
            return this;
        },

        setDate: alias('setDates'),
        setUTCDate: alias('setUTCDates'),

        setValue: function () {
            var formatted = this.getFormattedDate();
            if (!this.isInput) {
                if (this.component) {
                    this.element.find('input').val(formatted).change();
                }
            }
            else {
                this.element.val(formatted).change();
            }
            return this;
        },

        getFormattedDate: function (format) {
            if (format === undefined)
                format = this.o.format;

            var lang = this.o.language;
            return $.map(this.dates,function (d) {
                return DPGlobal.formatDate(d, format, lang);
            }).join(this.o.multidateSeparator);
        },

        setStartDate: function (startDate) {
            this._process_options({startDate: startDate});
            this.update();
            this.updateNavArrows();
            return this;
        },

        setEndDate: function (endDate) {
            this._process_options({endDate: endDate});
            this.update();
            this.updateNavArrows();
            return this;
        },

        setDaysOfWeekDisabled: function (daysOfWeekDisabled) {
            this._process_options({daysOfWeekDisabled: daysOfWeekDisabled});
            this.update();
            this.updateNavArrows();
            return this;
        },

        setDatesDisabled: function (datesDisabled) {
            this._process_options({datesDisabled: datesDisabled});
            this.update();
            this.updateNavArrows();
        },

        place: function () {
            if (this.isInline)
                return this;
            var calendarWidth = this.picker.outerWidth(),
                calendarHeight = this.picker.outerHeight(),
                visualPadding = 10,
                windowWidth = $(this.o.container).width(),
                windowHeight = $(this.o.container).height(),
                scrollTop = $(this.o.container).scrollTop(),
                appendOffset = $(this.o.container).offset();

            var parentsZindex = [];
            this.element.parents().each(function () {
                var itemZIndex = $(this).css('z-index');
                if (itemZIndex !== 'auto' && itemZIndex !== 0) parentsZindex.push(parseInt(itemZIndex));
            });
            var zIndex = Math.max.apply(Math, parentsZindex) + 10;
            var offset = this.component ? this.component.parent().offset() : this.element.offset();
            var height = this.component ? this.component.outerHeight(true) : this.element.outerHeight(false);
            var width = this.component ? this.component.outerWidth(true) : this.element.outerWidth(false);
            var left = offset.left - appendOffset.left,
                top = offset.top - appendOffset.top;

            this.picker.removeClass(
                'datepicker-orient-top datepicker-orient-bottom ' +
                    'datepicker-orient-right datepicker-orient-left'
            );

            if (this.o.orientation.x !== 'auto') {
                this.picker.addClass('datepicker-orient-' + this.o.orientation.x);
                if (this.o.orientation.x === 'right')
                    left -= calendarWidth - width;
            }
            // auto x orientation is best-placement: if it crosses a window
            // edge, fudge it sideways
            else {
                if (offset.left < 0) {
                    // component is outside the window on the left side. Move it into visible range
                    this.picker.addClass('datepicker-orient-left');
                    left -= offset.left - visualPadding;
                } else if (left + calendarWidth > windowWidth) {
                    // the calendar passes the widow right edge. Align it to component right side
                    this.picker.addClass('datepicker-orient-right');
                    left = offset.left + width - calendarWidth;
                } else {
                    // Default to left
                    this.picker.addClass('datepicker-orient-left');
                }
            }

            // auto y orientation is best-situation: top or bottom, no fudging,
            // decision based on which shows more of the calendar
            var yorient = this.o.orientation.y,
                top_overflow, bottom_overflow;
            if (yorient === 'auto') {
                top_overflow = -scrollTop + top - calendarHeight;
                bottom_overflow = scrollTop + windowHeight - (top + height + calendarHeight);
                if (Math.max(top_overflow, bottom_overflow) === bottom_overflow)
                    yorient = 'top';
                else
                    yorient = 'bottom';
            }
            this.picker.addClass('datepicker-orient-' + yorient);
            if (yorient === 'top')
                top += height;
            else
                top -= calendarHeight + parseInt(this.picker.css('padding-top'));

            if (this.o.rtl) {
                var right = windowWidth - (left + width);
                this.picker.css({
                    top: top,
                    right: right,
                    zIndex: zIndex
                });
            } else {
                this.picker.css({
                    top: top,
                    left: left,
                    zIndex: zIndex
                });
            }
            return this;
        },

        _allow_update: true,
        update: function () {
            if (!this._allow_update)
                return this;

            var oldDates = this.dates.copy(),
                dates = [],
                fromArgs = false;
            if (arguments.length) {
                $.each(arguments, $.proxy(function (i, date) {
                    if (date instanceof Date)
                        date = this._local_to_utc(date);
                    dates.push(date);
                }, this));
                fromArgs = true;
            }
            else {
                dates = this.isInput
                    ? this.element.val()
                    : this.element.data('date') || this.element.find('input').val();
                if (dates && this.o.multidate)
                    dates = dates.split(this.o.multidateSeparator);
                else
                    dates = [dates];
                delete this.element.data().date;
            }

            dates = $.map(dates, $.proxy(function (date) {
                return DPGlobal.parseDate(date, this.o.format, this.o.language);
            }, this));
            dates = $.grep(dates, $.proxy(function (date) {
                return (
                    date < this.o.startDate ||
                        date > this.o.endDate || !date
                    );
            }, this), true);
            this.dates.replace(dates);

            if (this.dates.length)
                this.viewDate = new Date(this.dates.get(-1));
            else if (this.viewDate < this.o.startDate)
                this.viewDate = new Date(this.o.startDate);
            else if (this.viewDate > this.o.endDate)
                this.viewDate = new Date(this.o.endDate);

            if (fromArgs) {
                // setting date by clicking
                this.setValue();
            }
            else if (dates.length) {
                // setting date by typing
                if (String(oldDates) !== String(this.dates))
                    this._trigger('changeDate');
            }
            if (!this.dates.length && oldDates.length)
                this._trigger('clearDate');

            this.fill();
            return this;
        },

        fillDow: function () {
            var dowCnt = this.o.weekStart,
                html = '<tr>';
            if (this.o.calendarWeeks) {
                this.picker.find('.datepicker-days thead tr:first-child .datepicker-switch')
                    .attr('colspan', function (i, val) {
                        return parseInt(val) + 1;
                    });
                var cell = '<th class="cw">&#160;</th>';
                html += cell;
            }
            while (dowCnt < this.o.weekStart + 7) {
                html += '<th class="dow">' + dates[this.o.language].daysMin[(dowCnt++) % 7] + '</th>';
            }
            html += '</tr>';
            this.picker.find('.datepicker-days thead').append(html);
        },

        fillMonths: function () {
            var html = '',
                i = 0;
            while (i < 12) {
                html += '<span class="month">' + dates[this.o.language].monthsShort[i++] + '</span>';
            }
            this.picker.find('.datepicker-months td').html(html);
        },

        setRange: function (range) {
            if (!range || !range.length)
                delete this.range;
            else
                this.range = $.map(range, function (d) {
                    return d.valueOf();
                });
            this.fill();
        },

        getClassNames: function (date) {
            var cls = [],
                year = this.viewDate.getUTCFullYear(),
                month = this.viewDate.getUTCMonth(),
                today = new Date();
            if (date.getUTCFullYear() < year || (date.getUTCFullYear() === year && date.getUTCMonth() < month)) {
                cls.push('old');
            }
            else if (date.getUTCFullYear() > year || (date.getUTCFullYear() === year && date.getUTCMonth() > month)) {
                cls.push('new');
            }
            if (this.focusDate && date.valueOf() === this.focusDate.valueOf())
                cls.push('focused');
            // Compare internal UTC date with local today, not UTC today
            if (this.o.todayHighlight &&
                date.getUTCFullYear() === today.getFullYear() &&
                date.getUTCMonth() === today.getMonth() &&
                date.getUTCDate() === today.getDate()) {
                cls.push('today');
            }
            if (this.dates.contains(date) !== -1)
                cls.push('active');
            if (date.valueOf() < this.o.startDate || date.valueOf() > this.o.endDate ||
                $.inArray(date.getUTCDay(), this.o.daysOfWeekDisabled) !== -1) {
                cls.push('disabled');
            }
            if (this.o.datesDisabled.length > 0 &&
                $.grep(this.o.datesDisabled,function (d) {
                    return isUTCEquals(date, d);
                }).length > 0) {
                cls.push('disabled', 'disabled-date');
            }

            if (this.range) {
                if (date > this.range[0] && date < this.range[this.range.length - 1]) {
                    cls.push('range');
                }
                if ($.inArray(date.valueOf(), this.range) !== -1) {
                    cls.push('selected');
                }
            }
            return cls;
        },

        fill: function () {
            var d = new Date(this.viewDate),
                year = d.getUTCFullYear(),
                month = d.getUTCMonth(),
                startYear = this.o.startDate !== -Infinity ? this.o.startDate.getUTCFullYear() : -Infinity,
                startMonth = this.o.startDate !== -Infinity ? this.o.startDate.getUTCMonth() : -Infinity,
                endYear = this.o.endDate !== Infinity ? this.o.endDate.getUTCFullYear() : Infinity,
                endMonth = this.o.endDate !== Infinity ? this.o.endDate.getUTCMonth() : Infinity,
                todaytxt = dates[this.o.language].today || dates['en'].today || '',
                cleartxt = dates[this.o.language].clear || dates['en'].clear || '',
                tooltip;
            if (isNaN(year) || isNaN(month))
                return;
            this.picker.find('.datepicker-days thead .datepicker-switch')
                .text(dates[this.o.language].months[month] + ' ' + year);
            this.picker.find('tfoot .today')
                .text(todaytxt)
                .toggle(this.o.todayBtn !== false);
            this.picker.find('tfoot .clear')
                .text(cleartxt)
                .toggle(this.o.clearBtn !== false);
            this.updateNavArrows();
            this.fillMonths();
            var prevMonth = UTCDate(year, month - 1, 28),
                day = DPGlobal.getDaysInMonth(prevMonth.getUTCFullYear(), prevMonth.getUTCMonth());
            prevMonth.setUTCDate(day);
            prevMonth.setUTCDate(day - (prevMonth.getUTCDay() - this.o.weekStart + 7) % 7);
            var nextMonth = new Date(prevMonth);
            nextMonth.setUTCDate(nextMonth.getUTCDate() + 42);
            nextMonth = nextMonth.valueOf();
            var html = [];
            var clsName;
            while (prevMonth.valueOf() < nextMonth) {
                if (prevMonth.getUTCDay() === this.o.weekStart) {
                    html.push('<tr>');
                    if (this.o.calendarWeeks) {
                        // ISO 8601: First week contains first thursday.
                        // ISO also states week starts on Monday, but we can be more abstract here.
                        var
                        // Start of current week: based on weekstart/current date
                            ws = new Date(+prevMonth + (this.o.weekStart - prevMonth.getUTCDay() - 7) % 7 * 864e5),
                        // Thursday of this week
                            th = new Date(Number(ws) + (7 + 4 - ws.getUTCDay()) % 7 * 864e5),
                        // First Thursday of year, year from thursday
                            yth = new Date(Number(yth = UTCDate(th.getUTCFullYear(), 0, 1)) + (7 + 4 - yth.getUTCDay()) % 7 * 864e5),
                        // Calendar week: ms between thursdays, div ms per day, div 7 days
                            calWeek = (th - yth) / 864e5 / 7 + 1;
                        html.push('<td class="cw">' + calWeek + '</td>');

                    }
                }
                clsName = this.getClassNames(prevMonth);
                clsName.push('day');

                if (this.o.beforeShowDay !== $.noop) {
                    var before = this.o.beforeShowDay(this._utc_to_local(prevMonth));
                    if (before === undefined)
                        before = {};
                    else if (typeof(before) === 'boolean')
                        before = {enabled: before};
                    else if (typeof(before) === 'string')
                        before = {classes: before};
                    if (before.enabled === false)
                        clsName.push('disabled');
                    if (before.classes)
                        clsName = clsName.concat(before.classes.split(/\s+/));
                    if (before.tooltip)
                        tooltip = before.tooltip;
                }

                clsName = $.unique(clsName);
                html.push('<td class="' + clsName.join(' ') + '"' + (tooltip ? ' title="' + tooltip + '"' : '') + '>' + prevMonth.getUTCDate() + '</td>');
                tooltip = null;
                if (prevMonth.getUTCDay() === this.o.weekEnd) {
                    html.push('</tr>');
                }
                prevMonth.setUTCDate(prevMonth.getUTCDate() + 1);
            }
            this.picker.find('.datepicker-days tbody').empty().append(html.join(''));

            var months = this.picker.find('.datepicker-months')
                .find('th:eq(1)')
                .text(year)
                .end()
                .find('span').removeClass('active');

            $.each(this.dates, function (i, d) {
                if (d.getUTCFullYear() === year)
                    months.eq(d.getUTCMonth()).addClass('active');
            });

            if (year < startYear || year > endYear) {
                months.addClass('disabled');
            }
            if (year === startYear) {
                months.slice(0, startMonth).addClass('disabled');
            }
            if (year === endYear) {
                months.slice(endMonth + 1).addClass('disabled');
            }

            if (this.o.beforeShowMonth !== $.noop) {
                var that = this;
                $.each(months, function (i, month) {
                    if (!$(month).hasClass('disabled')) {
                        var moDate = new Date(year, i, 1);
                        var before = that.o.beforeShowMonth(moDate);
                        if (before === false)
                            $(month).addClass('disabled');
                    }
                });
            }

            html = '';
            year = parseInt(year / 10, 10) * 10;
            var yearCont = this.picker.find('.datepicker-years')
                .find('th:eq(1)')
                .text(year + '-' + (year + 9))
                .end()
                .find('td');
            year -= 1;
            var years = $.map(this.dates, function (d) {
                    return d.getUTCFullYear();
                }),
                classes;
            for (var i = -1; i < 11; i++) {
                classes = ['year'];
                if (i === -1)
                    classes.push('old');
                else if (i === 10)
                    classes.push('new');
                if ($.inArray(year, years) !== -1)
                    classes.push('active');
                if (year < startYear || year > endYear)
                    classes.push('disabled');
                html += '<span class="' + classes.join(' ') + '">' + year + '</span>';
                year += 1;
            }
            yearCont.html(html);
        },

        updateNavArrows: function () {
            if (!this._allow_update)
                return;

            var d = new Date(this.viewDate),
                year = d.getUTCFullYear(),
                month = d.getUTCMonth();
            switch (this.viewMode) {
                case 0:
                    if (this.o.startDate !== -Infinity && year <= this.o.startDate.getUTCFullYear() && month <= this.o.startDate.getUTCMonth()) {
                        this.picker.find('.prev').css({visibility: 'hidden'});
                    }
                    else {
                        this.picker.find('.prev').css({visibility: 'visible'});
                    }
                    if (this.o.endDate !== Infinity && year >= this.o.endDate.getUTCFullYear() && month >= this.o.endDate.getUTCMonth()) {
                        this.picker.find('.next').css({visibility: 'hidden'});
                    }
                    else {
                        this.picker.find('.next').css({visibility: 'visible'});
                    }
                    break;
                case 1:
                case 2:
                    if (this.o.startDate !== -Infinity && year <= this.o.startDate.getUTCFullYear()) {
                        this.picker.find('.prev').css({visibility: 'hidden'});
                    }
                    else {
                        this.picker.find('.prev').css({visibility: 'visible'});
                    }
                    if (this.o.endDate !== Infinity && year >= this.o.endDate.getUTCFullYear()) {
                        this.picker.find('.next').css({visibility: 'hidden'});
                    }
                    else {
                        this.picker.find('.next').css({visibility: 'visible'});
                    }
                    break;
            }
        },

        click: function (e) {
            e.preventDefault();
            var target = $(e.target).closest('span, td, th'),
                year, month, day;
            if (target.length === 1) {
                switch (target[0].nodeName.toLowerCase()) {
                    case 'th':
                        switch (target[0].className) {
                            case 'datepicker-switch':
                                this.showMode(1);
                                break;
                            case 'prev':
                            case 'next':
                                var dir = DPGlobal.modes[this.viewMode].navStep * (target[0].className === 'prev' ? -1 : 1);
                                switch (this.viewMode) {
                                    case 0:
                                        this.viewDate = this.moveMonth(this.viewDate, dir);
                                        this._trigger('changeMonth', this.viewDate);
                                        break;
                                    case 1:
                                    case 2:
                                        this.viewDate = this.moveYear(this.viewDate, dir);
                                        if (this.viewMode === 1)
                                            this._trigger('changeYear', this.viewDate);
                                        break;
                                }
                                this.fill();
                                break;
                            case 'today':
                                var date = new Date();
                                date = UTCDate(date.getFullYear(), date.getMonth(), date.getDate(), 0, 0, 0);

                                this.showMode(-2);
                                var which = this.o.todayBtn === 'linked' ? null : 'view';
                                this._setDate(date, which);
                                break;
                            case 'clear':
                                this.clearDates();
                                break;
                        }
                        break;
                    case 'span':
                        if (!target.hasClass('disabled')) {
                            this.viewDate.setUTCDate(1);
                            if (target.hasClass('month')) {
                                day = 1;
                                month = target.parent().find('span').index(target);
                                year = this.viewDate.getUTCFullYear();
                                this.viewDate.setUTCMonth(month);
                                this._trigger('changeMonth', this.viewDate);
                                if (this.o.minViewMode === 1) {
                                    this._setDate(UTCDate(year, month, day));
                                    this.showMode();
                                } else {
                                    this.showMode(-1);
                                }
                            }
                            else {
                                day = 1;
                                month = 0;
                                year = parseInt(target.text(), 10) || 0;
                                this.viewDate.setUTCFullYear(year);
                                this._trigger('changeYear', this.viewDate);
                                if (this.o.minViewMode === 2) {
                                    this._setDate(UTCDate(year, month, day));
                                }
                                this.showMode(-1);
                            }
                            this.fill();
                        }
                        break;
                    case 'td':
                        if (target.hasClass('day') && !target.hasClass('disabled')) {
                            day = parseInt(target.text(), 10) || 1;
                            year = this.viewDate.getUTCFullYear();
                            month = this.viewDate.getUTCMonth();
                            if (target.hasClass('old')) {
                                if (month === 0) {
                                    month = 11;
                                    year -= 1;
                                }
                                else {
                                    month -= 1;
                                }
                            }
                            else if (target.hasClass('new')) {
                                if (month === 11) {
                                    month = 0;
                                    year += 1;
                                }
                                else {
                                    month += 1;
                                }
                            }
                            this._setDate(UTCDate(year, month, day));
                        }
                        break;
                }
            }
            if (this.picker.is(':visible') && this._focused_from) {
                $(this._focused_from).focus();
            }
            delete this._focused_from;
        },

        _toggle_multidate: function (date) {
            var ix = this.dates.contains(date);
            if (!date) {
                this.dates.clear();
            }

            if (ix !== -1) {
                if (this.o.multidate === true || this.o.multidate > 1 || this.o.toggleActive) {
                    this.dates.remove(ix);
                }
            } else if (this.o.multidate === false) {
                this.dates.clear();
                this.dates.push(date);
            }
            else {
                this.dates.push(date);
            }

            if (typeof this.o.multidate === 'number')
                while (this.dates.length > this.o.multidate)
                    this.dates.remove(0);
        },

        _setDate: function (date, which) {
            if (!which || which === 'date')
                this._toggle_multidate(date && new Date(date));
            if (!which || which === 'view')
                this.viewDate = date && new Date(date);

            this.fill();
            this.setValue();
            if (!which || which !== 'view') {
                this._trigger('changeDate');
            }
            var element;
            if (this.isInput) {
                element = this.element;
            }
            else if (this.component) {
                element = this.element.find('input');
            }
            if (element) {
                element.change();
            }
            if (this.o.autoclose && (!which || which === 'date')) {
                this.hide();
            }
        },

        moveMonth: function (date, dir) {
            if (!date)
                return undefined;
            if (!dir)
                return date;
            var new_date = new Date(date.valueOf()),
                day = new_date.getUTCDate(),
                month = new_date.getUTCMonth(),
                mag = Math.abs(dir),
                new_month, test;
            dir = dir > 0 ? 1 : -1;
            if (mag === 1) {
                test = dir === -1
                    // If going back one month, make sure month is not current month
                    // (eg, Mar 31 -> Feb 31 == Feb 28, not Mar 02)
                    ? function () {
                    return new_date.getUTCMonth() === month;
                }
                    // If going forward one month, make sure month is as expected
                    // (eg, Jan 31 -> Feb 31 == Feb 28, not Mar 02)
                    : function () {
                    return new_date.getUTCMonth() !== new_month;
                };
                new_month = month + dir;
                new_date.setUTCMonth(new_month);
                // Dec -> Jan (12) or Jan -> Dec (-1) -- limit expected date to 0-11
                if (new_month < 0 || new_month > 11)
                    new_month = (new_month + 12) % 12;
            }
            else {
                // For magnitudes >1, move one month at a time...
                for (var i = 0; i < mag; i++)
                    // ...which might decrease the day (eg, Jan 31 to Feb 28, etc)...
                    new_date = this.moveMonth(new_date, dir);
                // ...then reset the day, keeping it in the new month
                new_month = new_date.getUTCMonth();
                new_date.setUTCDate(day);
                test = function () {
                    return new_month !== new_date.getUTCMonth();
                };
            }
            // Common date-resetting loop -- if date is beyond end of month, make it
            // end of month
            while (test()) {
                new_date.setUTCDate(--day);
                new_date.setUTCMonth(new_month);
            }
            return new_date;
        },

        moveYear: function (date, dir) {
            return this.moveMonth(date, dir * 12);
        },

        dateWithinRange: function (date) {
            return date >= this.o.startDate && date <= this.o.endDate;
        },

        keydown: function (e) {
            if (!this.picker.is(':visible')) {
                if (e.keyCode === 40 || e.keyCode === 27) // allow down to re-show picker
                    this.show();
                return;
            }
            var dateChanged = false,
                dir, newDate, newViewDate,
                focusDate = this.focusDate || this.viewDate;
            switch (e.keyCode) {
                case 27: // escape
                    if (this.focusDate) {
                        this.focusDate = null;
                        this.viewDate = this.dates.get(-1) || this.viewDate;
                        this.fill();
                    }
                    else
                        this.hide();
                    e.preventDefault();
                    break;
                case 37: // left
                case 39: // right
                    if (!this.o.keyboardNavigation)
                        break;
                    dir = e.keyCode === 37 ? -1 : 1;
                    if (e.ctrlKey) {
                        newDate = this.moveYear(this.dates.get(-1) || UTCToday(), dir);
                        newViewDate = this.moveYear(focusDate, dir);
                        this._trigger('changeYear', this.viewDate);
                    }
                    else if (e.shiftKey) {
                        newDate = this.moveMonth(this.dates.get(-1) || UTCToday(), dir);
                        newViewDate = this.moveMonth(focusDate, dir);
                        this._trigger('changeMonth', this.viewDate);
                    }
                    else {
                        newDate = new Date(this.dates.get(-1) || UTCToday());
                        newDate.setUTCDate(newDate.getUTCDate() + dir);
                        newViewDate = new Date(focusDate);
                        newViewDate.setUTCDate(focusDate.getUTCDate() + dir);
                    }
                    if (this.dateWithinRange(newViewDate)) {
                        this.focusDate = this.viewDate = newViewDate;
                        this.setValue();
                        this.fill();
                        e.preventDefault();
                    }
                    break;
                case 38: // up
                case 40: // down
                    if (!this.o.keyboardNavigation)
                        break;
                    dir = e.keyCode === 38 ? -1 : 1;
                    if (e.ctrlKey) {
                        newDate = this.moveYear(this.dates.get(-1) || UTCToday(), dir);
                        newViewDate = this.moveYear(focusDate, dir);
                        this._trigger('changeYear', this.viewDate);
                    }
                    else if (e.shiftKey) {
                        newDate = this.moveMonth(this.dates.get(-1) || UTCToday(), dir);
                        newViewDate = this.moveMonth(focusDate, dir);
                        this._trigger('changeMonth', this.viewDate);
                    }
                    else {
                        newDate = new Date(this.dates.get(-1) || UTCToday());
                        newDate.setUTCDate(newDate.getUTCDate() + dir * 7);
                        newViewDate = new Date(focusDate);
                        newViewDate.setUTCDate(focusDate.getUTCDate() + dir * 7);
                    }
                    if (this.dateWithinRange(newViewDate)) {
                        this.focusDate = this.viewDate = newViewDate;
                        this.setValue();
                        this.fill();
                        e.preventDefault();
                    }
                    break;
                case 32: // spacebar
                    // Spacebar is used in manually typing dates in some formats.
                    // As such, its behavior should not be hijacked.
                    break;
                case 13: // enter
                    focusDate = this.focusDate || this.dates.get(-1) || this.viewDate;
                    if (this.o.keyboardNavigation) {
                        this._toggle_multidate(focusDate);
                        dateChanged = true;
                    }
                    this.focusDate = null;
                    this.viewDate = this.dates.get(-1) || this.viewDate;
                    this.setValue();
                    this.fill();
                    if (this.picker.is(':visible')) {
                        e.preventDefault();
                        if (typeof e.stopPropagation === 'function') {
                            e.stopPropagation(); // All modern browsers, IE9+
                        } else {
                            e.cancelBubble = true; // IE6,7,8 ignore "stopPropagation"
                        }
                        if (this.o.autoclose)
                            this.hide();
                    }
                    break;
                case 9: // tab
                    this.focusDate = null;
                    this.viewDate = this.dates.get(-1) || this.viewDate;
                    this.fill();
                    this.hide();
                    break;
            }
            if (dateChanged) {
                if (this.dates.length)
                    this._trigger('changeDate');
                else
                    this._trigger('clearDate');
                var element;
                if (this.isInput) {
                    element = this.element;
                }
                else if (this.component) {
                    element = this.element.find('input');
                }
                if (element) {
                    element.change();
                }
            }
        },

        showMode: function (dir) {
            if (dir) {
                this.viewMode = Math.max(this.o.minViewMode, Math.min(2, this.viewMode + dir));
            }
            this.picker
                .children('div')
                .hide()
                .filter('.datepicker-' + DPGlobal.modes[this.viewMode].clsName)
                .css('display', 'block');
            this.updateNavArrows();
        }
    };

    var DateRangePicker = function (element, options) {
        this.element = $(element);
        this.inputs = $.map(options.inputs, function (i) {
            return i.jquery ? i[0] : i;
        });
        delete options.inputs;

        datepickerPlugin.call($(this.inputs), options)
            .on('changeDate', $.proxy(this.dateUpdated, this));

        this.pickers = $.map(this.inputs, function (i) {
            return $(i).data('datepicker');
        });
        this.updateDates();
    };
    DateRangePicker.prototype = {
        updateDates: function () {
            this.dates = $.map(this.pickers, function (i) {
                return i.getUTCDate();
            });
            this.updateRanges();
        },
        updateRanges: function () {
            var range = $.map(this.dates, function (d) {
                return d.valueOf();
            });
            $.each(this.pickers, function (i, p) {
                p.setRange(range);
            });
        },
        dateUpdated: function (e) {
            // `this.updating` is a workaround for preventing infinite recursion
            // between `changeDate` triggering and `setUTCDate` calling.  Until
            // there is a better mechanism.
            if (this.updating)
                return;
            this.updating = true;

            var dp = $(e.target).data('datepicker'),
                new_date = dp.getUTCDate(),
                i = $.inArray(e.target, this.inputs),
                j = i - 1,
                k = i + 1,
                l = this.inputs.length;
            if (i === -1)
                return;

            $.each(this.pickers, function (i, p) {
                if (!p.getUTCDate())
                    p.setUTCDate(new_date);
            });

            if (new_date < this.dates[j]) {
                // Date being moved earlier/left
                while (j >= 0 && new_date < this.dates[j]) {
                    this.pickers[j--].setUTCDate(new_date);
                }
            }
            else if (new_date > this.dates[k]) {
                // Date being moved later/right
                while (k < l && new_date > this.dates[k]) {
                    this.pickers[k++].setUTCDate(new_date);
                }
            }
            this.updateDates();

            delete this.updating;
        },
        remove: function () {
            $.map(this.pickers, function (p) {
                p.remove();
            });
            delete this.element.data().datepicker;
        }
    };

    function opts_from_el(el, prefix) {
        // Derive options from element data-attrs
        var data = $(el).data(),
            out = {}, inkey,
            replace = new RegExp('^' + prefix.toLowerCase() + '([A-Z])');
        prefix = new RegExp('^' + prefix.toLowerCase());
        function re_lower(_, a) {
            return a.toLowerCase();
        }

        for (var key in data)
            if (prefix.test(key)) {
                inkey = key.replace(replace, re_lower);
                out[inkey] = data[key];
            }
        return out;
    }

    function opts_from_locale(lang) {
        // Derive options from locale plugins
        var out = {};
        // Check if "de-DE" style date is available, if not language should
        // fallback to 2 letter code eg "de"
        if (!dates[lang]) {
            lang = lang.split('-')[0];
            if (!dates[lang])
                return;
        }
        var d = dates[lang];
        $.each(locale_opts, function (i, k) {
            if (k in d)
                out[k] = d[k];
        });
        return out;
    }

    var old = $.fn.datepicker;
    var datepickerPlugin = function (option) {
        var args = Array.apply(null, arguments);
        args.shift();
        var internal_return;
        this.each(function () {
            var $this = $(this),
                data = $this.data('datepicker'),
                options = typeof option === 'object' && option;
            if (!data) {
                var elopts = opts_from_el(this, 'date'),
                // Preliminary otions
                    xopts = $.extend({}, defaults, elopts, options),
                    locopts = opts_from_locale(xopts.language),
                // Options priority: js args, data-attrs, locales, defaults
                    opts = $.extend({}, defaults, locopts, elopts, options);
                if ($this.hasClass('input-daterange') || opts.inputs) {
                    var ropts = {
                        inputs: opts.inputs || $this.find('input').toArray()
                    };
                    $this.data('datepicker', (data = new DateRangePicker(this, $.extend(opts, ropts))));
                }
                else {
                    $this.data('datepicker', (data = new Datepicker(this, opts)));
                }
            }
            if (typeof option === 'string' && typeof data[option] === 'function') {
                internal_return = data[option].apply(data, args);
                if (internal_return !== undefined)
                    return false;
            }
        });
        if (internal_return !== undefined)
            return internal_return;
        else
            return this;
    };
    $.fn.datepicker = datepickerPlugin;

    var defaults = $.fn.datepicker.defaults = {
        autoclose: false,
        beforeShowDay: $.noop,
        beforeShowMonth: $.noop,
        calendarWeeks: false,
        clearBtn: false,
        toggleActive: false,
        daysOfWeekDisabled: [],
        datesDisabled: [],
        endDate: Infinity,
        forceParse: true,
        format: 'mm/dd/yyyy',
        keyboardNavigation: true,
        language: 'en',
        minViewMode: 0,
        multidate: false,
        multidateSeparator: ',',
        orientation: "auto",
        rtl: false,
        startDate: -Infinity,
        startView: 0,
        todayBtn: false,
        todayHighlight: false,
        weekStart: 0,
        disableTouchKeyboard: false,
        enableOnReadonly: true,
        container: 'body',
        immediateUpdates: false
    };
    var locale_opts = $.fn.datepicker.locale_opts = [
        'format',
        'rtl',
        'weekStart'
    ];
    $.fn.datepicker.Constructor = Datepicker;
    var dates = $.fn.datepicker.dates = {
        en: {
            days: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
            daysShort: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
            daysMin: ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"],
            months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
            monthsShort: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
            today: "Today",
            clear: "Clear"
        }
    };

    var DPGlobal = {
        modes: [
            {
                clsName: 'days',
                navFnc: 'Month',
                navStep: 1
            },
            {
                clsName: 'months',
                navFnc: 'FullYear',
                navStep: 1
            },
            {
                clsName: 'years',
                navFnc: 'FullYear',
                navStep: 10
            }
        ],
        isLeapYear: function (year) {
            return (((year % 4 === 0) && (year % 100 !== 0)) || (year % 400 === 0));
        },
        getDaysInMonth: function (year, month) {
            return [31, (DPGlobal.isLeapYear(year) ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][month];
        },
        validParts: /dd?|DD?|mm?|MM?|yy(?:yy)?/g,
        nonpunctuation: /[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,
        parseFormat: function (format) {
            // IE treats \0 as a string end in inputs (truncating the value),
            // so it's a bad format delimiter, anyway
            var separators = format.replace(this.validParts, '\0').split('\0'),
                parts = format.match(this.validParts);
            if (!separators || !separators.length || !parts || parts.length === 0) {
                throw new Error("Invalid date format.");
            }
            return {separators: separators, parts: parts};
        },
        parseDate: function (date, format, language) {
            if (!date)
                return undefined;
            if (date instanceof Date)
                return date;
            if (typeof format === 'string')
                format = DPGlobal.parseFormat(format);
            var part_re = /([\-+]\d+)([dmwy])/,
                parts = date.match(/([\-+]\d+)([dmwy])/g),
                part, dir, i;
            if (/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(date)) {
                date = new Date();
                for (i = 0; i < parts.length; i++) {
                    part = part_re.exec(parts[i]);
                    dir = parseInt(part[1]);
                    switch (part[2]) {
                        case 'd':
                            date.setUTCDate(date.getUTCDate() + dir);
                            break;
                        case 'm':
                            date = Datepicker.prototype.moveMonth.call(Datepicker.prototype, date, dir);
                            break;
                        case 'w':
                            date.setUTCDate(date.getUTCDate() + dir * 7);
                            break;
                        case 'y':
                            date = Datepicker.prototype.moveYear.call(Datepicker.prototype, date, dir);
                            break;
                    }
                }
                return UTCDate(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), 0, 0, 0);
            }
            parts = date && date.match(this.nonpunctuation) || [];
            date = new Date();
            var parsed = {},
                setters_order = ['yyyy', 'yy', 'M', 'MM', 'm', 'mm', 'd', 'dd'],
                setters_map = {
                    yyyy: function (d, v) {
                        return d.setUTCFullYear(v);
                    },
                    yy: function (d, v) {
                        return d.setUTCFullYear(2000 + v);
                    },
                    m: function (d, v) {
                        if (isNaN(d))
                            return d;
                        v -= 1;
                        while (v < 0) v += 12;
                        v %= 12;
                        d.setUTCMonth(v);
                        while (d.getUTCMonth() !== v)
                            d.setUTCDate(d.getUTCDate() - 1);
                        return d;
                    },
                    d: function (d, v) {
                        return d.setUTCDate(v);
                    }
                },
                val, filtered;
            setters_map['M'] = setters_map['MM'] = setters_map['mm'] = setters_map['m'];
            setters_map['dd'] = setters_map['d'];
            date = UTCDate(date.getFullYear(), date.getMonth(), date.getDate(), 0, 0, 0);
            var fparts = format.parts.slice();
            // Remove noop parts
            if (parts.length !== fparts.length) {
                fparts = $(fparts).filter(function (i, p) {
                    return $.inArray(p, setters_order) !== -1;
                }).toArray();
            }
            // Process remainder
            function match_part() {
                var m = this.slice(0, parts[i].length),
                    p = parts[i].slice(0, m.length);
                return m.toLowerCase() === p.toLowerCase();
            }

            if (parts.length === fparts.length) {
                var cnt;
                for (i = 0, cnt = fparts.length; i < cnt; i++) {
                    val = parseInt(parts[i], 10);
                    part = fparts[i];
                    if (isNaN(val)) {
                        switch (part) {
                            case 'MM':
                                filtered = $(dates[language].months).filter(match_part);
                                val = $.inArray(filtered[0], dates[language].months) + 1;
                                break;
                            case 'M':
                                filtered = $(dates[language].monthsShort).filter(match_part);
                                val = $.inArray(filtered[0], dates[language].monthsShort) + 1;
                                break;
                        }
                    }
                    parsed[part] = val;
                }
                var _date, s;
                for (i = 0; i < setters_order.length; i++) {
                    s = setters_order[i];
                    if (s in parsed && !isNaN(parsed[s])) {
                        _date = new Date(date);
                        setters_map[s](_date, parsed[s]);
                        if (!isNaN(_date))
                            date = _date;
                    }
                }
            }
            return date;
        },
        formatDate: function (date, format, language) {
            if (!date)
                return '';
            if (typeof format === 'string')
                format = DPGlobal.parseFormat(format);
            var val = {
                d: date.getUTCDate(),
                D: dates[language].daysShort[date.getUTCDay()],
                DD: dates[language].days[date.getUTCDay()],
                m: date.getUTCMonth() + 1,
                M: dates[language].monthsShort[date.getUTCMonth()],
                MM: dates[language].months[date.getUTCMonth()],
                yy: date.getUTCFullYear().toString().substring(2),
                yyyy: date.getUTCFullYear()
            };
            val.dd = (val.d < 10 ? '0' : '') + val.d;
            val.mm = (val.m < 10 ? '0' : '') + val.m;
            date = [];
            var seps = $.extend([], format.separators);
            for (var i = 0, cnt = format.parts.length; i <= cnt; i++) {
                if (seps.length)
                    date.push(seps.shift());
                date.push(val[format.parts[i]]);
            }
            return date.join('');
        },
        headTemplate: '<thead>' +
            '<tr>' +
            '<th class="prev">&#171;</th>' +
            '<th colspan="5" class="datepicker-switch"></th>' +
            '<th class="next">&#187;</th>' +
            '</tr>' +
            '</thead>',
        contTemplate: '<tbody><tr><td colspan="7"></td></tr></tbody>',
        footTemplate: '<tfoot>' +
            '<tr>' +
            '<th colspan="7" class="today"></th>' +
            '</tr>' +
            '<tr>' +
            '<th colspan="7" class="clear"></th>' +
            '</tr>' +
            '</tfoot>'
    };
    DPGlobal.template = '<div class="datepicker">' +
        '<div class="datepicker-days">' +
        '<table class=" table-condensed">' +
        DPGlobal.headTemplate +
        '<tbody></tbody>' +
        DPGlobal.footTemplate +
        '</table>' +
        '</div>' +
        '<div class="datepicker-months">' +
        '<table class="table-condensed">' +
        DPGlobal.headTemplate +
        DPGlobal.contTemplate +
        DPGlobal.footTemplate +
        '</table>' +
        '</div>' +
        '<div class="datepicker-years">' +
        '<table class="table-condensed">' +
        DPGlobal.headTemplate +
        DPGlobal.contTemplate +
        DPGlobal.footTemplate +
        '</table>' +
        '</div>' +
        '</div>';

    $.fn.datepicker.DPGlobal = DPGlobal;


    /* DATEPICKER NO CONFLICT
     * =================== */

    $.fn.datepicker.noConflict = function () {
        $.fn.datepicker = old;
        return this;
    };

    /* DATEPICKER VERSION
     * =================== */
    $.fn.datepicker.version = "1.4.1-dev";

    /* DATEPICKER DATA-API
     * ================== */

    $(document).on(
        'focus.datepicker.data-api click.datepicker.data-api',
        '[data-provide="datepicker"]',
        function (e) {
            var $this = $(this);
            if ($this.data('datepicker'))
                return;
            e.preventDefault();
            // component click requires us to explicitly show it
            datepickerPlugin.call($this, 'show');
        }
    );
    $(function () {
        datepickerPlugin.call($('[data-provide="datepicker-inline"]'));
    });

}(window.jQuery));
/**
 * Russian translation for bootstrap-datepicker
 * Victor Taranenko <darwin@snowdale.com>
 */
;
(function ($) {
    $.fn.datepicker.dates['ru'] = {
        days: ["Воскресенье", "Понедельник", "Вторник", "Среда", "Четверг", "Пятница", "Суббота", "Воскресенье"],
        daysShort: ["Вск", "Пнд", "Втр", "Срд", "Чтв", "Птн", "Суб", "Вск"],
        daysMin: ["Вс", "Пн", "Вт", "Ср", "Чт", "Пт", "Сб", "Вс"],
        months: ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"],
        monthsShort: ["Янв", "Фев", "Мар", "Апр", "Май", "Июн", "Июл", "Авг", "Сен", "Окт", "Ноя", "Дек"],
        today: "Сегодня",
        clear: "Очистить",
        format: "dd.mm.yyyy",
        weekStart: 1
    };
}(jQuery));

!function (a, b) {
    "use strict";
    "undefined" != typeof module && module.exports ? module.exports = b(require("jquery")) : "function" == typeof define && define.amd ? define(["jquery"], function (a) {
        return b(a)
    }) : b(a.jQuery)
}(this, function (a) {
    "use strict";
    var b = function (b, c) {
        this.$element = a(b), this.options = a.extend({}, a.fn.typeahead.defaults, c), this.matcher = this.options.matcher || this.matcher, this.sorter = this.options.sorter || this.sorter, this.select = this.options.select || this.select, this.autoSelect = "boolean" == typeof this.options.autoSelect ? this.options.autoSelect : !0, this.highlighter = this.options.highlighter || this.highlighter, this.render = this.options.render || this.render, this.updater = this.options.updater || this.updater, this.displayText = this.options.displayText || this.displayText, this.source = this.options.source, this.delay = this.options.delay, this.$menu = a(this.options.menu), this.$appendTo = this.options.appendTo ? a(this.options.appendTo) : null, this.shown = !1, this.listen(), this.showHintOnFocus = "boolean" == typeof this.options.showHintOnFocus ? this.options.showHintOnFocus : !1, this.afterSelect = this.options.afterSelect, this.addItem = !1
    };
    b.prototype = {constructor: b, select: function () {
        var a = this.$menu.find(".active").data("value");
        if (this.$element.data("active", a), this.autoSelect || a) {
            var b = this.updater(a);
            this.$element.val(this.displayText(b) || b).change(), this.afterSelect(b)
        }
        return this.hide()
    }, updater: function (a) {
        return a
    }, setSource: function (a) {
        this.source = a
    }, show: function () {
        var b, c = a.extend({}, this.$element.position(), {height: this.$element[0].offsetHeight});
        return b = "function" == typeof this.options.scrollHeight ? this.options.scrollHeight.call() : this.options.scrollHeight, (this.$appendTo ? this.$menu.appendTo(this.$appendTo) : this.$menu.insertAfter(this.$element)).css({top: c.top + c.height + b, left: c.left}).show(), this.shown = !0, this
    }, hide: function () {
        return this.$menu.hide(), this.shown = !1, this
    }, lookup: function (b) {
        if (this.query = "undefined" != typeof b && null !== b ? b : this.$element.val() || "", this.query.length < this.options.minLength)return this.shown ? this.hide() : this;
        var c = a.proxy(function () {
            a.isFunction(this.source) ? this.source(this.query, a.proxy(this.process, this)) : this.source && this.process(this.source)
        }, this);
        clearTimeout(this.lookupWorker), this.lookupWorker = setTimeout(c, this.delay)
    }, process: function (b) {
        var c = this;
        return b = a.grep(b, function (a) {
            return c.matcher(a)
        }), b = this.sorter(b), b.length || this.options.addItem ? (b.length > 0 ? this.$element.data("active", b[0]) : this.$element.data("active", null), this.options.addItem && b.push(this.options.addItem), "all" == this.options.items ? this.render(b).show() : this.render(b.slice(0, this.options.items)).show()) : this.shown ? this.hide() : this
    }, matcher: function (a) {
        var b = this.displayText(a);
        return~b.toLowerCase().indexOf(this.query.toLowerCase())
    }, sorter: function (a) {
        for (var b, c = [], d = [], e = []; b = a.shift();) {
            var f = this.displayText(b);
            f.toLowerCase().indexOf(this.query.toLowerCase()) ? ~f.indexOf(this.query) ? d.push(b) : e.push(b) : c.push(b)
        }
        return c.concat(d, e)
    }, highlighter: function (b) {
        var c, d, e, f, g, h = a("<div></div>"), i = this.query, j = b.toLowerCase().indexOf(i.toLowerCase());
        if (c = i.length, 0 === c)return h.text(b).html();
        for (; j > -1;)d = b.substr(0, j), e = b.substr(j, c), f = b.substr(j + c), g = a("<strong></strong>").text(e), h.append(document.createTextNode(d)).append(g), b = f, j = b.toLowerCase().indexOf(i.toLowerCase());
        return h.append(document.createTextNode(b)).html()
    }, render: function (b) {
        var c = this, d = this, e = !1;
        return b = a(b).map(function (b, f) {
            var g = d.displayText(f);
            return b = a(c.options.item).data("value", f), b.find("a").html(c.highlighter(g)), g == d.$element.val() && (b.addClass("active"), d.$element.data("active", f), e = !0), b[0]
        }), this.autoSelect && !e && (b.first().addClass("active"), this.$element.data("active", b.first().data("value"))), this.$menu.html(b), this
    }, displayText: function (a) {
        return a.name || a
    }, next: function (b) {
        var c = this.$menu.find(".active").removeClass("active"), d = c.next();
        d.length || (d = a(this.$menu.find("li")[0])), d.addClass("active")
    }, prev: function (a) {
        var b = this.$menu.find(".active").removeClass("active"), c = b.prev();
        c.length || (c = this.$menu.find("li").last()), c.addClass("active")
    }, listen: function () {
        this.$element.on("focus", a.proxy(this.focus, this)).on("blur", a.proxy(this.blur, this)).on("keypress", a.proxy(this.keypress, this)).on("keyup", a.proxy(this.keyup, this)), this.eventSupported("keydown") && this.$element.on("keydown", a.proxy(this.keydown, this)), this.$menu.on("click", a.proxy(this.click, this)).on("mouseenter", "li", a.proxy(this.mouseenter, this)).on("mouseleave", "li", a.proxy(this.mouseleave, this))
    }, destroy: function () {
        this.$element.data("typeahead", null), this.$element.data("active", null), this.$element.off("focus").off("blur").off("keypress").off("keyup"), this.eventSupported("keydown") && this.$element.off("keydown"), this.$menu.remove()
    }, eventSupported: function (a) {
        var b = a in this.$element;
        return b || (this.$element.setAttribute(a, "return;"), b = "function" == typeof this.$element[a]), b
    }, move: function (a) {
        if (this.shown) {
            switch (a.keyCode) {
                case 9:
                case 13:
                case 27:
                    a.preventDefault();
                    break;
                case 38:
                    if (a.shiftKey)return;
                    a.preventDefault(), this.prev();
                    break;
                case 40:
                    if (a.shiftKey)return;
                    a.preventDefault(), this.next()
            }
            a.stopPropagation()
        }
    }, keydown: function (b) {
        this.suppressKeyPressRepeat = ~a.inArray(b.keyCode, [40, 38, 9, 13, 27]), this.shown || 40 != b.keyCode ? this.move(b) : this.lookup()
    }, keypress: function (a) {
        this.suppressKeyPressRepeat || this.move(a)
    }, keyup: function (a) {
        switch (a.keyCode) {
            case 40:
            case 38:
            case 16:
            case 17:
            case 18:
                break;
            case 9:
            case 13:
                if (!this.shown)return;
                this.select();
                break;
            case 27:
                if (!this.shown)return;
                this.hide();
                break;
            default:
                this.lookup()
        }
        a.stopPropagation(), a.preventDefault()
    }, focus: function (a) {
        this.focused || (this.focused = !0, this.options.showHintOnFocus && this.lookup(""))
    }, blur: function (a) {
        this.focused = !1, !this.mousedover && this.shown && this.hide()
    }, click: function (a) {
        a.stopPropagation(), a.preventDefault(), this.select(), this.$element.focus()
    }, mouseenter: function (b) {
        this.mousedover = !0, this.$menu.find(".active").removeClass("active"), a(b.currentTarget).addClass("active")
    }, mouseleave: function (a) {
        this.mousedover = !1, !this.focused && this.shown && this.hide()
    }};
    var c = a.fn.typeahead;
    a.fn.typeahead = function (c) {
        var d = arguments;
        return"string" == typeof c && "getActive" == c ? this.data("active") : this.each(function () {
            var e = a(this), f = e.data("typeahead"), g = "object" == typeof c && c;
            f || e.data("typeahead", f = new b(this, g)), "string" == typeof c && (d.length > 1 ? f[c].apply(f, Array.prototype.slice.call(d, 1)) : f[c]())
        })
    }, a.fn.typeahead.defaults = {source: [], items: 8, menu: '<ul class="typeahead dropdown-menu" role="listbox"></ul>', item: '<li><a href="#" role="option"></a></li>', minLength: 1, scrollHeight: 0, autoSelect: !0, afterSelect: a.noop, addItem: !1, delay: 0}, a.fn.typeahead.Constructor = b, a.fn.typeahead.noConflict = function () {
        return a.fn.typeahead = c, this
    }, a(document).on("focus.typeahead.data-api", '[data-provide="typeahead"]', function (b) {
        var c = a(this);
        c.data("typeahead") || c.typeahead(c.data())
    })
});
/*! mobile-detect - v1.1.0 - 2015-05-11
 https://github.com/hgoebl/mobile-detect.js */
!function (a, b) {
    a(function () {
        "use strict";
        function a(a, b) {
            return null != a && null != b && a.toLowerCase() === b.toLowerCase()
        }

        function c(a) {
            for (var b in a)g.call(a, b) && (a[b] = new RegExp(a[b], "i"))
        }

        function d(a, b) {
            this.ua = a || "", this._cache = {}, this.maxPhoneWidth = b || 600
        }

        var e = {};
        e.mobileDetectRules = {phones: {iPhone: "\\biPhone\\b|\\biPod\\b", BlackBerry: "BlackBerry|\\bBB10\\b|rim[0-9]+", HTC: "HTC|HTC.*(Sensation|Evo|Vision|Explorer|6800|8100|8900|A7272|S510e|C110e|Legend|Desire|T8282)|APX515CKT|Qtek9090|APA9292KT|HD_mini|Sensation.*Z710e|PG86100|Z715e|Desire.*(A8181|HD)|ADR6200|ADR6400L|ADR6425|001HT|Inspire 4G|Android.*\\bEVO\\b|T-Mobile G1|Z520m", Nexus: "Nexus One|Nexus S|Galaxy.*Nexus|Android.*Nexus.*Mobile|Nexus 4|Nexus 5|Nexus 6", Dell: "Dell.*Streak|Dell.*Aero|Dell.*Venue|DELL.*Venue Pro|Dell Flash|Dell Smoke|Dell Mini 3iX|XCD28|XCD35|\\b001DL\\b|\\b101DL\\b|\\bGS01\\b", Motorola: "Motorola|DROIDX|DROID BIONIC|\\bDroid\\b.*Build|Android.*Xoom|HRI39|MOT-|A1260|A1680|A555|A853|A855|A953|A955|A956|Motorola.*ELECTRIFY|Motorola.*i1|i867|i940|MB200|MB300|MB501|MB502|MB508|MB511|MB520|MB525|MB526|MB611|MB612|MB632|MB810|MB855|MB860|MB861|MB865|MB870|ME501|ME502|ME511|ME525|ME600|ME632|ME722|ME811|ME860|ME863|ME865|MT620|MT710|MT716|MT720|MT810|MT870|MT917|Motorola.*TITANIUM|WX435|WX445|XT300|XT301|XT311|XT316|XT317|XT319|XT320|XT390|XT502|XT530|XT531|XT532|XT535|XT603|XT610|XT611|XT615|XT681|XT701|XT702|XT711|XT720|XT800|XT806|XT860|XT862|XT875|XT882|XT883|XT894|XT901|XT907|XT909|XT910|XT912|XT928|XT926|XT915|XT919|XT925", Samsung: "Samsung|SGH-I337|BGT-S5230|GT-B2100|GT-B2700|GT-B2710|GT-B3210|GT-B3310|GT-B3410|GT-B3730|GT-B3740|GT-B5510|GT-B5512|GT-B5722|GT-B6520|GT-B7300|GT-B7320|GT-B7330|GT-B7350|GT-B7510|GT-B7722|GT-B7800|GT-C3010|GT-C3011|GT-C3060|GT-C3200|GT-C3212|GT-C3212I|GT-C3262|GT-C3222|GT-C3300|GT-C3300K|GT-C3303|GT-C3303K|GT-C3310|GT-C3322|GT-C3330|GT-C3350|GT-C3500|GT-C3510|GT-C3530|GT-C3630|GT-C3780|GT-C5010|GT-C5212|GT-C6620|GT-C6625|GT-C6712|GT-E1050|GT-E1070|GT-E1075|GT-E1080|GT-E1081|GT-E1085|GT-E1087|GT-E1100|GT-E1107|GT-E1110|GT-E1120|GT-E1125|GT-E1130|GT-E1160|GT-E1170|GT-E1175|GT-E1180|GT-E1182|GT-E1200|GT-E1210|GT-E1225|GT-E1230|GT-E1390|GT-E2100|GT-E2120|GT-E2121|GT-E2152|GT-E2220|GT-E2222|GT-E2230|GT-E2232|GT-E2250|GT-E2370|GT-E2550|GT-E2652|GT-E3210|GT-E3213|GT-I5500|GT-I5503|GT-I5700|GT-I5800|GT-I5801|GT-I6410|GT-I6420|GT-I7110|GT-I7410|GT-I7500|GT-I8000|GT-I8150|GT-I8160|GT-I8190|GT-I8320|GT-I8330|GT-I8350|GT-I8530|GT-I8700|GT-I8703|GT-I8910|GT-I9000|GT-I9001|GT-I9003|GT-I9010|GT-I9020|GT-I9023|GT-I9070|GT-I9082|GT-I9100|GT-I9103|GT-I9220|GT-I9250|GT-I9300|GT-I9305|GT-I9500|GT-I9505|GT-M3510|GT-M5650|GT-M7500|GT-M7600|GT-M7603|GT-M8800|GT-M8910|GT-N7000|GT-S3110|GT-S3310|GT-S3350|GT-S3353|GT-S3370|GT-S3650|GT-S3653|GT-S3770|GT-S3850|GT-S5210|GT-S5220|GT-S5229|GT-S5230|GT-S5233|GT-S5250|GT-S5253|GT-S5260|GT-S5263|GT-S5270|GT-S5300|GT-S5330|GT-S5350|GT-S5360|GT-S5363|GT-S5369|GT-S5380|GT-S5380D|GT-S5560|GT-S5570|GT-S5600|GT-S5603|GT-S5610|GT-S5620|GT-S5660|GT-S5670|GT-S5690|GT-S5750|GT-S5780|GT-S5830|GT-S5839|GT-S6102|GT-S6500|GT-S7070|GT-S7200|GT-S7220|GT-S7230|GT-S7233|GT-S7250|GT-S7500|GT-S7530|GT-S7550|GT-S7562|GT-S7710|GT-S8000|GT-S8003|GT-S8500|GT-S8530|GT-S8600|SCH-A310|SCH-A530|SCH-A570|SCH-A610|SCH-A630|SCH-A650|SCH-A790|SCH-A795|SCH-A850|SCH-A870|SCH-A890|SCH-A930|SCH-A950|SCH-A970|SCH-A990|SCH-I100|SCH-I110|SCH-I400|SCH-I405|SCH-I500|SCH-I510|SCH-I515|SCH-I600|SCH-I730|SCH-I760|SCH-I770|SCH-I830|SCH-I910|SCH-I920|SCH-I959|SCH-LC11|SCH-N150|SCH-N300|SCH-R100|SCH-R300|SCH-R351|SCH-R400|SCH-R410|SCH-T300|SCH-U310|SCH-U320|SCH-U350|SCH-U360|SCH-U365|SCH-U370|SCH-U380|SCH-U410|SCH-U430|SCH-U450|SCH-U460|SCH-U470|SCH-U490|SCH-U540|SCH-U550|SCH-U620|SCH-U640|SCH-U650|SCH-U660|SCH-U700|SCH-U740|SCH-U750|SCH-U810|SCH-U820|SCH-U900|SCH-U940|SCH-U960|SCS-26UC|SGH-A107|SGH-A117|SGH-A127|SGH-A137|SGH-A157|SGH-A167|SGH-A177|SGH-A187|SGH-A197|SGH-A227|SGH-A237|SGH-A257|SGH-A437|SGH-A517|SGH-A597|SGH-A637|SGH-A657|SGH-A667|SGH-A687|SGH-A697|SGH-A707|SGH-A717|SGH-A727|SGH-A737|SGH-A747|SGH-A767|SGH-A777|SGH-A797|SGH-A817|SGH-A827|SGH-A837|SGH-A847|SGH-A867|SGH-A877|SGH-A887|SGH-A897|SGH-A927|SGH-B100|SGH-B130|SGH-B200|SGH-B220|SGH-C100|SGH-C110|SGH-C120|SGH-C130|SGH-C140|SGH-C160|SGH-C170|SGH-C180|SGH-C200|SGH-C207|SGH-C210|SGH-C225|SGH-C230|SGH-C417|SGH-C450|SGH-D307|SGH-D347|SGH-D357|SGH-D407|SGH-D415|SGH-D780|SGH-D807|SGH-D980|SGH-E105|SGH-E200|SGH-E315|SGH-E316|SGH-E317|SGH-E335|SGH-E590|SGH-E635|SGH-E715|SGH-E890|SGH-F300|SGH-F480|SGH-I200|SGH-I300|SGH-I320|SGH-I550|SGH-I577|SGH-I600|SGH-I607|SGH-I617|SGH-I627|SGH-I637|SGH-I677|SGH-I700|SGH-I717|SGH-I727|SGH-i747M|SGH-I777|SGH-I780|SGH-I827|SGH-I847|SGH-I857|SGH-I896|SGH-I897|SGH-I900|SGH-I907|SGH-I917|SGH-I927|SGH-I937|SGH-I997|SGH-J150|SGH-J200|SGH-L170|SGH-L700|SGH-M110|SGH-M150|SGH-M200|SGH-N105|SGH-N500|SGH-N600|SGH-N620|SGH-N625|SGH-N700|SGH-N710|SGH-P107|SGH-P207|SGH-P300|SGH-P310|SGH-P520|SGH-P735|SGH-P777|SGH-Q105|SGH-R210|SGH-R220|SGH-R225|SGH-S105|SGH-S307|SGH-T109|SGH-T119|SGH-T139|SGH-T209|SGH-T219|SGH-T229|SGH-T239|SGH-T249|SGH-T259|SGH-T309|SGH-T319|SGH-T329|SGH-T339|SGH-T349|SGH-T359|SGH-T369|SGH-T379|SGH-T409|SGH-T429|SGH-T439|SGH-T459|SGH-T469|SGH-T479|SGH-T499|SGH-T509|SGH-T519|SGH-T539|SGH-T559|SGH-T589|SGH-T609|SGH-T619|SGH-T629|SGH-T639|SGH-T659|SGH-T669|SGH-T679|SGH-T709|SGH-T719|SGH-T729|SGH-T739|SGH-T746|SGH-T749|SGH-T759|SGH-T769|SGH-T809|SGH-T819|SGH-T839|SGH-T919|SGH-T929|SGH-T939|SGH-T959|SGH-T989|SGH-U100|SGH-U200|SGH-U800|SGH-V205|SGH-V206|SGH-X100|SGH-X105|SGH-X120|SGH-X140|SGH-X426|SGH-X427|SGH-X475|SGH-X495|SGH-X497|SGH-X507|SGH-X600|SGH-X610|SGH-X620|SGH-X630|SGH-X700|SGH-X820|SGH-X890|SGH-Z130|SGH-Z150|SGH-Z170|SGH-ZX10|SGH-ZX20|SHW-M110|SPH-A120|SPH-A400|SPH-A420|SPH-A460|SPH-A500|SPH-A560|SPH-A600|SPH-A620|SPH-A660|SPH-A700|SPH-A740|SPH-A760|SPH-A790|SPH-A800|SPH-A820|SPH-A840|SPH-A880|SPH-A900|SPH-A940|SPH-A960|SPH-D600|SPH-D700|SPH-D710|SPH-D720|SPH-I300|SPH-I325|SPH-I330|SPH-I350|SPH-I500|SPH-I600|SPH-I700|SPH-L700|SPH-M100|SPH-M220|SPH-M240|SPH-M300|SPH-M305|SPH-M320|SPH-M330|SPH-M350|SPH-M360|SPH-M370|SPH-M380|SPH-M510|SPH-M540|SPH-M550|SPH-M560|SPH-M570|SPH-M580|SPH-M610|SPH-M620|SPH-M630|SPH-M800|SPH-M810|SPH-M850|SPH-M900|SPH-M910|SPH-M920|SPH-M930|SPH-N100|SPH-N200|SPH-N240|SPH-N300|SPH-N400|SPH-Z400|SWC-E100|SCH-i909|GT-N7100|GT-N7105|SCH-I535|SM-N900A|SGH-I317|SGH-T999L|GT-S5360B|GT-I8262|GT-S6802|GT-S6312|GT-S6310|GT-S5312|GT-S5310|GT-I9105|GT-I8510|GT-S6790N|SM-G7105|SM-N9005|GT-S5301|GT-I9295|GT-I9195|SM-C101|GT-S7392|GT-S7560|GT-B7610|GT-I5510|GT-S7582|GT-S7530E|GT-I8750|SM-G9006V|SM-G9008V|SM-G9009D|SM-G900A|SM-G900D|SM-G900F|SM-G900H|SM-G900I|SM-G900J|SM-G900K|SM-G900L|SM-G900M|SM-G900P|SM-G900R4|SM-G900S|SM-G900T|SM-G900V|SM-G900W8|SHV-E160K", LG: "\\bLG\\b;|LG[- ]?(C800|C900|E400|E610|E900|E-900|F160|F180K|F180L|F180S|730|855|L160|LS740|LS840|LS970|LU6200|MS690|MS695|MS770|MS840|MS870|MS910|P500|P700|P705|VM696|AS680|AS695|AX840|C729|E970|GS505|272|C395|E739BK|E960|L55C|L75C|LS696|LS860|P769BK|P350|P500|P509|P870|UN272|US730|VS840|VS950|LN272|LN510|LS670|LS855|LW690|MN270|MN510|P509|P769|P930|UN200|UN270|UN510|UN610|US670|US740|US760|UX265|UX840|VN271|VN530|VS660|VS700|VS740|VS750|VS910|VS920|VS930|VX9200|VX11000|AX840A|LW770|P506|P925|P999|E612|D955|D802)", Sony: "SonyST|SonyLT|SonyEricsson|SonyEricssonLT15iv|LT18i|E10i|LT28h|LT26w|SonyEricssonMT27i|C5303|C6902|C6903|C6906|C6943|D2533", Asus: "Asus.*Galaxy|PadFone.*Mobile", Micromax: "Micromax.*\\b(A210|A92|A88|A72|A111|A110Q|A115|A116|A110|A90S|A26|A51|A35|A54|A25|A27|A89|A68|A65|A57|A90)\\b", Palm: "PalmSource|Palm", Vertu: "Vertu|Vertu.*Ltd|Vertu.*Ascent|Vertu.*Ayxta|Vertu.*Constellation(F|Quest)?|Vertu.*Monika|Vertu.*Signature", Pantech: "PANTECH|IM-A850S|IM-A840S|IM-A830L|IM-A830K|IM-A830S|IM-A820L|IM-A810K|IM-A810S|IM-A800S|IM-T100K|IM-A725L|IM-A780L|IM-A775C|IM-A770K|IM-A760S|IM-A750K|IM-A740S|IM-A730S|IM-A720L|IM-A710K|IM-A690L|IM-A690S|IM-A650S|IM-A630K|IM-A600S|VEGA PTL21|PT003|P8010|ADR910L|P6030|P6020|P9070|P4100|P9060|P5000|CDM8992|TXT8045|ADR8995|IS11PT|P2030|P6010|P8000|PT002|IS06|CDM8999|P9050|PT001|TXT8040|P2020|P9020|P2000|P7040|P7000|C790", Fly: "IQ230|IQ444|IQ450|IQ440|IQ442|IQ441|IQ245|IQ256|IQ236|IQ255|IQ235|IQ245|IQ275|IQ240|IQ285|IQ280|IQ270|IQ260|IQ250", Wiko: "KITE 4G|HIGHWAY|GETAWAY|STAIRWAY|DARKSIDE|DARKFULL|DARKNIGHT|DARKMOON|SLIDE|WAX 4G|RAINBOW|BLOOM|SUNSET|GOA|LENNY|BARRY|IGGY|OZZY|CINK FIVE|CINK PEAX|CINK PEAX 2|CINK SLIM|CINK SLIM 2|CINK +|CINK KING|CINK PEAX|CINK SLIM|SUBLIM", iMobile: "i-mobile (IQ|i-STYLE|idea|ZAA|Hitz)", SimValley: "\\b(SP-80|XT-930|SX-340|XT-930|SX-310|SP-360|SP60|SPT-800|SP-120|SPT-800|SP-140|SPX-5|SPX-8|SP-100|SPX-8|SPX-12)\\b", Wolfgang: "AT-B24D|AT-AS50HD|AT-AS40W|AT-AS55HD|AT-AS45q2|AT-B26D|AT-AS50Q", Alcatel: "Alcatel", Nintendo: "Nintendo 3DS", Amoi: "Amoi", INQ: "INQ", GenericPhone: "Tapatalk|PDA;|SAGEM|\\bmmp\\b|pocket|\\bpsp\\b|symbian|Smartphone|smartfon|treo|up.browser|up.link|vodafone|\\bwap\\b|nokia|Series40|Series60|S60|SonyEricsson|N900|MAUI.*WAP.*Browser"}, tablets: {iPad: "iPad|iPad.*Mobile", NexusTablet: "Android.*Nexus[\\s]+(7|9|10)|^.*Android.*Nexus(?:(?!Mobile).)*$", SamsungTablet: "SAMSUNG.*Tablet|Galaxy.*Tab|SC-01C|GT-P1000|GT-P1003|GT-P1010|GT-P3105|GT-P6210|GT-P6800|GT-P6810|GT-P7100|GT-P7300|GT-P7310|GT-P7500|GT-P7510|SCH-I800|SCH-I815|SCH-I905|SGH-I957|SGH-I987|SGH-T849|SGH-T859|SGH-T869|SPH-P100|GT-P3100|GT-P3108|GT-P3110|GT-P5100|GT-P5110|GT-P6200|GT-P7320|GT-P7511|GT-N8000|GT-P8510|SGH-I497|SPH-P500|SGH-T779|SCH-I705|SCH-I915|GT-N8013|GT-P3113|GT-P5113|GT-P8110|GT-N8010|GT-N8005|GT-N8020|GT-P1013|GT-P6201|GT-P7501|GT-N5100|GT-N5105|GT-N5110|SHV-E140K|SHV-E140L|SHV-E140S|SHV-E150S|SHV-E230K|SHV-E230L|SHV-E230S|SHW-M180K|SHW-M180L|SHW-M180S|SHW-M180W|SHW-M300W|SHW-M305W|SHW-M380K|SHW-M380S|SHW-M380W|SHW-M430W|SHW-M480K|SHW-M480S|SHW-M480W|SHW-M485W|SHW-M486W|SHW-M500W|GT-I9228|SCH-P739|SCH-I925|GT-I9200|GT-I9205|GT-P5200|GT-P5210|GT-P5210X|SM-T311|SM-T310|SM-T310X|SM-T210|SM-T210R|SM-T211|SM-P600|SM-P601|SM-P605|SM-P900|SM-P901|SM-T217|SM-T217A|SM-T217S|SM-P6000|SM-T3100|SGH-I467|XE500|SM-T110|GT-P5220|GT-I9200X|GT-N5110X|GT-N5120|SM-P905|SM-T111|SM-T2105|SM-T315|SM-T320|SM-T320X|SM-T321|SM-T520|SM-T525|SM-T530NU|SM-T230NU|SM-T330NU|SM-T900|XE500T1C|SM-P605V|SM-P905V|SM-T337V|SM-T537V|SM-T707V|SM-T807V|SM-P600X|SM-P900X|SM-T210X|SM-T230|SM-T230X|SM-T325|GT-P7503|SM-T531|SM-T330|SM-T530|SM-T705C|SM-T535|SM-T331|SM-T800|SM-T700|SM-T537|SM-T807|SM-P907A|SM-T337A|SM-T537A|SM-T707A|SM-T807A|SM-T237P|SM-T807P|SM-P607T|SM-T217T|SM-T337T|SM-T807T", Kindle: "Kindle|Silk.*Accelerated|Android.*\\b(KFOT|KFTT|KFJWI|KFJWA|KFOTE|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|WFJWAE|KFSAWA|KFSAWI|KFASWI)\\b", SurfaceTablet: "Windows NT [0-9.]+; ARM;.*(Tablet|ARMBJS)", HPTablet: "HP Slate (7|8|10)|HP ElitePad 900|hp-tablet|EliteBook.*Touch|HP 8|Slate 21|HP SlateBook 10", AsusTablet: "^.*PadFone((?!Mobile).)*$|Transformer|TF101|TF101G|TF300T|TF300TG|TF300TL|TF700T|TF700KL|TF701T|TF810C|ME171|ME301T|ME302C|ME371MG|ME370T|ME372MG|ME172V|ME173X|ME400C|Slider SL101|\\bK00F\\b|\\bK00C\\b|\\bK00E\\b|\\bK00L\\b|TX201LA|ME176C|ME102A|\\bM80TA\\b|ME372CL|ME560CG|ME372CG|ME302KL", BlackBerryTablet: "PlayBook|RIM Tablet", HTCtablet: "HTC_Flyer_P512|HTC Flyer|HTC Jetstream|HTC-P715a|HTC EVO View 4G|PG41200|PG09410", MotorolaTablet: "xoom|sholest|MZ615|MZ605|MZ505|MZ601|MZ602|MZ603|MZ604|MZ606|MZ607|MZ608|MZ609|MZ615|MZ616|MZ617", NookTablet: "Android.*Nook|NookColor|nook browser|BNRV200|BNRV200A|BNTV250|BNTV250A|BNTV400|BNTV600|LogicPD Zoom2", AcerTablet: "Android.*; \\b(A100|A101|A110|A200|A210|A211|A500|A501|A510|A511|A700|A701|W500|W500P|W501|W501P|W510|W511|W700|G100|G100W|B1-A71|B1-710|B1-711|A1-810|A1-811|A1-830)\\b|W3-810|\\bA3-A10\\b|\\bA3-A11\\b", ToshibaTablet: "Android.*(AT100|AT105|AT200|AT205|AT270|AT275|AT300|AT305|AT1S5|AT500|AT570|AT700|AT830)|TOSHIBA.*FOLIO", LGTablet: "\\bL-06C|LG-V909|LG-V900|LG-V700|LG-V510|LG-V500|LG-V410|LG-V400|LG-VK810\\b", FujitsuTablet: "Android.*\\b(F-01D|F-02F|F-05E|F-10D|M532|Q572)\\b", PrestigioTablet: "PMP3170B|PMP3270B|PMP3470B|PMP7170B|PMP3370B|PMP3570C|PMP5870C|PMP3670B|PMP5570C|PMP5770D|PMP3970B|PMP3870C|PMP5580C|PMP5880D|PMP5780D|PMP5588C|PMP7280C|PMP7280C3G|PMP7280|PMP7880D|PMP5597D|PMP5597|PMP7100D|PER3464|PER3274|PER3574|PER3884|PER5274|PER5474|PMP5097CPRO|PMP5097|PMP7380D|PMP5297C|PMP5297C_QUAD", LenovoTablet: "Idea(Tab|Pad)( A1|A10| K1|)|ThinkPad([ ]+)?Tablet|Lenovo.*(S2109|S2110|S5000|S6000|K3011|A3000|A3500|A1000|A2107|A2109|A1107|A5500|A7600|B6000|B8000|B8080)(-|)(FL|F|HV|H|)", DellTablet: "Venue 11|Venue 8|Venue 7|Dell Streak 10|Dell Streak 7", YarvikTablet: "Android.*\\b(TAB210|TAB211|TAB224|TAB250|TAB260|TAB264|TAB310|TAB360|TAB364|TAB410|TAB411|TAB420|TAB424|TAB450|TAB460|TAB461|TAB464|TAB465|TAB467|TAB468|TAB07-100|TAB07-101|TAB07-150|TAB07-151|TAB07-152|TAB07-200|TAB07-201-3G|TAB07-210|TAB07-211|TAB07-212|TAB07-214|TAB07-220|TAB07-400|TAB07-485|TAB08-150|TAB08-200|TAB08-201-3G|TAB08-201-30|TAB09-100|TAB09-211|TAB09-410|TAB10-150|TAB10-201|TAB10-211|TAB10-400|TAB10-410|TAB13-201|TAB274EUK|TAB275EUK|TAB374EUK|TAB462EUK|TAB474EUK|TAB9-200)\\b", MedionTablet: "Android.*\\bOYO\\b|LIFE.*(P9212|P9514|P9516|S9512)|LIFETAB", ArnovaTablet: "AN10G2|AN7bG3|AN7fG3|AN8G3|AN8cG3|AN7G3|AN9G3|AN7dG3|AN7dG3ST|AN7dG3ChildPad|AN10bG3|AN10bG3DT|AN9G2", IntensoTablet: "INM8002KP|INM1010FP|INM805ND|Intenso Tab|TAB1004", IRUTablet: "M702pro", MegafonTablet: "MegaFon V9|\\bZTE V9\\b|Android.*\\bMT7A\\b", EbodaTablet: "E-Boda (Supreme|Impresspeed|Izzycomm|Essential)", AllViewTablet: "Allview.*(Viva|Alldro|City|Speed|All TV|Frenzy|Quasar|Shine|TX1|AX1|AX2)", ArchosTablet: "\\b(101G9|80G9|A101IT)\\b|Qilive 97R|Archos5|\\bARCHOS (70|79|80|90|97|101|FAMILYPAD|)(b|)(G10| Cobalt| TITANIUM(HD|)| Xenon| Neon|XSK| 2| XS 2| PLATINUM| CARBON|GAMEPAD)\\b", AinolTablet: "NOVO7|NOVO8|NOVO10|Novo7Aurora|Novo7Basic|NOVO7PALADIN|novo9-Spark", SonyTablet: "Sony.*Tablet|Xperia Tablet|Sony Tablet S|SO-03E|SGPT12|SGPT13|SGPT114|SGPT121|SGPT122|SGPT123|SGPT111|SGPT112|SGPT113|SGPT131|SGPT132|SGPT133|SGPT211|SGPT212|SGPT213|SGP311|SGP312|SGP321|EBRD1101|EBRD1102|EBRD1201|SGP351|SGP341|SGP511|SGP512|SGP521|SGP541|SGP551|SGP621|SGP612", PhilipsTablet: "\\b(PI2010|PI3000|PI3100|PI3105|PI3110|PI3205|PI3210|PI3900|PI4010|PI7000|PI7100)\\b", CubeTablet: "Android.*(K8GT|U9GT|U10GT|U16GT|U17GT|U18GT|U19GT|U20GT|U23GT|U30GT)|CUBE U8GT", CobyTablet: "MID1042|MID1045|MID1125|MID1126|MID7012|MID7014|MID7015|MID7034|MID7035|MID7036|MID7042|MID7048|MID7127|MID8042|MID8048|MID8127|MID9042|MID9740|MID9742|MID7022|MID7010", MIDTablet: "M9701|M9000|M9100|M806|M1052|M806|T703|MID701|MID713|MID710|MID727|MID760|MID830|MID728|MID933|MID125|MID810|MID732|MID120|MID930|MID800|MID731|MID900|MID100|MID820|MID735|MID980|MID130|MID833|MID737|MID960|MID135|MID860|MID736|MID140|MID930|MID835|MID733", MSITablet: "MSI \\b(Primo 73K|Primo 73L|Primo 81L|Primo 77|Primo 93|Primo 75|Primo 76|Primo 73|Primo 81|Primo 91|Primo 90|Enjoy 71|Enjoy 7|Enjoy 10)\\b", SMiTTablet: "Android.*(\\bMID\\b|MID-560|MTV-T1200|MTV-PND531|MTV-P1101|MTV-PND530)", RockChipTablet: "Android.*(RK2818|RK2808A|RK2918|RK3066)|RK2738|RK2808A", FlyTablet: "IQ310|Fly Vision", bqTablet: "(bq)?.*(Elcano|Curie|Edison|Maxwell|Kepler|Pascal|Tesla|Hypatia|Platon|Newton|Livingstone|Cervantes|Avant|Aquaris E10)|Maxwell.*Lite|Maxwell.*Plus", HuaweiTablet: "MediaPad|MediaPad 7 Youth|IDEOS S7|S7-201c|S7-202u|S7-101|S7-103|S7-104|S7-105|S7-106|S7-201|S7-Slim", NecTablet: "\\bN-06D|\\bN-08D", PantechTablet: "Pantech.*P4100", BronchoTablet: "Broncho.*(N701|N708|N802|a710)", VersusTablet: "TOUCHPAD.*[78910]|\\bTOUCHTAB\\b", ZyncTablet: "z1000|Z99 2G|z99|z930|z999|z990|z909|Z919|z900", PositivoTablet: "TB07STA|TB10STA|TB07FTA|TB10FTA", NabiTablet: "Android.*\\bNabi", KoboTablet: "Kobo Touch|\\bK080\\b|\\bVox\\b Build|\\bArc\\b Build", DanewTablet: "DSlide.*\\b(700|701R|702|703R|704|802|970|971|972|973|974|1010|1012)\\b", TexetTablet: "NaviPad|TB-772A|TM-7045|TM-7055|TM-9750|TM-7016|TM-7024|TM-7026|TM-7041|TM-7043|TM-7047|TM-8041|TM-9741|TM-9747|TM-9748|TM-9751|TM-7022|TM-7021|TM-7020|TM-7011|TM-7010|TM-7023|TM-7025|TM-7037W|TM-7038W|TM-7027W|TM-9720|TM-9725|TM-9737W|TM-1020|TM-9738W|TM-9740|TM-9743W|TB-807A|TB-771A|TB-727A|TB-725A|TB-719A|TB-823A|TB-805A|TB-723A|TB-715A|TB-707A|TB-705A|TB-709A|TB-711A|TB-890HD|TB-880HD|TB-790HD|TB-780HD|TB-770HD|TB-721HD|TB-710HD|TB-434HD|TB-860HD|TB-840HD|TB-760HD|TB-750HD|TB-740HD|TB-730HD|TB-722HD|TB-720HD|TB-700HD|TB-500HD|TB-470HD|TB-431HD|TB-430HD|TB-506|TB-504|TB-446|TB-436|TB-416|TB-146SE|TB-126SE", PlaystationTablet: "Playstation.*(Portable|Vita)", TrekstorTablet: "ST10416-1|VT10416-1|ST70408-1|ST702xx-1|ST702xx-2|ST80208|ST97216|ST70104-2|VT10416-2|ST10216-2A|SurfTab", PyleAudioTablet: "\\b(PTBL10CEU|PTBL10C|PTBL72BC|PTBL72BCEU|PTBL7CEU|PTBL7C|PTBL92BC|PTBL92BCEU|PTBL9CEU|PTBL9CUK|PTBL9C)\\b", AdvanTablet: "Android.* \\b(E3A|T3X|T5C|T5B|T3E|T3C|T3B|T1J|T1F|T2A|T1H|T1i|E1C|T1-E|T5-A|T4|E1-B|T2Ci|T1-B|T1-D|O1-A|E1-A|T1-A|T3A|T4i)\\b ", DanyTechTablet: "Genius Tab G3|Genius Tab S2|Genius Tab Q3|Genius Tab G4|Genius Tab Q4|Genius Tab G-II|Genius TAB GII|Genius TAB GIII|Genius Tab S1", GalapadTablet: "Android.*\\bG1\\b", MicromaxTablet: "Funbook|Micromax.*\\b(P250|P560|P360|P362|P600|P300|P350|P500|P275)\\b", KarbonnTablet: "Android.*\\b(A39|A37|A34|ST8|ST10|ST7|Smart Tab3|Smart Tab2)\\b", AllFineTablet: "Fine7 Genius|Fine7 Shine|Fine7 Air|Fine8 Style|Fine9 More|Fine10 Joy|Fine11 Wide", PROSCANTablet: "\\b(PEM63|PLT1023G|PLT1041|PLT1044|PLT1044G|PLT1091|PLT4311|PLT4311PL|PLT4315|PLT7030|PLT7033|PLT7033D|PLT7035|PLT7035D|PLT7044K|PLT7045K|PLT7045KB|PLT7071KG|PLT7072|PLT7223G|PLT7225G|PLT7777G|PLT7810K|PLT7849G|PLT7851G|PLT7852G|PLT8015|PLT8031|PLT8034|PLT8036|PLT8080K|PLT8082|PLT8088|PLT8223G|PLT8234G|PLT8235G|PLT8816K|PLT9011|PLT9045K|PLT9233G|PLT9735|PLT9760G|PLT9770G)\\b", YONESTablet: "BQ1078|BC1003|BC1077|RK9702|BC9730|BC9001|IT9001|BC7008|BC7010|BC708|BC728|BC7012|BC7030|BC7027|BC7026", ChangJiaTablet: "TPC7102|TPC7103|TPC7105|TPC7106|TPC7107|TPC7201|TPC7203|TPC7205|TPC7210|TPC7708|TPC7709|TPC7712|TPC7110|TPC8101|TPC8103|TPC8105|TPC8106|TPC8203|TPC8205|TPC8503|TPC9106|TPC9701|TPC97101|TPC97103|TPC97105|TPC97106|TPC97111|TPC97113|TPC97203|TPC97603|TPC97809|TPC97205|TPC10101|TPC10103|TPC10106|TPC10111|TPC10203|TPC10205|TPC10503", GUTablet: "TX-A1301|TX-M9002|Q702|kf026", PointOfViewTablet: "TAB-P506|TAB-navi-7-3G-M|TAB-P517|TAB-P-527|TAB-P701|TAB-P703|TAB-P721|TAB-P731N|TAB-P741|TAB-P825|TAB-P905|TAB-P925|TAB-PR945|TAB-PL1015|TAB-P1025|TAB-PI1045|TAB-P1325|TAB-PROTAB[0-9]+|TAB-PROTAB25|TAB-PROTAB26|TAB-PROTAB27|TAB-PROTAB26XL|TAB-PROTAB2-IPS9|TAB-PROTAB30-IPS9|TAB-PROTAB25XXL|TAB-PROTAB26-IPS10|TAB-PROTAB30-IPS10", OvermaxTablet: "OV-(SteelCore|NewBase|Basecore|Baseone|Exellen|Quattor|EduTab|Solution|ACTION|BasicTab|TeddyTab|MagicTab|Stream|TB-08|TB-09)", HCLTablet: "HCL.*Tablet|Connect-3G-2.0|Connect-2G-2.0|ME Tablet U1|ME Tablet U2|ME Tablet G1|ME Tablet X1|ME Tablet Y2|ME Tablet Sync", DPSTablet: "DPS Dream 9|DPS Dual 7", VistureTablet: "V97 HD|i75 3G|Visture V4( HD)?|Visture V5( HD)?|Visture V10", CrestaTablet: "CTP(-)?810|CTP(-)?818|CTP(-)?828|CTP(-)?838|CTP(-)?888|CTP(-)?978|CTP(-)?980|CTP(-)?987|CTP(-)?988|CTP(-)?989", MediatekTablet: "\\bMT8125|MT8389|MT8135|MT8377\\b", ConcordeTablet: "Concorde([ ]+)?Tab|ConCorde ReadMan", GoCleverTablet: "GOCLEVER TAB|A7GOCLEVER|M1042|M7841|M742|R1042BK|R1041|TAB A975|TAB A7842|TAB A741|TAB A741L|TAB M723G|TAB M721|TAB A1021|TAB I921|TAB R721|TAB I720|TAB T76|TAB R70|TAB R76.2|TAB R106|TAB R83.2|TAB M813G|TAB I721|GCTA722|TAB I70|TAB I71|TAB S73|TAB R73|TAB R74|TAB R93|TAB R75|TAB R76.1|TAB A73|TAB A93|TAB A93.2|TAB T72|TAB R83|TAB R974|TAB R973|TAB A101|TAB A103|TAB A104|TAB A104.2|R105BK|M713G|A972BK|TAB A971|TAB R974.2|TAB R104|TAB R83.3|TAB A1042", ModecomTablet: "FreeTAB 9000|FreeTAB 7.4|FreeTAB 7004|FreeTAB 7800|FreeTAB 2096|FreeTAB 7.5|FreeTAB 1014|FreeTAB 1001 |FreeTAB 8001|FreeTAB 9706|FreeTAB 9702|FreeTAB 7003|FreeTAB 7002|FreeTAB 1002|FreeTAB 7801|FreeTAB 1331|FreeTAB 1004|FreeTAB 8002|FreeTAB 8014|FreeTAB 9704|FreeTAB 1003", VoninoTablet: "\\b(Argus[ _]?S|Diamond[ _]?79HD|Emerald[ _]?78E|Luna[ _]?70C|Onyx[ _]?S|Onyx[ _]?Z|Orin[ _]?HD|Orin[ _]?S|Otis[ _]?S|SpeedStar[ _]?S|Magnet[ _]?M9|Primus[ _]?94[ _]?3G|Primus[ _]?94HD|Primus[ _]?QS|Android.*\\bQ8\\b|Sirius[ _]?EVO[ _]?QS|Sirius[ _]?QS|Spirit[ _]?S)\\b", ECSTablet: "V07OT2|TM105A|S10OT1|TR10CS1", StorexTablet: "eZee[_']?(Tab|Go)[0-9]+|TabLC7|Looney Tunes Tab", VodafoneTablet: "SmartTab([ ]+)?[0-9]+|SmartTabII10|SmartTabII7", EssentielBTablet: "Smart[ ']?TAB[ ]+?[0-9]+|Family[ ']?TAB2", RossMoorTablet: "RM-790|RM-997|RMD-878G|RMD-974R|RMT-705A|RMT-701|RME-601|RMT-501|RMT-711", iMobileTablet: "i-mobile i-note", TolinoTablet: "tolino tab [0-9.]+|tolino shine", AudioSonicTablet: "\\bC-22Q|T7-QC|T-17B|T-17P\\b", AMPETablet: "Android.* A78 ", SkkTablet: "Android.* (SKYPAD|PHOENIX|CYCLOPS)", TecnoTablet: "TECNO P9", JXDTablet: "Android.*\\b(F3000|A3300|JXD5000|JXD3000|JXD2000|JXD300B|JXD300|S5800|S7800|S602b|S5110b|S7300|S5300|S602|S603|S5100|S5110|S601|S7100a|P3000F|P3000s|P101|P200s|P1000m|P200m|P9100|P1000s|S6600b|S908|P1000|P300|S18|S6600|S9100)\\b", iJoyTablet: "Tablet (Spirit 7|Essentia|Galatea|Fusion|Onix 7|Landa|Titan|Scooby|Deox|Stella|Themis|Argon|Unique 7|Sygnus|Hexen|Finity 7|Cream|Cream X2|Jade|Neon 7|Neron 7|Kandy|Scape|Saphyr 7|Rebel|Biox|Rebel|Rebel 8GB|Myst|Draco 7|Myst|Tab7-004|Myst|Tadeo Jones|Tablet Boing|Arrow|Draco Dual Cam|Aurix|Mint|Amity|Revolution|Finity 9|Neon 9|T9w|Amity 4GB Dual Cam|Stone 4GB|Stone 8GB|Andromeda|Silken|X2|Andromeda II|Halley|Flame|Saphyr 9,7|Touch 8|Planet|Triton|Unique 10|Hexen 10|Memphis 4GB|Memphis 8GB|Onix 10)", FX2Tablet: "FX2 PAD7|FX2 PAD10", XoroTablet: "KidsPAD 701|PAD[ ]?712|PAD[ ]?714|PAD[ ]?716|PAD[ ]?717|PAD[ ]?718|PAD[ ]?720|PAD[ ]?721|PAD[ ]?722|PAD[ ]?790|PAD[ ]?792|PAD[ ]?900|PAD[ ]?9715D|PAD[ ]?9716DR|PAD[ ]?9718DR|PAD[ ]?9719QR|PAD[ ]?9720QR|TelePAD1030|Telepad1032|TelePAD730|TelePAD731|TelePAD732|TelePAD735Q|TelePAD830|TelePAD9730|TelePAD795|MegaPAD 1331|MegaPAD 1851|MegaPAD 2151", ViewsonicTablet: "ViewPad 10pi|ViewPad 10e|ViewPad 10s|ViewPad E72|ViewPad7|ViewPad E100|ViewPad 7e|ViewSonic VB733|VB100a", OdysTablet: "LOOX|XENO10|ODYS[ -](Space|EVO|Xpress|NOON)|\\bXELIO\\b|Xelio10Pro|XELIO7PHONETAB|XELIO10EXTREME|XELIOPT2|NEO_QUAD10", CaptivaTablet: "CAPTIVA PAD", IconbitTablet: "NetTAB|NT-3702|NT-3702S|NT-3702S|NT-3603P|NT-3603P|NT-0704S|NT-0704S|NT-3805C|NT-3805C|NT-0806C|NT-0806C|NT-0909T|NT-0909T|NT-0907S|NT-0907S|NT-0902S|NT-0902S", TeclastTablet: "T98 4G|\\bP80\\b|\\bX90HD\\b|X98 Air|X98 Air 3G|\\bX89\\b|P80 3G|\\bX80h\\b|P98 Air|\\bX89HD\\b|P98 3G|\\bP90HD\\b|P89 3G|X98 3G|\\bP70h\\b|P79HD 3G|G18d 3G|\\bP79HD\\b|\\bP89s\\b|\\bA88\\b|\\bP10HD\\b|\\bP19HD\\b|G18 3G|\\bP78HD\\b|\\bA78\\b|\\bP75\\b|G17s 3G|G17h 3G|\\bP85t\\b|\\bP90\\b|\\bP11\\b|\\bP98t\\b|\\bP98HD\\b|\\bG18d\\b|\\bP85s\\b|\\bP11HD\\b|\\bP88s\\b|\\bA80HD\\b|\\bA80se\\b|\\bA10h\\b|\\bP89\\b|\\bP78s\\b|\\bG18\\b|\\bP85\\b|\\bA70h\\b|\\bA70\\b|\\bG17\\b|\\bP18\\b|\\bA80s\\b|\\bA11s\\b|\\bP88HD\\b|\\bA80h\\b|\\bP76s\\b|\\bP76h\\b|\\bP98\\b|\\bA10HD\\b|\\bP78\\b|\\bP88\\b|\\bA11\\b|\\bA10t\\b|\\bP76a\\b|\\bP76t\\b|\\bP76e\\b|\\bP85HD\\b|\\bP85a\\b|\\bP86\\b|\\bP75HD\\b|\\bP76v\\b|\\bA12\\b|\\bP75a\\b|\\bA15\\b|\\bP76Ti\\b|\\bP81HD\\b|\\bA10\\b|\\bT760VE\\b|\\bT720HD\\b|\\bP76\\b|\\bP73\\b|\\bP71\\b|\\bP72\\b|\\bT720SE\\b|\\bC520Ti\\b|\\bT760\\b|\\bT720VE\\b|T720-3GE|T720-WiFi", OndaTablet: "\\b(V975i|Vi30|VX530|V701|Vi60|V701s|Vi50|V801s|V719|Vx610w|VX610W|V819i|Vi10|VX580W|Vi10|V711s|V813|V811|V820w|V820|Vi20|V711|VI30W|V712|V891w|V972|V819w|V820w|Vi60|V820w|V711|V813s|V801|V819|V975s|V801|V819|V819|V818|V811|V712|V975m|V101w|V961w|V812|V818|V971|V971s|V919|V989|V116w|V102w|V973|Vi40)\\b[\\s]+", JaytechTablet: "TPC-PA762", BlaupunktTablet: "Endeavour 800NG|Endeavour 1010", DigmaTablet: "\\b(iDx10|iDx9|iDx8|iDx7|iDxD7|iDxD8|iDsQ8|iDsQ7|iDsQ8|iDsD10|iDnD7|3TS804H|iDsQ11|iDj7|iDs10)\\b", EvolioTablet: "ARIA_Mini_wifi|Aria[ _]Mini|Evolio X10|Evolio X7|Evolio X8|\\bEvotab\\b|\\bNeura\\b", LavaTablet: "QPAD E704|\\bIvoryS\\b|E-TAB IVORY", CelkonTablet: "CT695|CT888|CT[\\s]?910|CT7 Tab|CT9 Tab|CT3 Tab|CT2 Tab|CT1 Tab|C820|C720|\\bCT-1\\b", WolderTablet: "miTab \\b(DIAMOND|SPACE|BROOKLYN|NEO|FLY|MANHATTAN|FUNK|EVOLUTION|SKY|GOCAR|IRON|GENIUS|POP|MINT|EPSILON|BROADWAY|JUMP|HOP|LEGEND|NEW AGE|LINE|ADVANCE|FEEL|FOLLOW|LIKE|LINK|LIVE|THINK|FREEDOM|CHICAGO|CLEVELAND|BALTIMORE-GH|IOWA|BOSTON|SEATTLE|PHOENIX|DALLAS|IN 101|MasterChef)\\b", MiTablet: "\\bMI PAD\\b|\\bHM NOTE 1W\\b", NibiruTablet: "Nibiru M1|Nibiru Jupiter One", NexoTablet: "NEXO NOVA|NEXO 10|NEXO AVIO|NEXO FREE|NEXO GO|NEXO EVO|NEXO 3G|NEXO SMART|NEXO KIDDO|NEXO MOBI", UbislateTablet: "UbiSlate[\\s]?7C", PocketBookTablet: "Pocketbook", Hudl: "Hudl HT7S3", TelstraTablet: "T-Hub2", GenericTablet: "Android.*\\b97D\\b|Tablet(?!.*PC)|BNTV250A|MID-WCDMA|LogicPD Zoom2|\\bA7EB\\b|CatNova8|A1_07|CT704|CT1002|\\bM721\\b|rk30sdk|\\bEVOTAB\\b|M758A|ET904|ALUMIUM10|Smartfren Tab|Endeavour 1010|Tablet-PC-4|Tagi Tab|\\bM6pro\\b|CT1020W|arc 10HD|\\bJolla\\b"}, oss: {AndroidOS: "Android", BlackBerryOS: "blackberry|\\bBB10\\b|rim tablet os", PalmOS: "PalmOS|avantgo|blazer|elaine|hiptop|palm|plucker|xiino", SymbianOS: "Symbian|SymbOS|Series60|Series40|SYB-[0-9]+|\\bS60\\b", WindowsMobileOS: "Windows CE.*(PPC|Smartphone|Mobile|[0-9]{3}x[0-9]{3})|Window Mobile|Windows Phone [0-9.]+|WCE;", WindowsPhoneOS: "Windows Phone 8.1|Windows Phone 8.0|Windows Phone OS|XBLWP7|ZuneWP7|Windows NT 6.[23]; ARM;", iOS: "\\biPhone.*Mobile|\\biPod|\\biPad", MeeGoOS: "MeeGo", MaemoOS: "Maemo", JavaOS: "J2ME/|\\bMIDP\\b|\\bCLDC\\b", webOS: "webOS|hpwOS", badaOS: "\\bBada\\b", BREWOS: "BREW"}, uas: {Chrome: "\\bCrMo\\b|CriOS|Android.*Chrome/[.0-9]* (Mobile)?", Dolfin: "\\bDolfin\\b", Opera: "Opera.*Mini|Opera.*Mobi|Android.*Opera|Mobile.*OPR/[0-9.]+|Coast/[0-9.]+", Skyfire: "Skyfire", IE: "IEMobile|MSIEMobile", Firefox: "fennec|firefox.*maemo|(Mobile|Tablet).*Firefox|Firefox.*Mobile", Bolt: "bolt", TeaShark: "teashark", Blazer: "Blazer", Safari: "Version.*Mobile.*Safari|Safari.*Mobile|MobileSafari", Tizen: "Tizen", UCBrowser: "UC.*Browser|UCWEB", baiduboxapp: "baiduboxapp", baidubrowser: "baidubrowser", DiigoBrowser: "DiigoBrowser", Puffin: "Puffin", Mercury: "\\bMercury\\b", ObigoBrowser: "Obigo", NetFront: "NF-Browser", GenericBrowser: "NokiaBrowser|OviBrowser|OneBrowser|TwonkyBeamBrowser|SEMC.*Browser|FlyFlow|Minimo|NetFront|Novarra-Vision|MQQBrowser|MicroMessenger"}, props: {Mobile: "Mobile/[VER]", Build: "Build/[VER]", Version: "Version/[VER]", VendorID: "VendorID/[VER]", iPad: "iPad.*CPU[a-z ]+[VER]", iPhone: "iPhone.*CPU[a-z ]+[VER]", iPod: "iPod.*CPU[a-z ]+[VER]", Kindle: "Kindle/[VER]", Chrome: ["Chrome/[VER]", "CriOS/[VER]", "CrMo/[VER]"], Coast: ["Coast/[VER]"], Dolfin: "Dolfin/[VER]", Firefox: "Firefox/[VER]", Fennec: "Fennec/[VER]", IE: ["IEMobile/[VER];", "IEMobile [VER]", "MSIE [VER];", "Trident/[0-9.]+;.*rv:[VER]"], NetFront: "NetFront/[VER]", NokiaBrowser: "NokiaBrowser/[VER]", Opera: [" OPR/[VER]", "Opera Mini/[VER]", "Version/[VER]"], "Opera Mini": "Opera Mini/[VER]", "Opera Mobi": "Version/[VER]", "UC Browser": "UC Browser[VER]", MQQBrowser: "MQQBrowser/[VER]", MicroMessenger: "MicroMessenger/[VER]", baiduboxapp: "baiduboxapp/[VER]", baidubrowser: "baidubrowser/[VER]", Iron: "Iron/[VER]", Safari: ["Version/[VER]", "Safari/[VER]"], Skyfire: "Skyfire/[VER]", Tizen: "Tizen/[VER]", Webkit: "webkit[ /][VER]", Gecko: "Gecko/[VER]", Trident: "Trident/[VER]", Presto: "Presto/[VER]", iOS: " \\bi?OS\\b [VER][ ;]{1}", Android: "Android [VER]", BlackBerry: ["BlackBerry[\\w]+/[VER]", "BlackBerry.*Version/[VER]", "Version/[VER]"], BREW: "BREW [VER]", Java: "Java/[VER]", "Windows Phone OS": ["Windows Phone OS [VER]", "Windows Phone [VER]"], "Windows Phone": "Windows Phone [VER]", "Windows CE": "Windows CE/[VER]", "Windows NT": "Windows NT [VER]", Symbian: ["SymbianOS/[VER]", "Symbian/[VER]"], webOS: ["webOS/[VER]", "hpwOS/[VER];"]}, utils: {Bot: "Googlebot|facebookexternalhit|AdsBot-Google|Google Keyword Suggestion|Facebot|YandexBot|bingbot|ia_archiver|AhrefsBot|Ezooms|GSLFbot|WBSearchBot|Twitterbot|TweetmemeBot|Twikle|PaperLiBot|Wotbox|UnwindFetchor", MobileBot: "Googlebot-Mobile|AdsBot-Google-Mobile|YahooSeeker/M1A1-R2D2", DesktopMode: "WPDesktop", TV: "SonyDTV|HbbTV", WebKit: "(webkit)[ /]([\\w.]+)", Console: "\\b(Nintendo|Nintendo WiiU|Nintendo 3DS|PLAYSTATION|Xbox)\\b", Watch: "SM-V700"}}, e.detectMobileBrowsers = {fullPattern: /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i, shortPattern: /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i};
        var f, g = Object.prototype.hasOwnProperty;
        return e.FALLBACK_PHONE = "UnknownPhone", e.FALLBACK_TABLET = "UnknownTablet", e.FALLBACK_MOBILE = "UnknownMobile", f = "isArray"in Array ? Array.isArray : function (a) {
            return"[object Array]" === Object.prototype.toString.call(a)
        }, function () {
            var a, b, d, h, i, j, k = e.mobileDetectRules;
            for (a in k.props)if (g.call(k.props, a)) {
                for (b = k.props[a], f(b) || (b = [b]), i = b.length, h = 0; i > h; ++h)d = b[h], j = d.indexOf("[VER]"), j >= 0 && (d = d.substring(0, j) + "([\\w._\\+]+)" + d.substring(j + 5)), b[h] = new RegExp(d, "i");
                k.props[a] = b
            }
            c(k.oss), c(k.phones), c(k.tablets), c(k.uas), c(k.utils), k.oss0 = {WindowsPhoneOS: k.oss.WindowsPhoneOS, WindowsMobileOS: k.oss.WindowsMobileOS}
        }(), e.findMatch = function (a, b) {
            for (var c in a)if (g.call(a, c) && a[c].test(b))return c;
            return null
        }, e.getVersionStr = function (a, b) {
            var c, d, f, h, i = e.mobileDetectRules.props;
            if (g.call(i, a))for (c = i[a], f = c.length, d = 0; f > d; ++d)if (h = c[d].exec(b), null !== h)return h[1];
            return null
        }, e.getVersion = function (a, b) {
            var c = e.getVersionStr(a, b);
            return c ? e.prepareVersionNo(c) : NaN
        }, e.prepareVersionNo = function (a) {
            var b;
            return b = a.split(/[a-z._ \/\-]/i), 1 === b.length && (a = b[0]), b.length > 1 && (a = b[0] + ".", b.shift(), a += b.join("")), Number(a)
        }, e.isMobileFallback = function (a) {
            return e.detectMobileBrowsers.fullPattern.test(a) || e.detectMobileBrowsers.shortPattern.test(a.substr(0, 4))
        }, e.prepareDetectionCache = function (a, c, f) {
            if (a.mobile === b) {
                var g, h, i;
                return(h = e.findMatch(e.mobileDetectRules.tablets, c)) ? (a.mobile = a.tablet = h, void(a.phone = null)) : (g = e.findMatch(e.mobileDetectRules.phones, c)) ? (a.mobile = a.phone = g, void(a.tablet = null)) : void(e.isMobileFallback(c) ? (i = d.isPhoneSized(f), i === b ? (a.mobile = e.FALLBACK_MOBILE, a.tablet = a.phone = null) : i ? (a.mobile = a.phone = e.FALLBACK_PHONE, a.tablet = null) : (a.mobile = a.tablet = e.FALLBACK_TABLET, a.phone = null)) : a.mobile = a.tablet = a.phone = null)
            }
        }, e.mobileGrade = function (a) {
            var b = null !== a.mobile();
            return a.os("iOS") && a.version("iPad") >= 4.3 || a.os("iOS") && a.version("iPhone") >= 3.1 || a.os("iOS") && a.version("iPod") >= 3.1 || a.version("Android") > 2.1 && a.is("Webkit") || a.version("Windows Phone OS") >= 7 || a.is("BlackBerry") && a.version("BlackBerry") >= 6 || a.match("Playbook.*Tablet") || a.version("webOS") >= 1.4 && a.match("Palm|Pre|Pixi") || a.match("hp.*TouchPad") || a.is("Firefox") && a.version("Firefox") >= 12 || a.is("Chrome") && a.is("AndroidOS") && a.version("Android") >= 4 || a.is("Skyfire") && a.version("Skyfire") >= 4.1 && a.is("AndroidOS") && a.version("Android") >= 2.3 || a.is("Opera") && a.version("Opera Mobi") > 11 && a.is("AndroidOS") || a.is("MeeGoOS") || a.is("Tizen") || a.is("Dolfin") && a.version("Bada") >= 2 || (a.is("UC Browser") || a.is("Dolfin")) && a.version("Android") >= 2.3 || a.match("Kindle Fire") || a.is("Kindle") && a.version("Kindle") >= 3 || a.is("AndroidOS") && a.is("NookTablet") || a.version("Chrome") >= 11 && !b || a.version("Safari") >= 5 && !b || a.version("Firefox") >= 4 && !b || a.version("MSIE") >= 7 && !b || a.version("Opera") >= 10 && !b ? "A" : a.os("iOS") && a.version("iPad") < 4.3 || a.os("iOS") && a.version("iPhone") < 3.1 || a.os("iOS") && a.version("iPod") < 3.1 || a.is("Blackberry") && a.version("BlackBerry") >= 5 && a.version("BlackBerry") < 6 || a.version("Opera Mini") >= 5 && a.version("Opera Mini") <= 6.5 && (a.version("Android") >= 2.3 || a.is("iOS")) || a.match("NokiaN8|NokiaC7|N97.*Series60|Symbian/3") || a.version("Opera Mobi") >= 11 && a.is("SymbianOS") ? "B" : (a.version("BlackBerry") < 5 || a.match("MSIEMobile|Windows CE.*Mobile") || a.version("Windows Mobile") <= 5.2,
                "C")
        }, e.detectOS = function (a) {
            return e.findMatch(e.mobileDetectRules.oss0, a) || e.findMatch(e.mobileDetectRules.oss, a)
        }, e.getDeviceSmallerSide = function () {
            return window.screen.width < window.screen.height ? window.screen.width : window.screen.height
        }, d.prototype = {constructor: d, mobile: function () {
            return e.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth), this._cache.mobile
        }, phone: function () {
            return e.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth), this._cache.phone
        }, tablet: function () {
            return e.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth), this._cache.tablet
        }, userAgent: function () {
            return this._cache.userAgent === b && (this._cache.userAgent = e.findMatch(e.mobileDetectRules.uas, this.ua)), this._cache.userAgent
        }, os: function () {
            return this._cache.os === b && (this._cache.os = e.detectOS(this.ua)), this._cache.os
        }, version: function (a) {
            return e.getVersion(a, this.ua)
        }, versionStr: function (a) {
            return e.getVersionStr(a, this.ua)
        }, is: function (b) {
            return a(b, this.userAgent()) || a(b, this.os()) || a(b, this.phone()) || a(b, this.tablet()) || a(b, e.findMatch(e.mobileDetectRules.utils, this.ua))
        }, match: function (a) {
            return a instanceof RegExp || (a = new RegExp(a, "i")), a.test(this.ua)
        }, isPhoneSized: function (a) {
            return d.isPhoneSized(a || this.maxPhoneWidth)
        }, mobileGrade: function () {
            return this._cache.grade === b && (this._cache.grade = e.mobileGrade(this)), this._cache.grade
        }}, "undefined" != typeof window && window.screen ? d.isPhoneSized = function (a) {
            return 0 > a ? b : e.getDeviceSmallerSide() <= a
        } : d.isPhoneSized = function () {
        }, d._impl = e, d
    })
}(function (a) {
        if ("undefined" != typeof module && module.exports)return function (a) {
            module.exports = a()
        };
        if ("function" == typeof define && define.amd)return define;
        if ("undefined" != typeof window)return function (a) {
            window.MobileDetect = a()
        };
        throw new Error("unknown environment")
    }());
var SPB = SPB || {};

SPB.constants = {
    'desktop_min_width': 992,
    'tablet_min_width': 560,
    'banner_block_height': 440
};
var spb_scripts = spb_scripts || {};

/* helpers (start) */
spb_scripts.helpers = {

    // возвращает тип устройства
    getUserViewDevice: function () {
        var md = new MobileDetect(window.navigator.userAgent);

        if (md.phone()) {
            return 'mobile';
        }

        if (md.tablet()) {
            return 'tablet';
        }

        return 'desktop';
    },

    // возвращает текущий брейкпоинт
    getUserViewWidthDevice: function () {
        var md = new MobileDetect(window.navigator.userAgent);

        if (md.phone() || document.width < SPB.constants.tablet_min_width) {
            return 'mobile';
        }

        if (md.tablet() || document.width < SPB.constants.desktop_min_width) {
            return 'tablet';
        }

        return 'desktop';
    },

    matchMediaQueries: function (MediaQueries) {
        return window.matchMedia(MediaQueries).matches;
    },

    getCurrentCssDisplayClass: function (displayClass) {
        var result;
        if (typeof displayClass == undefined) {
            if (spb_scripts.helpers.matchMediaQueries('(min-width: 1200px)')) {
                result = 'lg';
            } else if (spb_scripts.helpers.matchMediaQueries('(min-width: 992px) and (max-width: 1199px)')) {
                result = 'md';
            } else if (spb_scripts.helpers.matchMediaQueries('(min-width: 561px) and (max-width: 992px)')) {
                result = 'sm';
            } else if (spb_scripts.helpers.matchMediaQueries('(max-width: 560px)')) {
                result = 'xs';
            }
        } else {
            result = false;
            if (spb_scripts.helpers.matchMediaQueries('(min-width: 1200px)') && displayClass == 'lg') {
                result = true;
            } else if (spb_scripts.helpers.matchMediaQueries('(min-width: 992px) and (max-width: 1199px)') && displayClass == 'md') {
                result = true;
            } else if (spb_scripts.helpers.matchMediaQueries('(min-width: 561px) and (max-width: 992px)') && displayClass == 'sm') {
                result = true;
            } else if (spb_scripts.helpers.matchMediaQueries('(max-width: 560px)') && displayClass == 'xs') {
                result = true;
            }
        }
        return result;
    },

    // проверяем юзер агент на оперу мини
    isOperaMini: function () {
        if (navigator.userAgent.indexOf('Opera Mini') != -1) {
            return true;
        } else {
            return false;
        }
    },

    // Подстановка картинки взависимости от DevicePixelRatio
    getImagesByDevicePixelRatio: function (elem) {
        var ratio = 1;
        var $elem = $(elem);
        var image_x1 = $elem.data('ratio-x1');
        var image_x2 = $elem.data('ratio-x2');
        var src = $elem.attr('src');

        if (typeof window.devicePixelRatio == "number") {
            ratio = window.devicePixelRatio;
        }

        if (src == image_x1 || src == image_x2) {
            // Проверка на уже изменёный src,
            // т.к. при изменении src срабатывает событие onload и меняет src и далее до бесконечности
            return;

        }

        if (ratio == 1 || image_x2 == '') {
            $elem.attr('src', image_x1);
        } else {
            $elem.attr('src', image_x2);
        }
    }

};
/* helpers (end) */

var spb_scripts = spb_scripts || {};

/* читаем Cookie */
function sb_c_res_def_getCookie(name) {
    var cookie = " " + document.cookie,
        search = " " + name + "=",
        set_str = null,
        offset = 0,
        end = 0;

    if (cookie.length > 0) {
        offset = cookie.indexOf(search);

        if (offset != -1) {
            offset += search.length;
            end = cookie.indexOf(";", offset);

            if (end == -1) end = cookie.length;

            set_str = unescape(cookie.substring(offset, end));
        }
    }

    return(set_str);
}

/* ставим Cookie */
function sb_c_res_def_setCookie(name, expire) {
    var now = new Date();

    if (!expire)
        var expire = new Date(now.getTime() + 3600000);

    document.cookie = name + '; path=/; expires=' + expire.toGMTString();
}

/* кнопка скролла наверх */
spb_scripts.scrollTopBtn = {
    init: function () {
        var self = spb_scripts.scrollTopBtn;
        self.$btn = $('#scroll-top-btn');
        self.binds();
        self.scrollShowBtn();
    },
    binds: function () {
        var self = spb_scripts.scrollTopBtn;
        self.$btn.on('click', self.scrollTop);
        $(window).on('scroll', self.scrollShowBtn);
    },
    scrollShowBtn: function () {
        var self = spb_scripts.scrollTopBtn;
        if (500 < window.pageYOffset) {
            if (!self.$btn.is('.show')) {
                self.$btn.addClass('show');
            }
        } else {
            if (self.$btn.is('.show')) {
                self.$btn.removeClass('show');
            }
        }
    },
    scrollTop: function () {
        var self = spb_scripts.scrollTopBtn;
        window.scrollTo(0, 0);
        return false;
    }
};

$(document).ready(function () {
    var actuallyNews = $('.b-actually__item');

    $.each(actuallyNews, function () {
        var elem = $(this);
        var comments = elem.next().detach();
        elem.append(comments);
    });

    var moreTopVideosObj = {
        limit: 32,
        offset: 16
    };

    $('.b-recommendations__link a, .b-recommendations__title').on('click', function (event) {
        var elem = $(this);
        var type = elem.data('type');

        if (!type) {
            return;
        }
        event.preventDefault();

        $('.list-block').removeClass('active');
        $('#' + type).addClass('active');

        $('.b-recommendations__link a, .b-recommendations__title').removeClass('active');
        elem.addClass('active');

        $('.more-btn-topvideos').removeClass('active');
        $('#more-' + type).addClass('active');
    });

    $('.b-recommendations__list').on('click', '.more-btn-topvideos', function (event) {
        var elem = $(this);
        var isOnLoad = false;
        var i = 0;
        var topVideosBlock = $('.b-recommendations__list .list-block.active').eq(0);
        var url = $(this).data('href');
        moreTopVideosObj.offset = topVideosBlock.find('.cell').length;

        event.preventDefault();

        $.ajax({
            url: url,
            type: 'post',
            beforeSend: function (xhr) {
                if (isOnLoad) {
                    xhr.abort();
                }
                isOnLoad = true;
                elem.addClass('loading');
            },
            success: function (response) {
                var $response = $(response);
                var moreBtn = $response.find('.more-btn');

                if (response === '' || (!$($response[0]).hasClass('cell'))) {
                    isOnLoad = false;
                    elem.removeClass('loading').addClass('hide');
                    return;
                }
                elem.replaceWith(moreBtn);
                topVideosBlock.append('<span class="col-lg-12" style="height: 15px; display: block;">').append(response);
                topVideosBlock.find('.more-btn').remove();
                topVideosBlock.find('.cell').css('display', 'block');
                elem.removeClass('loading');
                isOnLoad = false;
                i++;
            },
            error: function () {
                isOnLoad = false;
                i++;
                topVideosBlock.removeClass('loading');
                return;
            }
        });
    });


    // актуальное, подгрузка
    $('#b-actualy').on('click', '.more-btn', function (event) {
        var elem = $(this);
        var actuallyBlock = $('#b-actualy');
        var isOnLoad = false;
        var page_size = 36;
        var i = 0;
        var page_offset = $('.b-actually__item').length;
        var term_id = actuallyBlock.data('tid') ? actuallyBlock.data('tid') : false;

        event.preventDefault();

        $.ajax({
            url: '/actual/more',
            type: 'GET',
            data: {
                'page_size': page_size,
                'page_offset': page_offset,
                'term_id': term_id
            },
            beforeSend: function (xhr) {
                if (isOnLoad) {
                    xhr.abort();
                }
                isOnLoad = true;
                elem.addClass('loading');
            },
            success: function (response) {
                var moreBtn = $(response).find('.more-btn');
                if (response === '') {
                    actuallyBlock = false;
                    elem.remove();
                    return;
                }
                elem.remove();
                actuallyBlock.append('<div class="col-lg-12" style="height: 15px">').append(response);
                isOnLoad = false;
                i++;
            },
            error: function () {
                isOnLoad = false;
                i++;
                elem.remove();
                return;
            }
        });
    });
});


/* Подгрузка новостей рубрики по кнопке ЕЩЕ в правом блоке (start) */
$(document).ready(function () {
    var newsRubricBlock = $('.rubric-news');
    var newsListBlock;
    var termId;
    var limit = 30;
    var isOnLoad = false;
    var i = 0;
    var moreBtn = $('.rubric-news__more');

    var loadMoreNews = function (elem) {
        newsListBlock = elem.find('.rubric-news__list');
        var offset = newsRubricBlock.find('li').length;

        $.ajax({
            url: '/news/more/' + termId + '/' + limit + '/' + offset,
            beforeSend: function (xhr) {
                if (isOnLoad) {
                    xhr.abort();
                }
                isOnLoad = true;
                newsListBlock.addClass('loading');
            },
            success: function (response) {
                newsListBlock.append(response);
                isOnLoad = false;
                i++;
                newsListBlock.removeClass('loading');
                if (i <= 3) {
                    moreBtn.css('display', 'block');
                }
            },
            error: function () {
                isOnLoad = false;
                i++;
                newsListBlock.removeClass('loading');
                if (i <= 3) {
                    moreBtn.css('display', 'block');
                }
                return;
            }
        });
    };

    newsRubricBlock.on('click', '.rubric-news__more', function (event) {
        var elem = $(this).parent('.rubric-news');
        termId = elem.data('autoload-tid');

        event.preventDefault();

        $(this).css('display', 'none');
        loadMoreNews(elem, termId);
    });
});
/* Подгрузка новостей рубрики по кнопке ЕЩЕ в правом блоке (end) */

/* Подгрузка тизеров для рубрики по кнопке ЕЩЕ (start) */
$(document).ready(function () {
    $('#more-teazer-list').on('click', function (event) {
        var elem = $(this);
        var teazerList = $('.teazer-list');
        var termId = teazerList.data('tid');
        var offset = teazerList.find('li').length;
        var limit = 30;
        var isOnLoad = false;
        var longread = teazerList.data('longread') === true ? 1 : 0;

        event.preventDefault();

        $.ajax({
            type: 'GET',
            url: '/teazer-list/more',
            data: {
                'limit': limit,
                'offset': offset,
                'term_id': termId,
                'longread': longread
            },
            beforeSend: function (xhr) {
                if (isOnLoad) {
                    xhr.abort();
                }
                isOnLoad = true;
                teazerList.addClass('loading');
                elem.addClass('loading');
            },
            success: function (response) {
                teazerList.append(response);
                isOnLoad = false;
                teazerList.removeClass('loading');
                elem.removeClass('loading');
            },
            error: function () {
                isOnLoad = false;
                teazerList.removeClass('loading');
                elem.removeClass('loading');
                return;
            }
        });
    });
});
/* Подгрузка тизеров для рубрики по кнопке ЕЩЕ (end) */

/* Table Shorter (start) */
jQuery.fn.TablesShorter = function (options) {
    var options = jQuery.extend({
        rows: 7,
        topRows: 4,
        text: 'Развернуть',
        sides: 'bottom',
        buttonClass: 'table-shorter-2-button',
        buttonReverseClass: 'inverted',
        buttonTopClass: 'empty showUpper',
        exceptClasses: '.total-summary, .forceDisplay, .showUpper, .noHide'
    }, options);

    function toggleBottom(table) {
        if (table.is('.stats-tournirs-calendar-table')) {
            var rows = table.find('tbody tr.filled:gt(' + options.rows + ')');
            options.rows = 3;
        }
        else if (table.is('.stats-tournirs-history-table')) {
            var rows = table.find('tbody tr:not(' + options.exceptClasses + '):gt(5)');
            options.rows = 5;
        }
        else {
            var rows = table.find('tbody tr:not(' + options.exceptClasses + '):gt(' + options.rows + ')');
        }
        if (jQuery(rows[0]).is(':visible')) {
            rows.hide();
        }
        else {
            rows.show();
        }
        table.find('.total-summary').hide();
        return rows.length;
    }

    function toggleTop(table) {
        var rows = table.find('tr.empty:not(' + options.exceptClasses + ')');
        if (jQuery(rows[0]).is(':visible')) {
            rows.hide();
        }
        else {
            rows.show();
        }
    }

    function addBottomButton(table) {
        var button = jQuery('<div class="table-shorter-2-button-wrap"></div>');
        var buttonElement = jQuery('<span class="table-shorter-2-button" data-rows="' + options.rows + '" data-text="' + options.text + '" data-status="1"></span>').text(options.text)
            .click(function () {
                toggleBottom(table);
                table.toggleClass('bottom-margined-table-shorter');
                $(this).toggleClass(options.buttonReverseClass);
                switch ($(this).attr('data-status')) {
                    case '1':
                        $(this).prev().find('.total-summary').show();
                        $(this).text('Свернуть').attr('data-status', '0');
                        break;
                    case '0':
                        $(this).prev().find('.total-summary').hide();
                        $(this).text(options.text).attr('data-status', '1');
                        break;
                    default:
                        break;
                }

            });
        buttonElement.appendTo(button);

        if (table.is('.stats-tournirs-calendar-table')) {
            var rows = table.find('tbody tr.filled');
            options.rows = 3;
        }
        else if ((table.is('.stats-tournirs-calendar-table')) && (table.find('tbody tr.empty').length == 0)) {
            options.rows = 10;
        }
        else {
            var rows = table.find('tbody tr:not(' + options.exceptClasses + ')');
        }
        if (rows.length >= options.rows) {
            table.after(button);
        }
        else {
            if (table.is('.stats-tournirs-history-table')) {
                table.css('margin-bottom', '40px');
            }
        }

    }

    function addTopButton(table) {
        var button = $('<tr class="' + options.buttonTopClass + '"/>').append($('<td colspan="' + table.find('tbody tr:last td').length + '" align="center"/>').text('...')).click(function () {
            toggleTop(table);
        });

        var rows = table.find('tbody tr.empty:not(' + options.exceptClasses + ')');

        if (rows.length >= options.topRows) {
            table.find('tbody').prepend(button);
            table.find('tbody tr.empty:gt(' + (rows.length - (options.topRows - 1)) + ')').show().addClass('noHide');
            toggleTop(table);
        }


    }

    function fixWidths(table) {
        table.find('tbody tr:first').find('td').each(function () {
            $(this).css('width', $(this).width() + 'px');
        });
    }

    this.each(function () {
        if ($(this).is('table')) {
        }
        if ($(this).next().is('.' + options.buttonClass + '') || $(this).next().is('.table-shorter-group-more-button')) {
            return
        }
        // fixWidths($(this));

        switch (options.sides) {
            case 'bottom':
                toggleBottom($(this));
                addBottomButton($(this));
                break;
            case 'top':
                addTopButton($(this));
                break;
            case 'topBottom':
                addBottomButton($(this));
                var bottomrows = toggleBottom($(this));
                if (bottomrows == 0) {
                    options.topRows = 10;
                }
                addTopButton($(this));

                break;
            default:
                return;
                break;
        }
    });
};
/* Table Shorter (end) */

jQuery(document).ready(function ($) {
    $('input.search_autocomplete').typeahead({
        source: function (query, process) {
            $.ajax({
                url: '/ss_autocomplete',
                method: 'get',
                data: {
                    qac: query,
                    limit: 10
                },
                success: function (data) {
                    var items = data.split('\n');
                    process(items);
                }
            });
        },
        afterSelect: function (item) {
            this.$element.parents('form').first().submit();
        },
        delay: 500
    });
});

/* sessions and cookies */
function checkCookies() {
    //empty function for IE
    if (this.req.responseText) {
        var data = this.req.responseText.split(';');
        document.getElementById('auth_form-show').style.display = 'none';
        document.getElementById('auth_profile').style.display = 'block';
        document.getElementById('auth_name').innerHTML = data[1];
    }
}

function checkSession() {
    var authCookie = window.authCookie ? window.authCookie : readCookie('auth_sportbox');
    var nl = new net.Loader('/session?ssid=' + authCookie + '&random=' + Math.random(), checkCookies, null, "get", null, null);
}

function readCookie(name) {
    var nameEQ = name + "=",
        ca = document.cookie.split(';');

    for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) === ' ') {
            c = c.substring(1, c.length);
        }

        if (c.indexOf(nameEQ) === 0)  return c.substring(nameEQ.length, c.length);
    }

    return null;
}

function setCookie2(name) {
    var now = new Date(),
        expire = new Date(now.getTime() + 3600000);

    document.cookie = name + '; path=/; domain=.sportbox.ru; expires=' + expire.toGMTString();
}
/* /sessions and cookies */
var MD5 = function (string) {

    function RotateLeft(lValue, iShiftBits) {
        return (lValue << iShiftBits) | (lValue >>> (32 - iShiftBits));
    }

    function AddUnsigned(lX, lY) {
        var lX4, lY4, lX8, lY8, lResult;
        lX8 = (lX & 0x80000000);
        lY8 = (lY & 0x80000000);
        lX4 = (lX & 0x40000000);
        lY4 = (lY & 0x40000000);
        lResult = (lX & 0x3FFFFFFF) + (lY & 0x3FFFFFFF);
        if (lX4 & lY4) {
            return (lResult ^ 0x80000000 ^ lX8 ^ lY8);
        }
        if (lX4 | lY4) {
            if (lResult & 0x40000000) {
                return (lResult ^ 0xC0000000 ^ lX8 ^ lY8);
            } else {
                return (lResult ^ 0x40000000 ^ lX8 ^ lY8);
            }
        } else {
            return (lResult ^ lX8 ^ lY8);
        }
    }

    function F(x, y, z) {
        return (x & y) | ((~x) & z);
    }

    function G(x, y, z) {
        return (x & z) | (y & (~z));
    }

    function H(x, y, z) {
        return (x ^ y ^ z);
    }

    function I(x, y, z) {
        return (y ^ (x | (~z)));
    }

    function FF(a, b, c, d, x, s, ac) {
        a = AddUnsigned(a, AddUnsigned(AddUnsigned(F(b, c, d), x), ac));
        return AddUnsigned(RotateLeft(a, s), b);
    };

    function GG(a, b, c, d, x, s, ac) {
        a = AddUnsigned(a, AddUnsigned(AddUnsigned(G(b, c, d), x), ac));
        return AddUnsigned(RotateLeft(a, s), b);
    };

    function HH(a, b, c, d, x, s, ac) {
        a = AddUnsigned(a, AddUnsigned(AddUnsigned(H(b, c, d), x), ac));
        return AddUnsigned(RotateLeft(a, s), b);
    };

    function II(a, b, c, d, x, s, ac) {
        a = AddUnsigned(a, AddUnsigned(AddUnsigned(I(b, c, d), x), ac));
        return AddUnsigned(RotateLeft(a, s), b);
    };

    function ConvertToWordArray(string) {
        var lWordCount;
        var lMessageLength = string.length;
        var lNumberOfWords_temp1 = lMessageLength + 8;
        var lNumberOfWords_temp2 = (lNumberOfWords_temp1 - (lNumberOfWords_temp1 % 64)) / 64;
        var lNumberOfWords = (lNumberOfWords_temp2 + 1) * 16;
        var lWordArray = Array(lNumberOfWords - 1);
        var lBytePosition = 0;
        var lByteCount = 0;
        while (lByteCount < lMessageLength) {
            lWordCount = (lByteCount - (lByteCount % 4)) / 4;
            lBytePosition = (lByteCount % 4) * 8;
            lWordArray[lWordCount] = (lWordArray[lWordCount] | (string.charCodeAt(lByteCount) << lBytePosition));
            lByteCount++;
        }
        lWordCount = (lByteCount - (lByteCount % 4)) / 4;
        lBytePosition = (lByteCount % 4) * 8;
        lWordArray[lWordCount] = lWordArray[lWordCount] | (0x80 << lBytePosition);
        lWordArray[lNumberOfWords - 2] = lMessageLength << 3;
        lWordArray[lNumberOfWords - 1] = lMessageLength >>> 29;
        return lWordArray;
    };

    function WordToHex(lValue) {
        var WordToHexValue = "", WordToHexValue_temp = "", lByte, lCount;
        for (lCount = 0; lCount <= 3; lCount++) {
            lByte = (lValue >>> (lCount * 8)) & 255;
            WordToHexValue_temp = "0" + lByte.toString(16);
            WordToHexValue = WordToHexValue + WordToHexValue_temp.substr(WordToHexValue_temp.length - 2, 2);
        }
        return WordToHexValue;
    };

    function Utf8Encode(string) {
        string = string.replace(/\r\n/g, "\n");
        var utftext = "";

        for (var n = 0; n < string.length; n++) {

            var c = string.charCodeAt(n);

            if (c < 128) {
                utftext += String.fromCharCode(c);
            }
            else if ((c > 127) && (c < 2048)) {
                utftext += String.fromCharCode((c >> 6) | 192);
                utftext += String.fromCharCode((c & 63) | 128);
            }
            else {
                utftext += String.fromCharCode((c >> 12) | 224);
                utftext += String.fromCharCode(((c >> 6) & 63) | 128);
                utftext += String.fromCharCode((c & 63) | 128);
            }

        }

        return utftext;
    };

    var x = Array();
    var k, AA, BB, CC, DD, a, b, c, d;
    var S11 = 7, S12 = 12, S13 = 17, S14 = 22;
    var S21 = 5, S22 = 9 , S23 = 14, S24 = 20;
    var S31 = 4, S32 = 11, S33 = 16, S34 = 23;
    var S41 = 6, S42 = 10, S43 = 15, S44 = 21;

    string = Utf8Encode(string);

    x = ConvertToWordArray(string);

    a = 0x67452301;
    b = 0xEFCDAB89;
    c = 0x98BADCFE;
    d = 0x10325476;

    for (k = 0; k < x.length; k += 16) {
        AA = a;
        BB = b;
        CC = c;
        DD = d;
        a = FF(a, b, c, d, x[k + 0], S11, 0xD76AA478);
        d = FF(d, a, b, c, x[k + 1], S12, 0xE8C7B756);
        c = FF(c, d, a, b, x[k + 2], S13, 0x242070DB);
        b = FF(b, c, d, a, x[k + 3], S14, 0xC1BDCEEE);
        a = FF(a, b, c, d, x[k + 4], S11, 0xF57C0FAF);
        d = FF(d, a, b, c, x[k + 5], S12, 0x4787C62A);
        c = FF(c, d, a, b, x[k + 6], S13, 0xA8304613);
        b = FF(b, c, d, a, x[k + 7], S14, 0xFD469501);
        a = FF(a, b, c, d, x[k + 8], S11, 0x698098D8);
        d = FF(d, a, b, c, x[k + 9], S12, 0x8B44F7AF);
        c = FF(c, d, a, b, x[k + 10], S13, 0xFFFF5BB1);
        b = FF(b, c, d, a, x[k + 11], S14, 0x895CD7BE);
        a = FF(a, b, c, d, x[k + 12], S11, 0x6B901122);
        d = FF(d, a, b, c, x[k + 13], S12, 0xFD987193);
        c = FF(c, d, a, b, x[k + 14], S13, 0xA679438E);
        b = FF(b, c, d, a, x[k + 15], S14, 0x49B40821);
        a = GG(a, b, c, d, x[k + 1], S21, 0xF61E2562);
        d = GG(d, a, b, c, x[k + 6], S22, 0xC040B340);
        c = GG(c, d, a, b, x[k + 11], S23, 0x265E5A51);
        b = GG(b, c, d, a, x[k + 0], S24, 0xE9B6C7AA);
        a = GG(a, b, c, d, x[k + 5], S21, 0xD62F105D);
        d = GG(d, a, b, c, x[k + 10], S22, 0x2441453);
        c = GG(c, d, a, b, x[k + 15], S23, 0xD8A1E681);
        b = GG(b, c, d, a, x[k + 4], S24, 0xE7D3FBC8);
        a = GG(a, b, c, d, x[k + 9], S21, 0x21E1CDE6);
        d = GG(d, a, b, c, x[k + 14], S22, 0xC33707D6);
        c = GG(c, d, a, b, x[k + 3], S23, 0xF4D50D87);
        b = GG(b, c, d, a, x[k + 8], S24, 0x455A14ED);
        a = GG(a, b, c, d, x[k + 13], S21, 0xA9E3E905);
        d = GG(d, a, b, c, x[k + 2], S22, 0xFCEFA3F8);
        c = GG(c, d, a, b, x[k + 7], S23, 0x676F02D9);
        b = GG(b, c, d, a, x[k + 12], S24, 0x8D2A4C8A);
        a = HH(a, b, c, d, x[k + 5], S31, 0xFFFA3942);
        d = HH(d, a, b, c, x[k + 8], S32, 0x8771F681);
        c = HH(c, d, a, b, x[k + 11], S33, 0x6D9D6122);
        b = HH(b, c, d, a, x[k + 14], S34, 0xFDE5380C);
        a = HH(a, b, c, d, x[k + 1], S31, 0xA4BEEA44);
        d = HH(d, a, b, c, x[k + 4], S32, 0x4BDECFA9);
        c = HH(c, d, a, b, x[k + 7], S33, 0xF6BB4B60);
        b = HH(b, c, d, a, x[k + 10], S34, 0xBEBFBC70);
        a = HH(a, b, c, d, x[k + 13], S31, 0x289B7EC6);
        d = HH(d, a, b, c, x[k + 0], S32, 0xEAA127FA);
        c = HH(c, d, a, b, x[k + 3], S33, 0xD4EF3085);
        b = HH(b, c, d, a, x[k + 6], S34, 0x4881D05);
        a = HH(a, b, c, d, x[k + 9], S31, 0xD9D4D039);
        d = HH(d, a, b, c, x[k + 12], S32, 0xE6DB99E5);
        c = HH(c, d, a, b, x[k + 15], S33, 0x1FA27CF8);
        b = HH(b, c, d, a, x[k + 2], S34, 0xC4AC5665);
        a = II(a, b, c, d, x[k + 0], S41, 0xF4292244);
        d = II(d, a, b, c, x[k + 7], S42, 0x432AFF97);
        c = II(c, d, a, b, x[k + 14], S43, 0xAB9423A7);
        b = II(b, c, d, a, x[k + 5], S44, 0xFC93A039);
        a = II(a, b, c, d, x[k + 12], S41, 0x655B59C3);
        d = II(d, a, b, c, x[k + 3], S42, 0x8F0CCC92);
        c = II(c, d, a, b, x[k + 10], S43, 0xFFEFF47D);
        b = II(b, c, d, a, x[k + 1], S44, 0x85845DD1);
        a = II(a, b, c, d, x[k + 8], S41, 0x6FA87E4F);
        d = II(d, a, b, c, x[k + 15], S42, 0xFE2CE6E0);
        c = II(c, d, a, b, x[k + 6], S43, 0xA3014314);
        b = II(b, c, d, a, x[k + 13], S44, 0x4E0811A1);
        a = II(a, b, c, d, x[k + 4], S41, 0xF7537E82);
        d = II(d, a, b, c, x[k + 11], S42, 0xBD3AF235);
        c = II(c, d, a, b, x[k + 2], S43, 0x2AD7D2BB);
        b = II(b, c, d, a, x[k + 9], S44, 0xEB86D391);
        a = AddUnsigned(a, AA);
        b = AddUnsigned(b, BB);
        c = AddUnsigned(c, CC);
        d = AddUnsigned(d, DD);
    }

    var temp = WordToHex(a) + WordToHex(b) + WordToHex(c) + WordToHex(d);

    return temp.toLowerCase();
}

document.textareaCountdown = (function () {

    var textareaObject = null;
    var counterObject = null;
    var limit = 0;

    var init = function (opts) {

        if (!opts.textareaObj || !opts.textareaCountObj) {
            return '';
        }

        textareaObject = opts.textareaObj;
        counterObject = opts.textareaCountObj;
        limit = opts.limit;

        updateCount();
        textareaObject.on('input', updateCount);
        textareaObject.keyup(updateCount);

    };

    var updateCount = function () {
        var remaining = limit - textareaObject.val().length;
        if (remaining < 0) {
            counterObject.css('color', 'red');
        } else {
            counterObject.css('color', '');
        }

        counterObject.text(remaining);
    };

    return {init: init}

})();
/**
 * Нужно указать высоту, добавить overflow: hidden
 */
$.fn.ellipsis = function (offset, savetag, savetext) {
    offset = offset || 0;
    return this.each(function () {
        var el = $(this);
        var flag = false;
        var txt;
        var excludedHtml;

        if (savetag) {
            excludedHtml = el.find(savetag).last();
            if (excludedHtml.text() === savetext) {
                el.find(savetag).last().remove();
            } else {
                excludedHtml = '';
            }
        }
        txt = el.html();

        while (txt.length > 0 && (el[0].scrollHeight - 1 > el.height() || el[0].scrollWidth - 1 > el.width())) { // - 1 - fix for chrome
            txt = txt.substr(0, txt.length - 1);
            el.html(txt + '... ').append(excludedHtml);
            flag = true;
        }

        if (flag) {
            txt = txt.substr(0, txt.length - offset);
            el.html(txt + '... ').append(excludedHtml);
        } else {
            el.html(txt).append(excludedHtml);
        }
    });
};

/*
 Move to authorization file
 */
document.authorize = (function () {

    var userData = null;

    var query_in_progress = false;

    var successCallbackArray = [];
    var errorCallbackArray = [];

    var getAjaxAuthObject = function (successCallback, errorCallback) {

        query_in_progress = true;

        var authCookieName = window.authCookieName ? window.authCookieName : 'auth_sportbox';
        var authapiSessionId = $.cookie(authCookieName);

        var authApiHandler = {
            type: 'GET',
            url: 'http://' + location.host + '/session?ssid=' + authapiSessionId,
            timeout: 10000,
            success: function (data) {

                var parsedData = data.split(';');

                userData = {
                    "id": parsedData[0],
                    "name": parsedData[1],
                    "email": parsedData[2],
                    "is_soft_banned": parsedData[3],
                    "date_soft_banned": parsedData[4],
                    "extra_html": parsedData[5],
                    "dataSource": "authApi"
                };

                query_in_progress = false;
                callAllSuccessCallbacks(userData);

                return true;
            },
            error: function (err) {
                //handler error
                query_in_progress = false;
                callAllErrorCallbacks(userData);

                return true;
            }
        };
        return authApiHandler;
    };

    var getCurrentUserData = function (successCallback, errorCallback) {
        var authCookieName = window.authCookieName ? window.authCookieName : 'auth_sportbox';
        var session_cookie = $.cookie(authCookieName);
        if (!session_cookie) {
            errorCallback();
            return;
        }

        // user data already exists, return it
        if (userData) {
            successCallback(userData);
            return;
        }

        // save callbacks for calling after query will be done
        collectCallbacks(successCallback, errorCallback);

        if (!query_in_progress) {
            // fresh call, let's make a query!
            return $.ajax(getAjaxAuthObject());
        }

    };

    var collectCallbacks = function (successCallback, errorCallback) {
        if (typeof successCallback == 'function') {
            successCallbackArray.push(successCallback);
        }
        if (typeof errorCallbackArray == 'function') {
            errorCallbackArray.push(errorCallback);
        }
    }

    var callAllSuccessCallbacks = function (dataForCallback) {
        while (successCallbackArray[0]) {
            successCallbackArray[0](dataForCallback);
            successCallbackArray.shift();
        }
    };

    var callAllErrorCallbacks = function (dataForCallback) {
        while (errorCallbackArray[0]) {
            errorCallbackArray[0](dataForCallback);
            errorCallbackArray.shift();
        }
    };

    var getUsersData = function (users, callback) {

    };

    return {
        getCurrentUserData: getCurrentUserData,
        getUsersData: getUsersData,
        authMethod: true
    };
})();

/* User face */
spb_scripts['user_face'] = function () {

    var successCallback = function () {
        var successAuthApiCallback = function (user) {
            var extra_html = "";
            if (user.extra_html) {
                extra_html = '<span style="padding-left: 10px;">' + user.extra_html + '</span>';
            }
            var html = '<div id="user_block">' +
                '<a class="avatar" style="display: none" href="http://sportbox.ru/registration"></a>' +
                '<span style="color: #fff;"><a href="http://sportbox.ru/registration">' + user.name + '</a></span>' +
                '<a style="padding-left:10px; " target="_blank"  id="user_logout_link" href="">Выход</a>' + extra_html + '</div>';

            $('#incut_block').html(html);

            $('#user_logout_link').click(function (event) {
                event.preventDefault();
                location = 'http://sportbox.ru/login?action=logout&destination=' + encodeURIComponent(location.href);
            });
        };

        var successRussiaSportCallback = function (user) {
            var html = '<div id="user_block">\
								<a target="_blank"  href="http://russiasport.ru/user/' + user.id + '" id="user_block_face"><img src="' + user.avatar + '" /> ' + user.fullName + '</a>\
								<a target="_blank"  href="http://russiasport.ru/user/' + user.id + '/messages"  class="coment ' + (user.mess > 0 ? 'hascoment' : '') + '">' + user.mess + '</a>\
								<a target="_blank"  href="http://russiasport.ru/user/' + user.id + '/notify" class="notice ' + (user.nots > 0 ? 'hasnotice' : '') + '">' + user.nots + '</a>\
								<div id="options_btn">\
									<span class="options_popup">\
										<a target="_blank"  href="http://russiasport.ru/user/' + user.id + '">Стена</a>\
										<a target="_blank"  href="http://russiasport.ru/user/' + user.id + '/own">Записи пользователя</a>\
										<a target="_blank"  href="http://russiasport.ru/user/' + user.id + '/photos">Фотоальбомы</a>\
										<a target="_blank"  href="http://russiasport.ru/user/' + user.id + '/friends">Друзья, болельщики и группы</a>\
										<a target="_blank"  href="http://russiasport.ru/user/' + user.id + '/profile">Профиль</a>\
										<a target="_blank"  href="http://russiasport.ru/user/' + user.id + '/statshistory">Матчи и турниры</a>\
										<a target="_blank"  href="http://russiasport.ru/user/' + user.id + '/messages">Сообщения</a>\
										<a target="_blank"  href="http://russiasport.ru/user/' + user.id + '/notify">Уведомления</a>\
										<a target="_blank"  href="http://russiasport.ru/user/' + user.id + '/profile_edit">Редактировать профиль</a>\
										<a target="_blank"  href="http://russiasport.ru/user/' + user.id + '/group/add">Создать группу</a>\
										<a target="_blank"  id="user_logout_link" href="">Выход</a>\
									</span>\
								</div>\
					   </div>';

            $('#incut_block').html(html);

            $('#user_logout_link').click(function (event) {
                event.preventDefault();
                location = 'http://russiasport.ru/api.php?logout&format=sb&referer=' + encodeURIComponent(location.href);
            });

            // show/hide .options_popup
            var options_popup_tshow,
                options_popup_thide,
                showedFlag = false,
                options_btn = $('#options_btn'),
                options_popup = $('#options_btn .options_popup');

            options_btn.hover(
                function () {
                    clearTimeout(options_popup_thide);
                    options_popup_tshow = setTimeout(function () {
                        options_popup.show();
                        setTimeout(function () {
                            showedFlag = true;
                        }, 300);
                    }, 300);
                },
                function () {
                    clearTimeout(options_popup_tshow);
                    options_popup_thide = setTimeout(function () {
                        options_popup.hide();
                        showedFlag = false;
                    }, 600);
                }
            ).mousedown(function (event) {
                    event.preventDefault(); // Remove default text selection on doubleclick
                }).click(function () {
                    if (options_popup.is(':hidden')) {
                        options_popup.show();
                        showedFlag = true;
                    }
                    else {
                        if (!showedFlag) return;
                        options_popup.hide();
                        showedFlag = false;
                    }
                });

            options_popup.click(function (event) {
                event.stopPropagation();
            });
        };

        return successAuthApiCallback;
    }

    var errorCallback = function () {
        //$('#incut_block').append('<a id="enter_link" onclick="spb_scripts[\'user_face\'].show_hide_frame()">Войти</a>');
    };

    // draw login link before any requests
    $('#incut_block').html('<a id="enter_link" onclick="spb_scripts[\'user_face\'].show_hide_frame()">Войти</a>');
    document.authorize.getCurrentUserData(successCallback(), errorCallback);
}

// закрываем попап авторизации
$(window).on({
    'click': function (event) {
        var target = $(event.target),
            authPopup = $('#popup_wrap'),
            popupIsVisible = authPopup.hasClass('hide') ? false : true;

        if (target.attr('id') === 'close_iframe_login_popup' || (popupIsVisible && target.attr('id') !== 'popup_auth' && !target.parents('#popup_auth').length && !target.parents('#sbCNewsMainPhotoBig').length && target.attr('id') !== 'enter_link')) {
            authPopup.addClass('hide');
        }
    },
    'keydown': function (event) {
        var target = $(event.target),
            authPopup = $('#popup_wrap'),
            popupIsVisible = authPopup.hasClass('hide') ? false : true;

        if (popupIsVisible && event.keyCode === 27) {
            authPopup.addClass('hide');
        }
    }
});

// отображаем попап авторизации
spb_scripts['user_face'].show_hide_frame = function () {
    var $ = jQuery,
        timeout_id,
        authPopup = $('#popup_wrap'),
        popupIsVisible = authPopup.hasClass('hide') ? false : true,
        destinationField = authPopup.find('input[name="destination"]'),
        name_input = authPopup.find('#mail'),
        name_label = authPopup.find('#mail_label'),
        pass_input = authPopup.find('#password'),
        pass_label = authPopup.find('#password_label');

    name_input.on('focus', function () {
        name_label.addClass('hide');
    });

    name_input.on('blur', function () {
        if ($(this).val() === '') {
            name_label.removeClass('hide');
        }
    });

    pass_input.on('focus', function () {
        pass_label.addClass('hide');
    });

    pass_input.on('blur', function () {
        if ($(this).val() === '') {
            pass_label.removeClass('hide');
        }
    });

    // подставляем в форму адрес текущей страницы
    destinationField.val(window.location.href);

    if (!popupIsVisible) {
        authPopup.removeClass('hide');
    } else {
        authPopup.addClass('hide');
    }

    name_input.focus();
}

/**
 * Comments
 */

// Date_ru_utf-8
// date localization for locale 'ru-RU', utf-8 encoding
// provided by Sergey Nechaev http://nechaev.org/)
Date.dayNames = ['Воскресенье', 'Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота'];
Date.abbrDayNames = ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'];
Date.monthNames = ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'];
Date.monthNamesGenitive = ['Января', 'Февраля', 'Марта', 'Апреля', 'Мая', 'Июня', 'Июля', 'Августа', 'Сентября', 'Октября', 'Ноября', 'Декабря'];
Date.abbrMonthNames = ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'];
Date.firstDayOfWeek = 1;
Date.format = 'dd.mm.yyyy';
// End  date_ru_utf-8

document.comments = (function () {
    var conf = {
        comments_container_id: 'spb_comments_2014',
        comments_texteare_id: 'spb_comments_textarea',
        comments_send_btn: 'spb-comments-form-submit',
        thread_ajax_url: '',
        current_url: window.url('path'),
        current_url_md5: '',
        comment_add_url: '/comments/add',
        comment_like_url: '/comments/like',
        comment_delete_url: '/comments/delete',
        comment_hardbanuser_url: '/comments/hardban',
        comment_softbanuser_url: '/comments/softban',
        current_authapi_user_obj: null,
        hide_comments: true,

        comments_per_page: 0,
        comments_count: 0,
        comments_collapse_rate_limit: -1,

        is_on_submit: false

    };

    var state = {
        current_page_number: 1
    };

    var init = function () {

        conf.current_url = Drupal.settings.spb_comm.nodealias;
        conf.current_url_md5 = MD5(conf.current_url);
        conf.thread_ajax_url = '/comments/' + conf.current_url_md5 + '/list';

        // get auth data
        document.authorize.getCurrentUserData(
            function (userData) {
                conf.current_authapi_user_obj = userData;
                initCommentsThreadHTML();
            },
            function () {
                initCommentsThreadHTML();
            }
        );

    };

    var showThrobler = function () {
        $('#' + conf.comments_container_id).css('background', 'url(http://s.s-ports.ru/sites/all/libraries/design/_spbver1_/img/ajax-loader.gif) no-repeat 50% 50%');
    }

    var hideThrobler = function () {
        $('#' + conf.comments_container_id).css('background', 'none');
    }

    var initCommentsThreadHTML = function () {

        // clear container data
        clearCommentsContainerHTML();
        showThrobler();

        // return ajax promise
        return $.ajax({
            type: 'GET',
            url: 'http://' + location.host + conf.thread_ajax_url + '/' + state.current_page_number,
            dataType: "json",
            success: renderCommentsHTML,
            error: renderCommentsHTML
        });

    }

    var clearCommentsContainerHTML = function () {

        document.getElementById(conf.comments_container_id).innerHTML = '';

    }

    var hideComment = function (el) {
        $(el).find('.comment-body').wrapInner("<div style='display: none;'></div>");
        $(el).find('.comment-body').append('<a href=# onclick="return document.comments.showComment(this)" class="comment-expand">Раскрыть</a>');
    };

    var showComment = function (el) {
        $(el).siblings("div").show();
        $(el).remove();
        return false;
    }

    var hideBadComments = function (j_comments_wrapper) {

        var show_bad_comments = readCookie('show_bad_comments');
        if (show_bad_comments === "1") {
            return false;
        }

        if (!j_comments_wrapper) {
            j_comments_wrapper = $('.spb-comments-wrapper');
        }

        $(j_comments_wrapper).children('.comment').each(function () {
            // hide negative rating and softbanned comments
            if (($(this).data('rating') <= conf.comments_collapse_rate_limit) || $(this).data('author-is-softbanned')) {
                hideComment(this);
            }
        });
    }

    var hideBadCommentsHandler = function () {
        $.cookie("show_bad_comments", null, { path: '/' });

        $('.hide_bad_comments').css({ 'display': 'none'});
        $('.show_bad_comments').css({ 'display': 'inline'});

        hideBadComments($('.spb-comments-wrapper'));
    }

    var showBadCommentsHandler = function (j_comments_wrapper) {

        if (!j_comments_wrapper) {
            j_comments_wrapper = $('.spb-comments-wrapper');
        }

        $.cookie('show_bad_comments', 1, { expires: 5000, path: '/' });//Wed, 18 May 2033 03:33:20 GMT

        $(j_comments_wrapper).children('.comment').each(function () {
            showComment($('.comment-expand', this));
        });

        $('.hide_bad_comments').css({ 'display': 'inline'});
        $('.show_bad_comments').css({ 'display': 'none'});
    }

    var renderCommentsHTML = function (comments_json) {

        hideThrobler();

        var j_comments_html = $('<div class="spb-comments-empty">Комментариев пока нет</div>');

        var likes_arr = new Array();
        if (comments_json && comments_json.last_likes_arr) {
            likes_arr = comments_json.last_likes_arr;
        }

        if (comments_json && comments_json.html) {
            j_comments_html = $(comments_json.html);
            conf.comments_count = j_comments_html.filter('#spb_comments_wrapper').data('comments-total');
            conf.comments_per_page = j_comments_html.filter('#spb_comments_wrapper').data('comments-per-page');
        }

        var comment_form = '';

        //
        //  Logged user function: like, current user comments hightlight, comment form
        //

        if (conf.current_authapi_user_obj && (conf.current_authapi_user_obj.id > 0)) {
            if (conf.current_authapi_user_obj.is_soft_banned == 1) {
                var soft_banned_delta_time = 86400 * 3;
                var date_to_soft_banned = parseInt(conf.current_authapi_user_obj.date_soft_banned) + soft_banned_delta_time;
                var date_to_soft_banned_ms = date_to_soft_banned * 1000;
                var date_to_soft_obj = new Date(date_to_soft_banned_ms);
                var month_to_soft_banned = Date.monthNamesGenitive[date_to_soft_obj.getMonth()];
                var minutes_to_soft_banned = date_to_soft_obj.getMinutes();
                if (minutes_to_soft_banned < 10) {
                    minutes_to_soft_banned = '0' + minutes_to_soft_banned.toString();
                }
                j_comments_html.prepend('<div class="spb-comments-anon-message">Вы не можете оставлять комментарии в связи с нарушеним <a href="http://news.sportbox.ru/terms_of_service" target="_blank">правил</a>. Возможность добавления комментариев станет доступной ' + date_to_soft_obj.getDate() + ' ' + month_to_soft_banned + ' в ' + date_to_soft_obj.getHours() + ':' + minutes_to_soft_banned + '.</div>');
            } else {
                // like controlls
                j_comments_html = appendLikeControllsToThreadList(j_comments_html, likes_arr);


                j_comments_html.children('.comment').each(function () {
                    // highlight current user comments
                    if ($(this).data('author-id') == conf.current_authapi_user_obj.id) {
                        $(this).addClass('comment-curr-usr');
                    }
                });

                // generate form to add comments
                comment_form = getRenderedCommentForm();
            }
        } else {
            j_comments_html.prepend('<div class="spb-comments-anon-message">Для того, чтобы добавить комментарий, необходимо <a href="http://sportbox.ru/signon?destination=' + encodeURIComponent(window.url()) + '">войти на сайт</a>.</div>');
        }

        hideBadComments(j_comments_html);

        // comment created date append
        //j_comments_html = processAndAppendCommentsDateTime(j_comments_html);

        var paginator_html = getRenderedPaginator();

        var shoHideBadCommentsControl = getRenderedShowHideBadCommentsControl();


        clearCommentsContainerHTML();

        // inserts collected html
        $('#' + conf.comments_container_id).append(comment_form, j_comments_html, shoHideBadCommentsControl, paginator_html);

        $(".comment").on("touchstart touchend", function () {
            var hoverClass = "hover-touch";
            $(this).addClass(hoverClass).siblings().removeClass(hoverClass);
        });

    }

    var insertNickname = function (nickName) {

        var current_text = $('#' + conf.comments_texteare_id).val();
        $('#' + conf.comments_texteare_id).val(nickName + ', ' + current_text);
        scrollToTextarea();

        return false;

    };

    var getRenderedCommentForm = function () {

        var form_html = '<div class="spb-comments-form-wrapper"><form action="/comments/add" method="POST" class="spb-comments-form"><textarea name="comment_text" class="spb-comments-form-textarea" id="spb_comments_textarea"></textarea><input type="submit" class="spb-comments-form-submit" value="Добавить комментарий"><input type="button" value="Обновить" id="comments-update" class="spb-comments-form-submit"><a href="/terms_of_service" class="spb-comments-form-rules" target="_blank">Правила</a><span class="spb-comments-form-textarea-countdown">3000</span><input type="hidden" name="page_url" value="' + conf.current_url + '"></form></div>';
        if ($.cookie('test_comments_images') == 1) {
            form_html = '<div class="spb-comments-form-wrapper"><form action="/comments/add" method="POST" class="spb-comments-form"><div class="spb-comments-form-add-wrapper"><div class="spb-comments-form-image-upload"><div class="spb-comments-form-image-upload-field"><input type="file" multiple="true" name="images[]" size="20"></div></div><textarea name="comment_text" class="spb-comments-form-textarea" id="spb_comments_textarea"></textarea></div><input type="submit" class="spb-comments-form-submit" value="Добавить комментарий"><input type="button" value="Обновить" id="comments-update" class="spb-comments-form-submit"><a href="/terms_of_service" class="spb-comments-form-rules" target="_blank">Правила</a><span class="spb-comments-form-textarea-countdown">3000</span><input type="hidden" name="page_url" value="' + conf.current_url + '"></form></div>';
        }
        var j_form_html = $(form_html);

        j_form_html.find('#comments-update').click(initCommentsThreadHTML);

        j_form_html.find('form').submit(function (e) {
            e.preventDefault();
            validateCommentFormData(e);
        });

        if ($.cookie('test_comments_images') == 1) {

            /** INPUT MULTI SELECT IMAGES*/
            j_form_html.find('.spb-comments-form-image-upload-field input').change(function () {
                uploadCommentImages(j_form_html, this.files);
                $(this).val('');
            });

            /** PREVIEWS IMAGES */
            j_form_html.on('mouseenter', '.spb-comments-image-preview', function () {
                if ($(this).find('img').length) {
                    $(this).append('<span class="spb-comments-image-preview__remove">&times;</span>');
                }
            });
            j_form_html.on('mouseleave', '.spb-comments-image-preview', function () {
                $(this).find('.spb-comments-image-preview__remove').remove();
            });
            j_form_html.on('click', '.spb-comments-image-preview__remove', function () {
                $(this).parents('.spb-comments-image-preview').remove();
            });

            /** DRAG'N'DROP IMAGES*/
            var commentsTextarea = j_form_html.find('.spb-comments-form-textarea');

            $(document).on('dragenter', function (e) {
                e.stopPropagation();
                e.preventDefault();
                commentsTextarea.addClass('spb-comments-form-textarea-droping');
                var dt = e.originalEvent.dataTransfer;
                dt.effectAllowed = dt.dropEffect = 'none';

            });
            $(document).on('dragover', function (e) {
                e.stopPropagation();
                e.preventDefault();
                commentsTextarea.addClass('spb-comments-form-textarea-droping');
                var dt = e.originalEvent.dataTransfer;
                dt.effectAllowed = dt.dropEffect = 'none';
            });
            $(document).on('drop', function (e) {
                e.stopPropagation();
                e.preventDefault();
                commentsTextarea.removeClass('spb-comments-form-textarea-droping');
            });
            $(document).on('dragleave', function (e) {
                e.stopPropagation();
                e.preventDefault();
                commentsTextarea.removeClass('spb-comments-form-textarea-droping');
            });

            commentsTextarea.on('dragenter', function (e) {
                e.stopPropagation();
                e.preventDefault();
                $(this).addClass('spb-comments-form-textarea-droping');
            });
            commentsTextarea.on('dragover', function (e) {
                e.stopPropagation();
                e.preventDefault();
                $(this).addClass('spb-comments-form-textarea-droping');
            });
            commentsTextarea.on('drop', function (e) {
                $(this).removeClass('spb-comments-form-textarea-droping');
                e.preventDefault();
                var files = e.originalEvent.dataTransfer.files;
                uploadCommentImages(j_form_html, files);
            });

        }

        document.textareaCountdown.init({
            textareaObj: j_form_html.find('.spb-comments-form-textarea'),
            textareaCountObj: j_form_html.find('.spb-comments-form-textarea-countdown'),
            limit: 3000});

        return j_form_html;

    }

    /** UPLOAD COMMENT IMAGES */
    var commentImagePreviewHeight = 120;
    var uploadCommentImages = function (j_form_html, files) {
        j_form_html.find('.spb-comments-form-image-upload-field input').attr("disabled", true);
        j_form_html.find('.spb-comments-form-submit').attr("disabled", true);
        j_form_html.append('<div class="spb-comment-form-disabler"></div>');

        if (!j_form_html.find('.spb-comments-images-preview-wrapper').length) {
            j_form_html.find('.spb-comments-form-add-wrapper').append('<div class="spb-comments-images-preview-wrapper"></div>');
        }

        var images_preview_wrapper = j_form_html.find('.spb-comments-images-preview-wrapper');
        var images_previews_count = images_preview_wrapper.find('.spb-comments-image-preview').length;
        if (images_previews_count) {
            var last_preview = images_preview_wrapper.find('.spb-comments-image-preview').get(images_previews_count - 1);
            images_previews_count = parseInt($(last_preview).attr('data-number')) + 1;
        }

        var fd = new FormData();
        $.each(files, function (i, file) {
            fd.append('images_list[]', file);
            var number = (images_previews_count + i);
            images_preview_wrapper.append('<div data-number="' + number + '" id="spbCommentImagePreview_' + number + '" class="spb-comments-image-preview">&nbsp;<div class="spb-comment-preview-progress"><div class="spb-comment-preview-progress-bar spb-comment-preview-progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div></div></div>')
        });

        $.ajax({
            url: '/comments/image/upload',
            type: "POST",
            data: fd,
            processData: false,
            contentType: false,
            dataType: "json",
            success: function (data) {
                if (data) {
                    $.each(data, function (i, image_path_in_images) {
                        var previewContainer = $('#spbCommentImagePreview_' + (images_previews_count + i));
                        if (image_path_in_images == false) {
                            previewContainer.remove();
                            return true;
                        }

                        previewContainer.html('<img src="http://s.s-ports.ru/images/styles/120_120_auto/' + image_path_in_images + '"><input type="hidden" name="comment_images[]" value="' + image_path_in_images + '">');
                        var previewImg = previewContainer.find('img');
                        previewImg.load(function () {
                            var previewImgMargin = Math.round((commentImagePreviewHeight - previewImg.height()) / 2);
                            previewImg.css("margin-top", previewImgMargin + 'px');
                        });
                    });
                }
                j_form_html.find('.spb-comments-form-image-upload-field input').attr("disabled", false);
                j_form_html.find('.spb-comments-form-submit').attr("disabled", false);
                j_form_html.find('.spb-comment-form-disabler').remove();
            }
        });
    }

    var showMoreImages = function (el) {
        $(el).parents('.comment-images').find('.comment-other-images-container').show();
        $(el).remove();
        return;
    };

    var validateCommentFormData = function (e) {

        var comment_text = $(e.target).find('textarea').val();

        var comment_images = [];
        $.each($(e.target).find('input[name="comment_images[]"]'), function (i, inp) {
            if ($(inp).val() != '') {
                comment_images.push($(inp).val());
            }
        });

        // check for message is not empty
        if (($.trim(comment_text) == '') && (!comment_images.length)) {
            alert('Введите сообщение');
            return;
        }

        var page_url = $(e.target).find('input[name="page_url"]').val();
        if (page_url == '') {
            alert('Ошибка формы');
            return;
        }

        submitCommentFormData(comment_text, page_url, comment_images);

    }

    var submitCommentFormData = function (comment_text, page_url, comment_images) {

        $.ajax({
            url: conf.comment_add_url,
            beforeSend: function (xhr) {
                if (conf.is_on_submit) {
                    xhr.abort();
                }
                conf.is_on_submit = true;
                $('.' + conf.comments_send_btn).addClass('locked');
            },
            data: {
                'comment_text': comment_text,
                'page_url': page_url,
                'comment_images': comment_images
            },
            type: 'post',
            dataType: "json",
            success: function (json) {
                renderCommentsHTML(json);
                selectFirstPage();
                setTimeout(function () {
                    conf.is_on_submit = false;
                    $('.' + conf.comments_send_btn).removeClass('locked');
                }, 3000);
            },
            error: function () {
                alert('Ошибка отправки комментария');
                setTimeout(function () {
                    conf.is_on_submit = false;
                    $('.' + conf.comments_send_btn).removeClass('locked');
                }, 3000);
            }
        });

    }

    var getRenderedPaginator = function () {

        // calculate pages
        var pages_count = Math.ceil(conf.comments_count / conf.comments_per_page);

        if (!pages_count || pages_count == 1) {
            return '';
        }

        var prev_active_class = '';
        if (state.current_page_number > 1) {
            prev_active_class = ' active';
        }
        var prev_page_link = '<li class="pager-previous first' + prev_active_class + '">← <span>предыдущая</span></li>';


        var next_active_class = '';
        if (state.current_page_number < pages_count) {
            next_active_class = ' active';
        }
        var next_page_link = '<li class="pager-next last' + next_active_class + '"><span>следующая</span> →</li>';


        var pager_html = '<div class="ls-pager-def"><div class="item-list"><ul class="pager-prev-next">' + prev_page_link + next_page_link + '</ul></div><div class="item-list"><ul class="pager">';

        for (var i = 1; i <= pages_count; i++) {
            classStr = '';
            if (state.current_page_number == i) {
                classStr = ' class="pager-current"';
            }
            pager_html += '<li data-number="' + i + '"' + classStr + '><span>' + i + '</span></li>';
        }

        pager_html += '</ul></div></div>';

        var j_pager_html = $(pager_html);
        j_pager_html.find('.pager li span').click(processSelectedPagerItem);
        j_pager_html.find('.pager-prev-next li span').click(function (e) {
            if ($(e.target).parent().hasClass('pager-previous')) {
                var prev_page_li = $('#' + conf.comments_container_id + ' li.pager-current span').parent().prev();
                prev_page_li.children('span').click();
            } else {
                var next_page_li = $('#' + conf.comments_container_id + ' li.pager-current span').parent().next();
                next_page_li.children('span').click();
            }
        });

        return j_pager_html;

    }

    var getRenderedShowHideBadCommentsControl = function () {


        var hideControl = $('<span class="hide_bad_comments" style="display:inline;" onclick="return document.comments.hideBadCommentsHandler();">Скрыть плохие</span>');
        var showControl = $('<span class="show_bad_comments" style="display:inline;" onclick="return document.comments.showBadCommentsHandler()">Показать плохие</span>');

        var show_bad_comments = readCookie('show_bad_comments');
        if (show_bad_comments === "1") {
            showControl.css({ 'display': 'none'});
        } else {
            hideControl.css({ 'display': 'none'});
        }

        var html = $('<div class="spb-comments-visibility-toggler"></div>').append(hideControl, showControl);
        return html;
    }

    var processSelectedPagerItem = function (e) {

        $('#' + conf.comments_container_id + ' .pager li').removeClass('pager-current');
        var pager_container = $(e.target).parent();
        pager_container.addClass('pager-current');

        state.current_page_number = pager_container.data('number');
        initCommentsThreadHTML();
        scrollToTextarea();

    };

    var scrollToTextarea = function () {

        $("html, body").scrollTop($("#" + conf.comments_container_id).offset().top);

    };

    var appendLikeControllsToThreadList = function (j_comments_list_html, likes_arr) {
        j_comments_list_html.children('.comment').each(function () {
            var controlls_minus_html = '<li class="comment-rate-minus">&ndash;</li>';
            var controlls_plus_html = '<li class="comment-rate-plus">+</li>';

            var allow_only_plus_like = $(this).data('only-plus');
            if (allow_only_plus_like) {
                controlls_minus_html = '';
            }

            var controlls_container = $(this).children('.clearfix').children('.comment-rate');
            var comment_id = $(this).data('comment_id');
            var comment_rating = $(this).data('rating');

            var controlls_value_html = '<li class="comment-rate-value">' + comment_rating + '</li>';

            controlls_container.append(controlls_minus_html, controlls_value_html, controlls_plus_html);

            // mark liked comments
            if (likes_arr[comment_id]) {
                j_comments_list_html = disableLikeControlls(comment_id, comment_rating, j_comments_list_html);
            }
        });

        j_comments_list_html.on('click', '.comment-rate-minus, .comment-rate-plus', processCommentRate);

        return j_comments_list_html;

    }

    var processCommentRate = function (e) {

        if ($(e.target).parent().hasClass('disabled')) {
            return;
        }

        var comment_id = $(e.target).parents('.comment').data('comment_id');
        if (!comment_id) {
            return;
        }

        var rate_vector = -1;

        if ($(e.target).hasClass('comment-rate-plus')) {
            rate_vector = 1;
        }

        var allow_only_plus_like = $(e.target).parents('.comment').data('only-plus');
        if ((rate_vector == -1) && allow_only_plus_like) {
            return;
        }

        disableLikeControlls(comment_id, rate_vector);
        changeCommentRating(comment_id, rate_vector);

        $.ajax(
            {
                url: conf.comment_like_url,
                data: {
                    comment_id: comment_id,
                    like_value: rate_vector
                },
                type: 'post'
            }
        );

    };

    var disableLikeControlls = function (comment_id, rate_vector, container) {

        $('#comment_' + comment_id + ' .comment-rate', container).addClass('disabled');

        var like_button_class_to_remove = 'comment-rate-plus';
        var like_button_class_to_highlight = 'comment-rate-minus';
        if (rate_vector > '0') {
            like_button_class_to_remove = 'comment-rate-minus';
            like_button_class_to_highlight = 'comment-rate-plus';
        }

        $('#comment_' + comment_id + ' .' + like_button_class_to_remove, container).empty();
        $('#comment_' + comment_id + ' .' + like_button_class_to_highlight, container).addClass('selected');

        if (container) {
            return container;
        }

    };

    var changeCommentRating = function (comment_id, rate_vector) {

        var comment_rating_obj = $('#comment_' + comment_id + ' .comment-rate-value');
        var comment_rating_value = comment_rating_obj[0].innerHTML;
        var updated_comment_rating_value = parseInt(comment_rating_value) + parseInt(rate_vector);
        comment_rating_obj[0].innerHTML = updated_comment_rating_value;
        if (updated_comment_rating_value <= conf.comments_collapse_rate_limit) {
            hideComment($('#comment_' + comment_id));
        }

    };

    var processAndAppendCommentsDateTime = function (j_comments_html) {

        j_comments_html.children('.comment').each(function () {
            $(this).children('.clearfix').children('.comment-date')[0].innerHTML = dateStringSinceDateFormatter($(this).data('created-ts'));
        });

        return j_comments_html;

    };

    var selectFirstPage = function () {
        state.current_page_number = 1;
        $('#' + conf.comments_container_id + ' .ls-pager-def').remove();

        var paginator = getRenderedPaginator();
        $('#' + conf.comments_container_id).append(paginator);
    };

    var confirmPopup = function () {
        if (confirm('Вы уверены?')) {
            return true;
        }

        return false;
    }

    var deleteComment = function (comment_id) {

        if (('ontouchstart' in document.documentElement) && !confirmPopup()) {
            return false;
        }

        $.ajax({
            url: conf.comment_delete_url,
            data: {
                'comment_id': comment_id,
                'page_url': conf.current_url,
                'current_page_number': state.current_page_number
            },
            type: 'post',
            dataType: 'json',
            success: function (json) {
                renderCommentsHTML(json);
            },
            error: function () {
                alert('Ошибка удаления комментария')
            }
        });
    };

    var hardBanUser = function (user_id, comment_id) {

        if (!confirmPopup()) {
            return false;
        }

        var comment_text = $('#comment_' + comment_id).find('.comment-content').html();

        $.ajax({
            url: conf.comment_hardbanuser_url,
            data: {
                'user_id': user_id,
                'comment_id': comment_id,
                'page_url': conf.current_url,
                'current_page_number': state.current_page_number,
                'comment_text': comment_text
            },
            type: 'post',
            dataType: 'json',
            success: function (json) {
                renderCommentsHTML(json);
            },
            error: function () {
                alert('Ошибка блокировки пользователя')
            }
        });
    };

    var softBanUser = function (user_id, comment_id) {

        if (!confirmPopup()) {
            return false;
        }

        var comment_text = $('#comment_' + comment_id).find('.comment-content').html();

        $.ajax({
            url: conf.comment_softbanuser_url,
            data: {
                'user_id': user_id,
                'comment_id': comment_id,
                'page_url': conf.current_url,
                'current_page_number': state.current_page_number,
                'comment_text': comment_text
            },
            type: 'post',
            dataType: 'json',
            success: function (json) {
                renderCommentsHTML(json);
            },
            error: function () {
                alert('Ошибка блокировки пользователя')
            }
        });
    };

    return {
        init: init,
        showComment: showComment,
        deleteComment: deleteComment,
        showMoreImages: showMoreImages,
        hardBanUser: hardBanUser,
        softBanUser: softBanUser,
        insertNickname: insertNickname,
        showBadCommentsHandler: showBadCommentsHandler,
        hideBadCommentsHandler: hideBadCommentsHandler,
        hide_comments: conf.hide_comments
    };
})();


/* Comments (start) */
spb_scripts.spb_comments = function (options) {

    var authCookieName = window.authCookieName ? window.authCookieName : 'auth_sportbox';
    var $ = jQuery,
        comments_wrap = $('#spb-comments-new'),
        form = null,
        commentsLoaded = false,
        comments = null,
        safe_panel = null,
        pagen_now = 0,
        sending = false,
        textShowComments = 'Показать комментарии',
        textHideComments = 'Скрыть комментарии',

        options = $.extend({
            xreal: null,
            title: '',
            is_popup: false,
            js: '',
            auth_cookie: authCookieName,
            debug: false
        }, options);


    var box = {

        init: function () {
            box.show();
        },

        show: function () {

            if (!commentsLoaded) {
                comments = comments_wrap.find('.sp_comments_list:first');
                safe_panel = $('<div style=\'position:absolute;background:#000\'><span style=\'width:13px; height:13px;left:-15px;top:-15px;position:absolute;background:url(http://s.s-ports.ru/sites/all/libraries/design/_spbver9_/img/throbber.gif) no-repeat 0 -20px\'></span></div>');
                safe_panel.appendTo('body').css({opacity: 0, zIndex: 10});
                if (options.is_popup) {
                    box.init_forum_form();
                    box.init_forum_posts();
                }
                else {
                    box.init_tabs();
                }
                commentsLoaded = true;
            }
            comments_wrap.show();

        },

        init_tabs: function () {
            var fn_init = {
                'rs': function () {
                    var authCookieName = window.authCookieName ? window.authCookieName : 'auth_sportbox';
                    try {
                        var fullSiteUrl,
                            auth_param;

                        if (!Drupal.settings.spb_comm.site_url || (Drupal.settings.spb_comm.site_url == '')) {
                            fullSiteUrl = 'http://' + Drupal.settings.spb_comm.nodealias;
                        }
                        else {
                            fullSiteUrl = Drupal.settings.spb_comm.site_url + '/' + Drupal.settings.spb_comm.nodealias;
                        }

                        if (readCookie(authCookieName)) {
                            auth_param = 1;
                        }
                        else {
                            auth_param = 0;
                        }

                        var loadRsScript = function () {
                            $.getScript('http://russiasport.ru/sites/all/modules/mod_comments_api/js/mod_comments_api_out3.js', function () {
                                russiasport_comments_api('rs_comments', 'http://russiasport.ru/', auth_param, fullSiteUrl);
                            });
                        };

                        var comments_toggle_link = $('.comments-open-close-link');

                        if ($.cookie('spb_comments_keep_opened_n') === "1") {
                            loadRsScript();
                            comments_toggle_link.hide();
                        }

                        comments_toggle_link.click(function () {
                            $.cookie('spb_comments_keep_opened_n', 1, { expires: 30, path: '/' + Drupal.settings.spb_comm.nodealias });
                            loadRsScript();
                            comments_toggle_link.hide();
                        });

                    }
                    catch (e) {
                    }
                },

                'default': function () {
                    /* На сегодняшний день 'default' означает форумные комментарии */
                    box.load_forum_form((new RegExp(options.auth_cookie).test(document.cookie)));
                },

                'spb': function () {

                    var spb_comments_toggle_link = $('.spb-comments-open-close-link');

                    if (document.comments.hide_comments) {
                        if ($.cookie('spb_comments_keep_opened_n') === "1") {
                            box.init_spb_comments();
                            spb_comments_toggle_link.hide();
                        }

                        spb_comments_toggle_link.click(function () {
                            $.cookie('spb_comments_keep_opened_n', 1, { expires: 30, path: '/' + Drupal.settings.spb_comm.nodealias });
                            box.init_spb_comments();
                            spb_comments_toggle_link.hide();
                        });
                    } else {
                        box.init_spb_comments();
                        spb_comments_toggle_link.hide();
                    }
                },


                'vk': function () {
                    if (typeof window.VK == 'undefined')
                        $.getScript('http://userapi.com/js/api/openapi.js?48', function () {
                            box.init_vk()
                        });
                    else
                        box.init_vk();
                },

                'fb': function () {
                    $('#fb_comments').addClass('fb-comments');
                    if (window.FB)
                        FB.XFBML.parse(document.body, function () {
                            $('#fb_comments span:first').width('100%')
                        });
                }
            };

            var select_tab = function (type) {

                var last = $('.sp_c_comm_def_tab_active:first');

                if (last.length) {
                    var last_type = last.data('type');
                    if (last_type == type) return;

                    last.removeClass('sp_c_comm_def_tab_active');
                    $('.sp_c_comm_def_list-' + last_type + ':first').hide();
                }

                if (fn_init[type]) {
                    fn_init[type]();
                    delete fn_init[type]
                }
                sb_c_res_def_setCookie('sp_c_comm_def_tab_active=' + type);
                $('.sp_c_comm_def_tab-' + type).addClass('sp_c_comm_def_tab_active');
                $('.sp_c_comm_def_list-' + type + ':first').show()
            }

            $('.sp_c_comm_def_tab').click(function () {
                select_tab($(this).data('type'))
            });


            var type = sb_c_res_def_getCookie('sp_c_comm_def_tab_active');
            if (!type || !/^(vk|fb|rs|spb|default)$/.test(type))  type = 'rs';
            select_tab(type)
        },


        init_vk: function () {
            VK.init({apiId: 2828493, onlyWidgets: true});
            VK.Widgets.Comments('vk_comments', {
                limit: 50,
                attach: '*',
                autoPublish: 1,
                mini: 1
            }, vk_page_id);

        },


        init_forum_form: function () {
            form = comments_wrap.find('form');
            $('#sp_update_comments').live('click', function (e) {
                e.preventDefault();
                if (!$('#sp_update_comments_loader')[0])
                    $('body').append('<div id="sp_update_comments_loader" style="left:' + ($(this).offset().left + $(this).width() + 14) + 'px;top:' + ($(this).offset().top + 1) + 'px;position:absolute;width:20px;height:20px;background:url(http://s.s-ports.ru/sites/all/libraries/design/_spbver9_/img/load_process.gif) no-repeat"></div>');

                box.update_forum_posts();

                $(this).attr('disabled', true);
                return false;
            });

            form.find('textarea').keydown(function (e) {
                if (e.ctrlKey && e.keyCode == 13) box.send_forum_comment();
            });

            comments_wrap.find('.sp_but_cancel_reply').click(function (e) {
                e.preventDefault();
                box.reply_forum_post(0);
                return false;
            });

            form.submit(function () {
                return box.send_forum_comment();
            });

            if (console && options.debug) console.log('Comments: (FORUM) Form inited');
        },


        init_forum_posts: function () {
            $('.sp_comment_reply').unbind().live('click', function (e) {
                e.preventDefault();
                return box.reply_forum_post($(this).closest('.sp_c_comm_def_list_d').attr('id').split('-')[1]);
            });

            $('.sp_comments_delete').unbind().live('click', function (e) {
                e.preventDefault();
                return box.delete_forum_post($(this).closest('.sp_c_comm_def_list_d').attr('id').split('-')[1], $(this).attr('href'));
            });

            $('.sb_c_pages_def_type a').unbind().live('click', function (e) {
                e.preventDefault();
                var match = ($(this).attr('href')).match(/pagen=(\d+)/);
                if (match) {
                    box.update_forum_posts(match[1]);
                    document.location.href = "#comments";
                    return false;
                }
            });

            $('.sb_c_pages_def_nums a').unbind().live('click', function (e) {
                e.preventDefault();
                box.update_forum_posts(($(this).attr('href')).match(/pagen=(\d+)/)[1]);
                document.location.href = "#comments";
                return false;
            });

            $('.sp_c_comm_def_list_show').unbind().live('click', function (e) {
                e.preventDefault();
                $('#comment-' + $(this).attr('id').split('-')[1]).removeClass('sp_c_comm_def_list_hidden');
                return false;
            });

            var max_width = comments.width();
            comments.find('img').each(function () {
                if ($(this).width() > max_width)
                    $(this).width('100%');
            });

            if (console && options.debug) console.log('Comments: (FORUM) posts inited');
        },


        init_spb_comments: function () {
            document.comments.init();
        },


        safe_panel_toggle: function () {
            // Log
            if (!form) if (console && options.debug) console.log('Comments: (SAFE PANEL) FORM NOT FOUND!');
            if (console && options.debug) console.log('Comments: (SAFE PANEL) Toggle called');
            // End log

            if (!safe_panel.hasClass('show')) {
                safe_panel.addClass('show').stop().css({
                    opacity: 0,
                    left: form.offset().left - 10,
                    top: form.offset().top - 10,
                    width: form.width() + 20,
                    height: form.height() + 20
                }).animate({opacity: 0.5});
            }
            else {
                safe_panel.removeClass('show').stop().animate({opacity: 0}, function () {
                    $(this).height(0)
                });
            }
        },


        reply_forum_post: function (pid) {
            box.safe_panel_toggle();
            var scriptPath = (options.debug) ? '/ipbcomments.php?do=form&x_real_path=' : '/ipbcomments?do=form&x_real_path=';
            var url = scriptPath + options.xreal + '&quote_pid=' + pid + (options.is_popup ? '&popup_comments=true' : '');
            $.ajax({
                type: "GET",
                dataType: 'html',
                url: url,
                success: function (data) {
                    $('.sp_comments_form').html(data);
                    box.safe_panel_toggle();
                    box.init_forum_form();
                    form.find('textarea').focus();
                    if (console && options.debug) console.log('Comments: (SEND REPLY) Returned from AJAX: ' + data);
                },
                error: function () {
                    if (console && options.debug) console.log('Comments: (SEND REPLY) ERROR in ajax returned!');
                }
            });

            return false;
        },


        send_forum_comment: function () {
            if (sending) return false;

            sending = true;

            var data = form.serialize() + '&clienttitle=' + options.title;

            box.safe_panel_toggle();

            if (console && options.debug) console.log('data params: ' + data);
            if (console && options.debug) console.log('form.action: ' + form.attr('action'));

            $.ajax({
                type: "POST",
                dataType: 'json',
                url: form.attr('action'),
                data: data,
                success: function (json) {
                    sending = false;
                    form.find('textarea').val('').focus();
                    if (json.html) {
                        pagen_now = 0;
                        box.replace_forum_comments(json.html);
                    }
                    else {
                        if (console && options.debug) console.log('Not json.html');
                        if (console && options.debug) console.log('Пришло вот это:');
                        if (console && options.debug) console.log(json);
                    }
                    box.safe_panel_toggle();
                    if (console && options.debug) console.log('Comments: (SEND COMMENT) Returned from AJAX: ' + json);
                },
                error: function () {
                    sending = false;
                    box.safe_panel_toggle();
                    if (console && options.debug) console.log('Comments: (SEND COMMENT) ERROR in ajax returned!');
                }
            });


            return false;
        },


        update_forum_posts: function (pagen) {
            if (typeof pagen == 'undefined') pagen = pagen_now;
            else pagen_now = pagen;

            var scriptPath = (options.debug) ? '/ipbcomments.php?do=update&x_real_path=' : '/ipbcomments?do=update&x_real_path=';
            var url = scriptPath + options.xreal + '&pagen=' + pagen + '&rnd=' + Math.random();
            $.ajax({
                dataType: "json",
                url: url,
                success: function (data) {
                    if (data.html) {
                        box.replace_forum_comments(data.html);
                        $('#sp_update_comments_loader').stop().animate({opacity: 0}, 300, function () {
                            $(this).remove()
                        });
                        $('#sp_update_comments').attr('disabled', false);
                        if (console && options.debug) console.log('Comments: (UPDATE COMMENTS) Returned from AJAX: ' + data);
                    }
                },
                error: function () {
                    if (console && options.debug) console.log('Comments: (UPDATE COMMENTS) ERROR in ajax returned!');
                }
            });
        },


        replace_forum_comments: function (html) {
            if (console && options.debug) console.log('Comments div: ' + comments[0]);
            comments_wrap.find('.sp_comments_list:first').html(html);
            //box.init_forum_posts();
            if (console && options.debug) console.log('Comments: (function replace_comments) comments replaced with HTML: ' + html);
        },


        delete_forum_post: function (pid, url) {
            if (!confirm('Вы уверены, что хотите удалить этот комментарий?'))  return false;
            $.ajax({
                dataType: "json",
                url: url,
                success: function (data) {
                    if (data.ok) {
                        $('#comment-' + pid).slideUp('fast', function () {
                            $(this).remove();
                            box.update_forum_posts();
                        });
                    }
                    if (console && options.debug) console.log('Comments: (DELETE COMMENT) Ajax return data: ' + data);
                },
                error: function (data) {
                    if (console && options.debug) console.log('Comments: (DELETE COMMENT) ERROR in ajax returned!');
                }
            });
            return false;
        },


        load_forum_form: function (rnd) {
            var scriptPath = (options.debug) ? '/ipbcomments.php?do=show&x_real_path=' : '/ipbcomments?do=show&x_real_path=';
            var url = scriptPath + options.xreal + (options.is_popup ? '&popup_comments=true' : '') + '&js=' + options.js,
                match = (document.location.href).match(/pagen=(\d+)/);
            if (match)  url += '&pagen=' + match[1];
            if (rnd)    url += '&rnd=' + Math.random();
            $.ajax({
                url: url,
                async: false,
                success: function (data) {
                    if (data) {
                        $('#sp_c_comm_def_comms').html(data);
                        box.init_forum_form();
                    }
                    else {
                        setTimeout(function () {
                            box.load_forum_form(1)
                        }, 1000)
                    }
                    if (console && options.debug) console.log('Comments: (LOAD FORM) HTML returned from Ajax:' + data);
                },
                error: function () {
                    if (console && options.debug) console.log('Comments: (LOAD FORM) ERROR in ajax returned!');
                }
            });

            box.init_forum_posts();
        }
    };

    box.init();
};
/* Comments (end) */



/* start spb_comm */
Drupal = Drupal || {};
Drupal.spb_comms = Drupal.spb_comms || {}
Drupal.spb_comms.loaded = Drupal.spb_comms.loaded || false;

if (!Drupal.spb_comms.parseWindowLocation) {
    Drupal.spb_comms.parseWindowLocation = function (aLocation) {
        var re = /[?&]([^=]+)=([^&]+)/g,
            maches = null,
            urlParts = new Array();

        maches = aLocation.match(re);

        if (maches != null) {
            for (var i = 0; i < maches.length; i++) {
                var urlPart = maches[i].split("=");
                urlParts[urlPart[0].substr(1)] = urlPart[1];
            }
        }
        return urlParts;
    }
}

if (!Drupal.spb_comms.loaded) {
    Drupal.spb_comms.loaded = true;
    $(document).ready(function () {
        var comms_place = $('#spb-comments-new');
        if (Drupal.settings.spb_comm &&
            Drupal.settings.spb_comm.nodealias &&
            Drupal.settings.spb_comm.nodetitle &&
            comms_place.length) {
            comms_place.show();

            var current_time = new Date(),
                unixtime_ms = current_time.getTime(),
                unixtime = parseInt(unixtime_ms / 1000);

            document.cookie = "sportbox_comments_flood=" + unixtime + ";path=/;domain=.sportbox.ru;";
            var $GET = Drupal.spb_comms.parseWindowLocation(window.location.href);

            if ($GET['comments_number'] != null) {
                var anchorPosition = $GET['comments_number'].indexOf('#');
                if (anchorPosition > -1) $GET['comments_number'] = $GET['comments_number'].substring(0, anchorPosition);
                document.cookie = "sportbox_comments_number=" + $GET['comments_number'] + ";expire=" + unixtime + 3600000 + ";path=/;domain=.sportbox.ru;"
            }

            var xreal;

            if (!Drupal.settings.spb_comm.site_url || (Drupal.settings.spb_comm.site_url == '')) {
                // here goes full url in alias
                xreal = Drupal.settings.spb_comm.nodealias;
            }
            else {
                xreal = Drupal.settings.spb_comm.site_url + '/' + Drupal.settings.spb_comm.nodealias;
            }

            //for real debug use that
            //var xreal = 'drupal6.d9.test.sportbox.ru/' + Drupal.settings.spb_comm.nodealias;
            xreal = xreal.replace(/%23/g, '#');

            var options = {xreal: xreal, auth_cookie: Drupal.settings.spb_comm.auth_cookie};

            if (Drupal.settings.spb_comm.sportkindname) {
                options.title = Drupal.settings.spb_comm.sportkindname + ". " + Drupal.settings.spb_comm.nodetitle;
            }
            else {
                options.title = Drupal.settings.spb_comm.nodetitle;
            }

            //$('#spb-comments-new').spb_comments(options);
            if ($('#node_comments_btn_show').length != 0) {
                $('#node_comments_btn_show').on('click', function (e) {
                    e.preventDefault();
                    spb_scripts.spb_comments(options);
                });
            } else {
                spb_scripts.spb_comments(options);
            }

        }
    });
}
/* End spb_comm */


function processNewPollVote(obj, poll_id) {

    var pollContainerId = 'spbPoll_' + poll_id;
    var pollObj = jQuery('#' + pollContainerId);
    if (!pollObj.length) {
        return false;
    }

    var pollAction = pollObj.find('form').attr('action');

    var answers = [];

    jQuery("input:checked", pollObj).each(function () {
        answers.push(jQuery(this).val());
    });

    if (!answers.length) {
        alert('Ни один из вариантов не выбран');
        return false;
    }

    var url = pollAction + '?answer[]=' + answers.join('&answer[]=');

    $.ajax({
        cache: true,
        async: true,
        url: url,
        type: 'GET',
        dataType: 'html',
        success: function (data, textStatus) {
            if (textStatus == 'success') {
                jQuery("#" + pollContainerId).html(data);

                var date = new Date();
                date.setHours(date.getHours() + 6);
                $.cookie("participate_in_vote_as_anonymous", 1, {expires: date, path: '/'});
            }
        }
    });

    return false;

}
var site_menu = {

    sidebar: null,
    sidebar_container: null,
    menu_btn: null,
    menu_item: null,
    menu_loaded: false,
    menu_opened: false,

    init: function () {
        var touchStartPos, touchEndPos;

        site_menu.sidebar = $("#sidebar");
        site_menu.menu_btn = $("#menu-btn-js");
        site_menu.sidebar_container = $('.row-offcanvas');


        site_menu.menu_btn.on('click', function (event) {
            event.stopPropagation();
            event.preventDefault();
            site_menu.openMenu();
        });

        $(document).on({
            'click': function (event) {
                if (( $(event.target).parents('#sidebar').length === 0 ) &&
                    ( $(event.target).attr('id') !== 'menu-btn-js' ) &&
                    site_menu.menu_opened) {
                    site_menu.closeOnSwipe();
                }
            },
            'touchstart touchend': function (event) {
                if (event.type === 'touchstart') {
                    touchStartPos = {
                        'x': event.originalEvent.targetTouches[0].pageX,
                        'y': event.originalEvent.targetTouches[0].pageY
                    };
                } else if (event.type === 'touchend') {
                    touchEndPos = {
                        'x': event.originalEvent.changedTouches[0].pageX,
                        'y': event.originalEvent.changedTouches[0].pageY
                    };

                    if ((touchStartPos.x > touchEndPos.x + 50) && (touchEndPos.y < touchStartPos.y + 50)) {
                        site_menu.closeOnSwipe();
                    }
                    if ((touchStartPos.x === touchEndPos.x) && (touchEndPos.y === touchStartPos.y)) {
                        if (( $(event.target).parents('#sidebar').length === 0 ) && ( $(event.target).parents('#menu-btn-js').length === 0 ) &&
                            ( $(event.target).attr('id') !== 'menu-btn-js' ) &&
                            site_menu.menu_opened) {
                            event.stopPropagation();
                            site_menu.closeOnSwipe();
                        }
                    }
                }
            }
        });


        site_menu.sidebar.on('click', '.b-side-menu > li > a > .tap-area', function (event) {
            var elem = $(this).parent().parent();
            var autoHeight;

            event.stopPropagation();
            event.preventDefault();

            if (elem.hasClass('opened')) {
                elem.find('div').eq(0).animate({
                    'height': '0'
                }, 200, function () {
                    elem.removeClass('opened');
                    elem.find('div').eq(0).css({
                        'display': 'none'
                    })
                });

                return;
            }

            autoHeight = elem.find('div').eq(0).css('height', 'auto').height();
            elem.addClass('opened');
            elem.find('div').eq(0).css({
                'display': 'block',
                'height': '0'
            }).animate({
                'height': autoHeight
            }, 300);
        });

        $('#site_menu_more').on('click', site_menu.loadFullMenu);
        site_menu.events.menuLoaded();
    },

    events: {
        menuLoaded: function () {
            var window_width = $(window).width();
            var current_path = document.location.pathname;
            var blur = $('.blur');
            var hover_timeout;

            site_menu.menu_item = $('.b-side-menu > li');

            site_menu.menu_item.find('a').each(function () {
                var item_href = $(this).attr("href");
                var current_path_prefix = current_path.substring(0, item_href.length);

                if (item_href == '/') {
                    return;
                }

                if (current_path_prefix == item_href) {
                    site_menu.menu_item.removeClass("active");
                    $(this).parent().addClass('active');
                    return false; //break loop
                }
            });

            site_menu.menu_item.on({
                'mouseenter': function (event) {
                    if (window_width > 1165) {
                        var this_li = $(this);
                        clearTimeout(hover_timeout);
                        hover_timeout = setTimeout(function () {
                            site_menu.menu_item.removeClass("opened");
                            this_li.addClass("opened");
                            site_menu.menu_opened = true;
                            if (!this_li.hasClass('empty') && !this_li.hasClass('current') && !this_li.hasClass('children') && site_menu.menu_opened) {
                                blur.css('display', 'block');
                            } else {
                                blur.css('display', 'none');
                                $('.b-side-menu > li').removeClass("opened");
                                site_menu.menu_opened = false;
                            }
                        }, 350);
                    } else {
                        event.preventDefault();
                    }
                },
                'mouseleave': function (event) {
                    if (window_width > 1165) {
                        clearTimeout(hover_timeout);
                        hover_timeout = setTimeout(function () {
                            $('.b-side-menu > li').removeClass("opened");
                            site_menu.menu_opened = false;
                            blur.css('display', 'none');
                        }, 350);
                    } else {
                        event.preventDefault();
                    }
                },
                'hover': function (event) {
                    event.preventDefault();
                }
            });
        }
    },

    loadFullMenu: function (event) {
        var siteMenuMore = $("#site_menu_more");

        siteMenuMore.addClass("loading");

        event.preventDefault();

        $.get("/get_site_more_menu", {}, function (data) {
            siteMenuMore.removeClass("loading").replaceWith(data);
            site_menu.events.menuLoaded();
        }, "html")
    },

    openMenu: function () {
        var blur = $('.blur');

        site_menu.sidebar_container.toggleClass('active');

        if (site_menu.sidebar_container.hasClass('active')) {
            site_menu.menu_opened = true;
            blur.css('display', 'block');
        } else {
            site_menu.menu_opened = false;
            blur.css('display', 'none');
        }
    },

    closeOnSwipe: function () {
        if (site_menu.menu_opened) {
            site_menu.menu_btn.click();
        }
    }
};

$(site_menu.init);
/* perfect-scrollbar v0.6.2 */
(function e(t, n, r) {
    function s(o, u) {
        if (!n[o]) {
            if (!t[o]) {
                var a = typeof require == "function" && require;
                if (!u && a)return a(o, !0);
                if (i)return i(o, !0);
                var f = new Error("Cannot find module '" + o + "'");
                throw f.code = "MODULE_NOT_FOUND", f
            }
            var l = n[o] = {exports: {}};
            t[o][0].call(l.exports, function (e) {
                var n = t[o][1][e];
                return s(n ? n : e)
            }, l, l.exports, e, t, n, r)
        }
        return n[o].exports
    }

    var i = typeof require == "function" && require;
    for (var o = 0; o < r.length; o++)s(r[o]);
    return s
})({1: [function (require, module, exports) {
    /* Copyright (c) 2015 Hyunje Alex Jun and other contributors
     * Licensed under the MIT License
     */
    'use strict';

    var ps = require('../main')
        , psInstances = require('../plugin/instances');

    function mountJQuery(jQuery) {
        jQuery.fn.perfectScrollbar = function (settingOrCommand) {
            return this.each(function () {
                if (typeof settingOrCommand === 'object' ||
                    typeof settingOrCommand === 'undefined') {
                    // If it's an object or none, initialize.
                    var settings = settingOrCommand;

                    if (!psInstances.get(this)) {
                        ps.initialize(this, settings);
                    }
                } else {
                    // Unless, it may be a command.
                    var command = settingOrCommand;

                    if (command === 'update') {
                        ps.update(this);
                    } else if (command === 'destroy') {
                        ps.destroy(this);
                    }
                }

                return jQuery(this);
            });
        };
    }

    if (typeof define === 'function' && define.amd) {
        // AMD. Register as an anonymous module.
        define(['jquery'], mountJQuery);
    } else {
        var jq = window.jQuery ? window.jQuery : window.$;
        if (typeof jq !== 'undefined') {
            mountJQuery(jq);
        }
    }

    module.exports = mountJQuery;

}, {"../main": 7, "../plugin/instances": 18}], 2: [function (require, module, exports) {
    /* Copyright (c) 2015 Hyunje Alex Jun and other contributors
     * Licensed under the MIT License
     */
    'use strict';

    function oldAdd(element, className) {
        var classes = element.className.split(' ');
        if (classes.indexOf(className) < 0) {
            classes.push(className);
        }
        element.className = classes.join(' ');
    }

    function oldRemove(element, className) {
        var classes = element.className.split(' ');
        var idx = classes.indexOf(className);
        if (idx >= 0) {
            classes.splice(idx, 1);
        }
        element.className = classes.join(' ');
    }

    exports.add = function (element, className) {
        if (element.classList) {
            element.classList.add(className);
        } else {
            oldAdd(element, className);
        }
    };

    exports.remove = function (element, className) {
        if (element.classList) {
            element.classList.remove(className);
        } else {
            oldRemove(element, className);
        }
    };

    exports.list = function (element) {
        if (element.classList) {
            return element.classList;
        } else {
            return element.className.split(' ');
        }
    };

}, {}], 3: [function (require, module, exports) {
    /* Copyright (c) 2015 Hyunje Alex Jun and other contributors
     * Licensed under the MIT License
     */
    'use strict';

    exports.e = function (tagName, className) {
        var element = document.createElement(tagName);
        element.className = className;
        return element;
    };

    exports.appendTo = function (child, parent) {
        parent.appendChild(child);
        return child;
    };

    function cssGet(element, styleName) {
        return window.getComputedStyle(element)[styleName];
    }

    function cssSet(element, styleName, styleValue) {
        if (typeof styleValue === 'number') {
            styleValue = styleValue.toString() + 'px';
        }
        element.style[styleName] = styleValue;
        return element;
    }

    function cssMultiSet(element, obj) {
        for (var key in obj) {
            var val = obj[key];
            if (typeof val === 'number') {
                val = val.toString() + 'px';
            }
            element.style[key] = val;
        }
        return element;
    }

    exports.css = function (element, styleNameOrObject, styleValue) {
        if (typeof styleNameOrObject === 'object') {
            // multiple set with object
            return cssMultiSet(element, styleNameOrObject);
        } else {
            if (typeof styleValue === 'undefined') {
                return cssGet(element, styleNameOrObject);
            } else {
                return cssSet(element, styleNameOrObject, styleValue);
            }
        }
    };

    exports.matches = function (element, query) {
        if (typeof element.matches !== 'undefined') {
            return element.matches(query);
        } else {
            if (typeof element.matchesSelector !== 'undefined') {
                return element.matchesSelector(query);
            } else if (typeof element.webkitMatchesSelector !== 'undefined') {
                return element.webkitMatchesSelector(query);
            } else if (typeof element.mozMatchesSelector !== 'undefined') {
                return element.mozMatchesSelector(query);
            } else if (typeof element.msMatchesSelector !== 'undefined') {
                return element.msMatchesSelector(query);
            }
        }
    };

    exports.remove = function (element) {
        if (typeof element.remove !== 'undefined') {
            element.remove();
        } else {
            if (element.parentNode) {
                element.parentNode.removeChild(element);
            }
        }
    };

}, {}], 4: [function (require, module, exports) {
    /* Copyright (c) 2015 Hyunje Alex Jun and other contributors
     * Licensed under the MIT License
     */
    'use strict';

    var EventElement = function (element) {
        this.element = element;
        this.events = {};
    };

    EventElement.prototype.bind = function (eventName, handler) {
        if (typeof this.events[eventName] === 'undefined') {
            this.events[eventName] = [];
        }
        this.events[eventName].push(handler);
        this.element.addEventListener(eventName, handler, false);
    };

    EventElement.prototype.unbind = function (eventName, handler) {
        var isHandlerProvided = (typeof handler !== 'undefined');
        this.events[eventName] = this.events[eventName].filter(function (hdlr) {
            if (isHandlerProvided && hdlr !== handler) {
                return true;
            }
            this.element.removeEventListener(eventName, hdlr, false);
            return false;
        }, this);
    };

    EventElement.prototype.unbindAll = function () {
        for (var name in this.events) {
            this.unbind(name);
        }
    };

    var EventManager = function () {
        this.eventElements = [];
    };

    EventManager.prototype.eventElement = function (element) {
        var ee = this.eventElements.filter(function (eventElement) {
            return eventElement.element === element;
        })[0];
        if (typeof ee === 'undefined') {
            ee = new EventElement(element);
            this.eventElements.push(ee);
        }
        return ee;
    };

    EventManager.prototype.bind = function (element, eventName, handler) {
        this.eventElement(element).bind(eventName, handler);
    };

    EventManager.prototype.unbind = function (element, eventName, handler) {
        this.eventElement(element).unbind(eventName, handler);
    };

    EventManager.prototype.unbindAll = function () {
        for (var i = 0; i < this.eventElements.length; i++) {
            this.eventElements[i].unbindAll();
        }
    };

    EventManager.prototype.once = function (element, eventName, handler) {
        var ee = this.eventElement(element);
        var onceHandler = function (e) {
            ee.unbind(eventName, onceHandler);
            handler(e);
        };
        ee.bind(eventName, onceHandler);
    };

    module.exports = EventManager;

}, {}], 5: [function (require, module, exports) {
    /* Copyright (c) 2015 Hyunje Alex Jun and other contributors
     * Licensed under the MIT License
     */
    'use strict';

    module.exports = (function () {
        function s4() {
            return Math.floor((1 + Math.random()) * 0x10000)
                .toString(16)
                .substring(1);
        }

        return function () {
            return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
                s4() + '-' + s4() + s4() + s4();
        };
    })();

}, {}], 6: [function (require, module, exports) {
    /* Copyright (c) 2015 Hyunje Alex Jun and other contributors
     * Licensed under the MIT License
     */
    'use strict';

    var cls = require('./class')
        , d = require('./dom');

    exports.toInt = function (x) {
        if (typeof x === 'string') {
            return parseInt(x, 10);
        } else {
            return ~~x;
        }
    };

    exports.clone = function (obj) {
        if (obj === null) {
            return null;
        } else if (typeof obj === 'object') {
            var result = {};
            for (var key in obj) {
                result[key] = this.clone(obj[key]);
            }
            return result;
        } else {
            return obj;
        }
    };

    exports.extend = function (original, source) {
        var result = this.clone(original);
        for (var key in source) {
            result[key] = this.clone(source[key]);
        }
        return result;
    };

    exports.isEditable = function (el) {
        return d.matches(el, "input,[contenteditable]") ||
            d.matches(el, "select,[contenteditable]") ||
            d.matches(el, "textarea,[contenteditable]") ||
            d.matches(el, "button,[contenteditable]");
    };

    exports.removePsClasses = function (element) {
        var clsList = cls.list(element);
        for (var i = 0; i < clsList.length; i++) {
            var className = clsList[i];
            if (className.indexOf('ps-') === 0) {
                cls.remove(element, className);
            }
        }
    };

    exports.outerWidth = function (element) {
        return this.toInt(d.css(element, 'width')) +
            this.toInt(d.css(element, 'paddingLeft')) +
            this.toInt(d.css(element, 'paddingRight')) +
            this.toInt(d.css(element, 'borderLeftWidth')) +
            this.toInt(d.css(element, 'borderRightWidth'));
    };

    exports.startScrolling = function (element, axis) {
        cls.add(element, 'ps-in-scrolling');
        if (typeof axis !== 'undefined') {
            cls.add(element, 'ps-' + axis);
        } else {
            cls.add(element, 'ps-x');
            cls.add(element, 'ps-y');
        }
    };

    exports.stopScrolling = function (element, axis) {
        cls.remove(element, 'ps-in-scrolling');
        if (typeof axis !== 'undefined') {
            cls.remove(element, 'ps-' + axis);
        } else {
            cls.remove(element, 'ps-x');
            cls.remove(element, 'ps-y');
        }
    };

    exports.env = {
        isWebKit: 'WebkitAppearance' in document.documentElement.style,
        supportsTouch: (('ontouchstart' in window) || window.DocumentTouch && document instanceof window.DocumentTouch),
        supportsIePointer: window.navigator.msMaxTouchPoints !== null
    };

}, {"./class": 2, "./dom": 3}], 7: [function (require, module, exports) {
    /* Copyright (c) 2015 Hyunje Alex Jun and other contributors
     * Licensed under the MIT License
     */
    'use strict';

    var destroy = require('./plugin/destroy')
        , initialize = require('./plugin/initialize')
        , update = require('./plugin/update');

    module.exports = {
        initialize: initialize,
        update: update,
        destroy: destroy
    };

}, {"./plugin/destroy": 9, "./plugin/initialize": 17, "./plugin/update": 20}], 8: [function (require, module, exports) {
    /* Copyright (c) 2015 Hyunje Alex Jun and other contributors
     * Licensed under the MIT License
     */
    'use strict';

    module.exports = {
        wheelSpeed: 1,
        wheelPropagation: false,
        swipePropagation: true,
        minScrollbarLength: null,
        maxScrollbarLength: null,
        useBothWheelAxes: false,
        useKeyboard: true,
        suppressScrollX: false,
        suppressScrollY: false,
        scrollXMarginOffset: 0,
        scrollYMarginOffset: 0
    };

}, {}], 9: [function (require, module, exports) {
    /* Copyright (c) 2015 Hyunje Alex Jun and other contributors
     * Licensed under the MIT License
     */
    'use strict';

    var d = require('../lib/dom')
        , h = require('../lib/helper')
        , instances = require('./instances');

    module.exports = function (element) {
        var i = instances.get(element);

        i.event.unbindAll();
        d.remove(i.scrollbarX);
        d.remove(i.scrollbarY);
        d.remove(i.scrollbarXRail);
        d.remove(i.scrollbarYRail);
        h.removePsClasses(element);

        instances.remove(element);
    };

}, {"../lib/dom": 3, "../lib/helper": 6, "./instances": 18}], 10: [function (require, module, exports) {
    /* Copyright (c) 2015 Hyunje Alex Jun and other contributors
     * Licensed under the MIT License
     */
    'use strict';

    var h = require('../../lib/helper')
        , instances = require('../instances')
        , updateGeometry = require('../update-geometry');

    function bindClickRailHandler(element, i) {
        function pageOffset(el) {
            return el.getBoundingClientRect();
        }

        var stopPropagation = window.Event.prototype.stopPropagation.bind;

        i.event.bind(i.scrollbarY, 'click', stopPropagation);
        i.event.bind(i.scrollbarYRail, 'click', function (e) {
            var halfOfScrollbarLength = h.toInt(i.scrollbarYHeight / 2);
            var positionTop = e.pageY - pageOffset(i.scrollbarYRail).top - halfOfScrollbarLength;
            var maxPositionTop = i.containerHeight - i.scrollbarYHeight;
            var positionRatio = positionTop / maxPositionTop;

            if (positionRatio < 0) {
                positionRatio = 0;
            } else if (positionRatio > 1) {
                positionRatio = 1;
            }

            element.scrollTop = (i.contentHeight - i.containerHeight) * positionRatio;
            updateGeometry(element);
        });

        i.event.bind(i.scrollbarX, 'click', stopPropagation);
        i.event.bind(i.scrollbarXRail, 'click', function (e) {
            var halfOfScrollbarLength = h.toInt(i.scrollbarXWidth / 2);
            var positionLeft = e.pageX - pageOffset(i.scrollbarXRail).left - halfOfScrollbarLength;
            console.log(e.pageX, i.scrollbarXRail.offsetLeft);
            var maxPositionLeft = i.containerWidth - i.scrollbarXWidth;
            var positionRatio = positionLeft / maxPositionLeft;

            if (positionRatio < 0) {
                positionRatio = 0;
            } else if (positionRatio > 1) {
                positionRatio = 1;
            }

            element.scrollLeft = (i.contentWidth - i.containerWidth) * positionRatio;
            updateGeometry(element);
        });
    }

    module.exports = function (element) {
        var i = instances.get(element);
        bindClickRailHandler(element, i);
    };

}, {"../../lib/helper": 6, "../instances": 18, "../update-geometry": 19}], 11: [function (require, module, exports) {
    /* Copyright (c) 2015 Hyunje Alex Jun and other contributors
     * Licensed under the MIT License
     */
    'use strict';

    var d = require('../../lib/dom')
        , h = require('../../lib/helper')
        , instances = require('../instances')
        , updateGeometry = require('../update-geometry');

    function bindMouseScrollXHandler(element, i) {
        var currentLeft = null;
        var currentPageX = null;

        function updateScrollLeft(deltaX) {
            var newLeft = currentLeft + deltaX;
            var maxLeft = i.containerWidth - i.scrollbarXWidth;

            if (newLeft < 0) {
                i.scrollbarXLeft = 0;
            } else if (newLeft > maxLeft) {
                i.scrollbarXLeft = maxLeft;
            } else {
                i.scrollbarXLeft = newLeft;
            }

            var scrollLeft = h.toInt(i.scrollbarXLeft * (i.contentWidth - i.containerWidth) / (i.containerWidth - i.scrollbarXWidth));
            element.scrollLeft = scrollLeft;
        }

        var mouseMoveHandler = function (e) {
            updateScrollLeft(e.pageX - currentPageX);
            updateGeometry(element);
            e.stopPropagation();
            e.preventDefault();
        };

        var mouseUpHandler = function () {
            h.stopScrolling(element, 'x');
            i.event.unbind(i.ownerDocument, 'mousemove', mouseMoveHandler);
        };

        i.event.bind(i.scrollbarX, 'mousedown', function (e) {
            currentPageX = e.pageX;
            currentLeft = h.toInt(d.css(i.scrollbarX, 'left'));
            h.startScrolling(element, 'x');

            i.event.bind(i.ownerDocument, 'mousemove', mouseMoveHandler);
            i.event.once(i.ownerDocument, 'mouseup', mouseUpHandler);

            e.stopPropagation();
            e.preventDefault();
        });
    }

    function bindMouseScrollYHandler(element, i) {
        var currentTop = null;
        var currentPageY = null;

        function updateScrollTop(deltaY) {
            var newTop = currentTop + deltaY;
            var maxTop = i.containerHeight - i.scrollbarYHeight;

            if (newTop < 0) {
                i.scrollbarYTop = 0;
            } else if (newTop > maxTop) {
                i.scrollbarYTop = maxTop;
            } else {
                i.scrollbarYTop = newTop;
            }

            var scrollTop = h.toInt(i.scrollbarYTop * (i.contentHeight - i.containerHeight) / (i.containerHeight - i.scrollbarYHeight));
            element.scrollTop = scrollTop;
        }

        var mouseMoveHandler = function (e) {
            updateScrollTop(e.pageY - currentPageY);
            updateGeometry(element);
            e.stopPropagation();
            e.preventDefault();
        };

        var mouseUpHandler = function () {
            h.stopScrolling(element, 'y');
            i.event.unbind(i.ownerDocument, 'mousemove', mouseMoveHandler);
        };

        i.event.bind(i.scrollbarY, 'mousedown', function (e) {
            currentPageY = e.pageY;
            currentTop = h.toInt(d.css(i.scrollbarY, 'top'));
            h.startScrolling(element, 'y');

            i.event.bind(i.ownerDocument, 'mousemove', mouseMoveHandler);
            i.event.once(i.ownerDocument, 'mouseup', mouseUpHandler);

            e.stopPropagation();
            e.preventDefault();
        });
    }

    module.exports = function (element) {
        var i = instances.get(element);
        bindMouseScrollXHandler(element, i);
        bindMouseScrollYHandler(element, i);
    };

}, {"../../lib/dom": 3, "../../lib/helper": 6, "../instances": 18, "../update-geometry": 19}], 12: [function (require, module, exports) {
    /* Copyright (c) 2015 Hyunje Alex Jun and other contributors
     * Licensed under the MIT License
     */
    'use strict';

    var h = require('../../lib/helper')
        , instances = require('../instances')
        , updateGeometry = require('../update-geometry');

    function bindKeyboardHandler(element, i) {
        var hovered = false;
        i.event.bind(element, 'mouseenter', function () {
            hovered = true;
        });
        i.event.bind(element, 'mouseleave', function () {
            hovered = false;
        });

        var shouldPrevent = false;

        function shouldPreventDefault(deltaX, deltaY) {
            var scrollTop = element.scrollTop;
            if (deltaX === 0) {
                if (!i.scrollbarYActive) {
                    return false;
                }
                if ((scrollTop === 0 && deltaY > 0) || (scrollTop >= i.contentHeight - i.containerHeight && deltaY < 0)) {
                    return !i.settings.wheelPropagation;
                }
            }

            var scrollLeft = element.scrollLeft;
            if (deltaY === 0) {
                if (!i.scrollbarXActive) {
                    return false;
                }
                if ((scrollLeft === 0 && deltaX < 0) || (scrollLeft >= i.contentWidth - i.containerWidth && deltaX > 0)) {
                    return !i.settings.wheelPropagation;
                }
            }
            return true;
        }

        i.event.bind(i.ownerDocument, 'keydown', function (e) {
            if (e.isDefaultPrevented && e.isDefaultPrevented()) {
                return;
            }

            if (!hovered) {
                return;
            }

            var activeElement = document.activeElement ? document.activeElement : i.ownerDocument.activeElement;
            if (activeElement) {
                // go deeper if element is a webcomponent
                while (activeElement.shadowRoot) {
                    activeElement = activeElement.shadowRoot.activeElement;
                }
                if (h.isEditable(activeElement)) {
                    return;
                }
            }

            var deltaX = 0;
            var deltaY = 0;

            switch (e.which) {
                case 37: // left
                    deltaX = -30;
                    break;
                case 38: // up
                    deltaY = 30;
                    break;
                case 39: // right
                    deltaX = 30;
                    break;
                case 40: // down
                    deltaY = -30;
                    break;
                case 33: // page up
                    deltaY = 90;
                    break;
                case 32: // space bar
                case 34: // page down
                    deltaY = -90;
                    break;
                case 35: // end
                    if (e.ctrlKey) {
                        deltaY = -i.contentHeight;
                    } else {
                        deltaY = -i.containerHeight;
                    }
                    break;
                case 36: // home
                    if (e.ctrlKey) {
                        deltaY = element.scrollTop;
                    } else {
                        deltaY = i.containerHeight;
                    }
                    break;
                default:
                    return;
            }

            element.scrollTop = element.scrollTop - deltaY;
            element.scrollLeft = element.scrollLeft + deltaX;
            updateGeometry(element);

            shouldPrevent = shouldPreventDefault(deltaX, deltaY);
            if (shouldPrevent) {
                e.preventDefault();
            }
        });
    }

    module.exports = function (element) {
        var i = instances.get(element);
        bindKeyboardHandler(element, i);
    };

}, {"../../lib/helper": 6, "../instances": 18, "../update-geometry": 19}], 13: [function (require, module, exports) {
    /* Copyright (c) 2015 Hyunje Alex Jun and other contributors
     * Licensed under the MIT License
     */
    'use strict';

    var h = require('../../lib/helper')
        , instances = require('../instances')
        , updateGeometry = require('../update-geometry');

    function bindMouseWheelHandler(element, i) {
        var shouldPrevent = false;

        function shouldPreventDefault(deltaX, deltaY) {
            var scrollTop = element.scrollTop;
            if (deltaX === 0) {
                if (!i.scrollbarYActive) {
                    return false;
                }
                if ((scrollTop === 0 && deltaY > 0) || (scrollTop >= i.contentHeight - i.containerHeight && deltaY < 0)) {
                    return !i.settings.wheelPropagation;
                }
            }

            var scrollLeft = element.scrollLeft;
            if (deltaY === 0) {
                if (!i.scrollbarXActive) {
                    return false;
                }
                if ((scrollLeft === 0 && deltaX < 0) || (scrollLeft >= i.contentWidth - i.containerWidth && deltaX > 0)) {
                    return !i.settings.wheelPropagation;
                }
            }
            return true;
        }

        function getDeltaFromEvent(e) {
            var deltaX = e.deltaX;
            var deltaY = -1 * e.deltaY;

            if (typeof deltaX === "undefined" || typeof deltaY === "undefined") {
                // OS X Safari
                deltaX = -1 * e.wheelDeltaX / 6;
                deltaY = e.wheelDeltaY / 6;
            }

            if (e.deltaMode && e.deltaMode === 1) {
                // Firefox in deltaMode 1: Line scrolling
                deltaX *= 10;
                deltaY *= 10;
            }

            if (deltaX !== deltaX && deltaY !== deltaY/* NaN checks */) {
                // IE in some mouse drivers
                deltaX = 0;
                deltaY = e.wheelDelta;
            }

            return [deltaX, deltaY];
        }

        function shouldBeConsumedByTextarea(deltaX, deltaY) {
            var hoveredTextarea = element.querySelector('textarea:hover');
            if (hoveredTextarea) {
                var maxScrollTop = hoveredTextarea.scrollHeight - hoveredTextarea.clientHeight;
                if (maxScrollTop > 0) {
                    if (!(hoveredTextarea.scrollTop === 0 && deltaY > 0) && !(hoveredTextarea.scrollTop === maxScrollTop && deltaY < 0)) {
                        return true;
                    }
                }
                var maxScrollLeft = hoveredTextarea.scrollLeft - hoveredTextarea.clientWidth;
                if (maxScrollLeft > 0) {
                    if (!(hoveredTextarea.scrollLeft === 0 && deltaX < 0) && !(hoveredTextarea.scrollLeft === maxScrollLeft && deltaX > 0)) {
                        return true;
                    }
                }
            }
            return false;
        }

        function mousewheelHandler(e) {
            // FIXME: this is a quick fix for the select problem in FF and IE.
            // If there comes an effective way to deal with the problem,
            // this lines should be removed.
            if (!h.env.isWebKit && element.querySelector('select:focus')) {
                return;
            }

            var delta = getDeltaFromEvent(e);

            var deltaX = delta[0];
            var deltaY = delta[1];

            if (shouldBeConsumedByTextarea(deltaX, deltaY)) {
                return;
            }

            shouldPrevent = false;
            if (!i.settings.useBothWheelAxes) {
                // deltaX will only be used for horizontal scrolling and deltaY will
                // only be used for vertical scrolling - this is the default
                element.scrollTop = element.scrollTop - (deltaY * i.settings.wheelSpeed);
                element.scrollLeft = element.scrollLeft + (deltaX * i.settings.wheelSpeed);
            } else if (i.scrollbarYActive && !i.scrollbarXActive) {
                // only vertical scrollbar is active and useBothWheelAxes option is
                // active, so let's scroll vertical bar using both mouse wheel axes
                if (deltaY) {
                    element.scrollTop = element.scrollTop - (deltaY * i.settings.wheelSpeed);
                } else {
                    element.scrollTop = element.scrollTop + (deltaX * i.settings.wheelSpeed);
                }
                shouldPrevent = true;
            } else if (i.scrollbarXActive && !i.scrollbarYActive) {
                // useBothWheelAxes and only horizontal bar is active, so use both
                // wheel axes for horizontal bar
                if (deltaX) {
                    element.scrollLeft = element.scrollLeft + (deltaX * i.settings.wheelSpeed);
                } else {
                    element.scrollLeft = element.scrollLeft - (deltaY * i.settings.wheelSpeed);
                }
                shouldPrevent = true;
            }

            updateGeometry(element);

            shouldPrevent = (shouldPrevent || shouldPreventDefault(deltaX, deltaY));
            if (shouldPrevent) {
                e.stopPropagation();
                e.preventDefault();
            }
        }

        if (typeof window.onwheel !== "undefined") {
            i.event.bind(element, 'wheel', mousewheelHandler);
        } else if (typeof window.onmousewheel !== "undefined") {
            i.event.bind(element, 'mousewheel', mousewheelHandler);
        }
    }

    module.exports = function (element) {
        var i = instances.get(element);
        bindMouseWheelHandler(element, i);
    };

}, {"../../lib/helper": 6, "../instances": 18, "../update-geometry": 19}], 14: [function (require, module, exports) {
    /* Copyright (c) 2015 Hyunje Alex Jun and other contributors
     * Licensed under the MIT License
     */
    'use strict';

    var instances = require('../instances')
        , updateGeometry = require('../update-geometry');

    function bindNativeScrollHandler(element, i) {
        i.event.bind(element, 'scroll', function () {
            updateGeometry(element);
        });
    }

    module.exports = function (element) {
        var i = instances.get(element);
        bindNativeScrollHandler(element, i);
    };

}, {"../instances": 18, "../update-geometry": 19}], 15: [function (require, module, exports) {
    /* Copyright (c) 2015 Hyunje Alex Jun and other contributors
     * Licensed under the MIT License
     */
    'use strict';

    var h = require('../../lib/helper')
        , instances = require('../instances')
        , updateGeometry = require('../update-geometry');

    function bindSelectionHandler(element, i) {
        function getRangeNode() {
            var selection = window.getSelection ? window.getSelection() :
                document.getSelection ? document.getSelection() : '';
            if (selection.toString().length === 0) {
                return null;
            } else {
                return selection.getRangeAt(0).commonAncestorContainer;
            }
        }

        var scrollingLoop = null;
        var scrollDiff = {top: 0, left: 0};

        function startScrolling() {
            if (!scrollingLoop) {
                scrollingLoop = setInterval(function () {
                    if (!instances.get(element)) {
                        clearInterval(scrollingLoop);
                        return;
                    }

                    element.scrollTop = element.scrollTop + scrollDiff.top;
                    element.scrollLeft = element.scrollLeft + scrollDiff.left;
                    updateGeometry(element);
                }, 50); // every .1 sec
            }
        }

        function stopScrolling() {
            if (scrollingLoop) {
                clearInterval(scrollingLoop);
                scrollingLoop = null;
            }
            h.stopScrolling(element);
        }

        var isSelected = false;
        i.event.bind(i.ownerDocument, 'selectionchange', function () {
            if (element.contains(getRangeNode())) {
                isSelected = true;
            } else {
                isSelected = false;
                stopScrolling();
            }
        });
        i.event.bind(window, 'mouseup', function () {
            if (isSelected) {
                isSelected = false;
                stopScrolling();
            }
        });

        i.event.bind(window, 'mousemove', function (e) {
            if (isSelected) {
                var mousePosition = {x: e.pageX, y: e.pageY};
                var containerGeometry = {
                    left: element.offsetLeft,
                    right: element.offsetLeft + element.offsetWidth,
                    top: element.offsetTop,
                    bottom: element.offsetTop + element.offsetHeight
                };

                if (mousePosition.x < containerGeometry.left + 3) {
                    scrollDiff.left = -5;
                    h.startScrolling(element, 'x');
                } else if (mousePosition.x > containerGeometry.right - 3) {
                    scrollDiff.left = 5;
                    h.startScrolling(element, 'x');
                } else {
                    scrollDiff.left = 0;
                }

                if (mousePosition.y < containerGeometry.top + 3) {
                    if (containerGeometry.top + 3 - mousePosition.y < 5) {
                        scrollDiff.top = -5;
                    } else {
                        scrollDiff.top = -20;
                    }
                    h.startScrolling(element, 'y');
                } else if (mousePosition.y > containerGeometry.bottom - 3) {
                    if (mousePosition.y - containerGeometry.bottom + 3 < 5) {
                        scrollDiff.top = 5;
                    } else {
                        scrollDiff.top = 20;
                    }
                    h.startScrolling(element, 'y');
                } else {
                    scrollDiff.top = 0;
                }

                if (scrollDiff.top === 0 && scrollDiff.left === 0) {
                    stopScrolling();
                } else {
                    startScrolling();
                }
            }
        });
    }

    module.exports = function (element) {
        var i = instances.get(element);
        bindSelectionHandler(element, i);
    };

}, {"../../lib/helper": 6, "../instances": 18, "../update-geometry": 19}], 16: [function (require, module, exports) {
    /* Copyright (c) 2015 Hyunje Alex Jun and other contributors
     * Licensed under the MIT License
     */
    'use strict';

    var instances = require('../instances')
        , updateGeometry = require('../update-geometry');

    function bindTouchHandler(element, i, supportsTouch, supportsIePointer) {
        function shouldPreventDefault(deltaX, deltaY) {
            var scrollTop = element.scrollTop;
            var scrollLeft = element.scrollLeft;
            var magnitudeX = Math.abs(deltaX);
            var magnitudeY = Math.abs(deltaY);

            if (magnitudeY > magnitudeX) {
                // user is perhaps trying to swipe up/down the page

                if (((deltaY < 0) && (scrollTop === i.contentHeight - i.containerHeight)) ||
                    ((deltaY > 0) && (scrollTop === 0))) {
                    return !i.settings.swipePropagation;
                }
            } else if (magnitudeX > magnitudeY) {
                // user is perhaps trying to swipe left/right across the page

                if (((deltaX < 0) && (scrollLeft === i.contentWidth - i.containerWidth)) ||
                    ((deltaX > 0) && (scrollLeft === 0))) {
                    return !i.settings.swipePropagation;
                }
            }

            return true;
        }

        function applyTouchMove(differenceX, differenceY) {
            element.scrollTop = element.scrollTop - differenceY;
            element.scrollLeft = element.scrollLeft - differenceX;

            updateGeometry(element);
        }

        var startOffset = {};
        var startTime = 0;
        var speed = {};
        var easingLoop = null;
        var inGlobalTouch = false;
        var inLocalTouch = false;

        function globalTouchStart() {
            inGlobalTouch = true;
        }

        function globalTouchEnd() {
            inGlobalTouch = false;
        }

        function getTouch(e) {
            if (e.targetTouches) {
                return e.targetTouches[0];
            } else {
                // Maybe IE pointer
                return e;
            }
        }

        function shouldHandle(e) {
            if (e.targetTouches && e.targetTouches.length === 1) {
                return true;
            }
            if (e.pointerType && e.pointerType !== 'mouse' && e.pointerType !== e.MSPOINTER_TYPE_MOUSE) {
                return true;
            }
            return false;
        }

        function touchStart(e) {
            if (shouldHandle(e)) {
                inLocalTouch = true;

                var touch = getTouch(e);

                startOffset.pageX = touch.pageX;
                startOffset.pageY = touch.pageY;

                startTime = (new Date()).getTime();

                if (easingLoop !== null) {
                    clearInterval(easingLoop);
                }

                e.stopPropagation();
            }
        }

        function touchMove(e) {
            if (!inGlobalTouch && inLocalTouch && shouldHandle(e)) {
                var touch = getTouch(e);

                var currentOffset = {pageX: touch.pageX, pageY: touch.pageY};

                var differenceX = currentOffset.pageX - startOffset.pageX;
                var differenceY = currentOffset.pageY - startOffset.pageY;

                applyTouchMove(differenceX, differenceY);
                startOffset = currentOffset;

                var currentTime = (new Date()).getTime();

                var timeGap = currentTime - startTime;
                if (timeGap > 0) {
                    speed.x = differenceX / timeGap;
                    speed.y = differenceY / timeGap;
                    startTime = currentTime;
                }

                if (shouldPreventDefault(differenceX, differenceY)) {
                    e.stopPropagation();
                    e.preventDefault();
                }
            }
        }

        function touchEnd() {
            if (!inGlobalTouch && inLocalTouch) {
                inLocalTouch = false;

                clearInterval(easingLoop);
                easingLoop = setInterval(function () {
                    if (!instances.get(element)) {
                        clearInterval(easingLoop);
                        return;
                    }

                    if (Math.abs(speed.x) < 0.01 && Math.abs(speed.y) < 0.01) {
                        clearInterval(easingLoop);
                        return;
                    }

                    applyTouchMove(speed.x * 30, speed.y * 30);

                    speed.x *= 0.8;
                    speed.y *= 0.8;
                }, 10);
            }
        }

        if (supportsTouch) {
            i.event.bind(window, 'touchstart', globalTouchStart);
            i.event.bind(window, 'touchend', globalTouchEnd);
            i.event.bind(element, 'touchstart', touchStart);
            i.event.bind(element, 'touchmove', touchMove);
            i.event.bind(element, 'touchend', touchEnd);
        }

        if (supportsIePointer) {
            if (window.PointerEvent) {
                i.event.bind(window, 'pointerdown', globalTouchStart);
                i.event.bind(window, 'pointerup', globalTouchEnd);
                i.event.bind(element, 'pointerdown', touchStart);
                i.event.bind(element, 'pointermove', touchMove);
                i.event.bind(element, 'pointerup', touchEnd);
            } else if (window.MSPointerEvent) {
                i.event.bind(window, 'MSPointerDown', globalTouchStart);
                i.event.bind(window, 'MSPointerUp', globalTouchEnd);
                i.event.bind(element, 'MSPointerDown', touchStart);
                i.event.bind(element, 'MSPointerMove', touchMove);
                i.event.bind(element, 'MSPointerUp', touchEnd);
            }
        }
    }

    module.exports = function (element, supportsTouch, supportsIePointer) {
        var i = instances.get(element);
        bindTouchHandler(element, i, supportsTouch, supportsIePointer);
    };

}, {"../instances": 18, "../update-geometry": 19}], 17: [function (require, module, exports) {
    /* Copyright (c) 2015 Hyunje Alex Jun and other contributors
     * Licensed under the MIT License
     */
    'use strict';

    var cls = require('../lib/class')
        , h = require('../lib/helper')
        , instances = require('./instances')
        , updateGeometry = require('./update-geometry');

// Handlers
    var clickRailHandler = require('./handler/click-rail')
        , dragScrollbarHandler = require('./handler/drag-scrollbar')
        , keyboardHandler = require('./handler/keyboard')
        , mouseWheelHandler = require('./handler/mouse-wheel')
        , nativeScrollHandler = require('./handler/native-scroll')
        , selectionHandler = require('./handler/selection')
        , touchHandler = require('./handler/touch');

    module.exports = function (element, userSettings) {
        userSettings = typeof userSettings === 'object' ? userSettings : {};

        cls.add(element, 'ps-container');

        // Create a plugin instance.
        var i = instances.add(element);

        i.settings = h.extend(i.settings, userSettings);

        clickRailHandler(element);
        dragScrollbarHandler(element);
        mouseWheelHandler(element);
        nativeScrollHandler(element);
        selectionHandler(element);

        if (h.env.supportsTouch || h.env.supportsIePointer) {
            touchHandler(element, h.env.supportsTouch, h.env.supportsIePointer);
        }
        if (i.settings.useKeyboard) {
            keyboardHandler(element);
        }

        updateGeometry(element);
    };

}, {"../lib/class": 2, "../lib/helper": 6, "./handler/click-rail": 10, "./handler/drag-scrollbar": 11, "./handler/keyboard": 12, "./handler/mouse-wheel": 13, "./handler/native-scroll": 14, "./handler/selection": 15, "./handler/touch": 16, "./instances": 18, "./update-geometry": 19}], 18: [function (require, module, exports) {
    /* Copyright (c) 2015 Hyunje Alex Jun and other contributors
     * Licensed under the MIT License
     */
    'use strict';

    var d = require('../lib/dom')
        , defaultSettings = require('./default-setting')
        , EventManager = require('../lib/event-manager')
        , guid = require('../lib/guid')
        , h = require('../lib/helper');

    var instances = {};

    function Instance(element) {
        var i = this;

        i.settings = h.clone(defaultSettings);
        i.containerWidth = null;
        i.containerHeight = null;
        i.contentWidth = null;
        i.contentHeight = null;

        i.isRtl = d.css(element, 'direction') === "rtl";
        i.event = new EventManager();
        i.ownerDocument = element.ownerDocument || document;

        i.scrollbarXRail = d.appendTo(d.e('div', 'ps-scrollbar-x-rail'), element);
        i.scrollbarX = d.appendTo(d.e('div', 'ps-scrollbar-x'), i.scrollbarXRail);
        i.scrollbarXActive = null;
        i.scrollbarXWidth = null;
        i.scrollbarXLeft = null;
        i.scrollbarXBottom = h.toInt(d.css(i.scrollbarXRail, 'bottom'));
        i.isScrollbarXUsingBottom = i.scrollbarXBottom === i.scrollbarXBottom; // !isNaN
        i.scrollbarXTop = i.isScrollbarXUsingBottom ? null : h.toInt(d.css(i.scrollbarXRail, 'top'));
        i.railBorderXWidth = h.toInt(d.css(i.scrollbarXRail, 'borderLeftWidth')) + h.toInt(d.css(i.scrollbarXRail, 'borderRightWidth'));
        i.railXMarginWidth = h.toInt(d.css(i.scrollbarXRail, 'marginLeft')) + h.toInt(d.css(i.scrollbarXRail, 'marginRight'));
        i.railXWidth = null;

        i.scrollbarYRail = d.appendTo(d.e('div', 'ps-scrollbar-y-rail'), element);
        i.scrollbarY = d.appendTo(d.e('div', 'ps-scrollbar-y'), i.scrollbarYRail);
        i.scrollbarYActive = null;
        i.scrollbarYHeight = null;
        i.scrollbarYTop = null;
        i.scrollbarYRight = h.toInt(d.css(i.scrollbarYRail, 'right'));
        i.isScrollbarYUsingRight = i.scrollbarYRight === i.scrollbarYRight; // !isNaN
        i.scrollbarYLeft = i.isScrollbarYUsingRight ? null : h.toInt(d.css(i.scrollbarYRail, 'left'));
        i.scrollbarYOuterWidth = i.isRtl ? h.outerWidth(i.scrollbarY) : null;
        i.railBorderYWidth = h.toInt(d.css(i.scrollbarYRail, 'borderTopWidth')) + h.toInt(d.css(i.scrollbarYRail, 'borderBottomWidth'));
        i.railYMarginHeight = h.toInt(d.css(i.scrollbarYRail, 'marginTop')) + h.toInt(d.css(i.scrollbarYRail, 'marginBottom'));
        i.railYHeight = null;
    }

    function getId(element) {
        if (typeof element.dataset === 'undefined') {
            return element.getAttribute('data-ps-id');
        } else {
            return element.dataset.psId;
        }
    }

    function setId(element, id) {
        if (typeof element.dataset === 'undefined') {
            element.setAttribute('data-ps-id', id);
        } else {
            element.dataset.psId = id;
        }
    }

    function removeId(element) {
        if (typeof element.dataset === 'undefined') {
            element.removeAttribute('data-ps-id');
        } else {
            delete element.dataset.psId;
        }
    }

    exports.add = function (element) {
        var newId = guid();
        setId(element, newId);
        instances[newId] = new Instance(element);
        return instances[newId];
    };

    exports.remove = function (element) {
        delete instances[getId(element)];
        removeId(element);
    };

    exports.get = function (element) {
        return instances[getId(element)];
    };

}, {"../lib/dom": 3, "../lib/event-manager": 4, "../lib/guid": 5, "../lib/helper": 6, "./default-setting": 8}], 19: [function (require, module, exports) {
    /* Copyright (c) 2015 Hyunje Alex Jun and other contributors
     * Licensed under the MIT License
     */
    'use strict';

    var cls = require('../lib/class')
        , d = require('../lib/dom')
        , h = require('../lib/helper')
        , instances = require('./instances');

    function getThumbSize(i, thumbSize) {
        if (i.settings.minScrollbarLength) {
            thumbSize = Math.max(thumbSize, i.settings.minScrollbarLength);
        }
        if (i.settings.maxScrollbarLength) {
            thumbSize = Math.min(thumbSize, i.settings.maxScrollbarLength);
        }
        return thumbSize;
    }

    function updateCss(element, i) {
        var xRailOffset = {width: i.railXWidth};
        if (i.isRtl) {
            xRailOffset.left = element.scrollLeft + i.containerWidth - i.contentWidth;
        } else {
            xRailOffset.left = element.scrollLeft;
        }
        if (i.isScrollbarXUsingBottom) {
            xRailOffset.bottom = i.scrollbarXBottom - element.scrollTop;
        } else {
            xRailOffset.top = i.scrollbarXTop + element.scrollTop;
        }
        d.css(i.scrollbarXRail, xRailOffset);

        var yRailOffset = {top: element.scrollTop, height: i.railYHeight};
        if (i.isScrollbarYUsingRight) {
            if (i.isRtl) {
                yRailOffset.right = i.contentWidth - element.scrollLeft - i.scrollbarYRight - i.scrollbarYOuterWidth;
            } else {
                yRailOffset.right = i.scrollbarYRight - element.scrollLeft;
            }
        } else {
            if (i.isRtl) {
                yRailOffset.left = element.scrollLeft + i.containerWidth * 2 - i.contentWidth - i.scrollbarYLeft - i.scrollbarYOuterWidth;
            } else {
                yRailOffset.left = i.scrollbarYLeft + element.scrollLeft;
            }
        }
        d.css(i.scrollbarYRail, yRailOffset);

        d.css(i.scrollbarX, {left: i.scrollbarXLeft, width: i.scrollbarXWidth - i.railBorderXWidth});
        d.css(i.scrollbarY, {top: i.scrollbarYTop, height: i.scrollbarYHeight - i.railBorderYWidth});
    }

    module.exports = function (element) {
        var i = instances.get(element);

        i.containerWidth = element.clientWidth;
        i.containerHeight = element.clientHeight;
        i.contentWidth = element.scrollWidth;
        i.contentHeight = element.scrollHeight;

        if (!element.contains(i.scrollbarXRail)) {
            d.appendTo(i.scrollbarXRail, element);
        }
        if (!element.contains(i.scrollbarYRail)) {
            d.appendTo(i.scrollbarYRail, element);
        }

        if (!i.settings.suppressScrollX && i.containerWidth + i.settings.scrollXMarginOffset < i.contentWidth) {
            i.scrollbarXActive = true;
            i.railXWidth = i.containerWidth - i.railXMarginWidth;
            i.scrollbarXWidth = getThumbSize(i, h.toInt(i.railXWidth * i.containerWidth / i.contentWidth));
            i.scrollbarXLeft = h.toInt(element.scrollLeft * (i.railXWidth - i.scrollbarXWidth) / (i.contentWidth - i.containerWidth));
        } else {
            i.scrollbarXActive = false;
            i.scrollbarXWidth = 0;
            i.scrollbarXLeft = 0;
            element.scrollLeft = 0;
        }

        if (!i.settings.suppressScrollY && i.containerHeight + i.settings.scrollYMarginOffset < i.contentHeight) {
            i.scrollbarYActive = true;
            i.railYHeight = i.containerHeight - i.railYMarginHeight;
            i.scrollbarYHeight = getThumbSize(i, h.toInt(i.railYHeight * i.containerHeight / i.contentHeight));
            i.scrollbarYTop = h.toInt(element.scrollTop * (i.railYHeight - i.scrollbarYHeight) / (i.contentHeight - i.containerHeight));
        } else {
            i.scrollbarYActive = false;
            i.scrollbarYHeight = 0;
            i.scrollbarYTop = 0;
            element.scrollTop = 0;
        }

        if (i.scrollbarXLeft >= i.railXWidth - i.scrollbarXWidth) {
            i.scrollbarXLeft = i.railXWidth - i.scrollbarXWidth;
        }
        if (i.scrollbarYTop >= i.railYHeight - i.scrollbarYHeight) {
            i.scrollbarYTop = i.railYHeight - i.scrollbarYHeight;
        }

        updateCss(element, i);

        cls[i.scrollbarXActive ? 'add' : 'remove'](element, 'ps-active-x');
        cls[i.scrollbarYActive ? 'add' : 'remove'](element, 'ps-active-y');
    };

}, {"../lib/class": 2, "../lib/dom": 3, "../lib/helper": 6, "./instances": 18}], 20: [function (require, module, exports) {
    /* Copyright (c) 2015 Hyunje Alex Jun and other contributors
     * Licensed under the MIT License
     */
    'use strict';

    var d = require('../lib/dom')
        , instances = require('./instances')
        , updateGeometry = require('./update-geometry');

    module.exports = function (element) {
        var i = instances.get(element);

        // Hide scrollbars not to affect scrollWidth and scrollHeight
        d.css(i.scrollbarXRail, 'display', 'none');
        d.css(i.scrollbarYRail, 'display', 'none');

        updateGeometry(element);

        d.css(i.scrollbarXRail, 'display', 'block');
        d.css(i.scrollbarYRail, 'display', 'block');
    };

}, {"../lib/dom": 3, "./instances": 18, "./update-geometry": 19}]}, {}, [1]);

function isTouchDevice() {
    var el = document.createElement('div');
    el.setAttribute('ontouchmove', 'return;');
    return typeof el.ontouchmove == "function";
}

// Photogalery
var sb_cp_foto_def = {
    url: '',
    is_init: false,
    disable: {},
    // Инициализация
    init: function () {
        // Проверяем были ли инициализация
        if (this.is_init) {
            return false;
        }

        this.is_init = true;
        this.anc = document.getElementById('top_gal_content');
        this.anc2 = $('.sb_cp_foto_def');
        this.photos = $('.sb_cp_foto_def_scrl_elem');
        this.preload = $('.gal_preloader');
        this.big_photo = $('.imagecache-medium-photos-photo')[0];//huge?
        this.img_info = $('.sb_cp_foto_def_img_info');

        //msie 6 & 7 .brd width
        if ($.browser.msie && Math.round($.browser.version) < 8) {
            this.photos.each(function (index) {
                var bord = $(this).find('.sb_cp_foto_def_scrl_elem_brd');
                var imgLoad = new Image();
                var img = $(this).find('img')[0];
                imgLoad.onload = function () {
                    bord.css('width', img.offsetWidth - 6 + 'px');
                }
                imgLoad.src = img.getAttribute('src');
            });
        }

        this.navigate = $('.sb_cp_foto_def_scrl_box')[0];
        sb_cp_foto_def.newOnChange();
//		this.navigate.onmousewheel!==null  ?  this.navigate.addEventListener('DOMMouseScroll', this.scroll, false)  :  this.navigate.onmousewheel=this.scroll;
        $('.sb_cp_foto_def_scrl .sb_cp_foto_def_scrl_prev_ar').bind('click', function (e) {
            sb_cp_foto_def.scroll.call(sb_cp_foto_def.navigate, 1)
        });
        $('.sb_cp_foto_def_scrl .sb_cp_foto_def_scrl_next_ar').bind('click', function (e) {

            sb_cp_foto_def.scroll.call(sb_cp_foto_def.navigate, -1)
        });
        this.photos.bind('click', function () {
            sb_cp_foto_def.newOnChange(this.href); //sb_cp_foto_def.ajax(url);
            // Удаляем похожие фото наверху (рядом со скроллом маленьких фото)
            $('.sb_cp_foto_def_scrl_box .sb_cp_foto_def_scrl_elem_sim').remove();
            return false;
        });
        //bind prev, next & big_img clicks
        $('.sb_cp_foto_def_foto .sb_cp_foto_def_scrl_prev, .sb_cp_foto_def_foto .sb_cp_foto_def_scrl_next, .imagecache-medium-photos-photo').bind('click', sb_cp_foto_def.prevNext)
        //touch events
        if (isTouchDevice()) {
            var touchNav = $('.sb_cp_foto_def_scrl')[0],
                nav = this.navigate

            touchNav.addEventListener('touchstart', function (e) {
                this.flg = true
                startX = e.touches[0].pageX
                offsetX = e.touches[0].pageX + nav.scrollLeft; //offset = scroll-startd
                startY = e.touches[0].pageY; //offset = scroll-startd
                e.preventDefault();
            }, false);
            touchNav.addEventListener('touchmove', function (e) {
                this.flg = false
                endX = startX - e.touches[0].pageX
                nav.scrollLeft = offsetX - e.touches[0].pageX
                window.scrollBy(0, startY - e.touches[0].pageY) // прыгает
                sb_cp_foto_def.hideArrow();
                e.preventDefault();
            }, false);
            touchNav.addEventListener('touchend', function (e) {
                var cse = {'sb_cp_foto_def_scrl_prev': 1, 'sb_cp_foto_def_scrl_next': -1},
                    p = e.target.parentNode
                if (this.flg) {
                    if (p.className.indexOf('sb_cp_foto_def_scrl_elem') != -1) {
                        sb_cp_foto_def.newOnChange(p.href);
                        $('.sb_cp_foto_def_scrl_box .sb_cp_foto_def_scrl_elem_sim').remove();
                    }
                    else if (cse[p.className]) {
                        sb_cp_foto_def.scroll.call(nav, cse[p.className])
                    }
                }
                e.preventDefault();
            }, false);
        }

        $(document).keydown(function (e) {
            if (e.ctrlKey) {
                if (e.which == 37) {
                    sb_cp_foto_def.prevNext(-1)
                    return false
                }
                else if (e.which == 39) {
                    sb_cp_foto_def.prevNext(1)
                    return false
                }
            }

        });
        //запускаем функицию для проверки истории
        setInterval(function () {
            sb_cp_foto_def.newOnChange()
        }, 500);
    },
    getOffsets: function () {
        this.photosOffset = [];
        var photos = $('.sb_cp_foto_def_scrl_elem');
        for (var i = 0; i < photos.length; i++) {
            this.photosOffset[i] = photos[i].offsetLeft;
        }
    },
    scroll: function (e) {
        if (!e) e = window.event;
        var direction = e.wheelDelta ? e.wheelDelta / 120 : e.detail / -3 || e;
        var sl = this.scrollLeft;
        if (e.preventDefault) {
            e.preventDefault();
        }
        //IE7FIX scrollWidth
        var scrollWidth = this.scrollWidth;
        if ($.browser.msie && Math.round($.browser.version) < 8) {
            scrollWidth = this.lastChild.offsetLeft + this.lastChild.offsetWidth + 1;
        }
        if (sl <= 0 && direction > 0 || sl + this.offsetWidth >= scrollWidth && direction < 0) {
            return false
        }

        if (!sb_cp_foto_def.photosOffset) {
            sb_cp_foto_def.getOffsets();
        }

        var scrollVars = sb_cp_foto_def.photosOffset;
        for (var i = 0; i < scrollVars.length; i++) {
            if (sl <= scrollVars[i] && sl < scrollVars[i + 1]) {
                break;
            }
        }

        var step = direction > 0 ? i - 3 : i + 3;
        step = step < 0 ? 0 : step;
        //this.scrollLeft = scrollVars[i-direction]


        //this.scrollLeft = scrollVars[step];
        if (jQuery(this).is(':animated')) return;
        jQuery(this).stop().animate({scrollLeft: scrollVars[step]},
            {duration: 300, queue: false, complete: function () {
                sb_cp_foto_def.hideArrow();
            }});


        //IE7FIX
        if ($.browser.msie && $.browser.version < 8 && this.scrollLeft + this.offsetWidth >= scrollWidth && direction < 0)
            jQuery(this).stop().animate({scrollLeft: scrollWidth - sb_cp_foto_def.navigate.offsetWidth},
                {duration: 300, queue: false, complete: function () {
                    sb_cp_foto_def.hideArrow();
                }});
        //this.scrollLeft = scrollWidth-sb_cp_foto_def.navigate.offsetWidth;


        return false;

    },

    centerActive: function (el) {
        var padd = el.offsetLeft + (el.offsetWidth - this.navigate.offsetWidth) / 2;
        //IE7FIX scrollWidth
        if ($.browser.msie && Math.round($.browser.version) < 8) {
            var scrollWidth = this.navigate.lastChild.offsetLeft + this.navigate.lastChild.offsetWidth + 1;
            if (padd + this.navigate.offsetWidth >= scrollWidth) {
                padd = scrollWidth - this.navigate.offsetWidth;
            }
        }
        $(this.navigate).stop().animate({scrollLeft: padd}, 400, function () {
            sb_cp_foto_def.hideArrow()
        });
    },

    hideArrow: function () {
        if (this.disable.small) {
            this.disable.small.show();
            this.disable.small = null;
        }//after || IE7fix
        if (this.navigate.scrollLeft + this.navigate.offsetWidth == this.navigate.scrollWidth || this.navigate.scrollLeft + this.navigate.offsetWidth == this.navigate.lastChild.offsetLeft + this.navigate.lastChild.offsetWidth + 1) {
            this.disable.small = $('.sb_cp_foto_def_scrl .sb_cp_foto_def_scrl_next');
            this.disable.small.hide();
        }
        else if (this.navigate.scrollLeft == 0) {
            this.disable.small = $('.sb_cp_foto_def_scrl .sb_cp_foto_def_scrl_prev');
            this.disable.small.hide();
        }
    },

    prevNext: function (increase) {
        var i = parseInt(sb_cp_foto_def.parseNum(sb_cp_foto_def.url)), //[t?]cache i
            el = null;
        if (sb_cp_foto_def.disable.big && increase == -1) {
            return false
        }
        if ($('.sb_cp_foto_def_sim').length == 1 && increase == 1) {
            sb_cp_foto_def.newOnChange(sb_cp_foto_def.photos[0].href)
            return false
        }
        $(this).hasClass('sb_cp_foto_def_scrl_prev') || increase == -1 ? i-- : i++;
        if (el = sb_cp_foto_def.photos[i]) {
            sb_cp_foto_def.newOnChange(el.href);
        }
        else {
            sb_cp_foto_def.add_foto_top();
            sb_cp_foto_def.add_sim_top();
        }
        return false;
    },

    newOnChange: function (url) {
        if (!url) {
            url = window.location.href;
        }

        if (url !== this.url) {
            var num = this.parseNum(url);
            //var topOffset = this.anc2.position().top + parseInt($("body").css("padding-top")) + 20;
            var topOffset = this.anc2.position().top + 20;

            if (!!this.url) {
                window.location.hash = 'top_gal_content&imgDelta=' + num;
            }

            if (~location.search.indexOf('huge') || ~url.indexOf('#')) {
                $(window).scrollTop(topOffset);
            }

            this.url = window.location.href;
            this.switch_pic(num);
        }
    },

    //new href & old href
    parseNum: function (url) {
        var num = url.match(/imgDelta=\d+/g)
        return num ? num[num.length - 1].split('=')[1] : 0
    },

    switch_pic: function (i) {
        this.preload.show();
        var imgSrc = gallery_image_arr[i].src,
            imgLoad = new Image();//dummy

        $(imgLoad).load(function () {
            sb_cp_foto_def.big_photo.parentNode.replaceChild(this, sb_cp_foto_def.big_photo)
            sb_cp_foto_def.big_photo = this
            sb_cp_foto_def.big_photo.className = 'imagecache-medium-photos-photo'
            sb_cp_foto_def.big_photo.onclick = sb_cp_foto_def.prevNext
            if (window.location.search.indexOf('huge') == -1) {
                var strip = $('.sb_cp_foto_def_scrl').height(),
                    newHeight = $(window).height() - strip;
                this.removeAttribute('height')
                if ($(this).height() >= newHeight - 6) {
                    this.setAttribute('height', newHeight - 32);
                    this.style.width = 'auto'
                }
                $('.sb_cp_foto_def_loop_link').attr('href', '?huge=1&imgDelta=' + i + location.hash);
            }
            else {
                $('.sb_cp_foto_def_loop_link').attr('href', '?imgDelta=' + i + location.hash);
            }

            sb_cp_foto_def.preload.hide();
            sb_cp_foto_def.img_info.hide();
            $(sb_cp_foto_def.img_info[i]).show();
            $('.sb_cp_foto_def_sim').remove();
            sb_cp_foto_def.centerActive(sb_cp_foto_def.photos[i]);//center active element
        });
        imgLoad.src = imgSrc;

        //cache


        //hide big arrows
        if (this.active) {
            this.active.removeClass('sb_cp_foto_def_scrl_elem_slt');
        }
        this.active = $(this.photos[i]);
        this.active.addClass('sb_cp_foto_def_scrl_elem_slt');
        //hide arrows
        if (this.disable.big) {
            this.disable.big.show();
            this.disable.big = null;
        }
        if (i == 0) {
            this.disable.big = $('.sb_cp_foto_def_foto .sb_cp_foto_def_scrl_prev');
            this.disable.big.hide();
        }
        /*else if(i == this.photos.length-1){
         this.disable.big = $('.sb_cp_foto_def_foto .sb_cp_foto_def_scrl_next');
         this.disable.big.hide();
         }*/
    },

    // Добавляет похожие фото поверх большой фото
    add_foto_top: function () {
        //sb_cp_foto_def_sim
        this.photosOffset = null;
        if (!sb_c_similar_def && sb_c_similar_def.foto_top_ar && sb_c_similar_def.foto_top_ar.length > 0 && sb_c_similar_def.foto_ar && sb_c_similar_def.foto_ar.length > 0) {
            return false;
        }
        // Генерация фото
        var similar_str = '',
            similar_ar,
            i;

        for (i = 0; i < sb_c_similar_def.foto_top_ar.length; i++) {
            similar_ar = sb_c_similar_def.foto_top_ar[i];

            // Если номер фото
            //if (typeof(similar_ar) === 'string' && similar_ar !== '' && typeof(sb_c_similar_def.foto_ar[i]) === 'object') {
            //similar_ar = sb_c_similar_def.foto_ar[i];
            //}


            if (!(typeof(similar_ar) === 'object' && typeof(similar_ar['icon']) === 'string' && typeof(similar_ar['path']) === 'string' && similar_ar['icon'] !== '' && similar_ar['path'] !== '')) {
                continue;
            }

            // Заменяем сущности
            similar_ar.icon = similar_ar.icon.replace(/&lt;/, "<");
            similar_ar.icon = similar_ar.icon.replace(/&gt;/, ">");
            similar_ar.icon = similar_ar.icon.replace(/&amp;/, '&');

            similar_str += '<a style="visibility:hidden" href="/' + similar_ar.path + '">' + similar_ar.icon + '</a>';
        }

        //var html = '<style type="text/css">#photoblock_wall { height:20px; overflow:hidden; } #photoblock_wall a { visibility:hidden; }	#photoblock_loader { width:100%; height:100%; position:relative; }</style>';
        var html = '<div class="sb_cp_foto_def_sim"><p class="sb_cp_foto_def_sim_loop"><a href="?' + (window.location.href.indexOf('huge=1') !== -1 ? '&huge=1' : '') + 'imgDelta=0#top_gal_content">Повторить<span></span></a></p> <div class="sb_cp_foto_def_sim_line"></div> <h2>Фото по теме</h2> <div class="sb_cp_foto_def_sim_list  clear-block"><div id="photoblock_loader"><img class="gal_preloader" src="http://s.s-ports.ru/sites/all/libraries/design/_spbver9_/img/ajax-loader.gif" alt ="" /></div>' + similar_str + '</div></div>';


        // Вешаем событие на кнопку повторить
        $('.sb_cp_foto_def_foto').append(html).find('.sb_cp_foto_def_sim_loop a').click(function () {
            // Удаляем похожие фото наверху (рядом со скроллом маленьких фото)
            $('.sb_cp_foto_def_scrl_box .sb_cp_foto_def_scrl_elem_sim').remove();
            var url = $(this).attr('href');
            sb_cp_foto_def.newOnChange(url);
            return false;
        });

        // Вызов плагина красивого вывода картинок
        (function () {
            var wall = jQuery('.sb_cp_foto_def_sim_list'),
                LENGTH = jQuery('img', wall).size(),
                i = 0;

            jQuery('img', wall).each(function () {
                var originalImg = this;
                var loadImg = new Image();
                var loader = jQuery('#photoblock_loader', wall);
                loadImg.onload = function () {
                    jQuery(originalImg).width($(originalImg).width());
                    jQuery(originalImg).height($(originalImg).height());
                    i++;

                    if (i >= LENGTH) {
                        wall.gpGallery('a', {
                            row_min_height: 120,
                            row_max_height: 180,
                            callback: function () {
                                // Удаляем похожие фото, которые не помещаются на большом фото в колбеке.
                                var box_j = $('.sb_cp_foto_def_sim');
                                var box_height = box_j.get(0).clientHeight;
                                var box_top = box_j.offset().top;

                                $('.sb_cp_foto_def_sim_list > a').each(function () {
                                    var sim_j = $(this);
                                    var sim_img_top = sim_j.offset().top + 117 - box_top + 20;

                                    if (sim_img_top > box_height) {
                                        sim_j.remove();
                                    } else {
                                        sim_j.css('visibility', 'visible');
                                    }
                                });
                                wall.css('height', 'auto');
                                jQuery('a', wall).css('visibility', 'visible');
                                loader.remove();
                            }
                        });
                    }

                }
                loadImg.src = this.src;
            });


        })();
    },


    // Добавляет похожие фото над большой фото (рядом со скроллом маленьких фото)

    add_sim_top: function () {

        if (!(typeof(sb_c_similar_def) === 'object' && sb_c_similar_def !== null && typeof(sb_c_similar_def.elem_build) === 'function')) {
            return false;
        }

        if (!(typeof(sb_c_similar_def.foto_ar) === 'object' && sb_c_similar_def.foto_ar !== null && sb_c_similar_def.foto_ar.length > 0)) {
            return false;
        }


        var foto_old, foto_new,
            i;

        for (i = 0; i < sb_c_similar_def.foto_ar.length; i++) {
            // Генерим html фото
            foto_old = sb_c_similar_def.elem_build(sb_c_similar_def.foto_ar[i], 'foto');


            if (!(typeof(foto_old) === 'string' && foto_old !== '')) {
                continue;
            }


            foto_new = '<div style="*display: inline; zoom: 1;" class="sb_cp_foto_def_scrl_elem sb_cp_foto_def_scrl_elem_sim' + ((i === 0) ? ' sb_cp_foto_def_scrl_elem_sim_f' : '') + '">' + $(foto_old).html() + '</div>';

            $('.sb_cp_foto_def_scrl_box').append(foto_new);


            // Добавляем многоточие
            if (typeof(sb_c_similar_def.hellip) === 'function') {
                sb_c_similar_def.hellip('.sb_cp_foto_def_scrl_elem_sim:last', sb_c_similar_def.foto_ar[i].title);
            }


            // Unbind click element scrollable
            $('.sb_cp_foto_def_scrl_box .sb_cp_foto_def_scrl_elem_sim a').unbind();
        }

        // Ставим по центру активную фотографию, т.к. добавилися ещё похожие фото
        this.centerActive(this.photos[this.photos.length - 1]);
    }

};
// End photogalery

// Similar
var sb_c_similar_def = {

    object_class: '.sb_c_similar',
    //elem_width: 120,
    elem_width: 112,
    elem_width_no_mar: 100,
    elem_class: '.sb_c_similar_list_item',
    elem_title: 'h4 a',
    elem_show: 0,
    elem_index_cur: 0,
    arr_prev: '.sp_c_similar_prev',
    arr_next: '.sp_c_similar_next',
    video_class: '.sb_c_similar_video',
    // video_ar: [],
    foto_class: '.sb_c_similar_foto',
    foto_ar: [],
    foto_top_ar: [],
    vert_lines_max: 3,


    // Инициализация

    init: function () {

        // Проверяем, чтобы количество видео было равно количеству фото и больше 0
        if (!(typeof(sb_c_similar_def.video_ar) === 'object' && typeof(sb_c_similar_def.foto_ar) === 'object' && sb_c_similar_def.video_ar.length === sb_c_similar_def.foto_ar.length && sb_c_similar_def.video_ar.length !== 0)) {
            return false;
        }

        // Находим родителя
        var parent_j = $(sb_c_similar_def.object_class + ':parent');

        // Если не нашли блок и его родителя соответственно
        if (parent_j.length === 0) return false;

        // Вычисляем ширину
        var parent_width = parent_j.width();

        // Если ширина родителя меньше ширины одного элемента без правого отступа
        if (parent_width <= sb_c_similar_def.elem_width_no_mar)    return false;

        // Вычисляем количество элементов
        var elems_count = Math.floor(parent_width / sb_c_similar_def.elem_width);

        // Проверяем поместиться ли последний элемент без правого отступа
        var parent_width_new = elems_count * sb_c_similar_def.elem_width + sb_c_similar_def.elem_width_no_mar;

        if (parent_width_new <= parent_width) elems_count++;

        // Сохраняем количество показываемых элементов и позицию элемента
        sb_c_similar_def.elem_show = elems_count;
        sb_c_similar_def.elem_index_cur = elems_count;

        // Вешаем события на стрелки, если количество элементов больше, чем отображается
        if (sb_c_similar_def.video_ar.length > sb_c_similar_def.elem_show) {

            // Вешаем событие на стрелку влево
            $(sb_c_similar_def.arr_prev).bind('click', function () {
                sb_c_similar_def.left();
            });

            // Вешаем событие на стрелку вправо
            $(sb_c_similar_def.arr_next).bind('click', function () {
                sb_c_similar_def.right();
            });

        }


        var elem_html = '',
            elem_j;

        // Добавляем элементы
        for (i = 0; i < sb_c_similar_def.elem_show; i++) {

            if (typeof(sb_c_similar_def.video_ar[i]) !== 'undefined') {

                // Генерим HTML элемента и добавляем его в конец
                elem_html = sb_c_similar_def.elem_build(sb_c_similar_def.video_ar[i], 'video');
                elem_j = $(elem_html).appendTo(sb_c_similar_def.video_class);

                // Добавляем многоточие если длинный текст
                sb_c_similar_def.hellip(elem_j);

            }

            if (typeof(sb_c_similar_def.foto_ar[i]) !== 'undefined') {
                // Генерим HTML элемента и добавляем его в конец
                elem_html = sb_c_similar_def.elem_build(sb_c_similar_def.foto_ar[i], 'foto');
                elem_j = $(elem_html).appendTo(sb_c_similar_def.foto_class);

                // Добавляем многоточие если длинный текст
                sb_c_similar_def.hellip(elem_j);

            }

        }


        // Убираем правый отступ у последних элементов видео и фото
        $(sb_c_similar_def.video_class + ' ' + sb_c_similar_def.elem_class + ':last,' + sb_c_similar_def.foto_class + ' ' + sb_c_similar_def.elem_class + ':last').attr('style', 'margin-right: 0 !important');

    },


    // Генерим HTML элемента
    /*
     item = {
     "nid": "246117",
     "title": "\u041d",
     "path": "Vidy_sporta",
     "icon": "&lt;img src=\"http:\/\/s.s-ports.ru\/sites\/default\/files\/imagecache\/icon_w100_h75\/4def1ad9908ac.jpg\" alt=\"\u041d" title=\"\u041d" width=\"100\" height=\"75\" \/&gt;",
     "duration": "5:07"
     };

     type (video | foto)
     */

    elem_build: function (item, type) {

        // Проходим по объекту элемента и заменяем сущности на символы
        for (var key in item) {
            item[key] = item[key].replace(/&lt;/, "<");
            item[key] = item[key].replace(/&gt;/, ">");
            item[key] = item[key].replace(/&amp;/, '&');
        }


        var elem_html = '';


        // Генерим HTML видео элемента
        if (type === 'video' && typeof(item) === 'object' && typeof(item['path']) === 'string' && typeof(item['icon']) === 'string' && typeof(item['title']) === 'string') {

            elem_html += '<div class="sb_c_similar_list_item">';
            elem_html += '<p class="sb_u_img_block">';
            elem_html += '<a href="/' + item['path'] + '">' + item['icon'] + '</a>';
            elem_html += '<span class="sb_u_img_block_icon"><span><span class="sb_u_icon_type sb_u_icon_type_v_w" title="Видео">Видео</span></span></span>';

            if (typeof(item['duration']) === 'string' && item['duration'] !== '') {
                elem_html += '<span class="spb_video_info_label">' + item['duration'] + '</span>';
            }

            elem_html += '</p>';
            elem_html += '<div><h4><a href="/' + item['path'] + '">' + item['title'] + '</a></h4></div><div class="sb_c_block_media_clr"></div>';
            elem_html += '</div>';

        }


        // Генерим HTML фото элемента
        if (type === 'foto' && typeof(item) === 'object' && typeof(item['path']) === 'string' && typeof(item['icon']) === 'string' && typeof(item['title']) === 'string') {

            elem_html += '<div class="sb_c_similar_list_item">';
            elem_html += '<p class="sb_c_block_media_foto"><a href="/' + item['path'] + '">' + item['icon'] + '</a><span><span>&nbsp;</span></span></p>';
            elem_html += '<div><h4><a href="/' + item['path'] + '">' + item['title'] + '</a></h4></div><div class="sb_c_block_media_clr"></div>';
            elem_html += '</div>';

        }


        // Возвращаем сгенерированный HTML элемента
        return elem_html;

    },


    // Добавляет многоточие, если длинный текст (для набора)

    hellip: function (elem_j) {

        $(sb_c_similar_def.elem_title, elem_j).each(function () {
            sb_c_similar_def.hellip_one(this);
        });

    },


    // Добавляет многоточие, если длинный текст (для одного элемента)

    hellip_one: function (a_obj) {

        // Получаем текст заголовка и разбиваем на массив
        var a_j = $(a_obj).eq(0),
            a_text = a_j.html(),
            a_text_ar = a_text.split(' '); // Может вместо пробела указать пробельные символы


        // Если текст не разбили на массив
        if (a_text_ar.length === 1 && a_text_ar[0] === a_text) return false;


        // Создаем новую строчку со <span> , чтобы узнать какое слово и на какой строке
        var text_new = '<span>' + a_text_ar.join('</span><span> </span><span>') + '</span>';

        // Добавляем новую строчку
        a_j.html(text_new);


        // Узнаем порядковый номер <span> на максимальной строчке
        var spans_j = $('span', a_j),
            spans_count = spans_j.length,
            vert_lines = 1,
            spans_top = 0,
            span_last = 0,
            i;

        for (i = 0; i < spans_count; i = i + 2) {
            // Вычисляем вертикальные координаты
            span_top = spans_j.eq(i).offset().top;

            // Задаем начальные вертикальные координаты
            if (i === 0) spans_top = span_top;

            // Добавляем +1 к счетчику вертикальных строк
            if (span_top > spans_top) {
                spans_top = span_top;
                vert_lines++;
            }

            // Прекращаем поиск, если вертикальных строк больше максимума
            if (vert_lines > sb_c_similar_def.vert_lines_max) {
                // Запоминаем номер последнего <span>
                span_last = i / 2;
                break;
            }
        }


        // Вернуть текст без <span>
        a_j.html(a_text);


        // Если вертикальных строк больше максимума
        if (span_last > 0) {

            // Объединяем массив в строку и добавляем её
            var a_text_ar_new = a_text_ar.slice(0, span_last);
            text_new = a_text_ar_new.join(' ');
            text_new += '<span>&hellip;</span>';

            a_j.html(text_new);

            // Проверяем на какой строке многоточие
            spans_j = $('span', a_j);
            span_top = spans_j.eq(0).offset().top;

            if (span_top >= spans_top) {
                a_text_ar_new = a_text_ar.slice(0, span_last - 1);
                text_new = a_text_ar_new.join(' ');
                text_new += '&hellip;';
            }


            a_j.html(text_new);

        }

    },


    // Событие для стрелки влево

    left: function () {

        // Возвращает false , если слева нет больше элементов
        if (sb_c_similar_def.elem_index_cur <= sb_c_similar_def.elem_show) return false;


        // Определяем номер элемента, который должен быть слева
        elem_index = sb_c_similar_def.elem_index_cur - sb_c_similar_def.elem_show - 1;
        sb_c_similar_def.elem_index_cur--;


        // Удаляем последние элементы
        $('.sb_c_similar_video .sb_c_similar_list_item:last').remove();
        $('.sb_c_similar_foto .sb_c_similar_list_item:last').remove();


        // Убираем отступ справа у последнего элемента
        $('.sb_c_similar_video .sb_c_similar_list_item:last').attr('style', 'margin-right: 0 !important');
        $('.sb_c_similar_foto .sb_c_similar_list_item:last').attr('style', 'margin-right: 0 !important');


        var elem_html = '',
            elem_j;

        // Добавляем первый элемент и ставим многоточие в заголовке, если длинный текст
        elem_html = sb_c_similar_def.elem_build(sb_c_similar_def.video_ar[elem_index], 'video');
        elem_j = $(elem_html).prependTo('.sb_c_similar_video');
        sb_c_similar_def.hellip(elem_j);

        elem_html = sb_c_similar_def.elem_build(sb_c_similar_def.foto_ar[elem_index], 'foto');
        elem_j = $(elem_html).prependTo('.sb_c_similar_foto');
        sb_c_similar_def.hellip(elem_j);

        // Активируем/Декативируем стрелки
        sb_c_similar_def.arrs_disables();

    },


    // Событие для стрелки вправо

    right: function () {

        // Возвращает false , если справа нет больше элементов
        // Проверять соответсвие количество элементов видео и фото
        var elem_all_count = sb_c_similar_def.video_ar.length - 1;
        if (sb_c_similar_def.elem_index_cur >= elem_all_count) return false;

        // Определяем номер элемента, который должен быть справа
        elem_index = sb_c_similar_def.elem_index_cur + 1;
        sb_c_similar_def.elem_index_cur++;

        // Удаляем первые элементы
        $('.sb_c_similar_video .sb_c_similar_list_item:first').remove();
        $('.sb_c_similar_foto .sb_c_similar_list_item:first').remove();

        // Убираем отступ справа у последнего элемента
        $('.sb_c_similar_video .sb_c_similar_list_item:last').attr('style', 'margin-right: 12px !important');
        $('.sb_c_similar_foto .sb_c_similar_list_item:last').attr('style', 'margin-right: 12px !important');

        var elem_html = '',
            elem_j;

        // Добавляем последний элемент и ставим многоточие в заголовке, если длинный текст
        elem_html = sb_c_similar_def.elem_build(sb_c_similar_def.video_ar[elem_index], 'video');
        elem_j = $(elem_html).appendTo('.sb_c_similar_video');
        sb_c_similar_def.hellip(elem_j);

        elem_html = sb_c_similar_def.elem_build(sb_c_similar_def.foto_ar[elem_index], 'foto');
        elem_j = $(elem_html).appendTo('.sb_c_similar_foto');
        sb_c_similar_def.hellip(elem_j);

        // Активируем/Декативируем стрелки
        sb_c_similar_def.arrs_disables();

    },


    // Активируем/Декативируем стрелки

    arrs_disables: function () {

        if (sb_c_similar_def.elem_index_cur <= sb_c_similar_def.elem_show) {
            // Левая стрелка неактивна
            $(sb_c_similar_def.arr_prev).addClass('sp_c_similar_prev_disabled');
            $(sb_c_similar_def.arr_next).removeClass('sp_c_similar_next_disabled');
        }
        else if (sb_c_similar_def.elem_index_cur >= (sb_c_similar_def.video_ar.length - 1)) {
            // Правая стрелка неактивна
            $(sb_c_similar_def.arr_prev).removeClass('sp_c_similar_prev_disabled');
            $(sb_c_similar_def.arr_next).addClass('sp_c_similar_next_disabled');
        }
        else {
            // Обе стрелки активны
            $(sb_c_similar_def.arr_prev).removeClass('sp_c_similar_prev_disabled');
            $(sb_c_similar_def.arr_next).removeClass('sp_c_similar_next_disabled');
        }

    }

};
// End similar

$(document).ready(function () {
    if ($('.transfer_block_graph_wrap').length < 1) {
        return false;
    }

    function sortLines(lines) {
        lines.sort(function (a, b) {
            if (parseInt($(a).data('summ')) > parseInt($(b).data('summ'))) {
                return -1;
            } else if (parseInt($(a).data('summ')) < parseInt($(b).data('summ'))) {
                return 1;
            } else {
                return 0;
            }
        });
        return lines;
    }

    function construct_graphs(wrap, cls) {
        var lines = sortLines(wrap.find(cls)),
            etalon = parseInt($(lines[0]).data('summ'));

        for (i = 0; i < lines.length; i++) {
            if (i === 0) {
                $(lines[0]).find('.graph_left_part').width('100%');
                $(lines[0]).find('.graph_right_part').width(0);
            } else {
                var value = parseInt($(lines[i]).data('summ')),
                    itemWidth = Math.round((value / etalon) * 100);

                $(lines[i]).find('.graph_left_part').width(itemWidth + '%');
                $(lines[i]).find('.graph_right_part').width(parseInt(100 - itemWidth) + '%');
            }
        }
    }

    $('.transfer_block_graph_wrap').each(function () {
        construct_graphs($(this), '.transfer_graph_line');
        construct_graphs($(this), '.transfer_graph_line2');
    });
});
SPB.teaserImageLoader = function () {
    var win = $(window);
    var teasersImgs = $('.teazer-list li a img:not([src])');
    var type = 'big';
    var width = 210;
    var height = 120;

    if (win.width() < SPB.constants.desktop_min_width) {
        type = 'small';
        width = 109;
        height = 90;
    }

    $.each(teasersImgs, function () {
        var elem = $(this);
        var srcAttr = $(this).attr('src');

        if (typeof srcAttr === typeof undefined || srcAttr === false) {
            elem.addClass('lazy-teasers').attr('width', width).attr('height', height);
        }
    });
    $('.lazy-teasers').lazyload({
        'data_attribute': type,
        'threshold': 1000
    });
};
$(function () {
    SPB.teaserImageLoader();
});
/**
 * Добавляет кномпу подгрузки контента "Еще",
 * в нижнюю часть списка материалов
 * 'min-screen-width' - минимальная ширина окна, при котором срабатывает подгрузка по скроллу
 * 'scroll-down-event' - включена подгрузка по скроллу
 */

$.fn.moreRead = function (options) {
    var settings = $.extend({
        'min-screen-width': 0,
        'scroll-down-event': true,
        'link-more': $('<div class="row"><a class="more-btn" href="#"><span>Еще</span></a></div>'),
        'additional-data': {},
        callback: function () {
        }
    }, options);

    var container = this;
    var containerClass = this.attr('class');
    var scrollCounter = 0;
    var getNextPageUrl = function (pagination) {
        var next_page_el;

        if (!pagination.length) {
            return false;
        }

        next_page_el = pagination.find('.next-page');
        pagination.remove();

        if (!next_page_el.length) {
            return false;
        }

        return next_page_el.attr('href');
    };
    var scrollDownPage = function () {
        if (($(window).width() <= settings['min-screen-width']) || (!settings['scroll-down-event'])) {
            return;
        }
        if (($(window).scrollTop() + $(window).height()) >= (container.innerHeight() + container.offset().top)) {
            if (scrollCounter < 3) {
                settings['link-more'].click();
            }
        }
    };
    var next_page_url = getNextPageUrl(container.next('.pagination'));
    var isLoad = false;

    if (!container.length) {
        return;
    }

    settings['link-more'].on('click', function () {
        if (!next_page_url || isLoad) {
            return false;
        }

        scrollCounter++;
        settings['additional-data']['plain_content'] = 1;
        $.ajax({
            type: 'GET',
            url: next_page_url,
            data: settings['additional-data'],
            beforeSend: function () {
                isLoad = true;
                settings['link-more'].find('.more-btn').addClass('loading');
            },
            success: function (html) {
                var context = $('<div>' + html + '</div>');
                var pagination = context.find('ul.pagination');
                var content = context.find('.' + containerClass);

                if (!content.length) {
                    isLoad = false;
                    settings['link-more'].find('.more-btn').removeClass('loading');
                    return;
                }

                next_page_url = getNextPageUrl(pagination);

                container.append(content.html());

                if (!next_page_url) {
                    settings['link-more'].remove();
                }
                isLoad = false;
                settings['link-more'].find('.more-btn').removeClass('loading');

                settings.callback.call(this);
            }
        });

        return false;
    });

    $(window).on('scroll', scrollDownPage);

    if (next_page_url) {
        container.after(settings['link-more']);
    }
};

var goldped_js = {

    vote: function (id_tour) {
        var data = [];
        $('#goldped_place form#tour_' + id_tour + ' input:radio:checked').each(function (e) {
            var input = $(this);
            data.push(input.val());
        });

        if (Drupal.settings && Drupal.settings.spb_helper && Drupal.settings.spb_helper.current_page_nid) {
            page_node_id = Drupal.settings.spb_helper.current_page_nid;
        }

        if (Drupal.settings && Drupal.settings.spb_current_page_node_id) {
            page_node_id = Drupal.settings.spb_current_page_node_id;
        }

        var post = {'vote': data, 'nid': page_node_id};
        if (data.length) {
            jQuery("#goldped_place").html('Идет голосование!');
            jQuery.ajax({
                async: true,
                url: '/goldped/vote',
                data: post,
                type: 'POST',
                success: function (data, textStatus) {
                    jQuery("#goldped_place").html(textStatus == 'success' ? data : 'Ошибка');
                }
            });
        }
    },

    revert_vote: function (id_tour) {
        if (Drupal.settings && Drupal.settings.spb_helper && Drupal.settings.spb_helper.current_page_nid) {
            page_node_id = Drupal.settings.spb_helper.current_page_nid;
        }

        if (Drupal.settings && Drupal.settings.spb_current_page_node_id) {
            page_node_id = Drupal.settings.spb_current_page_node_id;
        }

        post = {
            'id_tour': id_tour,
            'nid': page_node_id
        };

        jQuery("#goldped_place").html('Идет отмена голоса!');
        jQuery.ajax({
            async: true,
            url: '/goldped/vote',
            data: post,
            type: 'POST',
            success: function (data, textStatus) {
                jQuery("#goldped_place").html(textStatus == 'success' ? data : 'Ошибка');
            }
        });
    }

};

/* Разворачивалка длинных списков */
// Обрабатывает элемент-обёртку длинного списка
// И если необходима кнопка для разворачивания, - добавляет её и обозначает елемент обработанным(убирает класс)
spb_scripts.expandListProcess = function (idElement) {
    var $ = jQuery;

    var $expandListWrapper = $('#' + idElement);
    var expandListWrapperHeight = $expandListWrapper.height();
    var $expandListWrapperChildren = $expandListWrapper.children();
    var expandListContentHeight = 0;

    $expandListWrapperChildren.each(function () {
        expandListContentHeight += $(this).height();
    });

    if (expandListContentHeight > expandListWrapperHeight) {
        // класс hide скрывает блок. Поставили на время A/B-тестов
        if ($expandListWrapper.find('ul').hasClass('similar-content-block')) {
            $expandListWrapper.after('<div class="more-rows-expander hide"><div class="btn" onclick="spb_scripts.moreRowsExpanderClickHandler.call(this)">Развернуть</div></div>');
        } else if ($expandListWrapper.attr('id') === 'more_wrapper') {
            var wrapperHeight = spb_scripts.getHeightForExpandList(idElement);

            $expandListWrapper.css('max-height', wrapperHeight + 30);
            $expandListWrapper.after('<div class="more-rows-expander"><div class="btn" onclick="spb_scripts.moreRowsExpanderClickHandler.call(this)">Еще</div></div>');

            $(window).on('resize', function () {
                var moreBtn = $('#' + idElement).next('.more-rows-expander');

                if (moreBtn.length !== 0) {
                    $('#' + idElement).css('max-height', spb_scripts.getHeightForExpandList(idElement) + 30);
                }
            });
        } else {
            $expandListWrapper.after('<div class="more-rows-expander"><div class="btn" onclick="spb_scripts.moreRowsExpanderClickHandler.call(this)">Развернуть</div></div>');
        }
    }
};

// Реакция на кнопку 'развернуть'
spb_scripts.moreRowsExpanderClickHandler = function () {
    var $ = jQuery,
        $expanderElement = $(this).closest('.more-rows-expander'),
        $expandListWrapper = $expanderElement.prev(),
        expandListContentHeight = $expandListWrapper[0].scrollHeight; //scrollHeight - получает высоту вместе с margin

    // убрал анимацию чтобы не дергалась правая колонка
    $expanderElement.animate({height: 0, opacity: 0}, 0, function () {
        $(this).remove();
    });

    // убрал анимацию чтобы не дергалась правая колонка
    // Вначале анимируем высоту до полной высоты, после этого убираем
    $expandListWrapper.animate({maxHeight: expandListContentHeight}, 0, function () {
        $expandListWrapper.css({maxHeight: 'none'});
    });
};

// Расчитываем высоту контейнера экспандера
spb_scripts.getHeightForExpandList = function (idElement) {
    var expandListWrapper = $('#' + idElement);
    var similarItem = expandListWrapper.find('.similar-content li');
    var wrapperWidth = expandListWrapper.innerWidth();
    var wrapperHeight;
    var item1height = similarItem.eq(0).find('.title').outerHeight();
    var item2height = similarItem.eq(1).find('.title').outerHeight();
    var item3height = similarItem.eq(2).find('.title').outerHeight();
    var itemWidth = similarItem.width();
    var imgRatio = 1.78;
    var colsCounter = Math.floor(wrapperWidth / itemWidth);
    var imgHeight = itemWidth / imgRatio;

    item1height = item1height + imgHeight + 8;
    item2height = item2height + imgHeight + 8;
    item3height = item3height + imgHeight + 8;

    if (colsCounter === 3) {
        wrapperHeight = Math.max(item1height, item2height, item3height);
    } else if (colsCounter === 2) {
        wrapperHeight = Math.max(item1height, item2height);
    } else {
        wrapperHeight = similarItem.eq(0).outerHeight() + similarItem.eq(1).outerHeight() + 15;
    }

    return wrapperHeight;
};
/* Конец разворачивалки длинных списков */
/* SPORT REGIONS VOTING */
function buildVotes(json, sportregions_nid) {

    var Block = function (i, obj) {
        this.init = function (i, obj) {
            this.count = i;
            this.obj = obj;
            this.starsWrap = obj.find('.regions-vote-stars');
            this.stars = this.starsWrap.find('li');

            obj.find('.regions-vote-descr').html(json[i]);

            var cookie = mainObj.cookie.data;
            if ((cookie && cookie[i]) || obj.hasClass('voting')) {
                this.disabledBlock();
            } else {
                this.enablingBlock();
            }
        }

        this.disabledBlock = function () {
            this.obj
                .removeClass('novoting')
                .addClass('voting');

            this.stars.unbind('click.star mouseover.star mouseout.star');
        }

        this.enablingBlock = function () {
            this.obj
                .removeClass('voting')
                .addClass('novoting');

            this.events();
        }

        this.changeStars = function (star) {
            var useClasses = this.starsWrap.attr('class');
            var removeClass = /star-[0-9]*/.exec(useClasses)[0];

            this.starsWrap
                .removeClass(removeClass)
                .addClass('star-' + star);
        }

        this.sendVote = function (count) {
            var block = this;
            block.disabledBlock();
            var id_tourpeople = block.starsWrap.data('id_tourpeople');

            $.ajax({
                async: true,
                url: '/goldped/vote',
                data: {'stars_count': count, 'id_tourpeople': id_tourpeople, 'nid': sportregions_nid},
                type: 'POST',
                dataType: 'json',
                success: function (data) {
                    if (!data) {
                        alert('Ошибка голосования');
                        block.enablingBlock();
                        return;
                    }

                    data = Array(3);
                    data[block.count] = count;
                    mainObj.cookie.setCookie(data);

                    block.starsWrap.data({'default': count});
                },
                error: function () {
                    alert('Ошибка голосования');
                    block.enablingBlock();
                    return;
                }
            });
        }

        this.events = function () {
            var block = this;

            var click = function (e) {
                var obj = $(e.target);
                var count = obj.data('count');
                block.sendVote(count);
            }

            var mouseover = function (e) {
                var currentStar = $(e.target);
                var count = currentStar.data('count');
                block.changeStars(count);
            }

            var mouseout = function () {
                var count = block.starsWrap.data('default');
                block.changeStars(count);
            }

            this.stars
                .bind('click.star', function (e) {
                    click(e);
                })
                .bind('mouseover.star', function (e) {
                    mouseover(e);
                })
                .bind('mouseout.star', function () {
                    mouseout();
                });
        }

        this.init(i, obj);
    }


    var MainObj = function () {
        var cookieName = 'sport_regions_voting';

        this.cookie = {
            getCookie: function (full) {
                var cookie = $.cookie(cookieName);

                if (!cookie) {
                    return false
                }

                cookie = JSON.parse(cookie);

                if (cookie[sportregions_nid] || full) {
                    if (full) {
                        return cookie;
                    } else {
                        return cookie[sportregions_nid];
                    }
                } else {
                    return false;
                }
            },

            setCookie: function (data) {
                var cookie = this.getCookie('full');

                if (cookie) {
                    if (cookie[sportregions_nid]) {
                        for (var i = 0; i < data.length; i++) {
                            if ((!data[i] && cookie[sportregions_nid][i]) || (data[i] && cookie[sportregions_nid][i])) {
                                data[i] = cookie[sportregions_nid][i];
                            } else {
                                continue
                            }
                        }
                    }
                } else {
                    cookie = {};
                }

                cookie[sportregions_nid] = data;

                var currentTime = new Date();
                var expiration = 24 * 60 * 60 - (currentTime.getHours() * 60 * 60 + currentTime.getMinutes() * 60 + currentTime.getSeconds());
                $.cookie(cookieName, JSON.stringify(cookie), { expires: expiration, path: '/' });
                this.data = data;
            }
        }

        this.cookie.data = this.cookie.getCookie();

        this.init = (function () {
            $.ajax({
                cache: true,
                async: true,
                url: '/goldped/toursview?nid=' + sportregions_nid,
                type: 'GET',
                dataType: 'html',
                success: function (data) {
                    mainObj.render(data);
                }
            });
            return true;
        })()

        this.render = function (data) {
            var mainWrap = $('#sportregions_place');
            mainWrap.html(data);

            var block = [];
            var objs = mainWrap.find('.regions-vote-block');
            objs.each(function (i, obj) {
                block[i] = new Block(i, $(obj));
            });

            this.blocks = block;

            if (typeof Cufon != 'undefined') {
                Cufon.replace('.etelka-font', {letterSpacing: '-1px'});
            }
        }
    }

    var mainObj = new MainObj();

    if (typeof Cufon != 'undefined') {
        Cufon.replace('.etelka-font', {letterSpacing: '-1px'});
        Cufon.replace('.etelka-font-header', {textShadow: '0px 1px rgba(51,51,51, 0.6)', letterSpacing: '-1px'});
    }
};
/* /SPORT REGIONS VOTING */

var spb_scripts = spb_scripts || {};

/* определяем текущий брекпоинт (start) */
spb_scripts.getCurrentBreakpoint = function () {
    var breakpoint;

    if (spb_scripts.helpers.matchMediaQueries('(min-width: 1200px)')) {
        breakpoint = 'lg';
    } else if (spb_scripts.helpers.matchMediaQueries('(min-width: 992px) and (max-width: 1199px)')) {
        breakpoint = 'md';
    } else if (spb_scripts.helpers.matchMediaQueries('(min-width: 561px) and (max-width: 992px)')) {
        breakpoint = 'sm';
    } else if (spb_scripts.helpers.matchMediaQueries('(max-width: 560px)')) {
        breakpoint = 'xs';
    }

    return breakpoint;
};
/* определяем текущий брекпоинт (end) */

/* определяем текущий контейнер под баннер (start) */
spb_scripts.getBannerContainer = function (breakpoint) {
    var container = $('.b-advertise_240x400-' + breakpoint);
    return container;
};
/* определяем текущий контейнер под баннер (end) */

/* Нижний баннер правой колонки по доходу до него фиксируеться вверху (start) */
spb_scripts.getFixedRightColumnBanner = function () {
    var banner = $('#adfox_spb2015_right_column_botton');
    var banner_box = banner.parent();

    $(window).on('scroll', function () {
        if ((banner_box.offset().top + banner_box.outerHeight() - banner.outerHeight()) < $(window).scrollTop()) {
            banner.height(banner.find(' > .banner').outerHeight()).addClass('fixed');
        } else {
            banner.removeClass('fixed');
        }
    });
};
/* Нижний баннер правой колонки по доходу до него фиксируеться вверху (end) */
/* социальные кнопки (start) */
spb_scripts.socialBtns = function (ajaxReload) {
    var container = $('.b-social-btns');
    var url = window.location.href;
    var title = $('meta[property="og:title"]').attr('content');
    var logo = $('meta[property="og:image"]').attr('content');

    if (!container) {
        return;
    }

    container.html('<ul>' +
        '<li class="b-social-btns__li">' +
        '<a class="social-btn social-btn_vk" target="_blank" href="http://vk.com/share.php?url=' + url + '&title=' + title + '&image=' + logo + '" title="ВКонтакте">R</a>' +
        '</li>' +
        '<li class="b-social-btns__li">' +
        '<a class="social-btn social-btn_fb" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=' + url + '&title=' + title + '" title="Facebook">E</a>' +
        '</li>' +
        '<li class="b-social-btns__li">' +
        '<a class="social-btn social-btn_gp" target="_blank" href="https://plus.google.com/share?url=' + url + '&image=' + logo + '" title="Google+">Q</a>' +
        '</li>' +
        '</ul>');

    container.on('click', '.social-btn_vk, .social-btn_fb , .social-btn_gp', function (event) {
        var url = $(this).attr('href');
        event.preventDefault();
        window.open(url, '', 'width=400,height=150');
        // Счётчик клика
        if (typeof yaCounter1598595 != "undefined") {
            yaCounter1598595.reachGoal('spbSocialButton-' + spb_scripts.helpers.getUserViewDevice() + '-click');
        }
    });

    if ((typeof ajaxReload == "undefined") && (typeof yaCounter1598595 != "undefined")) {
        // Счётчик показа
        yaCounter1598595.reachGoal('spbSocialButton-' + spb_scripts.helpers.getUserViewDevice() + '-show');
    }
};
$(document).ready(function () {
    spb_scripts.socialBtns();
});
/* социальные кнопки (end) */



/* Исправляем соотношение колонок для небольших разрешений */
$(document).ready(function () {
    var timer = null;
    spb_scripts.fixColumns = function () {
        var bp = {
            'min': 500,
            'max': 630
        };
        var docWidth = $(window).width();

        if (docWidth < bp.max && docWidth > bp.min) {
            $('.col-sm-6-less-630').addClass('col-sm-6').removeClass('col-sm-7').removeClass('col-sm-5');
        } else {
            $('.col-sm-5-more-630').addClass('col-sm-5').removeClass('col-sm-6');
            $('.col-sm-7-more-630').addClass('col-sm-7').removeClass('col-sm-6');
        }
    };

    spb_scripts.fixColumns();

    $(window).resize(function () {
        clearTimeout(timer);
        timer = setTimeout(function () {
            spb_scripts.fixColumns();
        }, 100);
    });
});


$(function () {

    /*
     Глобальный класс навешивания
     стандортного bootstrap-datepicker
     */

    var $elemDatepicker = $('.js-global-calendar');


    $elemDatepicker.datepicker({
        language: "ru",
        format: "yyyy-mm-dd",
        todayHighlight: true
    });


    var page_microts = $elemDatepicker.data("page-ts") * 1000;
    if (page_microts) {
        var page_date = new Date(page_microts);
        $elemDatepicker.datepicker('setDate', page_date);
    }

});

/* Stats tables 10.04 (start) */
function Blocks_Colums_Sorter() {
    $('#stats_container .stats-two-colls-wrap').each(function () {
        if ($(this).find('div.stats-column:last-child').text().length == 0) {
            if ($(this).find('div.stats-column:first-child .new_stats_table_v2_blocks_wrap').length > 1) {
                if ($(this).is('.noMove')) {
                    return;
                } else {
                    var newtable = $(this).find('div.stats-column:first-child .new-stats-div-blocks-wrap').clone();
                    var newtableHeader = $(this).find('div.new_stats_table_v2_blocks_header').clone();
                    newtable.empty();
                    var gt = Math.round($(this).find('.new_stats_table_v2_blocks_wrap').length / 2 - 1);
                    newtable.append($(this).find('.new_stats_table_v2_blocks_wrap:gt(' + gt + ')'));
                    $(this).find('div.stats-column:last-child').append(newtableHeader).append(newtable);
                }
            } else if ($(this).find('div.stats-column:first-child .stats_group').length > 0) {
                var count = Math.round($(this).find('div.stats-column:first-child .stats_group').length / 2) - 1;
                var blocks = $(this).find('div.stats-column:first-child .stats_group:gt(' + count + ')');
                blocks.appendTo($(this).find('div.stats-column:last-child'));
            } else if ($(this).find('div.stats-column:first-child .stats_conference').length > 0) {
                var count = Math.round($(this).find('div.stats-column:first-child .stats_conference').length / 2) - 1;
                var blocks = $(this).find('div.stats-column:first-child .stats_conference:gt(' + count + ')');
                blocks.appendTo($(this).find('div.stats-column:last-child'));
            } else if ($(this).find('div.new_stats_table.grey_zebra.teamsdisplay.table-shorter-group').length > 0) {
                var group = $(this).find('div.new_stats_table.grey_zebra.teamsdisplay.table-shorter-group table');
                var LeftLine = $('<div class="new_stats_table grey_zebra"/>');
                var RightLine = $('<div class="new_stats_table grey_zebra"/>');
                if (group.length > 1) {
                    var leftSide = group.splice(0, Math.ceil(group.length / 2));
                    $(leftSide).each(function () {
                        $(this).prev().appendTo(LeftLine);
                        $(this).appendTo(LeftLine);
                    });
                    $(group).each(function () {
                        $(this).prev().appendTo(RightLine);
                        $(this).appendTo(RightLine);
                    });
                } else {
                    return;
                }
                $(LeftLine).appendTo($(this).find('div.stats-column:first-child'));
                $(RightLine).appendTo($(this).find('div.stats-column:last-child'));
                $(this).find('div.new_stats_table.grey_zebra.teamsdisplay.table-shorter-group').remove();
                $(this).find('.stats-column').addClass('shorted');
                var shorterheight = ($(this).find('div.stats-column:first-child').height() < $(this).find('div.stats-column:last-child').height()) ? $(this).find('div.stats-column:first-child').height() - 15 : $(this).find('div.stats-column:last-child').height() - 15;
                shorterheight = (shorterheight > 500) ? 450 : shorterheight;
                var button = $('<div class="table-shorter-group-more-button2" align="center" style="clear:both" data-shorted="1"/>').text('Весь состав').click(function () {
                    var switcher = parseInt($(this).attr('data-shorted'));
                    switch (switcher) {
                        case 0:
                            $(this).attr('data-shorted', '1').removeClass('reversed-button-bg').text('Весь состав').prev().css('height', shorterheight + 'px');
                            break;
                        default:
                            $(this).attr('data-shorted', '0').addClass('reversed-button-bg').text('Свернуть').prev().css('height', 'auto');
                            break;
                    }
                });
                $(this).css('height', shorterheight + 'px').css('overflow', 'hidden').after(button);
            } else {
                return;
            }
        } else {
            return;
        }
    });
}
/* Stats tables 10.04 (end) */






/* разворачивалка описания для карточек команд и игроков (start) */
(function ($) {
    $.fn.readmore = function (settings) {
        var opts = $.extend({}, $.fn.readmore.defaults, settings);

        this.each(function () {
            $(this).data('opts', opts);
            if ($(this).html().length > opts.substr_len) {
                abridge($(this));
                linkage($(this));
            }
        });

        function linkage(elem) {
            elem.append(elem.data('opts').more_link);
            elem.children('.more').on('click', function (event) {
                event.preventDefault();

                $(this).hide();
                $(this).siblings('span:not(.hidden-text)').hide().siblings('span.hidden-text').animate({'opacity': 'toggle'}, 1000);
            });
        }

        function abridge(elem) {
            var opts = elem.data('opts');
            var txt = elem.html();
            var len = opts.substr_len;
            var dots = '<span>' + opts.ellipses + '</span>';
            var charAtLen = txt.substr(len, 1);
            while (len < txt.length && !/\s/.test(charAtLen)) {
                len++;
                charAtLen = txt.substr(len, 1);
            }
            var shown = txt.substring(0, len) + dots;
            var hidden = '<span class="hidden-text" style="display: none;">' + txt.substring(len, txt.length) + '</span>';
            elem.html(shown + hidden);
        }

        return this;
    };

    $.fn.readmore.defaults = {
        substr_len: 300,
        ellipses: '&#8230; ',
        more_link: '<a class="more" href="#" style="cursor: pointer; text-decoration: none; border-bottom: #008bd7 dashed 1px;">Еще</a>'
    };

})(jQuery);
/* разворачивалка описания для карточек команд и игроков (end) */


var spb_scripts = spb_scripts || {};

spb_scripts.tables = {
    // делаем из tr ссылку
    make_tr_link: function () {
        var link = $('.make-tr-clickable-js');

        $.each(link, function (i) {
            var tr = $(link[i]).parents('tr').eq(0);

            tr.addClass('clickable');
            tr.find('td, tr').wrapInner(function () {
                if (!$(this).children().hasClass('make-tr-clickable-js')) {
                    return '<a href="' + $(link[i]).attr('href') + '"></a>';
                }
            });
        });
    },

    // Раскрытие условных обозначений под таблицами
    open_legend: function () {
        var legend = $('.legend-js');
        var legend_btn = legend.find('.b-legend__title');

        legend_btn.on('click', function () {
            $(this).next('.b-legend__wrap').toggleClass('hide');
        });
    },

    // разворачивалка строк календаря
    expand_rows: function (table) {
        var expand_btn = $('.next-rows-js, .prev-rows-js');

        table.find('.hidden-js').addClass('hidden');
        expand_btn.removeClass('hidden');

        expand_btn.on('click', function (event) {
            var elem = $(this);
            var type = elem.data('type');
            var table = elem.parents('table').eq(0);

            event.preventDefault();
            event.stopPropagation();

            elem.addClass('hidden');
            table.find('.' + type).removeClass('hidden');
        });
    }
};
$(document).ready(function () {
    $.tablesorter.defaults.widgets = ["zebra"];
    var regexp = /^([0-9]+) \\([0-9]+\\)$/;
    var regexp1 = /^([0-9]+)$/;
    var integerTextExtractor = function (node) {
        var text = $(node).text();
        var matches = text.match(regexp);
        if (matches) {
            text = matches[1];
        } else {
            matches = text.match(regexp1);
            if (matches) text = matches[1];
        }
        return text;
    };

    $('.b-table-tablesorter-js > table').tablesorter({
        sortList: [
            [0, 0]
        ],
        textExtraction: integerTextExtractor,
        //sortInitialOrder: "asc",
        headers: {
            0: {sorter: 0},
            1: {sorter: "integer"},
            2: {sorter: "integer"},
            3: {sorter: "integer"},
            4: {sorter: "integer"}
        },
        cssDesc: 'tablesorter-desc',
        cssAsc: 'tablesorter-asc'
    });

    spb_scripts.tables.make_tr_link();
    spb_scripts.tables.open_legend();
});

/* разворачивалка таблиц (start) */
(function ($) {
    $.fn.cutting_table = function (settings) {
        var opts = $.extend({}, $.fn.cutting_table.defaults, settings);

        this.each(function () {
            var table = $(this);

            table.data('opts', opts);
            if (!table.hasClass('cutting-table-js')) {
                hide_rows(table);
                more_link(table);
                table.addClass('cutting-table-js')
            }
        });

        function more_link(elem) {
            ;
            var rows = elem.find('tr');

            if (rows.length <= opts.visible_rows) {
                return;
            }
            elem.after(elem.data('opts').more_link);
            elem.next('.more-btn-table-js').on('click', function (event) {
                event.preventDefault();

                $(this).hide();
                $(this).prev().find('.hidden').removeClass('hidden');
            });
        }

        function hide_rows(elem) {
            var opts = elem.data('opts');
            var rows = elem.find('tr');
            var len = opts.visible_rows;

            $.each(rows, function (index) {
                if (index > len) {
                    $(this).addClass('hidden');
                }
            });
        }

        return this;
    };

    $.fn.cutting_table.defaults = {
        visible_rows: 6,
        more_link: '<a class="more-btn more-btn-tournir-table more-btn-table-js" href="#"><span>Еще</span></a>'
    };

})(jQuery);
/* разворачивалка таблиц (end) */

spb_scripts.playerResize = function () {
    var videoFrame = $('.node-header__video iframe')[0];
    var videoContainerWidth = $('.node-header__video').width();
    var aspectRatio = 16 / 9;
    var barHeight = 24;
    var frameHeight = (videoContainerWidth / aspectRatio) + barHeight;

    if (videoFrame) {
        $(videoFrame).attr('width', videoContainerWidth).attr('height', frameHeight);
    }
};

spb_scripts.resizePlayerInNodeContent = function () {
    var iframeWidth = $('.node-content__body').width();
    var aspectRatio = 16 / 9;
    var barHeight = 24;
    var iframeHeight = (iframeWidth / aspectRatio) + barHeight;

    var playerIframe = $('iframe[name=spb_player_iframe]');
    playerIframe.height(iframeHeight);
    playerIframe.width(iframeWidth);
};

/* переставляем тизеры в ноде (start) */
spb_scripts.readMoreBlockReplacer = function () {
    var obj = this;

    obj.replaceTeasers = function () {
        var teasers;
        var breakpoint = spb_scripts.getCurrentBreakpoint();
        var container = obj.getTeasersContainer(breakpoint);

        teasers = $('.read-more-block-container-js').detach();
        container.append(teasers);
    };

    obj.getTeasersContainer = function (breakpoint) {
        return $('.read-more-block-' + breakpoint);
    };

    obj.replaceTeasers();

    obj.old_breakpoint = spb_scripts.getCurrentBreakpoint();
    obj.container = obj.getTeasersContainer(obj.old_breakpoint);
    obj.timerTeasersReplace = null;

    $(window).resize(function () {
        clearTimeout(obj.timerTeasersReplace);

        obj.timerTeasersReplace = setTimeout(function () {
            var new_breakpoint = spb_scripts.getCurrentBreakpoint();

            if (new_breakpoint !== obj.old_breakpoint) {
                obj.replaceTeasers();

                obj.old_breakpoint = new_breakpoint;
            }

        }, 100);
    });
};
/* переставляем тизеры в ноде (end) */

$(function () {
    // загрузка фотографий по необходимости (при прокрутке)
    $('.lazy').lazyload({
        effect: 'fadeIn',
        threshold: 1000
    });

    // шара в социальные сети
    $('.node-content__social a').on('click', function (event) {
        var elem = $(this);

        event.preventDefault();
        window.open(elem.attr('href'), '', 'menubar=no, toolbar=no, resizable=no, scrollbars=no, width=640, height=400');
    });
});

// слайдер похожих видео
$(function () {
    if ($('.node-header__match').length !== 0 && $('.node-header__similar-videos').length !== 0) {
        var similarVideosBlock = $('.node-header__similar-videos .wrapper');
        var navBtn = $('.nav-btn');

        navBtn.on('click', function (event) {
            var elem = $(this);
            var type = elem.attr('id');

            event.preventDefault();

            if (type === 'next-btn-js') {
                similarVideosBlock.animate({scrollLeft: '+=158'}, 'fast');
            } else {
                similarVideosBlock.animate({scrollLeft: '-=158'}, 'fast');
            }
        });
    }
});

/* Вставляем инфографику в iFrame (start) */
$(document).ready(function () {
    var infograph = $('a[data-role-spb="infographic"]');
    var iframe = $('<iframe frameborder="0" scrolling="no"></iframe>');
    var imgRegExp = new RegExp(/(https?:\/\/.*\.(?:png|jpg|jpeg|gif))/i);
    var player = $('a[data-role-spb="spb_player"]');
    var playerIframe = $('<iframe name="spb_player_iframe" scrolling="no" frameborder="0" allowfullscreen="1" width="450" height="254"></iframe>');
    var instagram = $('a[data-role-spb="spb_ig"]');
    var twitter = $('a[data-role-spb="spb_tw"]');
    var youtube = $('a[data-role-spb="spb_youtube_embed"]');
    var instagramBlock;
    var twitterBlock;
    var content;

    spb_scripts.playerResize();

    $.each(infograph, function () {
        var elem = $(this);
        var image = $('<img />');

        if (imgRegExp.test(elem.attr('href'))) {
            image.attr({
                'src': elem.attr('href'),
                'width': elem.data('iframe-width')
            }).addClass('node-infograph').addClass('node-infograph__image');
            content = '<a href="' + elem.attr('href') + '" target="_blank"></a>';
            content = $(content).append(image);
            elem.after(content);
            elem.remove();
        } else {
            if (!(elem.data('iframe-width') > elem.parent().width())) {
                iframe.attr({
                    'src': elem.attr('href'),
                    'height': elem.data('iframe-height'),
                    'width': elem.data('iframe-width')
                }).addClass('node-infograph');
                content = iframe;
                elem.after(content);
                elem.remove();
            } else {
                if (!elem.parent('p')) {
                    elem.wrap('<p></p>');
                }
            }
        }

    });

    $.each(player, function () {
        var elem = $(this);
        playerIframe.attr({
            'src': elem.data('player-url')
        });

        elem.after(playerIframe);
        elem.remove();

        spb_scripts.resizePlayerInNodeContent();

        $(window).resize(function () {
            spb_scripts.resizePlayerInNodeContent();
        });

    });

    $.each(instagram, function () {
        var elem = $(this);
        instagramBlock = $('<blockquote class="instagram-media" data-instgrm-captioned data-instgrm-version="4" style="display: block; margin: 15px; max-width:617px; padding:0; width: 100%;">' +
            '<div style="padding:8px;">' +
            '<div style=" background:#F8F8F8; line-height:0; margin-top:40px; padding:50% 0; text-align:center; width:100%;">' +
            '<div style="display:block; height:44px; margin:0 auto -44px; position:relative; top:-22px; width:44px;">' +
            '</div></div>' +
            '<p style=" margin:8px 0 0 0; padding:0 4px;">' +
            '<a href="' + elem.attr('href') + '" style=" color:#000; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none; word-wrap:break-word;" target="_top"></a></p> <p style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; line-height:17px; margin-bottom:0; margin-top:8px; overflow:hidden; padding:8px 0 7px; text-align:center; text-overflow:ellipsis; white-space:nowrap;">' +
            '</p></div></blockquote>' +
            '<script async defer src="http://s.s-ports.ru/sites/all/libraries/design/_spbver_/js/instagram/embeds.js"></script>');

        elem.after(instagramBlock);
        elem.remove();
    });

    $.each(twitter, function () {
        var elem = $(this);
        twitterBlock = $('<blockquote class="twitter-tweet" lang="ru">' +
            '<a href="' + elem.attr('href') + '"></a></blockquote>' +
            '<script async src="http://platform.twitter.com/widgets.js" charset="utf-8"></script>');

        elem.after(twitterBlock);
        elem.remove();
    });

    $.each(youtube, function () {
        var elem = $(this),
            embed_url = elem.data('embed-url'),
            wrapper = $('<div class="youtube_embed_wrapper">'),
            iframe = $('<iframe>');

        iframe.attr({
            src: embed_url,
            width: 560,
            height: 315,
            frameborder: 0,
            allowfullscreen: true
        });

        function resize() {
            var width, height;

            width = iframe.parent().width();
            height = Math.round(width * 0.5625); // 16:9

            iframe.attr({
                width: width,
                height: height
            });
        }

        wrapper.append(iframe);
        elem.after(wrapper);
        elem.remove();

        $(document).ready(resize);
        $(window).resize(resize);
    });
});
/* Вставляем инфографику в iFrame (end) */

/* Слайдер похожих видео в Материале (start) */
(function () {
    var video_similar = {
        primary_li_width: 0,
        wrapper_focused: false,
        wrapper: null,

        init: function () {
            video_similar.wrapper = $('.node-header__similar-videos .wrapper');
            video_similar.wrapper.perfectScrollbar({
                suppressScrollY: false,
                useBothWheelAxes: true
            });

            video_similar.primary_li_width = video_similar.wrapper.find('li').outerWidth();

            video_similar.resize_images();
            video_similar.scroll_similar();

            video_similar.wrapper.one('wheel click touchstart', function () {
                video_similar.wrapper_focused = true;
            });

            $(window).resize(function () {
                video_similar.resize_images();
                if (!video_similar.wrapper_focused) {
                    video_similar.scroll_similar();
                }
            });
        },

        resize_images: function () {
            var li_arr = $('.node-header__similar-videos .wrapper li');
            var visible_li_count = video_similar.wrapper.width() / video_similar.primary_li_width;
            var visible_li_count_floor = Math.floor(visible_li_count);
            var free_space_percent = visible_li_count - visible_li_count_floor;

            if ($(window).width() >= SPB.constants.desktop_min_width) {
                li_arr.width(video_similar.primary_li_width);
                return;
            }

            if ((free_space_percent < 0.2 ) && (visible_li_count <= li_arr.length)) {
                li_arr.width(video_similar.primary_li_width * 1.2);
            } else if ((free_space_percent > 0.9) && (visible_li_count <= li_arr.length)) {
                li_arr.width(video_similar.primary_li_width * 1.1);
            } else {
                li_arr.width(video_similar.primary_li_width);
            }
        },

        scroll_similar: function () {
            var current_li = video_similar.wrapper.find('.current');
            var li_width = video_similar.wrapper.find('li').not(current_li).outerWidth();
            var li_left_offset = current_li.prevAll().length * li_width - video_similar.wrapper.width();
            var scroll_left = (video_similar.wrapper.width() / 2 ) + li_left_offset + (current_li.outerWidth() / 2 );

            video_similar.wrapper.scrollLeft(scroll_left);
        }
    };

    $(video_similar.init);
})();
/* Слайдер похожих видео в Материале (end) */


$(window).resize(function () {
    clearTimeout(timer);
    var timer = setTimeout(function () {
        spb_scripts.playerResize();
    }, 100);
});

var tv_page = {
    server_time: 0,
    client_time: 0,
    city_timezone: 0,

    current_channel: 'all',
    hide_out_time: true,
    today_date: undefined,
    selected_date: undefined,

    show_now: true,

    sportbox_channel_id: 36,

    onLoad: function (server_time, city_timezone, selected_date) {
        tv_page.server_time = server_time;
        tv_page.city_timezone = city_timezone;
        tv_page.client_time = (new Date()).getTime() / 1000;

        if (url('?date') != null) {
            tv_page.hide_out_time = false;
        }

        tv_page.today_date = $('.tv-today-link-js').data('date');
        tv_page.selected_date = selected_date;

        tv_page.setupTransmission();
        tv_page.setupSportboxEndedTranslation();

        $('.channel-js').each(function () {
            var channel_id = $(this).data('channelId');
            $(this).find('.tv-channel-logo-js').on('click', function (event) {
                event.preventDefault();
                tv_page.changeChannel(channel_id);
            });
            $(this).find('.tv-channel-header-js').on('click', function (event) {
                event.preventDefault();
                tv_page.changeChannel(channel_id);
            });
        });

        $('.tv-channel-select-item-js').each(function () {
            var channel_id = $(this).data('channelId');
            $(this).on('click', function () {
                tv_page.changeChannel(channel_id)
            });
        });

        $('.tv-now-link-js').on('click', function (event) {
            event.preventDefault();
            tv_page.showNow();
        });

        $('.tv-today-link-js').on('click', function (event) {
            event.preventDefault();
            tv_page.showToday()
        });

        $('.tv-city-select-item-js').each(function () {
            var city_id = $(this).data('cityId');
            $(this).on('click', function () {
                tv_page.changeCity(city_id)
            });
        });

        $('.tv-day-link-js').each(function () {
            var date = $(this).data('date');
            $(this).on('click', function (event) {
                event.preventDefault();
                tv_page.changeDate(date);
            });
        });

        $('.tv-current-day-js .tv-today-link-js').addClass('change_mode_link');

        // Сделано для Адфокса для того чтобы в баннере можно было поставь ссылку на конкретный канал
        // Т.к. адфокс не умеет ссылки с хэшами
        if (url('?channel') != null) {
            var channel_hash = '#channel=' + url('?channel');
            if (url('?date') != null) {
                window.history.pushState('', '', '/tv?date=' + url('?date') + channel_hash);
            } else {
                window.history.pushState('', '', '/tv' + channel_hash);
            }
        }

        if (url('#channel') != null) {
            tv_page.changeChannel(
                url('#channel')
            );
        }
    },

    showNow: function () {
        if (tv_page.today_date != tv_page.selected_date) {
            window.location.href = url('path');
            return;
        }

        tv_page.hide_out_time = true;
        $('.channel-js').each(function () {
            var channel_id = $(this).data('channelId');
            tv_page.restoreChannel(channel_id);
        });
        $('.tv-current-day-js .tv-now-link-js').removeClass('change_mode_link');
        $('.tv-current-day-js .tv-today-link-js').addClass('change_mode_link');

        this.show_now = true;
        tv_page.setupSportboxEndedTranslation();
    },

    showToday: function () {
        if (tv_page.today_date != tv_page.selected_date) {
            tv_page.changeDate(tv_page.today_date);
            return;
        }

        if (tv_page.current_channel == 'all') {
            $('.channel-js').each(function () {
                $(this).find('.tv-transmission-container-js').removeClass('hide');
            });
            $('.tv-current-day-js .tv-now-link-js').addClass('change_mode_link');
            $('.tv-current-day-js .tv-today-link-js').removeClass('change_mode_link');
        }

        this.show_now = false;
        tv_page.setupSportboxEndedTranslation();
    },

    showAllChannels: function () {
        $('.channel-js').removeClass('hide');
        window.location.hash = '#channel=all';
    },

    changeChannel: function (channel_id) {
        if (tv_page.current_channel != 'all') {
            tv_page.restoreChannel(tv_page.current_channel);
        }

        if (channel_id == 'all') {
            this.showAllChannels();

            $('.channel-select-js').html('Все каналы<span class="caret"></span>');
            $('.tv-now-link-js').removeClass('hide');
            tv_page.current_channel = 'all';
            $('.tv-current-day-js .tv-now-link-js').addClass('change_mode_link');
            $('.tv-current-day-js .tv-today-link-js').removeClass('change_mode_link');

            if (tv_page.today_date == tv_page.selected_date) {
                if (this.show_now) {
                    this.showNow();
                } else {
                    this.showToday();
                }
            }

            return;
        }

        $('.channel-js').each(function () {
            var $this = $(this),
                current_channel_id = $this.data('channelId');

            if (current_channel_id != channel_id) {
                $this.addClass('hide');
                return;
            }

            $this.removeClass('hide');
            $this.find('.tv-transmission-container-js').removeClass('hide');
            $this.find('h3').addClass('hide');

            // делаем программу выбранного канала одноколоночной
            $this.parent()
                .removeClass('col-lg-4').addClass('col-lg-8')
                .removeClass('col-md-4').addClass('col-md-8');
            // col-sm-6 и col-xs-12 таким и остаётся

            $('.tv-third-clearfix-js')
                .removeClass('visible-lg').addClass('hidden-lg')
                .removeClass('visible-md').addClass('hidden-md');

            $('.tv-second-clearfix-js')
                .removeClass('visible-sm').addClass('hidden-sm');

            $('.channel-select-js').html($this.find('h3').text() + '<span class="caret"></span>');
        });

        $('.tv-now-link-js').addClass('hide');
        tv_page.current_channel = channel_id;
        window.location.hash = '#channel=' + channel_id;
    },

    setupTransmission: function () {
        if (tv_page.today_date != tv_page.selected_date) {
            return;
        }
        var near_transmission_count = 0;
        var previous_channel_id = 0;

        $('.tv-transmission-container-js').each(function (i) {
            var elem = $(this);
            var time_start = elem.data('timeStart');
            var time_finish = elem.data('timeFinish');
            var current_channel = elem.parent('.channel-js').data('channelId');

            if (previous_channel_id != current_channel) {
                near_transmission_count = 0;
            }

            if (tv_page.server_time > time_finish) {
                elem.addClass('out_time');
                if (tv_page.hide_out_time) {
                    elem.addClass('hide');
                }
            } else if ((tv_page.server_time > time_start) && (tv_page.server_time < time_finish)) {

                var percentage;
                var progress;
                elem.addClass('right_now');
                percentage = Math.round(100 * ((tv_page.server_time - time_start) / (time_finish - time_start)));
                progress = '<div class="tv_progress" style="width:' + percentage + '%">&nbsp;</div>';
                elem.find('.tv-transmission-js').parent().prepend(progress);

            } else if ((near_transmission_count >= 4) && tv_page.hide_out_time) {
                elem.addClass('hide');
            } else {
                near_transmission_count++;
            }

            previous_channel_id = current_channel;
        });
    },

    restoreChannel: function (channel_id) {
        // Делаем программу (ранее выбранного) канала обратно 2х-3х колоночной
        var $current_channel = $('.channel-' + tv_page.current_channel + '-js').parent();
        $current_channel.removeClass('col-lg-12').addClass('col-lg-4');
        $current_channel.removeClass('col-md-12').addClass('col-md-4');
        // col-sm-6 и col-xs-12 таким и остаётся

        $('.tv-third-clearfix-js')
            .removeClass('hidden-lg').addClass('visible-lg')
            .removeClass('hidden-md').addClass('visible-md');

        $('.tv-second-clearfix-js')
            .removeClass('hidden-sm').addClass('visible-sm');

        $('.channel-' + channel_id + '-js h3').removeClass('hide');

        if (tv_page.today_date != tv_page.selected_date) {
            return;
        }

        var near_transmission_count = 0;
        $('.channel-' + channel_id + '-js .tv-transmission-container-js').each(function (i) {
            var elem = $(this);
            var time_start = elem.data('timeStart');
            var time_finish = elem.data('timeFinish');

            if (tv_page.server_time > time_finish) {
                if (tv_page.hide_out_time) {
                    elem.addClass('hide');
                }
            } else if ((tv_page.server_time > time_start) && (tv_page.server_time < time_finish)) {
                // now
            } else if ((near_transmission_count >= 4) && tv_page.hide_out_time) {
                elem.addClass('hide');
            } else {
                near_transmission_count++;
            }
        });
    },

    changeCity: function (city_id) {
        $.cookie('tv_city', city_id, {expires: 365, path: '/'});
        location.reload(true);
    },

    changeDate: function (date) {
        var channel_hash = '';
        if (tv_page.current_channel != 'all') {
            channel_hash = '#channel=' + tv_page.current_channel;
        }
        window.location.href = '/tv?date=' + date + channel_hash;
    },

    datepickerChangeDate: function () {
        $('.tv-calendar-container-js').on('changeDate', function (event) {
            tv_page.changeDate(event.format());
        });
    },

    setupSportboxEndedTranslation: function () {
        var total_transmission = $('.channel-' + tv_page.sportbox_channel_id + '-js>.tv-transmission-container-js').length,
            finished_transmissions = $('.channel-' + tv_page.sportbox_channel_id + '-js>.tv-transmission-container-js.out_time').length;

        var remain_tranmissions = total_transmission - finished_transmissions;

        if (tv_page.show_now && remain_tranmissions == 0) {
            $('.tv-sportbox-end-translation-js').removeClass('hide');
        } else {
            $('.tv-sportbox-end-translation-js').addClass('hide');
        }
    }
};

$(function () {
    tv_page.datepickerChangeDate();
    $('.tv_datepicker_button-js').on('click', function (event) {
        event.stopPropagation();
        $(this).prev('span').click();
    });
});
var count = 0;
var counter = null;

$(function () {
    var liveTournir = $('.translation.tournir_live');
    var liveCheckbox = $('#live-checkbox-js');

    if (liveTournir.length > 0) {
        liveTournir.on('click', function () {
            spb_scripts.reloadWindow();
        });

        count = 10;
        counter = setInterval(spb_scripts.LivePageReloadTimer, 1000);

        spb_scripts.reloadWindow();
    }
    spb_scripts.onlinesPageTitleCalendar();

    liveCheckbox.on('change', function () {
        var isChecked = $(this).prop('checked');
        var param = '';

        if (isChecked) {
            param = '?live=1';
        }

        window.location.href = '/stats' + param;
    });
});

spb_scripts.toggleShowInBlockOnline = function (game_id, link, is_to_sport) {
    is_to_sport = is_to_sport || false;

    var action = 'toggle_show_game_in_block_top_results';
    if (is_to_sport) {
        action = 'toggle_show_game_in_block_top_results_to_sport';
    }

    $.ajax({
        url: '/stats_online/' + action + '/' + game_id,
        success: function () {
            link = $(link);

            var is_set_show_in_block = link.hasClass('checked');

            var message = 'Не выводить в блоке онлайнов';
            if (is_set_show_in_block) {
                message = 'Выводить в блоке онлайнов';
            }
            if (is_to_sport) {
                message += ' на странице вида спорта';
            }

            if (is_set_show_in_block) {
                link.html('<span class="glyphicon glyphicon-unchecked"></span>').css('color', '').attr('title', message).removeClass('checked');
            } else {
                link.html('<span class="glyphicon glyphicon-check"></span>').css('color', 'red').attr('title', message).addClass('checked');
            }
        },
        error: function () {
            alert('Ошибка при изменение значения');
        }
    });
};

spb_scripts.onlinesPageTitleCalendar = function () {
    $('#onlines_page_title_calendar').on('changeDate', function (event) {
        var s_date = event.date;
        var r_date = s_date;
        var r_date_month = '' + (r_date.getMonth() + 1);
        var r_date_date = '' + r_date.getDate();
        var date_param;

        if (typeof( s_date ) == 'string') {
            var split_date = s_date.split('-');
            r_date = new Date();
            r_date.setMonth(split_date[1], split_date[0]);
            r_date.setYear(split_date[2]);
        }

        if (r_date_month.match(/^\d$/) !== null) {
            r_date_month = '0' + r_date_month;
        }

        if (r_date_date.match(/^\d$/) !== null) {
            r_date_date = '0' + r_date_date;
        }

        date_param = r_date.getFullYear() + '-' + r_date_month + '-' + r_date_date;

        window.location.href = '/stats/' + date_param;
    });
};

/* обновляем онлайны по таймеру (start) */
spb_scripts.loadPageWithAjax = function (date, live, sport_id, parent_sport_id) {
    var data_send = {
        page_date: date
    };

    if (live == 1) {
        data_send.live = live;
    }

    if (sport_id) {
        data_send.sport_id = sport_id;
    }

    if (parent_sport_id) {
        data_send.parent_sport_id = parent_sport_id;
    }

    $.ajax({
        url: "/sportevents_online",
        cache: true,
        type: "GET",
        data: data_send
    }).done(function (data) {
        var tournnamentsArr = data;
        var tournnamentsArrLength = 0;
        var tournnamentElem;
        var isChecked = $('#live-checkbox-js').prop('checked');
        var param = '';

        if (isChecked) {
            param = '?live=1';
        }

        for (tournnamentElem in tournnamentsArr) {
            if (tournnamentsArr.hasOwnProperty(tournnamentElem)) {
                tournnamentsArrLength++;
            }
        }

        if (tournnamentsArrLength === $('.b-onlines-box').length) {
            $.each(tournnamentsArr, function (i) {
                var tournamentHtml = $(tournnamentsArr[i]).html();

                $('#' + i).html(tournamentHtml);
            });
            Blocks_Colums_Sorter();
        } else {
            window.location.href = '/stats' + param;
        }
    });
};
/* обновляем онлайны по таймеру (end) */

spb_scripts.reloadWindow = function () {
    var live = 0;
    var date = $('#livereload_current_page_date').val();

    if ($('input[name=live]').prop('checked') === true) {
        live = 1;
    }
    count = 10;
    spb_scripts.loadPageWithAjax(date, live);
};

spb_scripts.LivePageReloadTimer = function () {
    count = count - 1;
    if (count <= 0) {
        clearInterval(counter);
        spb_scripts.reloadWindow();
        count = 10;
        counter = setInterval(spb_scripts.LivePageReloadTimer, 1000);
    } else {
        $('.translation.tournir_live').text(count);
    }
};
function toggleShowInBlockOnline(game_id, link, is_to_sport) {
    is_to_sport = is_to_sport || false;

    var action = 'toggle_show_game_in_block_top_results';
    if (is_to_sport) {
        action = 'toggle_show_game_in_block_top_results_to_sport';
    }

    $.ajax({
        url: '/stats_online/' + action + '/' + game_id,
        success: function () {
            link = $(link);

            var is_set_show_in_block = link.hasClass('checked');

            var message = 'Не выводить в блоке онлайнов';
            if (is_set_show_in_block) {
                message = 'Выводить в блоке онлайнов';
            }
            if (is_to_sport) {
                message += ' на странице вида спорта';
            }

            if (is_set_show_in_block) {
                link.html('<span class="glyphicon glyphicon-unchecked"></span>').css('color', '').attr('title', message).removeClass('checked');
            } else {
                link.html('<span class="glyphicon glyphicon-check"></span>').css('color', 'red').attr('title', message).addClass('checked');
            }
        },
        error: function () {
            alert('Ошибка при изменение значения');
        }
    });
};
spb_scripts.topResultsCalendar = function () {
    $('#top-results-calendar-js').on('changeDate', function (event) {
        var s_date = event.date,
            r_date = s_date;

        if (typeof( s_date ) == 'string') {
            var split_date = s_date.split('-');
            r_date = new Date();
            r_date.setMonth(split_date[1], split_date[0]);
            r_date.setYear(split_date[2]);
        }

        var r_date_month = '' + (r_date.getMonth() + 1);

        if (r_date_month.match(/^\d$/) !== null) {
            r_date_month = '0' + r_date_month;
        }

        var r_date_date = '' + r_date.getDate();

        if (r_date_date.match(/^\d$/) !== null) {
            r_date_date = '0' + r_date_date;
        }

        var date_param = r_date.getFullYear() + '-' + r_date_month + '-' + r_date_date;

        window.location.href = '/stats/' + date_param;
    });
};


$(function () {
    spb_scripts.topResultsCalendar();
});
var rateAPlayerController = (function () {
    return {
        sendVote: function (formData) {
            $.ajax({
                cache: true,
                async: true,
                url: '/voting/points/rateaplayer',
                type: 'GET',
                data: formData,
                dataType: 'html',
                success: function () {
                    var page_node_id = 0;

                    if (Drupal.settings && Drupal.settings.spb_helper && Drupal.settings.spb_helper.current_page_nid) {
                        page_node_id = Drupal.settings.spb_helper.current_page_nid;
                    }

                    if (Drupal.settings && Drupal.settings.spb_current_page_node_id) {
                        page_node_id = Drupal.settings.spb_current_page_node_id;
                    }

                    if (page_node_id) {
                        $.ajax({
                            cache: true,
                            async: true,
                            url: '/rateaplayer/nodeplayers/' + page_node_id,
                            type: 'GET',
                            data: formData,
                            dataType: 'html',
                            success: function (data, textStatus) {
                                var entityId = url("?entity_id", [location.host, "?", formData].join(''));
                                if (textStatus == 'success') {
                                    if (entityId) {
                                        $("#rateaplayerModel-" + entityId).replaceWith(data);
                                    } else {
                                        $("#newRateAPlayer").html(data);
                                    }
                                }
                            }
                        });
                    }

                    var date = new Date();
                    date.setHours(date.getHours() + 6);
                    $.cookie('participate_in_vote_as_anonymous', 1, {expires: date, path: '/'});
                }
            });
        }
    }
})();
/* Game bet votes JS (begin) */
var poll = {
    data: {
        block: '#match-center-poll',
        resTeam1: 0,
        resTeam2: 0,
        resDraw: 0,
        team1ResPercent: 0,
        team2ResPercent: 0,
        drawResPercent: 0,
        isDraw: false,
        isDisable: false,
        isFirstRender: true,
        timer: null
    },
    init: function () {
        var obj = this;
        var block = $(obj.data.block);

        obj.data.drawBtn = block.find('.btn-draw');
        if (obj.data.drawBtn.length !== 0) {
            obj.data.isDraw = true;
        }
        obj.data.isDisable = block.find('.match-center-poll__btn').hasClass('disabled') ? true : false;

        obj.data.resTeam1 = block.find('.res-team1').data('res') || 0;
        obj.data.resTeam2 = block.find('.res-team2').data('res') || 0;
        obj.data.resDraw = block.find('.res-draw').data('res') || 0;

        obj.bindEvents();
        obj.countValues(obj.data.resTeam1, obj.data.resTeam2, obj.data.resDraw);
        obj.renderBars();
    },
    // рендерим результаты голосовалки
    renderBars: function () {
        var obj = this;
        var block = $(obj.data.block);
        var team1Bar = block.find('.res-team1');
        var team2Bar = block.find('.res-team2');
        var drawBar = block.find('.res-draw');
        var team1Btn = block.find('.btn-team1');
        var team2Btn = block.find('.btn-team2');
        var drawBtn = block.find('.btn-draw');
        var team1Class = obj.data.team1ResPercent >= obj.data.team2ResPercent ? 'winner' : 'loser';
        var team2Class = obj.data.team1ResPercent < obj.data.team2ResPercent ? 'winner' : 'loser';

        block.find('.btn-team1 .match-center-poll__btn-count').text(obj.data.resTeam1);
        block.find('.btn-team2 .match-center-poll__btn-count').text(obj.data.resTeam2);
        block.find('.btn-draw .match-center-poll__btn-count').text(obj.data.resDraw);

        team1Bar.removeClass('winner').removeClass('loser');
        team2Bar.removeClass('winner').removeClass('loser');

        team1Bar.addClass(team1Class).animate({
            width: obj.data.team1ResPercent + "%"
        }, 'fast');

        team2Bar.addClass(team2Class).animate({
            width: obj.data.team2ResPercent + "%"
        }, 'fast');

        if (obj.data.isDraw) {
            drawBar.animate({
                width: obj.data.drawResPercent + '%'
            }, 'fast');
        } else {
            drawBar.css('display', 'none');
        }
    },
    // навешиваем события на кнопки
    bindEvents: function () {
        var obj = this;
        var block = $(obj.data.block);
        var btn = block.find('.match-center-poll__btn');
        var game_id = block.data('gameid');
        var vote_id = block.data('voteid').length !== 0 ? '/' + block.data('voteid') : '';
        var param;

        btn.on('click', function () {
            var elem = $(this);
            var type = elem.attr('class');

            if (elem.hasClass('disabled')) {
                return;
            }

            switch (type) {
                case 'match-center-poll__btn btn-team1':
                    obj.data.resTeam1++;
                    param = 'vote_for_winning_team1';
                    break;

                case 'match-center-poll__btn btn-team2':
                    obj.data.resTeam2++;
                    param = 'vote_for_winning_team2';
                    break;

                case 'match-center-poll__btn btn-draw':
                    obj.data.resDraw++;
                    param = 'vote_for_draw';
                    break;

                default:
                    break;
            }

            obj.setDisable(elem);
            obj.countValues(obj.data.resTeam1, obj.data.resTeam2, obj.data.resDraw);
            obj.renderBars();

            $.ajax({
                url: '/matchcenter/game_bet_votes/' + game_id + vote_id + '?vote_action=' + param,
                type: 'GET',
                success: function (data) {
                    if (data === null || data === 'null' || data.length === 0) {
                        return;
                    }
                    obj.data.resTeam1 = parseInt(data.vote_for_winning_team1);
                    obj.data.resTeam2 = parseInt(data.vote_for_winning_team2);
                    obj.data.resDraw = parseInt(data.vote_for_draw);

                    obj.countValues(obj.data.resTeam1, obj.data.resTeam2, obj.data.resDraw);
                    obj.renderBars();
                },
                error: function () {
                }
            });
        });
    },
    // получаем значения в процентах
    countValues: function (team1, team2, draw) {

        var obj = this;

        var zeroValueBarWidthPercent = 1;
        var totalVotes = (team1 + team2 + draw);

        obj.data.team1ResPercent = ((parseInt(team1) / parseInt(totalVotes)) * 100);
        obj.data.team2ResPercent = ((parseInt(team2) / parseInt(totalVotes)) * 100);
        obj.data.drawResPercent = ((parseInt(draw) / parseInt(totalVotes)) * 100);

        // ставим дефольные проценты в случае, если голосов за пункт не было
        var minus_percent = 0;
        if (team1 == 0) {
            obj.data.team1ResPercent = zeroValueBarWidthPercent;
            minus_percent += zeroValueBarWidthPercent;
        }
        if (team2 == 0) {
            obj.data.team2ResPercent = zeroValueBarWidthPercent;
            minus_percent += zeroValueBarWidthPercent;
        }
        // поставим дефолтную ширину только если в игре возможна ничья
        if (obj.data.isDraw && draw == 0) {
            obj.data.drawResPercent = zeroValueBarWidthPercent;
            minus_percent += zeroValueBarWidthPercent;
        }

        // т.к. были прибавлены проценты для нулевых значений, нужно вычесть их из других пунктов, у которых были голоса
        var values_arr = [team1, team2, draw];
        var biggest_value_key = values_arr.indexOf(Math.max.apply(window, values_arr));
        switch (biggest_value_key) {
            case 0:
                obj.data.team1ResPercent -= minus_percent;
                break;
            case 1:
                obj.data.team2ResPercent -= minus_percent;
                break;
            case 2:
                if (obj.data.isDraw) {
                    obj.data.drawResPercent -= minus_percent;
                }
                break;
        }

    },
    // дизэйблим голосовалку
    setDisable: function (elem) {
        var obj = this;
        var btns = $(obj.data.block).find('.match-center-poll__btn');

        elem.addClass('disabled');
        clearTimeout(obj.data.timer);

        obj.data.timer = setTimeout(function () {
            btns.removeClass('disabled');
        }, 15000);
    }
};
/* Game bet votes JS (end) */
spb_scripts.matchcenter = {

    live: {
        settings: {
            timer: '',
        },

        init: function () {
            var self = spb_scripts.matchcenter.live;
            if (!self.settings.live) {
                return false;
            }

            self.$elems = {};
            self.$elems.$head = $('.liveHtml_head');
            self.$elems.$video_links = $('.liveHtml_video_links');
            self.$elems.$line_up = $('.liveHtml_timeline');
            self.$elems.$football_field = $('.liveHtml_football_field');
            self.$elems.$football_timeline = $('.liveHtml_football_timeline');
            self.$elems.$football_line_up = $('.liveHtml_football_line_up');
            self.$elems.$football_statistic_match = $('.liveHtml_football_statistic_match');
            self.$elems.$protocol = $('.liveHtml_protocol');
            self.$elems.$other_matches = $('.liveHtml_other_matches');

            self.intervalInit();
        },

        intervalInit: function () {
            var self = spb_scripts.matchcenter.live;
            self.settings.timer = setInterval(self.ajaxUpdate, self.settings.update_time * 1000);
        },

        ajaxUpdate: function () {
            var self = spb_scripts.matchcenter.live;

            $.ajax({
                type: "GET",
                dataType: 'json',
                cache: true,
                url: self.settings.json_url,
                success: self.ajaxSuccess,
                error: self.ajaxFailure
            });
        },

        ajaxSuccess: function (data) {
            var self = spb_scripts.matchcenter.live;

            if (typeof data.head_html !== 'undefined') {
                self.renderHead(data.head_html);
            }

            if (typeof data.video_links_html !== 'undefined') {
                self.renderVideoLinks(data.video_links_html);
            }

            if (typeof data.line_up_html !== 'undefined') {
                self.renderLineUp(data.line_up_html);
            }

            if (typeof data.football_field_html !== 'undefined') {
                self.renderFootballField(data.football_field_html);
            }

            if (typeof data.football_timeline_html !== 'undefined') {
                self.renderFootballTimeline(data.football_timeline_html);
            }

            if (typeof data.football_line_up_html !== 'undefined') {
                self.renderFootballLineUp(data.football_line_up_html);
            }

            if (typeof data.football_statistic_match_html !== 'undefined') {
                self.renderFootballStatisticMatch(data.football_statistic_match_html);
            }

            if (typeof data.protocol_html !== 'undefined') {
                self.renderProtocol(data.protocol_html);
            }

            if (typeof data.other_matches_html !== 'undefined') {
                self.renderOtherMatches(data.other_matches_html);
            }

            if (typeof data.live_commentary !== 'undefined') {
                self.insertLiveCommentary(data.live_commentary);
            }

            if (typeof data.last_game_events !== 'undefined') {
                self.lastGameEvents(data.last_game_events);
            }

            if (typeof data.game_bet_votes !== 'undefined') {
                self.gameBetVotes(data.game_bet_votes);
            }

            if (self.$elems.$football_field.length != 0) {
                spb_scripts.matchcenter.mouseEventsBind.init();
            }
        },

        ajaxFailure: function (data) {
            var self = spb_scripts.matchcenter.live;
            clearInterval(self.settings.timer);
            self.init();
        },

        renderHead: function (data) {
            var self = spb_scripts.matchcenter.live;
            self.$elems.$head.html(data);

            // Запукс рендера социалок
            spb_scripts.socialBtns(true);
        },

        renderVideoLinks: function (data) {
            var self = spb_scripts.matchcenter.live;
            self.$elems.$video_links.html(data);
        },

        renderLineUp: function (data) {
            var self = spb_scripts.matchcenter.live;
            self.$elems.$line_up.html(data);
        },

        renderFootballField: function (data) {
            var self = spb_scripts.matchcenter.live;
            self.$elems.$football_field.html(data);

            // расстановка игроков на поле
            spb_scripts.isFirstPlayersSet = true;
            spb_scripts.setPlayersOnField();
            spb_scripts.isFirstPlayersSet = false;
        },

        renderFootballTimeline: function (data) {
            var self = spb_scripts.matchcenter.live;
            self.$elems.$football_timeline.html(data);
        },

        renderFootballLineUp: function (data) {
            var self = spb_scripts.matchcenter.live;
            self.$elems.$football_line_up.html(data);
        },

        renderFootballStatisticMatch: function (data) {
            var self = spb_scripts.matchcenter.live;
            self.$elems.$football_statistic_match.html(data);
        },

        renderProtocol: function (data) {
            var self = spb_scripts.matchcenter.live;
            self.$elems.$protocol.html(data);
        },

        renderOtherMatches: function (data) {
            var self = spb_scripts.matchcenter.live;
            self.$elems.$other_matches.html(data);
        },

        insertLiveCommentary: function (data) {
            var self = spb_scripts.matchcenter.live;
            var commentary = $('#sb_c_trans_text_text').find('ul');

            $.each(data, function (key, value) {
                var id = 'labels-id-' + key;

                if (value.log != '') {
                    if (self.settings.commentary_list_id.indexOf(key) == -1) {
                        self.settings.commentary_list_id.push(key);

                        if ($('#' + id).length) {
                            $('li#' + id).replaceWith(value.log);
                        }
                        else {
                            commentary.prepend(value.log);
                            $('#' + id).addClass('labeling_new');
                        }
                    } else {
                        if ($('#' + id).length) {
                            $('li#' + id).replaceWith(value.log);
                        }
                        else {
                            commentary.prepend(value.log);
                            $('#' + id).addClass('labeling_new');
                        }
                    }
                }

            });
        },

        lastGameEvents: function (data) {
            var self = spb_scripts.matchcenter.live;

            function flashAnimate(elem) {
                $(elem)
                    .fadeTo(400, 0.2)
                    .fadeTo(400, 1)
                    .fadeTo(400, 0.2)
                    .fadeTo(400, 1)
                    .fadeTo(400, 0.2)
                    .fadeTo(400, 1)
                    .fadeTo(400, 0.2)
                    .fadeTo(400, 1);
            };

            $.each(data, function (key, value) {

                if (self.settings.event_list_id.indexOf(key) == -1) {

                    self.settings.event_list_id.push(key);

                    var event_icon = $('[data-game-event="' + key + '"]');
                    flashAnimate(event_icon);

                    var event_player = $('#players_' + value.source_player_id + ', .liveHtml_football_field a[data-href-pid="' + value.source_player_id + '"]');
                    flashAnimate(event_player);

                    if (value.target_player_id != null) {
                        var event_target_player = $('#players_' + value.target_player_id + ', .liveHtml_football_field a[data-href-pid="' + value.target_player_id + '"]');
                        flashAnimate(event_target_player);
                    }
                }

            });
        },

        gameBetVotes: function (data) {
            var self = spb_scripts.matchcenter.live;

            poll.data.resDraw = data.vote_for_draw;
            poll.data.resTeam1 = data.vote_for_winning_team1;
            poll.data.resTeam2 = data.vote_for_winning_team2;
            poll.countValues(poll.data.resTeam2, poll.data.resTeam2, poll.data.resDraw);
            poll.renderBars();
        },
    },

    mouseEventsBind: {
        init: function () {
            var self = spb_scripts.matchcenter.mouseEventsBind;

            self.data = {};
            self.data.field_sel1 = '.match_field_block div.igrok a, .match_field_block .match_field_zamen div a, .match_field_block .match_field_zapas a';
            self.data.field_sel2 = '.match_field_block div.igrok span.stats_pict, .match_field_block .match_field_zamen div span.stats_pict';
            self.data.timeline = '#match_center_timeline span.event_left_command, #match_center_timeline span.event_right_command';
            self.data.sostav = '#players_clubs table td';

            // Fields binds
            $(self.data.field_sel1).unbind('mouseenter, mouseleave').bind('mouseenter', self.field_player_mouseenter).bind('mouseleave', self.field_player_mouseleave);
            $(self.data.field_sel2).unbind('mouseenter, mouseleave').bind('mouseenter', self.field_span_mouseenter).bind('mouseleave', self.field_span_mouseleave);

            // Timeline binds
            $(self.data.timeline).unbind('mouseenter, mouseleave').bind('mouseenter', self.update_timeline_event_mouseenter).bind('mouseleave', self.update_timeline_event_mouseleave)
                // baloon
                .on('show.bs.tooltip', function () {
                    $(self.data.timeline).tooltip('hide');
                })
                .tooltip({
                    html: '<div class="match_center_tooltip"/>',
                    animation: false,
                    delay: { "show": 200, "hide": 1000 }
                });

            // Sostav binds
            $(self.data.sostav).unbind('mouseenter, mouseleave').bind('mouseenter', self.update_sostav_mouseenter).bind('mouseleave', self.update_sostav_mouseleave);
        },

        field_player_mouseenter: function () {
            var pid = 0, min = 0;

            if ($(this).attr('data-href-pid'))
                pid = $(this).attr('data-href-pid');
            else if ($(this).attr('data-pid'))
                pid = $(this).attr('data-pid');

            if (pid) {
                var sel = '#match_center_timeline span.stats_pict[attrfrom=' + pid + '], #match_center_timeline span.stats_pict[attrto=' + pid + ']';
                $(sel).addClass('event_lighted');
            }
        },

        field_player_mouseleave: function () {
            var pid = 0, min = 0;

            if ($(this).attr('data-href-pid'))
                pid = $(this).attr('data-href-pid');
            else if ($(this).attr('data-pid'))
                pid = $(this).attr('data-pid');

            if (pid) {
                var sel = '#match_center_timeline span.stats_pict[attrfrom=' + pid + '], #match_center_timeline span.stats_pict[attrto=' + pid + ']';
                $(sel).removeClass('event_lighted');
            }
        },

        field_span_mouseenter: function () {
            var pid = $(this).attr('data-pid');
            if (pid) {
                var min = $(this).attr('attr-min'),
                    subclass = $(this).attr('class').replace(/^stats_pict (stats\_pict\_[a-z\_]+).*/, '$1'),
                    sel = '#match_center_timeline span.stats_pict.' + subclass + '[attrfrom=' + pid + '][attr-min=' + min
                        + ']:first, #match_center_timeline span.stats_pict.' + subclass + '[attrto=' + pid
                        + '][attr-min=' + min + ']:first';

                if ($(this).hasClass('stats_pict_replace')) {
                    var topid = $(this).attr('attrto');
                    if (topid) {
                        var sel1 = '.match_field_block div.igrok[data-pid=' + topid + '] span.stats_pict_replace[attrto=' + pid
                            + '][attr-min=' + min + '], .match_field_block .match_field_zamen div[data-pid=' + topid + '] span.stats_pict_replace[attrto=' + pid
                            + '][attr-min=' + min + ']';
                        $(sel1).addClass('event_lighted');
                    }
                }

                $(sel).addClass('event_lighted');
            }
        },

        field_span_mouseleave: function () {
            var pid = $(this).attr('data-pid');
            if (pid) {
                var min = $(this).attr('attr-min'),
                    subclass = $(this).attr('class').replace(/^stats_pict (stats\_pict\_[a-z\_]+).*/, '$1'),
                    sel = '#match_center_timeline span.stats_pict.' + subclass + '[attrfrom=' + pid + '][attr-min=' + min
                        + ']:first, #match_center_timeline span.stats_pict.' + subclass + '[attrto=' + pid
                        + '][attr-min=' + min + ']:first';

                if ($(this).hasClass('stats_pict_replace')) {
                    var topid = $(this).attr('attrto');
                    if (topid) {
                        var sel1 = '.match_field_block div.igrok[data-pid=' + topid + '] span.stats_pict_replace[attrto=' + pid
                            + '][attr-min=' + min + '], .match_field_block .match_field_zamen div[data-pid=' + topid + '] span.stats_pict_replace[attrto=' + pid
                            + '][attr-min=' + min + ']';
                        $(sel1).removeClass('event_lighted');
                    }
                }

                $(sel).removeClass('event_lighted');
            }
        },


        update_timeline_event_mouseenter: function () {
            var from = $(this).attr('attrfrom'),
                to = $(this).attr('attrto'),
                field_sel = '',
                field_sel1 = '',
                minute = $(this).attr('attr-min'),
                classes = $(this).attr('class'),
                class1 = classes.replace(/.*(stats\_pict\_[a-z\_]+).*/, '$1');

            $('div.igrok div.relative_events div span.stats_pict, .match_field_zamen div span.events  span.stats_pict').removeClass('event_lighted');

            if (from) {
                field_sel = 'div.igrok[data-pid=' + from + '] div.relative_events div span.stats_pict.' + class1 + '[attr-min=' + minute + ']:first, .match_field_zamen div[data-pid=' + from
                    + '] span.events span.stats_pict.' + class1 + '[attr-min=' + minute + ']:first';

                if ($(field_sel).length)
                    $(field_sel).addClass('event_lighted');

                field_sel1 = 'td#players_' + from;
            }

            if (field_sel1 != '') {
                $(field_sel1).attr('old-bg', $(field_sel1).css('background-color'));
                $(field_sel1).css('background-color', '#E4F18E');
            }

            if (to) {
                field_sel = 'div.igrok[data-pid=' + to + '] div.relative_events div span.stats_pict.' + class1 + '[attr-min=' + minute + ']:first, .match_field_zamen div[data-pid=' + to
                    + '] span.events  span.stats_pict.' + class1 + '[attr-min=' + minute + ']:first';

                if ($(field_sel).length)
                    $(field_sel).addClass('event_lighted');

                field_sel1 = 'td#players_' + to;
            }

            if (field_sel1 != '') {
                $(field_sel1).attr('old-bg', $(field_sel1).css('background-color'));
                $(field_sel1).css('background-color', '#E4F18E');
            }
        },

        update_timeline_event_mouseleave: function () {
            var from = $(this).attr('attrfrom'),
                to = $(this).attr('attrto'),
                field_sel = '',
                field_sel1 = '';

            if (from) {
                field_sel = 'div.igrok div.relative_events div span.stats_pict, .match_field_zamen div span.events span.stats_pict';
                $(field_sel).removeClass('event_lighted');
                field_sel1 = 'td#players_' + from;
            }

            if (field_sel1 != '')
                $(field_sel1).stop().css('background-color', $(field_sel1).attr('old-bg'));

            if (to) {
                field_sel = 'div.igrok div.relative_events div span.stats_pict, .match_field_zamen div span.events  span.stats_pict';
                $(field_sel).removeClass('event_lighted');
                field_sel1 = 'td#players_' + to;
            }

            if (field_sel1 != '')
                $(field_sel1).stop().css('background-color', $(field_sel1).attr('old-bg'));
        },


        update_sostav_mouseenter: function () {
            if (this.id) {
                $(this).attr('old-bg', $(this).css('background-color'));
                $(this).css('background-color', '#E4F18E');
                var pid = this.id.replace('players_', '');
                var sel = 'span.stats_pict[attrfrom=' + pid + '], span.stats_pict[attrto=' + pid + '], div.igrok[data-pid="' + pid + '"] div.relative_events div span.stats_pict';
                $(sel).addClass('event_lighted');
            }
        },

        update_sostav_mouseleave: function () {
            if (this.id) {
                $(this).css('background-color', $(this).attr('old-bg'));
                var pid = this.id.replace('players_', '');
                var sel = 'span.stats_pict[attrfrom=' + pid + '], span.stats_pict[attrto=' + pid + '], div.igrok[data-pid="' + pid + '"] div.relative_events div span.stats_pict';
                $(sel).removeClass('event_lighted');
            }
        },
    }

};


$(document).ready(function () {
    spb_scripts.matchcenter.live.init();
    spb_scripts.matchcenter.mouseEventsBind.init();


    $('.labeling_row:lt(8)').addClass('show');  // показываем первые 8 элементов

    /* расстановка игроков на поле в зависимости от ширины экрана (start) */
    spb_scripts.isFirstPlayersSet = true;

    spb_scripts.setPlayersOnField = function () {
        var fieldZona = $('.b-field__zona');
        var fieldZoneWidth = fieldZona.width();
        var fieldZonaRatio = 276 / 286;
        var igrok = $('.igrok');

        fieldZona.css('height', fieldZoneWidth * fieldZonaRatio);

        if (spb_scripts.isFirstPlayersSet) {
            $.each(igrok, function () {
                var elem = $(this);
                var xPos = elem.data('left') / (276 / 100) - 8;
                var yPos = elem.data('top') / (286 / 100) - 5;

                if (xPos < 0) {
                    elem.css({
                        'left': 0 - xPos + '%',
                        'top': yPos + '%'
                    });
                } else {
                    elem.css({
                        'left': xPos + '%',
                        'top': yPos + '%'
                    });
                }
            });
        }
        igrok.fadeTo(300, 100);
    };

    spb_scripts.setPlayersOnField();
    spb_scripts.isFirstPlayersSet = false;
    /* расстановка игроков на поле в зависимости от ширины экрана (end) */


    /* позиционируем блоки в сетке (start) */
    spb_scripts.moveMoreReadOnMatchcenter = function () {
        var winWidth = $(window).width();
        var statsBlock = $('#stats-block');

        if ((winWidth < SPB.constants.tablet_min_width) && !spb_scripts.moveMoreReadOnMatchcenteMovedToTop) {
            $('#more-content-js').before(statsBlock);
            spb_scripts.moveMoreReadOnMatchcenterMovedToTop = true;
        } else {
            $('#right-column').prepend(statsBlock);
            spb_scripts.moveMoreReadOnMatchcenteMovedToTop = false;
        }
    };

    spb_scripts.moveMoreReadOnMatchcenterMovedToTop = false;
    spb_scripts.moveMoreReadOnMatchcenter();
    /* позиционируем блоки в сетке (end) */

    /* выравниваеться на высоту соседнего блока (start) */
    (function () {
        if (spb_scripts.helpers.getCurrentCssDisplayClass('lg')) {
            var $live_commentary_block = $('#live-commentary-js');
            var $parent_row = $live_commentary_block.closest('.row');
            var fix_height = $parent_row.outerHeight() - 30;
            if (fix_height > $live_commentary_block.height()) {
                $live_commentary_block.height(fix_height);
            }
        }
    })();
    /* выравниваеться на высоту соседнего блока (end) */

    /* показываем пачку текстовой трансляции при нажатии ЕЩЕ (start) */
    var live_commentary_more_js_flag = false;
    $('#live-commentary-more-js').on('touchstart click', function (event) {

        if (live_commentary_more_js_flag) {
            return false;
        }

        live_commentary_more_js_flag = true;

        var moreBtn = $(this);
        var block = $('#live-commentary-js');

        event.preventDefault();

        block.css('cssText', 'height: auto !important;');

        moreBtn.remove();

        setTimeout(function () {
            live_commentary_more_js_flag = false;
        }, 1000);


    });
    /* показываем пачку текстовой трансляции при нажатии ЕЩЕ (end) */


    $(window).resize(function () {
        spb_scripts.setPlayersOnField();
        spb_scripts.moveMoreReadOnMatchcenter();
    });


    $(".b-videos-more").click(function (e) {
        e.preventDefault();
        $(this).closest("#spb_match_videos").addClass("show_all");
        $(this).closest("li").remove();
    });

    $(".b-onlines__item_more_link a").click(function (e) {
        e.preventDefault();
        $(this).closest('.b-onlines').addClass('open');
    });


    /* разворачивалка других матчей (start) */
    spb_scripts.onlinesExpander = function () {
        var onlinesBlock = $('.b-onlines-expander-js');
        var onlinesItem = onlinesBlock.find('.b-onlines-box__item');

        if (onlinesItem.length > 9) {
            $.each(onlinesItem, function (index) {
                if (index > 8) {
                    $(this).addClass('hidden');
                }
            });
            onlinesBlock.append('<a class="more-btn more-btn_type_dotted more-btn_no_margins more-btn-expand-matches-js" href="#"><span class="glyphicon glyphicon-option-horizontal"></span></a>');

            onlinesBlock.on('click', '.more-btn-expand-matches-js', function (event) {
                event.preventDefault();
                onlinesItem.removeClass('hidden');
                $(this).remove();
            });
        }
    }();
    /* разворачивалка других матчей (end) */
});


/* TournamentsSelector (stats) */

$(document).ready(function () {
    $('.tournaments-after-item').each(function () {
        if (document.location.pathname == $(this).find('a').attr('href')) {
            $(this).addClass('active');
            $(this).find('span').unwrap();
        }
    })

    if (document.location.pathname != $('.tournaments-main-link').find('a').attr('href')) {
        $('.tournaments-main-link').show();
    }
});

/* TournamentsSelector (end) */

function pingLiveGameScore(gameId, pingIntervalSeconds, callback) {
    var timer;

    if (!gameId || (typeof callback !== 'function')) {
        return;
    }

    function updateScore() {
        $.ajax({
            'url': '/game_json/' + gameId,
            'dataType': 'json',
            cache: true,
            success: function (data) {
                if (!data || !data.score) {
                    return;
                }

                if (data.live) {
                    callback.call(this, data.score, true);
                } else {
                    callback.call(this, data.score, false);

                    $(window).off('focus', startPing);
                    $(window).off('blur', stopPing);
                    stopPing();
                }
            }
        });
    }

    function startPing() {
        clearTimeout(timer);
        timer = setInterval(updateScore, pingIntervalSeconds * 1000);
    }

    function stopPing() {
        clearTimeout(timer);
    }

    $(window).on('focus', startPing);
    $(window).on('blur', stopPing);

    startPing();
}

/* селектор турнира (stast) */
$(document).ready(function () {
    var selects = $('.sb_c_tourney_drop .sb_stats_selector');
    var zIndex = 20;
    var options = {
        maxHeight: 400,
        hover_class: 'hover',
        hideOnScroll: true
    };


    if (selects.size() < 1) {
        return;
    }

    selects.each(function (key, select_component) {
        var dropbox = $('.dropbox', select_component);
        var opts = $('.option', select_component);
        $(this).css('z-index', zIndex--);

        if (dropbox.width() < ($(this).width())) {
            dropbox.width($(this).width());
        }

        opts.hover(function () {
                $(this).addClass(options.hover_class);
            },
            function () {
                $(this).removeClass(options.hover_class);
            });

        if (options.maxHeight && (dropbox.innerHeight() >= options.maxHeight)) {
            dropbox.css({overflowY: 'scroll', overflowX: 'hidden', width: (dropbox.width() + 10), height: options.maxHeight + 'px'})
        }

        $(select_component).click(function (event) {
            $('.dropbox').hide();
            event.stopPropagation();
            // event.preventDefault(); // commented for links to work
            if (dropbox.is(':hidden') && !$(event.target).is('a')) {
                dropbox.show();
                //var opts = $('.dropbox .option', select_component);

                var position,
                    first = $(opts[0]).position();

                $(opts).each(function () {
                    if ($(this).hasClass('selectedOption'))
                        position = $(this).position();
                });
                var currentInList = $(this).find('a:contains(' + $(this).find('.selected span').text() + ')').css('background-color', '#e6e6e6');
                if (currentInList) {
                    var scrollToPosition = ((currentInList.position().top - 218) < 0) ? 0 : (currentInList.position().top - 218);
                    $('.dropbox', select_component).scrollTop(scrollToPosition);
                }
                /*
                 var currentInList = $(this).find('a:contains('+$(this).find('.selected span').text()+')').css('background-color','#e6e6e6');
                 if ( !position ) {
                 var curInListPos = currentInList.position();
                 if (curInListPos) $('.dropbox',select_component).scrollTop(currentInList.position().top);
                 else $('.dropbox',select_component).scrollTop(0);
                 }
                 else {
                 if (position.top >= 430) $('.dropbox',select_component).scrollTop(position.top - first.top);
                 else $('.dropbox',select_component).scrollTop(position.top - first.top);
                 }
                 */

            } else {
                dropbox.hide();
            }

        });
    });

    $(document).click(function () {
        $('div.sb_stats_selector .dropbox').hide()
    });

    if (options.hideOnScroll) {
        $(window).scroll(function () {
            $('.sb_stats_selector .dropbox').hide()
        });
    }
});
/* селектор турнира (end) */





/*! Javascript plotting library for jQuery, v. 0.7.
 *
 * Released under the MIT license by IOLA, December 2007.
 *
 */

// first an inline dependency, jquery.colorhelpers.js, we inline it here
// for convenience

/* Plugin for jQuery for working with colors.
 * 
 * Version 1.1.
 * 
 * Inspiration from jQuery color animation plugin by John Resig.
 *
 * Released under the MIT license by Ole Laursen, October 2009.
 *
 * Examples:
 *
 *   $.color.parse("#fff").scale('rgb', 0.25).add('a', -0.5).toString()
 *   var c = $.color.extract($("#mydiv"), 'background-color');
 *   console.log(c.r, c.g, c.b, c.a);
 *   $.color.make(100, 50, 25, 0.4).toString() // returns "rgba(100,50,25,0.4)"
 *
 * Note that .scale() and .add() return the same modified object
 * instead of making a new one.
 *
 * V. 1.1: Fix error handling so e.g. parsing an empty string does
 * produce a color rather than just crashing.
 */
(function (B) {
    B.color = {};
    B.color.make = function (F, E, C, D) {
        var G = {};
        G.r = F || 0;
        G.g = E || 0;
        G.b = C || 0;
        G.a = D != null ? D : 1;
        G.add = function (J, I) {
            for (var H = 0; H < J.length; ++H) {
                G[J.charAt(H)] += I
            }
            return G.normalize()
        };
        G.scale = function (J, I) {
            for (var H = 0; H < J.length; ++H) {
                G[J.charAt(H)] *= I
            }
            return G.normalize()
        };
        G.toString = function () {
            if (G.a >= 1) {
                return"rgb(" + [G.r, G.g, G.b].join(",") + ")"
            } else {
                return"rgba(" + [G.r, G.g, G.b, G.a].join(",") + ")"
            }
        };
        G.normalize = function () {
            function H(J, K, I) {
                return K < J ? J : (K > I ? I : K)
            }

            G.r = H(0, parseInt(G.r), 255);
            G.g = H(0, parseInt(G.g), 255);
            G.b = H(0, parseInt(G.b), 255);
            G.a = H(0, G.a, 1);
            return G
        };
        G.clone = function () {
            return B.color.make(G.r, G.b, G.g, G.a)
        };
        return G.normalize()
    };
    B.color.extract = function (D, C) {
        var E;
        do {
            E = D.css(C).toLowerCase();
            if (E != "" && E != "transparent") {
                break
            }
            D = D.parent()
        } while (!B.nodeName(D.get(0), "body"));
        if (E == "rgba(0, 0, 0, 0)") {
            E = "transparent"
        }
        return B.color.parse(E)
    };
    B.color.parse = function (F) {
        var E, C = B.color.make;
        if (E = /rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(F)) {
            return C(parseInt(E[1], 10), parseInt(E[2], 10), parseInt(E[3], 10))
        }
        if (E = /rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(F)) {
            return C(parseInt(E[1], 10), parseInt(E[2], 10), parseInt(E[3], 10), parseFloat(E[4]))
        }
        if (E = /rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(F)) {
            return C(parseFloat(E[1]) * 2.55, parseFloat(E[2]) * 2.55, parseFloat(E[3]) * 2.55)
        }
        if (E = /rgba\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(F)) {
            return C(parseFloat(E[1]) * 2.55, parseFloat(E[2]) * 2.55, parseFloat(E[3]) * 2.55, parseFloat(E[4]))
        }
        if (E = /#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(F)) {
            return C(parseInt(E[1], 16), parseInt(E[2], 16), parseInt(E[3], 16))
        }
        if (E = /#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(F)) {
            return C(parseInt(E[1] + E[1], 16), parseInt(E[2] + E[2], 16), parseInt(E[3] + E[3], 16))
        }
        var D = B.trim(F).toLowerCase();
        if (D == "transparent") {
            return C(255, 255, 255, 0)
        } else {
            E = A[D] || [0, 0, 0];
            return C(E[0], E[1], E[2])
        }
    };
    var A = {aqua: [0, 255, 255], azure: [240, 255, 255], beige: [245, 245, 220], black: [0, 0, 0], blue: [0, 0, 255], brown: [165, 42, 42], cyan: [0, 255, 255], darkblue: [0, 0, 139], darkcyan: [0, 139, 139], darkgrey: [169, 169, 169], darkgreen: [0, 100, 0], darkkhaki: [189, 183, 107], darkmagenta: [139, 0, 139], darkolivegreen: [85, 107, 47], darkorange: [255, 140, 0], darkorchid: [153, 50, 204], darkred: [139, 0, 0], darksalmon: [233, 150, 122], darkviolet: [148, 0, 211], fuchsia: [255, 0, 255], gold: [255, 215, 0], green: [0, 128, 0], indigo: [75, 0, 130], khaki: [240, 230, 140], lightblue: [173, 216, 230], lightcyan: [224, 255, 255], lightgreen: [144, 238, 144], lightgrey: [211, 211, 211], lightpink: [255, 182, 193], lightyellow: [255, 255, 224], lime: [0, 255, 0], magenta: [255, 0, 255], maroon: [128, 0, 0], navy: [0, 0, 128], olive: [128, 128, 0], orange: [255, 165, 0], pink: [255, 192, 203], purple: [128, 0, 128], violet: [128, 0, 128], red: [255, 0, 0], silver: [192, 192, 192], white: [255, 255, 255], yellow: [255, 255, 0]}
})(jQuery);

// the actual Flot code
(function ($) {
    function Plot(placeholder, data_, options_, plugins) {
        // data is on the form:
        //   [ series1, series2 ... ]
        // where series is either just the data as [ [x1, y1], [x2, y2], ... ]
        // or { data: [ [x1, y1], [x2, y2], ... ], label: "some label", ... }

        var series = [],
            options = {
                // the color theme used for graphs
                colors: ["#edc240", "#afd8f8", "#cb4b4b", "#4da74d", "#9440ed"],
                legend: {
                    show: true,
                    noColumns: 1, // number of colums in legend table
                    labelFormatter: null, // fn: string -> string
                    labelBoxBorderColor: "#ccc", // border color for the little label boxes
                    container: null, // container (as jQuery object) to put legend in, null means default on top of graph
                    position: "ne", // position of default legend container within plot
                    margin: 5, // distance from grid edge to default legend container within plot
                    backgroundColor: null, // null means auto-detect
                    backgroundOpacity: 0.85 // set to 0 to avoid background
                },
                xaxis: {
                    show: null, // null = auto-detect, true = always, false = never
                    position: "bottom", // or "top"
                    mode: null, // null or "time"
                    font: null, // null (derived from CSS in placeholder) or object like { size: 11, style: "italic", weight: "bold", family: "sans-serif", variant: "small-caps" }
                    color: null, // base color, labels, ticks
                    tickColor: null, // possibly different color of ticks, e.g. "rgba(0,0,0,0.15)"
                    transform: null, // null or f: number -> number to transform axis
                    inverseTransform: null, // if transform is set, this should be the inverse function
                    min: null, // min. value to show, null means set automatically
                    max: null, // max. value to show, null means set automatically
                    autoscaleMargin: null, // margin in % to add if auto-setting min/max
                    ticks: null, // either [1, 3] or [[1, "a"], 3] or (fn: axis info -> ticks) or app. number of ticks for auto-ticks
                    tickFormatter: null, // fn: number -> string
                    labelWidth: null, // size of tick labels in pixels
                    labelHeight: null,
                    reserveSpace: null, // whether to reserve space even if axis isn't shown
                    tickLength: null, // size in pixels of ticks, or "full" for whole line
                    alignTicksWithAxis: null, // axis number or null for no sync

                    // mode specific options
                    tickDecimals: null, // no. of decimals, null means auto
                    tickSize: null, // number or [number, "unit"]
                    minTickSize: null, // number or [number, "unit"]
                    monthNames: null, // list of names of months
                    timeformat: null, // format string to use
                    twelveHourClock: false // 12 or 24 time in time mode
                },
                yaxis: {
                    autoscaleMargin: 0.02,
                    position: "left" // or "right"
                },
                xaxes: [],
                yaxes: [],
                series: {
                    points: {
                        show: false,
                        radius: 3,
                        lineWidth: 2, // in pixels
                        fill: true,
                        fillColor: "#ffffff",
                        symbol: "circle" // or callback
                    },
                    lines: {
                        // we don't put in show: false so we can see
                        // whether lines were actively disabled 
                        lineWidth: 2, // in pixels
                        fill: false,
                        fillColor: null,
                        steps: false
                    },
                    bars: {
                        show: false,
                        lineWidth: 2, // in pixels
                        barWidth: 1, // in units of the x axis
                        fill: true,
                        fillColor: null,
                        align: "left", // or "center" 
                        horizontal: false
                    },
                    shadowSize: 3
                },
                grid: {
                    show: true,
                    aboveData: false,
                    color: "#545454", // primary color used for outline and labels
                    backgroundColor: null, // null for transparent, else color
                    borderColor: null, // set if different from the grid color
                    tickColor: null, // color for the ticks, e.g. "rgba(0,0,0,0.15)"
                    labelMargin: 5, // in pixels
                    axisMargin: 8, // in pixels
                    borderWidth: 2, // in pixels
                    minBorderMargin: null, // in pixels, null means taken from points radius
                    markings: null, // array of ranges or fn: axes -> array of ranges
                    markingsColor: "#f4f4f4",
                    markingsLineWidth: 2,
                    // interactive stuff
                    clickable: false,
                    hoverable: false,
                    autoHighlight: true, // highlight in case mouse is near
                    mouseActiveRadius: 10 // how far the mouse can be away to activate an item
                },
                interaction: {
                    redrawOverlayInterval: 1000 / 60 // time between updates, -1 means in same flow
                },
                hooks: {}
            },
            canvas = null,      // the canvas for the plot itself
            overlay = null,     // canvas for interactive stuff on top of plot
            eventHolder = null, // jQuery object that events should be bound to
            ctx = null, octx = null,
            xaxes = [], yaxes = [],
            plotOffset = { left: 0, right: 0, top: 0, bottom: 0},
            canvasWidth = 0, canvasHeight = 0,
            plotWidth = 0, plotHeight = 0,
            hooks = {
                processOptions: [],
                processRawData: [],
                processDatapoints: [],
                drawSeries: [],
                draw: [],
                bindEvents: [],
                drawOverlay: [],
                shutdown: []
            },
            plot = this;

        // public functions
        plot.setData = setData;
        plot.setupGrid = setupGrid;
        plot.draw = draw;
        plot.getPlaceholder = function () {
            return placeholder;
        };
        plot.getCanvas = function () {
            return canvas;
        };
        plot.getPlotOffset = function () {
            return plotOffset;
        };
        plot.width = function () {
            return plotWidth;
        };
        plot.height = function () {
            return plotHeight;
        };
        plot.offset = function () {
            var o = eventHolder.offset();
            o.left += plotOffset.left;
            o.top += plotOffset.top;
            return o;
        };
        plot.getData = function () {
            return series;
        };
        plot.getAxes = function () {
            var res = {}, i;
            $.each(xaxes.concat(yaxes), function (_, axis) {
                if (axis)
                    res[axis.direction + (axis.n != 1 ? axis.n : "") + "axis"] = axis;
            });
            return res;
        };
        plot.getXAxes = function () {
            return xaxes;
        };
        plot.getYAxes = function () {
            return yaxes;
        };
        plot.c2p = canvasToAxisCoords;
        plot.p2c = axisToCanvasCoords;
        plot.getOptions = function () {
            return options;
        };
        plot.highlight = highlight;
        plot.unhighlight = unhighlight;
        plot.triggerRedrawOverlay = triggerRedrawOverlay;
        plot.pointOffset = function (point) {
            return {
                left: parseInt(xaxes[axisNumber(point, "x") - 1].p2c(+point.x) + plotOffset.left),
                top: parseInt(yaxes[axisNumber(point, "y") - 1].p2c(+point.y) + plotOffset.top)
            };
        };
        plot.shutdown = shutdown;
        plot.resize = function () {
            getCanvasDimensions();
            resizeCanvas(canvas);
            resizeCanvas(overlay);
        };

        // public attributes
        plot.hooks = hooks;

        // initialize
        initPlugins(plot);
        parseOptions(options_);
        setupCanvases();
        setData(data_);
        setupGrid();
        draw();
        bindEvents();


        function executeHooks(hook, args) {
            args = [plot].concat(args);
            for (var i = 0; i < hook.length; ++i)
                hook[i].apply(this, args);
        }

        function initPlugins() {
            for (var i = 0; i < plugins.length; ++i) {
                var p = plugins[i];
                p.init(plot);
                if (p.options)
                    $.extend(true, options, p.options);
            }
        }

        function parseOptions(opts) {
            var i;

            $.extend(true, options, opts);

            if (options.xaxis.color == null)
                options.xaxis.color = options.grid.color;
            if (options.yaxis.color == null)
                options.yaxis.color = options.grid.color;

            if (options.xaxis.tickColor == null) // backwards-compatibility
                options.xaxis.tickColor = options.grid.tickColor;
            if (options.yaxis.tickColor == null) // backwards-compatibility
                options.yaxis.tickColor = options.grid.tickColor;

            if (options.grid.borderColor == null)
                options.grid.borderColor = options.grid.color;
            if (options.grid.tickColor == null)
                options.grid.tickColor = $.color.parse(options.grid.color).scale('a', 0.22).toString();

            // fill in defaults in axes, copy at least always the
            // first as the rest of the code assumes it'll be there
            for (i = 0; i < Math.max(1, options.xaxes.length); ++i)
                options.xaxes[i] = $.extend(true, {}, options.xaxis, options.xaxes[i]);
            for (i = 0; i < Math.max(1, options.yaxes.length); ++i)
                options.yaxes[i] = $.extend(true, {}, options.yaxis, options.yaxes[i]);

            // backwards compatibility, to be removed in future
            if (options.xaxis.noTicks && options.xaxis.ticks == null)
                options.xaxis.ticks = options.xaxis.noTicks;
            if (options.yaxis.noTicks && options.yaxis.ticks == null)
                options.yaxis.ticks = options.yaxis.noTicks;
            if (options.x2axis) {
                options.xaxes[1] = $.extend(true, {}, options.xaxis, options.x2axis);
                options.xaxes[1].position = "top";
            }
            if (options.y2axis) {
                options.yaxes[1] = $.extend(true, {}, options.yaxis, options.y2axis);
                options.yaxes[1].position = "right";
            }
            if (options.grid.coloredAreas)
                options.grid.markings = options.grid.coloredAreas;
            if (options.grid.coloredAreasColor)
                options.grid.markingsColor = options.grid.coloredAreasColor;
            if (options.lines)
                $.extend(true, options.series.lines, options.lines);
            if (options.points)
                $.extend(true, options.series.points, options.points);
            if (options.bars)
                $.extend(true, options.series.bars, options.bars);
            if (options.shadowSize != null)
                options.series.shadowSize = options.shadowSize;

            // save options on axes for future reference
            for (i = 0; i < options.xaxes.length; ++i)
                getOrCreateAxis(xaxes, i + 1).options = options.xaxes[i];
            for (i = 0; i < options.yaxes.length; ++i)
                getOrCreateAxis(yaxes, i + 1).options = options.yaxes[i];

            // add hooks from options
            for (var n in hooks)
                if (options.hooks[n] && options.hooks[n].length)
                    hooks[n] = hooks[n].concat(options.hooks[n]);

            executeHooks(hooks.processOptions, [options]);
        }

        function setData(d) {
            series = parseData(d);
            fillInSeriesOptions();
            processData();
        }

        function parseData(d) {
            var res = [];
            for (var i = 0; i < d.length; ++i) {
                var s = $.extend(true, {}, options.series);

                if (d[i].data != null) {
                    s.data = d[i].data; // move the data instead of deep-copy
                    delete d[i].data;

                    $.extend(true, s, d[i]);

                    d[i].data = s.data;
                }
                else
                    s.data = d[i];
                res.push(s);
            }

            return res;
        }

        function axisNumber(obj, coord) {
            var a = obj[coord + "axis"];
            if (typeof a == "object") // if we got a real axis, extract number
                a = a.n;
            if (typeof a != "number")
                a = 1; // default to first axis
            return a;
        }

        function allAxes() {
            // return flat array without annoying null entries
            return $.grep(xaxes.concat(yaxes), function (a) {
                return a;
            });
        }

        function canvasToAxisCoords(pos) {
            // return an object with x/y corresponding to all used axes 
            var res = {}, i, axis;
            for (i = 0; i < xaxes.length; ++i) {
                axis = xaxes[i];
                if (axis && axis.used)
                    res["x" + axis.n] = axis.c2p(pos.left);
            }

            for (i = 0; i < yaxes.length; ++i) {
                axis = yaxes[i];
                if (axis && axis.used)
                    res["y" + axis.n] = axis.c2p(pos.top);
            }

            if (res.x1 !== undefined)
                res.x = res.x1;
            if (res.y1 !== undefined)
                res.y = res.y1;

            return res;
        }

        function axisToCanvasCoords(pos) {
            // get canvas coords from the first pair of x/y found in pos
            var res = {}, i, axis, key;

            for (i = 0; i < xaxes.length; ++i) {
                axis = xaxes[i];
                if (axis && axis.used) {
                    key = "x" + axis.n;
                    if (pos[key] == null && axis.n == 1)
                        key = "x";

                    if (pos[key] != null) {
                        res.left = axis.p2c(pos[key]);
                        break;
                    }
                }
            }

            for (i = 0; i < yaxes.length; ++i) {
                axis = yaxes[i];
                if (axis && axis.used) {
                    key = "y" + axis.n;
                    if (pos[key] == null && axis.n == 1)
                        key = "y";

                    if (pos[key] != null) {
                        res.top = axis.p2c(pos[key]);
                        break;
                    }
                }
            }

            return res;
        }

        function getOrCreateAxis(axes, number) {
            if (!axes[number - 1])
                axes[number - 1] = {
                    n: number, // save the number for future reference
                    direction: axes == xaxes ? "x" : "y",
                    options: $.extend(true, {}, axes == xaxes ? options.xaxis : options.yaxis)
                };

            return axes[number - 1];
        }

        function fillInSeriesOptions() {
            var i;

            // collect what we already got of colors
            var neededColors = series.length,
                usedColors = [],
                assignedColors = [];
            for (i = 0; i < series.length; ++i) {
                var sc = series[i].color;
                if (sc != null) {
                    --neededColors;
                    if (typeof sc == "number")
                        assignedColors.push(sc);
                    else
                        usedColors.push($.color.parse(series[i].color));
                }
            }

            // we might need to generate more colors if higher indices
            // are assigned
            for (i = 0; i < assignedColors.length; ++i) {
                neededColors = Math.max(neededColors, assignedColors[i] + 1);
            }

            // produce colors as needed
            var colors = [], variation = 0;
            i = 0;
            while (colors.length < neededColors) {
                var c;
                if (options.colors.length == i) // check degenerate case
                    c = $.color.make(100, 100, 100);
                else
                    c = $.color.parse(options.colors[i]);

                // vary color if needed
                var sign = variation % 2 == 1 ? -1 : 1;
                c.scale('rgb', 1 + sign * Math.ceil(variation / 2) * 0.2);

                // FIXME: if we're getting to close to something else,
                // we should probably skip this one
                colors.push(c);

                ++i;
                if (i >= options.colors.length) {
                    i = 0;
                    ++variation;
                }
            }

            // fill in the options
            var colori = 0, s;
            for (i = 0; i < series.length; ++i) {
                s = series[i];

                // assign colors
                if (s.color == null) {
                    s.color = colors[colori].toString();
                    ++colori;
                }
                else if (typeof s.color == "number")
                    s.color = colors[s.color].toString();

                // turn on lines automatically in case nothing is set
                if (s.lines.show == null) {
                    var v, show = true;
                    for (v in s)
                        if (s[v] && s[v].show) {
                            show = false;
                            break;
                        }
                    if (show)
                        s.lines.show = true;
                }

                // setup axes
                s.xaxis = getOrCreateAxis(xaxes, axisNumber(s, "x"));
                s.yaxis = getOrCreateAxis(yaxes, axisNumber(s, "y"));
            }
        }

        function processData() {
            var topSentry = Number.POSITIVE_INFINITY,
                bottomSentry = Number.NEGATIVE_INFINITY,
                fakeInfinity = Number.MAX_VALUE,
                i, j, k, m, length,
                s, points, ps, x, y, axis, val, f, p;

            function updateAxis(axis, min, max) {
                if (min < axis.datamin && min != -fakeInfinity)
                    axis.datamin = min;
                if (max > axis.datamax && max != fakeInfinity)
                    axis.datamax = max;
            }

            $.each(allAxes(), function (_, axis) {
                // init axis
                axis.datamin = topSentry;
                axis.datamax = bottomSentry;
                axis.used = false;
            });

            for (i = 0; i < series.length; ++i) {
                s = series[i];
                s.datapoints = { points: [] };

                executeHooks(hooks.processRawData, [ s, s.data, s.datapoints ]);
            }

            // first pass: clean and copy data
            for (i = 0; i < series.length; ++i) {
                s = series[i];

                var data = s.data, format = s.datapoints.format;

                if (!format) {
                    format = [];
                    // find out how to copy
                    format.push({ x: true, number: true, required: true });
                    format.push({ y: true, number: true, required: true });

                    if (s.bars.show || (s.lines.show && s.lines.fill)) {
                        format.push({ y: true, number: true, required: false, defaultValue: 0 });
                        if (s.bars.horizontal) {
                            delete format[format.length - 1].y;
                            format[format.length - 1].x = true;
                        }
                    }

                    s.datapoints.format = format;
                }

                if (s.datapoints.pointsize != null)
                    continue; // already filled in

                s.datapoints.pointsize = format.length;

                ps = s.datapoints.pointsize;
                points = s.datapoints.points;

                insertSteps = s.lines.show && s.lines.steps;
                s.xaxis.used = s.yaxis.used = true;

                for (j = k = 0; j < data.length; ++j, k += ps) {
                    p = data[j];

                    var nullify = p == null;
                    if (!nullify) {
                        for (m = 0; m < ps; ++m) {
                            val = p[m];
                            f = format[m];

                            if (f) {
                                if (f.number && val != null) {
                                    val = +val; // convert to number
                                    if (isNaN(val))
                                        val = null;
                                    else if (val == Infinity)
                                        val = fakeInfinity;
                                    else if (val == -Infinity)
                                        val = -fakeInfinity;
                                }

                                if (val == null) {
                                    if (f.required)
                                        nullify = true;

                                    if (f.defaultValue != null)
                                        val = f.defaultValue;
                                }
                            }

                            points[k + m] = val;
                        }
                    }

                    if (nullify) {
                        for (m = 0; m < ps; ++m) {
                            val = points[k + m];
                            if (val != null) {
                                f = format[m];
                                // extract min/max info
                                if (f.x)
                                    updateAxis(s.xaxis, val, val);
                                if (f.y)
                                    updateAxis(s.yaxis, val, val);
                            }
                            points[k + m] = null;
                        }
                    }
                    else {
                        // a little bit of line specific stuff that
                        // perhaps shouldn't be here, but lacking
                        // better means...
                        if (insertSteps && k > 0
                            && points[k - ps] != null
                            && points[k - ps] != points[k]
                            && points[k - ps + 1] != points[k + 1]) {
                            // copy the point to make room for a middle point
                            for (m = 0; m < ps; ++m)
                                points[k + ps + m] = points[k + m];

                            // middle point has same y
                            points[k + 1] = points[k - ps + 1];

                            // we've added a point, better reflect that
                            k += ps;
                        }
                    }
                }
            }

            // give the hooks a chance to run
            for (i = 0; i < series.length; ++i) {
                s = series[i];

                executeHooks(hooks.processDatapoints, [ s, s.datapoints]);
            }

            // second pass: find datamax/datamin for auto-scaling
            for (i = 0; i < series.length; ++i) {
                s = series[i];
                points = s.datapoints.points,
                    ps = s.datapoints.pointsize;
                format = s.datapoints.format;

                var xmin = topSentry, ymin = topSentry,
                    xmax = bottomSentry, ymax = bottomSentry;

                for (j = 0; j < points.length; j += ps) {
                    if (points[j] == null)
                        continue;

                    for (m = 0; m < ps; ++m) {
                        val = points[j + m];
                        f = format[m];
                        if (!f || val == fakeInfinity || val == -fakeInfinity)
                            continue;

                        if (f.x) {
                            if (val < xmin)
                                xmin = val;
                            if (val > xmax)
                                xmax = val;
                        }
                        if (f.y) {
                            if (val < ymin)
                                ymin = val;
                            if (val > ymax)
                                ymax = val;
                        }
                    }
                }

                if (s.bars.show) {
                    // make sure we got room for the bar on the dancing floor
                    var delta = s.bars.align == "left" ? 0 : -s.bars.barWidth / 2;
                    if (s.bars.horizontal) {
                        ymin += delta;
                        ymax += delta + s.bars.barWidth;
                    }
                    else {
                        xmin += delta;
                        xmax += delta + s.bars.barWidth;
                    }
                }

                updateAxis(s.xaxis, xmin, xmax);
                updateAxis(s.yaxis, ymin, ymax);
            }

            $.each(allAxes(), function (_, axis) {
                if (axis.datamin == topSentry)
                    axis.datamin = null;
                if (axis.datamax == bottomSentry)
                    axis.datamax = null;
            });
        }

        function makeCanvas(skipPositioning, cls) {
            var c = document.createElement('canvas');
            c.className = cls;
            c.width = canvasWidth;
            c.height = canvasHeight;

            if (!skipPositioning)
                $(c).css({ position: 'absolute', left: 0, top: 0 });

            $(c).appendTo(placeholder);

            if (!c.getContext) // excanvas hack
                c = window.G_vmlCanvasManager.initElement(c);

            // used for resetting in case we get replotted
            c.getContext("2d").save();

            return c;
        }

        function getCanvasDimensions() {
            canvasWidth = placeholder.width();
            canvasHeight = placeholder.height();

            if (canvasWidth <= 0 || canvasHeight <= 0)
                throw "Invalid dimensions for plot, width = " + canvasWidth + ", height = " + canvasHeight;
        }

        function resizeCanvas(c) {
            // resizing should reset the state (excanvas seems to be
            // buggy though)
            if (c.width != canvasWidth)
                c.width = canvasWidth;

            if (c.height != canvasHeight)
                c.height = canvasHeight;

            // so try to get back to the initial state (even if it's
            // gone now, this should be safe according to the spec)
            var cctx = c.getContext("2d");
            cctx.restore();

            // and save again
            cctx.save();
        }

        function setupCanvases() {
            var reused,
                existingCanvas = placeholder.children("canvas.flot-base"),
                existingOverlay = placeholder.children("canvas.flot-overlay");

            if (existingCanvas.length == 0 || existingOverlay == 0) {
                // init everything

                placeholder.html(""); // make sure placeholder is clear

                placeholder.css({ padding: 0 }); // padding messes up the positioning

                if (placeholder.css("position") == 'static')
                    placeholder.css("position", "relative"); // for positioning labels and overlay

                getCanvasDimensions();

                canvas = makeCanvas(true, "flot-base");
                overlay = makeCanvas(false, "flot-overlay"); // overlay canvas for interactive features

                reused = false;
            }
            else {
                // reuse existing elements

                canvas = existingCanvas.get(0);
                overlay = existingOverlay.get(0);

                reused = true;
            }

            ctx = canvas.getContext("2d");
            octx = overlay.getContext("2d");

            // define which element we're listening for events on
            eventHolder = $(overlay);

            if (reused) {
                // run shutdown in the old plot object
                placeholder.data("plot").shutdown();

                // reset reused canvases
                plot.resize();

                // make sure overlay pixels are cleared (canvas is cleared when we redraw)
                octx.clearRect(0, 0, canvasWidth, canvasHeight);

                // then whack any remaining obvious garbage left
                eventHolder.unbind();
                placeholder.children().not([canvas, overlay]).remove();
            }

            // save in case we get replotted
            placeholder.data("plot", plot);
        }

        function bindEvents() {
            // bind events
            if (options.grid.hoverable) {
                eventHolder.mousemove(onMouseMove);
                eventHolder.mouseleave(onMouseLeave);
            }

            if (options.grid.clickable)
                eventHolder.click(onClick);

            executeHooks(hooks.bindEvents, [eventHolder]);
        }

        function shutdown() {
            if (redrawTimeout)
                clearTimeout(redrawTimeout);

            eventHolder.unbind("mousemove", onMouseMove);
            eventHolder.unbind("mouseleave", onMouseLeave);
            eventHolder.unbind("click", onClick);

            executeHooks(hooks.shutdown, [eventHolder]);
        }

        function setTransformationHelpers(axis) {
            // set helper functions on the axis, assumes plot area
            // has been computed already

            function identity(x) {
                return x;
            }

            var s, m, t = axis.options.transform || identity,
                it = axis.options.inverseTransform;

            // precompute how much the axis is scaling a point
            // in canvas space
            if (axis.direction == "x") {
                s = axis.scale = plotWidth / Math.abs(t(axis.max) - t(axis.min));
                m = Math.min(t(axis.max), t(axis.min));
            }
            else {
                s = axis.scale = plotHeight / Math.abs(t(axis.max) - t(axis.min));
                s = -s;
                m = Math.max(t(axis.max), t(axis.min));
            }

            // data point to canvas coordinate
            if (t == identity) // slight optimization
                axis.p2c = function (p) {
                    return (p - m) * s;
                };
            else
                axis.p2c = function (p) {
                    return (t(p) - m) * s;
                };
            // canvas coordinate to data point
            if (!it)
                axis.c2p = function (c) {
                    return m + c / s;
                };
            else
                axis.c2p = function (c) {
                    return it(m + c / s);
                };
        }

        function measureTickLabels(axis) {
            var opts = axis.options, ticks = axis.ticks || [],
                axisw = opts.labelWidth || 0, axish = opts.labelHeight || 0,
                f = axis.font;

            ctx.save();
            ctx.font = f.style + " " + f.variant + " " + f.weight + " " + f.size + "px '" + f.family + "'";

            for (var i = 0; i < ticks.length; ++i) {
                var t = ticks[i];

                t.lines = [];
                t.width = t.height = 0;

                if (!t.label)
                    continue;

                // accept various kinds of newlines, including HTML ones
                // (you can actually split directly on regexps in Javascript,
                // but IE is unfortunately broken)
                var lines = t.label.replace(/<br ?\/?>|\r\n|\r/g, "\n").split("\n");
                for (var j = 0; j < lines.length; ++j) {
                    var line = { text: lines[j] },
                        m = ctx.measureText(line.text);

                    line.width = m.width;
                    // m.height might not be defined, not in the
                    // standard yet
                    line.height = m.height != null ? m.height : f.size;

                    // add a bit of margin since font rendering is
                    // not pixel perfect and cut off letters look
                    // bad, this also doubles as spacing between
                    // lines
                    line.height += Math.round(f.size * 0.15);

                    t.width = Math.max(line.width, t.width);
                    t.height += line.height;

                    t.lines.push(line);
                }

                if (opts.labelWidth == null)
                    axisw = Math.max(axisw, t.width);
                if (opts.labelHeight == null)
                    axish = Math.max(axish, t.height);
            }
            ctx.restore();

            axis.labelWidth = Math.ceil(axisw);
            axis.labelHeight = Math.ceil(axish);
        }

        function allocateAxisBoxFirstPhase(axis) {
            // find the bounding box of the axis by looking at label
            // widths/heights and ticks, make room by diminishing the
            // plotOffset; this first phase only looks at one
            // dimension per axis, the other dimension depends on the
            // other axes so will have to wait

            var lw = axis.labelWidth,
                lh = axis.labelHeight,
                pos = axis.options.position,
                tickLength = axis.options.tickLength,
                axisMargin = options.grid.axisMargin,
                padding = options.grid.labelMargin,
                all = axis.direction == "x" ? xaxes : yaxes,
                index;

            // determine axis margin
            var samePosition = $.grep(all, function (a) {
                return a && a.options.position == pos && a.reserveSpace;
            });
            if ($.inArray(axis, samePosition) == samePosition.length - 1)
                axisMargin = 0; // outermost

            // determine tick length - if we're innermost, we can use "full"
            if (tickLength == null) {
                var sameDirection = $.grep(all, function (a) {
                    return a && a.reserveSpace;
                });

                var innermost = $.inArray(axis, sameDirection) == 0;
                if (innermost)
                    tickLength = "full";
                else
                    tickLength = 5;
            }

            if (!isNaN(+tickLength))
                padding += +tickLength;

            // compute box
            if (axis.direction == "x") {
                lh += padding;

                if (pos == "bottom") {
                    plotOffset.bottom += lh + axisMargin;
                    axis.box = { top: canvasHeight - plotOffset.bottom, height: lh };
                }
                else {
                    axis.box = { top: plotOffset.top + axisMargin, height: lh };
                    plotOffset.top += lh + axisMargin;
                }
            }
            else {
                lw += padding;

                if (pos == "left") {
                    axis.box = { left: plotOffset.left + axisMargin, width: lw };
                    plotOffset.left += lw + axisMargin;
                }
                else {
                    plotOffset.right += lw + axisMargin;
                    axis.box = { left: canvasWidth - plotOffset.right, width: lw };
                }
            }

            // save for future reference
            axis.position = pos;
            axis.tickLength = tickLength;
            axis.box.padding = padding;
            axis.innermost = innermost;
        }

        function allocateAxisBoxSecondPhase(axis) {
            // now that all axis boxes have been placed in one
            // dimension, we can set the remaining dimension coordinates
            if (axis.direction == "x") {
                axis.box.left = plotOffset.left - axis.labelWidth / 2;
                axis.box.width = canvasWidth - plotOffset.left - plotOffset.right + axis.labelWidth;
            }
            else {
                axis.box.top = plotOffset.top - axis.labelHeight / 2;
                axis.box.height = canvasHeight - plotOffset.bottom - plotOffset.top + axis.labelHeight;
            }
        }

        function adjustLayoutForThingsStickingOut() {
            // possibly adjust plot offset to ensure everything stays
            // inside the canvas and isn't clipped off

            var minMargin = options.grid.minBorderMargin,
                margins = { x: 0, y: 0 }, i, axis;

            // check stuff from the plot (FIXME: this should just read
            // a value from the series, otherwise it's impossible to
            // customize)
            if (minMargin == null) {
                minMargin = 0;
                for (i = 0; i < series.length; ++i)
                    minMargin = Math.max(minMargin, 2 * (series[i].points.radius + series[i].points.lineWidth / 2));
            }

            margins.x = margins.y = Math.ceil(minMargin);

            // check axis labels, note we don't check the actual
            // labels but instead use the overall width/height to not
            // jump as much around with replots
            $.each(allAxes(), function (_, axis) {
                var dir = axis.direction;
                if (axis.reserveSpace)
                    margins[dir] = Math.ceil(Math.max(margins[dir], (dir == "x" ? axis.labelWidth : axis.labelHeight) / 2));
            });

            plotOffset.left = Math.max(margins.x, plotOffset.left);
            plotOffset.right = Math.max(margins.x, plotOffset.right);
            plotOffset.top = Math.max(margins.y, plotOffset.top);
            plotOffset.bottom = Math.max(margins.y, plotOffset.bottom);
        }

        function setupGrid() {
            var i, axes = allAxes(), showGrid = options.grid.show;

            // init plot offset
            for (var a in plotOffset)
                plotOffset[a] = showGrid ? options.grid.borderWidth : 0;

            // init axes
            $.each(axes, function (_, axis) {
                axis.show = axis.options.show;
                if (axis.show == null)
                    axis.show = axis.used; // by default an axis is visible if it's got data

                axis.reserveSpace = axis.show || axis.options.reserveSpace;

                setRange(axis);
            });

            if (showGrid) {
                // determine from the placeholder the font size ~ height of font ~ 1 em
                var fontDefaults = {
                    style: placeholder.css("font-style"),
                    size: Math.round(0.8 * (+placeholder.css("font-size").replace("px", "") || 13)),
                    variant: placeholder.css("font-variant"),
                    weight: placeholder.css("font-weight"),
                    family: placeholder.css("font-family")
                };

                var allocatedAxes = $.grep(axes, function (axis) {
                    return axis.reserveSpace;
                });

                $.each(allocatedAxes, function (_, axis) {
                    // make the ticks
                    setupTickGeneration(axis);
                    setTicks(axis);
                    snapRangeToTicks(axis, axis.ticks);

                    // find labelWidth/Height for axis
                    axis.font = $.extend({}, fontDefaults, axis.options.font);
                    measureTickLabels(axis);
                });

                // with all dimensions calculated, we can compute the
                // axis bounding boxes, start from the outside
                // (reverse order)
                for (i = allocatedAxes.length - 1; i >= 0; --i)
                    allocateAxisBoxFirstPhase(allocatedAxes[i]);

                // make sure we've got enough space for things that
                // might stick out
                adjustLayoutForThingsStickingOut();

                $.each(allocatedAxes, function (_, axis) {
                    allocateAxisBoxSecondPhase(axis);
                });
            }

            plotWidth = canvasWidth - plotOffset.left - plotOffset.right;
            plotHeight = canvasHeight - plotOffset.bottom - plotOffset.top;

            // now we got the proper plot dimensions, we can compute the scaling
            $.each(axes, function (_, axis) {
                setTransformationHelpers(axis);
            });

            insertLegend();
        }

        function setRange(axis) {
            var opts = axis.options,
                min = +(opts.min != null ? opts.min : axis.datamin),
                max = +(opts.max != null ? opts.max : axis.datamax),
                delta = max - min;

            if (delta == 0.0) {
                // degenerate case
                var widen = max == 0 ? 1 : 0.01;

                if (opts.min == null)
                    min -= widen;
                // always widen max if we couldn't widen min to ensure we
                // don't fall into min == max which doesn't work
                if (opts.max == null || opts.min != null)
                    max += widen;
            }
            else {
                // consider autoscaling
                var margin = opts.autoscaleMargin;
                if (margin != null) {
                    if (opts.min == null) {
                        min -= delta * margin;
                        // make sure we don't go below zero if all values
                        // are positive
                        if (min < 0 && axis.datamin != null && axis.datamin >= 0)
                            min = 0;
                    }
                    if (opts.max == null) {
                        max += delta * margin;
                        if (max > 0 && axis.datamax != null && axis.datamax <= 0)
                            max = 0;
                    }
                }
            }
            axis.min = min;
            axis.max = max;
        }

        function setupTickGeneration(axis) {
            var opts = axis.options;

            // estimate number of ticks
            var noTicks;
            if (typeof opts.ticks == "number" && opts.ticks > 0)
                noTicks = opts.ticks;
            else
            // heuristic based on the model a*sqrt(x) fitted to
            // some data points that seemed reasonable
                noTicks = 0.3 * Math.sqrt(axis.direction == "x" ? canvasWidth : canvasHeight);

            var delta = (axis.max - axis.min) / noTicks,
                size, generator, unit, formatter, i, magn, norm;

            if (opts.mode == "time") {
                // pretty handling of time

                // map of app. size of time units in milliseconds
                var timeUnitSize = {
                    "second": 1000,
                    "minute": 60 * 1000,
                    "hour": 60 * 60 * 1000,
                    "day": 24 * 60 * 60 * 1000,
                    "month": 30 * 24 * 60 * 60 * 1000,
                    "year": 365.2425 * 24 * 60 * 60 * 1000
                };


                // the allowed tick sizes, after 1 year we use
                // an integer algorithm
                var spec = [
                    [1, "second"],
                    [2, "second"],
                    [5, "second"],
                    [10, "second"],
                    [30, "second"],
                    [1, "minute"],
                    [2, "minute"],
                    [5, "minute"],
                    [10, "minute"],
                    [30, "minute"],
                    [1, "hour"],
                    [2, "hour"],
                    [4, "hour"],
                    [8, "hour"],
                    [12, "hour"],
                    [1, "day"],
                    [2, "day"],
                    [3, "day"],
                    [0.25, "month"],
                    [0.5, "month"],
                    [1, "month"],
                    [2, "month"],
                    [3, "month"],
                    [6, "month"],
                    [1, "year"]
                ];

                var minSize = 0;
                if (opts.minTickSize != null) {
                    if (typeof opts.tickSize == "number")
                        minSize = opts.tickSize;
                    else
                        minSize = opts.minTickSize[0] * timeUnitSize[opts.minTickSize[1]];
                }

                for (var i = 0; i < spec.length - 1; ++i)
                    if (delta < (spec[i][0] * timeUnitSize[spec[i][1]]
                        + spec[i + 1][0] * timeUnitSize[spec[i + 1][1]]) / 2
                        && spec[i][0] * timeUnitSize[spec[i][1]] >= minSize)
                        break;
                size = spec[i][0];
                unit = spec[i][1];

                // special-case the possibility of several years
                if (unit == "year") {
                    magn = Math.pow(10, Math.floor(Math.log(delta / timeUnitSize.year) / Math.LN10));
                    norm = (delta / timeUnitSize.year) / magn;
                    if (norm < 1.5)
                        size = 1;
                    else if (norm < 3)
                        size = 2;
                    else if (norm < 7.5)
                        size = 5;
                    else
                        size = 10;

                    size *= magn;
                }

                axis.tickSize = opts.tickSize || [size, unit];

                generator = function (axis) {
                    var ticks = [],
                        tickSize = axis.tickSize[0], unit = axis.tickSize[1],
                        d = new Date(axis.min);

                    var step = tickSize * timeUnitSize[unit];

                    if (unit == "second")
                        d.setUTCSeconds(floorInBase(d.getUTCSeconds(), tickSize));
                    if (unit == "minute")
                        d.setUTCMinutes(floorInBase(d.getUTCMinutes(), tickSize));
                    if (unit == "hour")
                        d.setUTCHours(floorInBase(d.getUTCHours(), tickSize));
                    if (unit == "month")
                        d.setUTCMonth(floorInBase(d.getUTCMonth(), tickSize));
                    if (unit == "year")
                        d.setUTCFullYear(floorInBase(d.getUTCFullYear(), tickSize));

                    // reset smaller components
                    d.setUTCMilliseconds(0);
                    if (step >= timeUnitSize.minute)
                        d.setUTCSeconds(0);
                    if (step >= timeUnitSize.hour)
                        d.setUTCMinutes(0);
                    if (step >= timeUnitSize.day)
                        d.setUTCHours(0);
                    if (step >= timeUnitSize.day * 4)
                        d.setUTCDate(1);
                    if (step >= timeUnitSize.year)
                        d.setUTCMonth(0);


                    var carry = 0, v = Number.NaN, prev;
                    do {
                        prev = v;
                        v = d.getTime();
                        ticks.push(v);
                        if (unit == "month") {
                            if (tickSize < 1) {
                                // a bit complicated - we'll divide the month
                                // up but we need to take care of fractions
                                // so we don't end up in the middle of a day
                                d.setUTCDate(1);
                                var start = d.getTime();
                                d.setUTCMonth(d.getUTCMonth() + 1);
                                var end = d.getTime();
                                d.setTime(v + carry * timeUnitSize.hour + (end - start) * tickSize);
                                carry = d.getUTCHours();
                                d.setUTCHours(0);
                            }
                            else
                                d.setUTCMonth(d.getUTCMonth() + tickSize);
                        }
                        else if (unit == "year") {
                            d.setUTCFullYear(d.getUTCFullYear() + tickSize);
                        }
                        else
                            d.setTime(v + step);
                    } while (v < axis.max && v != prev);

                    return ticks;
                };

                formatter = function (v, axis) {
                    var d = new Date(v);

                    // first check global format
                    if (opts.timeformat != null)
                        return $.plot.formatDate(d, opts.timeformat, opts.monthNames);

                    var t = axis.tickSize[0] * timeUnitSize[axis.tickSize[1]];
                    var span = axis.max - axis.min;
                    var suffix = (opts.twelveHourClock) ? " %p" : "";

                    if (t < timeUnitSize.minute)
                        fmt = "%h:%M:%S" + suffix;
                    else if (t < timeUnitSize.day) {
                        if (span < 2 * timeUnitSize.day)
                            fmt = "%h:%M" + suffix;
                        else
                            fmt = "%b %d %h:%M" + suffix;
                    }
                    else if (t < timeUnitSize.month)
                        fmt = "%b %d";
                    else if (t < timeUnitSize.year) {
                        if (span < timeUnitSize.year)
                            fmt = "%b";
                        else
                            fmt = "%b %y";
                    }
                    else
                        fmt = "%y";

                    return $.plot.formatDate(d, fmt, opts.monthNames);
                };
            }
            else {
                // pretty rounding of base-10 numbers
                var maxDec = opts.tickDecimals;
                var dec = -Math.floor(Math.log(delta) / Math.LN10);
                if (maxDec != null && dec > maxDec)
                    dec = maxDec;

                magn = Math.pow(10, -dec);
                norm = delta / magn; // norm is between 1.0 and 10.0

                if (norm < 1.5)
                    size = 1;
                else if (norm < 3) {
                    size = 2;
                    // special case for 2.5, requires an extra decimal
                    if (norm > 2.25 && (maxDec == null || dec + 1 <= maxDec)) {
                        size = 2.5;
                        ++dec;
                    }
                }
                else if (norm < 7.5)
                    size = 5;
                else
                    size = 10;

                size *= magn;

                if (opts.minTickSize != null && size < opts.minTickSize)
                    size = opts.minTickSize;

                axis.tickDecimals = Math.max(0, maxDec != null ? maxDec : dec);
                axis.tickSize = opts.tickSize || size;

                generator = function (axis) {
                    var ticks = [];

                    // spew out all possible ticks
                    var start = floorInBase(axis.min, axis.tickSize),
                        i = 0, v = Number.NaN, prev;
                    do {
                        prev = v;
                        v = start + i * axis.tickSize;
                        ticks.push(v);
                        ++i;
                    } while (v < axis.max && v != prev);
                    return ticks;
                };

                formatter = function (v, axis) {
                    return v.toFixed(axis.tickDecimals);
                };
            }

            if (opts.alignTicksWithAxis != null) {
                var otherAxis = (axis.direction == "x" ? xaxes : yaxes)[opts.alignTicksWithAxis - 1];
                if (otherAxis && otherAxis.used && otherAxis != axis) {
                    // consider snapping min/max to outermost nice ticks
                    var niceTicks = generator(axis);
                    if (niceTicks.length > 0) {
                        if (opts.min == null)
                            axis.min = Math.min(axis.min, niceTicks[0]);
                        if (opts.max == null && niceTicks.length > 1)
                            axis.max = Math.max(axis.max, niceTicks[niceTicks.length - 1]);
                    }

                    generator = function (axis) {
                        // copy ticks, scaled to this axis
                        var ticks = [], v, i;
                        for (i = 0; i < otherAxis.ticks.length; ++i) {
                            v = (otherAxis.ticks[i].v - otherAxis.min) / (otherAxis.max - otherAxis.min);
                            v = axis.min + v * (axis.max - axis.min);
                            ticks.push(v);
                        }
                        return ticks;
                    };

                    // we might need an extra decimal since forced
                    // ticks don't necessarily fit naturally
                    if (!axis.mode && opts.tickDecimals == null) {
                        var extraDec = Math.max(0, -Math.floor(Math.log(delta) / Math.LN10) + 1),
                            ts = generator(axis);

                        // only proceed if the tick interval rounded
                        // with an extra decimal doesn't give us a
                        // zero at end
                        if (!(ts.length > 1 && /\..*0$/.test((ts[1] - ts[0]).toFixed(extraDec))))
                            axis.tickDecimals = extraDec;
                    }
                }
            }

            axis.tickGenerator = generator;
            if ($.isFunction(opts.tickFormatter))
                axis.tickFormatter = function (v, axis) {
                    return "" + opts.tickFormatter(v, axis);
                };
            else
                axis.tickFormatter = formatter;
        }

        function setTicks(axis) {
            var oticks = axis.options.ticks, ticks = [];
            if (oticks == null || (typeof oticks == "number" && oticks > 0))
                ticks = axis.tickGenerator(axis);
            else if (oticks) {
                if ($.isFunction(oticks))
                // generate the ticks
                    ticks = oticks(axis);
                else
                    ticks = oticks;
            }

            // clean up/labelify the supplied ticks, copy them over
            var i, v;
            axis.ticks = [];
            for (i = 0; i < ticks.length; ++i) {
                var label = null;
                var t = ticks[i];
                if (typeof t == "object") {
                    v = +t[0];
                    if (t.length > 1)
                        label = t[1];
                }
                else
                    v = +t;
                if (label == null)
                    label = axis.tickFormatter(v, axis);
                if (!isNaN(v))
                    axis.ticks.push({ v: v, label: label });
            }
        }

        function snapRangeToTicks(axis, ticks) {
            if (axis.options.autoscaleMargin && ticks.length > 0) {
                // snap to ticks
                if (axis.options.min == null)
                    axis.min = Math.min(axis.min, ticks[0].v);
                if (axis.options.max == null && ticks.length > 1)
                    axis.max = Math.max(axis.max, ticks[ticks.length - 1].v);
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);

            var grid = options.grid;

            // draw background, if any
            if (grid.show && grid.backgroundColor)
                drawBackground();

            if (grid.show && !grid.aboveData) {
                drawGrid();
                drawAxisLabels();
            }

            for (var i = 0; i < series.length; ++i) {
                executeHooks(hooks.drawSeries, [ctx, series[i]]);
                drawSeries(series[i]);
            }

            executeHooks(hooks.draw, [ctx]);

            if (grid.show && grid.aboveData) {
                drawGrid();
                drawAxisLabels();
            }
        }

        function extractRange(ranges, coord) {
            var axis, from, to, key, axes = allAxes();

            for (i = 0; i < axes.length; ++i) {
                axis = axes[i];
                if (axis.direction == coord) {
                    key = coord + axis.n + "axis";
                    if (!ranges[key] && axis.n == 1)
                        key = coord + "axis"; // support x1axis as xaxis
                    if (ranges[key]) {
                        from = ranges[key].from;
                        to = ranges[key].to;
                        break;
                    }
                }
            }

            // backwards-compat stuff - to be removed in future
            if (!ranges[key]) {
                axis = coord == "x" ? xaxes[0] : yaxes[0];
                from = ranges[coord + "1"];
                to = ranges[coord + "2"];
            }

            // auto-reverse as an added bonus
            if (from != null && to != null && from > to) {
                var tmp = from;
                from = to;
                to = tmp;
            }

            return { from: from, to: to, axis: axis };
        }

        function drawBackground() {
            ctx.save();
            ctx.translate(plotOffset.left, plotOffset.top);

            ctx.fillStyle = getColorOrGradient(options.grid.backgroundColor, plotHeight, 0, "rgba(255, 255, 255, 0)");
            ctx.fillRect(0, 0, plotWidth, plotHeight);
            ctx.restore();
        }

        function drawGrid() {
            var i;

            ctx.save();
            ctx.translate(plotOffset.left, plotOffset.top);

            // draw markings
            var markings = options.grid.markings;
            if (markings) {
                if ($.isFunction(markings)) {
                    var axes = plot.getAxes();
                    // xmin etc. is backwards compatibility, to be
                    // removed in the future
                    axes.xmin = axes.xaxis.min;
                    axes.xmax = axes.xaxis.max;
                    axes.ymin = axes.yaxis.min;
                    axes.ymax = axes.yaxis.max;

                    markings = markings(axes);
                }

                for (i = 0; i < markings.length; ++i) {
                    var m = markings[i],
                        xrange = extractRange(m, "x"),
                        yrange = extractRange(m, "y");

                    // fill in missing
                    if (xrange.from == null)
                        xrange.from = xrange.axis.min;
                    if (xrange.to == null)
                        xrange.to = xrange.axis.max;
                    if (yrange.from == null)
                        yrange.from = yrange.axis.min;
                    if (yrange.to == null)
                        yrange.to = yrange.axis.max;

                    // clip
                    if (xrange.to < xrange.axis.min || xrange.from > xrange.axis.max ||
                        yrange.to < yrange.axis.min || yrange.from > yrange.axis.max)
                        continue;

                    xrange.from = Math.max(xrange.from, xrange.axis.min);
                    xrange.to = Math.min(xrange.to, xrange.axis.max);
                    yrange.from = Math.max(yrange.from, yrange.axis.min);
                    yrange.to = Math.min(yrange.to, yrange.axis.max);

                    if (xrange.from == xrange.to && yrange.from == yrange.to)
                        continue;

                    // then draw
                    xrange.from = xrange.axis.p2c(xrange.from);
                    xrange.to = xrange.axis.p2c(xrange.to);
                    yrange.from = yrange.axis.p2c(yrange.from);
                    yrange.to = yrange.axis.p2c(yrange.to);

                    if (xrange.from == xrange.to || yrange.from == yrange.to) {
                        // draw line
                        ctx.beginPath();
                        ctx.strokeStyle = m.color || options.grid.markingsColor;
                        ctx.lineWidth = m.lineWidth || options.grid.markingsLineWidth;
                        ctx.moveTo(xrange.from, yrange.from);
                        ctx.lineTo(xrange.to, yrange.to);
                        ctx.stroke();
                    }
                    else {
                        // fill area
                        ctx.fillStyle = m.color || options.grid.markingsColor;
                        ctx.fillRect(xrange.from, yrange.to,
                            xrange.to - xrange.from,
                            yrange.from - yrange.to);
                    }
                }
            }

            // draw the ticks
            var axes = allAxes(), bw = options.grid.borderWidth;

            for (var j = 0; j < axes.length; ++j) {
                var axis = axes[j], box = axis.box,
                    t = axis.tickLength, x, y, xoff, yoff;
                if (!axis.show || axis.ticks.length == 0)
                    continue;

                ctx.strokeStyle = axis.options.tickColor || $.color.parse(axis.options.color).scale('a', 0.22).toString();
                ctx.lineWidth = 1;

                // find the edges
                if (axis.direction == "x") {
                    x = 0;
                    if (t == "full")
                        y = (axis.position == "top" ? 0 : plotHeight);
                    else
                        y = box.top - plotOffset.top + (axis.position == "top" ? box.height : 0);
                }
                else {
                    y = 0;
                    if (t == "full")
                        x = (axis.position == "left" ? 0 : plotWidth);
                    else
                        x = box.left - plotOffset.left + (axis.position == "left" ? box.width : 0);
                }

                // draw tick bar
                if (!axis.innermost) {
                    ctx.beginPath();
                    xoff = yoff = 0;
                    if (axis.direction == "x")
                        xoff = plotWidth;
                    else
                        yoff = plotHeight;

                    if (ctx.lineWidth == 1) {
                        x = Math.floor(x) + 0.5;
                        y = Math.floor(y) + 0.5;
                    }

                    ctx.moveTo(x, y);
                    ctx.lineTo(x + xoff, y + yoff);
                    ctx.stroke();
                }

                // draw ticks
                ctx.beginPath();
                for (i = 0; i < axis.ticks.length; ++i) {
                    var v = axis.ticks[i].v;

                    xoff = yoff = 0;

                    if (v < axis.min || v > axis.max
                        // skip those lying on the axes if we got a border
                        || (t == "full" && bw > 0
                        && (v == axis.min || v == axis.max)))
                        continue;

                    if (axis.direction == "x") {
                        x = axis.p2c(v);
                        yoff = t == "full" ? -plotHeight : t;

                        if (axis.position == "top")
                            yoff = -yoff;
                    }
                    else {
                        y = axis.p2c(v);
                        xoff = t == "full" ? -plotWidth : t;

                        if (axis.position == "left")
                            xoff = -xoff;
                    }

                    if (ctx.lineWidth == 1) {
                        if (axis.direction == "x")
                            x = Math.floor(x) + 0.5;
                        else
                            y = Math.floor(y) + 0.5;
                    }

                    ctx.moveTo(x, y);
                    ctx.lineTo(x + xoff, y + yoff);
                }

                ctx.stroke();
            }


            // draw border
            if (bw) {
                ctx.lineWidth = bw;
                ctx.strokeStyle = options.grid.borderColor;
                ctx.strokeRect(-bw / 2, -bw / 2, plotWidth + bw, plotHeight + bw);
            }

            ctx.restore();
        }

        function drawAxisLabels() {
            ctx.save();

            $.each(allAxes(), function (_, axis) {
                if (!axis.show || axis.ticks.length == 0)
                    return;

                var box = axis.box, f = axis.font;
                // placeholder.append('<div style="position:absolute;opacity:0.10;background-color:red;left:' + box.left + 'px;top:' + box.top + 'px;width:' + box.width +  'px;height:' + box.height + 'px"></div>') // debug

                ctx.fillStyle = axis.options.color;
                // Important: Don't use quotes around axis.font.family! Just around single 
                // font names like 'Times New Roman' that have a space or special character in it.
                ctx.font = f.style + " " + f.variant + " " + f.weight + " " + f.size + "px " + f.family;
                ctx.textAlign = "start";
                // middle align the labels - top would be more
                // natural, but browsers can differ a pixel or two in
                // where they consider the top to be, so instead we
                // middle align to minimize variation between browsers
                // and compensate when calculating the coordinates
                ctx.textBaseline = "middle";

                for (var i = 0; i < axis.ticks.length; ++i) {
                    var tick = axis.ticks[i];
                    if (!tick.label || tick.v < axis.min || tick.v > axis.max)
                        continue;

                    var x, y, offset = 0, line;
                    for (var k = 0; k < tick.lines.length; ++k) {
                        line = tick.lines[k];

                        if (axis.direction == "x") {
                            x = plotOffset.left + axis.p2c(tick.v) - line.width / 2;
                            if (axis.position == "bottom")
                                y = box.top + box.padding;
                            else
                                y = box.top + box.height - box.padding - tick.height;
                        }
                        else {
                            y = plotOffset.top + axis.p2c(tick.v) - tick.height / 2;
                            if (axis.position == "left")
                                x = box.left + box.width - box.padding - line.width;
                            else
                                x = box.left + box.padding;
                        }

                        // account for middle aligning and line number
                        y += line.height / 2 + offset;
                        offset += line.height;

                        if ($.browser.opera) {
                            // FIXME: UGLY BROWSER DETECTION
                            // round the coordinates since Opera
                            // otherwise switches to more ugly
                            // rendering (probably non-hinted) and
                            // offset the y coordinates since it seems
                            // to be off pretty consistently compared
                            // to the other browsers
                            x = Math.floor(x);
                            y = Math.ceil(y - 2);
                        }
                        ctx.fillText(line.text, x, y);
                    }
                }
            });

            ctx.restore();
        }

        function drawSeries(series) {
            if (series.lines.show)
                drawSeriesLines(series);
            if (series.bars.show)
                drawSeriesBars(series);
            if (series.points.show)
                drawSeriesPoints(series);
        }

        function drawSeriesLines(series) {
            function plotLine(datapoints, xoffset, yoffset, axisx, axisy) {
                var points = datapoints.points,
                    ps = datapoints.pointsize,
                    prevx = null, prevy = null;

                ctx.beginPath();
                for (var i = ps; i < points.length; i += ps) {
                    var x1 = points[i - ps], y1 = points[i - ps + 1],
                        x2 = points[i], y2 = points[i + 1];

                    if (x1 == null || x2 == null)
                        continue;

                    // clip with ymin
                    if (y1 <= y2 && y1 < axisy.min) {
                        if (y2 < axisy.min)
                            continue;   // line segment is outside
                        // compute new intersection point
                        x1 = (axisy.min - y1) / (y2 - y1) * (x2 - x1) + x1;
                        y1 = axisy.min;
                    }
                    else if (y2 <= y1 && y2 < axisy.min) {
                        if (y1 < axisy.min)
                            continue;
                        x2 = (axisy.min - y1) / (y2 - y1) * (x2 - x1) + x1;
                        y2 = axisy.min;
                    }

                    // clip with ymax
                    if (y1 >= y2 && y1 > axisy.max) {
                        if (y2 > axisy.max)
                            continue;
                        x1 = (axisy.max - y1) / (y2 - y1) * (x2 - x1) + x1;
                        y1 = axisy.max;
                    }
                    else if (y2 >= y1 && y2 > axisy.max) {
                        if (y1 > axisy.max)
                            continue;
                        x2 = (axisy.max - y1) / (y2 - y1) * (x2 - x1) + x1;
                        y2 = axisy.max;
                    }

                    // clip with xmin
                    if (x1 <= x2 && x1 < axisx.min) {
                        if (x2 < axisx.min)
                            continue;
                        y1 = (axisx.min - x1) / (x2 - x1) * (y2 - y1) + y1;
                        x1 = axisx.min;
                    }
                    else if (x2 <= x1 && x2 < axisx.min) {
                        if (x1 < axisx.min)
                            continue;
                        y2 = (axisx.min - x1) / (x2 - x1) * (y2 - y1) + y1;
                        x2 = axisx.min;
                    }

                    // clip with xmax
                    if (x1 >= x2 && x1 > axisx.max) {
                        if (x2 > axisx.max)
                            continue;
                        y1 = (axisx.max - x1) / (x2 - x1) * (y2 - y1) + y1;
                        x1 = axisx.max;
                    }
                    else if (x2 >= x1 && x2 > axisx.max) {
                        if (x1 > axisx.max)
                            continue;
                        y2 = (axisx.max - x1) / (x2 - x1) * (y2 - y1) + y1;
                        x2 = axisx.max;
                    }

                    if (x1 != prevx || y1 != prevy)
                        ctx.moveTo(axisx.p2c(x1) + xoffset, axisy.p2c(y1) + yoffset);

                    prevx = x2;
                    prevy = y2;
                    ctx.lineTo(axisx.p2c(x2) + xoffset, axisy.p2c(y2) + yoffset);
                }
                ctx.stroke();
            }

            function plotLineArea(datapoints, axisx, axisy) {
                var points = datapoints.points,
                    ps = datapoints.pointsize,
                    bottom = Math.min(Math.max(0, axisy.min), axisy.max),
                    i = 0, top, areaOpen = false,
                    ypos = 1, segmentStart = 0, segmentEnd = 0;

                // we process each segment in two turns, first forward
                // direction to sketch out top, then once we hit the
                // end we go backwards to sketch the bottom
                while (true) {
                    if (ps > 0 && i > points.length + ps)
                        break;

                    i += ps; // ps is negative if going backwards

                    var x1 = points[i - ps],
                        y1 = points[i - ps + ypos],
                        x2 = points[i], y2 = points[i + ypos];

                    if (areaOpen) {
                        if (ps > 0 && x1 != null && x2 == null) {
                            // at turning point
                            segmentEnd = i;
                            ps = -ps;
                            ypos = 2;
                            continue;
                        }

                        if (ps < 0 && i == segmentStart + ps) {
                            // done with the reverse sweep
                            ctx.fill();
                            areaOpen = false;
                            ps = -ps;
                            ypos = 1;
                            i = segmentStart = segmentEnd + ps;
                            continue;
                        }
                    }

                    if (x1 == null || x2 == null)
                        continue;

                    // clip x values

                    // clip with xmin
                    if (x1 <= x2 && x1 < axisx.min) {
                        if (x2 < axisx.min)
                            continue;
                        y1 = (axisx.min - x1) / (x2 - x1) * (y2 - y1) + y1;
                        x1 = axisx.min;
                    }
                    else if (x2 <= x1 && x2 < axisx.min) {
                        if (x1 < axisx.min)
                            continue;
                        y2 = (axisx.min - x1) / (x2 - x1) * (y2 - y1) + y1;
                        x2 = axisx.min;
                    }

                    // clip with xmax
                    if (x1 >= x2 && x1 > axisx.max) {
                        if (x2 > axisx.max)
                            continue;
                        y1 = (axisx.max - x1) / (x2 - x1) * (y2 - y1) + y1;
                        x1 = axisx.max;
                    }
                    else if (x2 >= x1 && x2 > axisx.max) {
                        if (x1 > axisx.max)
                            continue;
                        y2 = (axisx.max - x1) / (x2 - x1) * (y2 - y1) + y1;
                        x2 = axisx.max;
                    }

                    if (!areaOpen) {
                        // open area
                        ctx.beginPath();
                        ctx.moveTo(axisx.p2c(x1), axisy.p2c(bottom));
                        areaOpen = true;
                    }

                    // now first check the case where both is outside
                    if (y1 >= axisy.max && y2 >= axisy.max) {
                        ctx.lineTo(axisx.p2c(x1), axisy.p2c(axisy.max));
                        ctx.lineTo(axisx.p2c(x2), axisy.p2c(axisy.max));
                        continue;
                    }
                    else if (y1 <= axisy.min && y2 <= axisy.min) {
                        ctx.lineTo(axisx.p2c(x1), axisy.p2c(axisy.min));
                        ctx.lineTo(axisx.p2c(x2), axisy.p2c(axisy.min));
                        continue;
                    }

                    // else it's a bit more complicated, there might
                    // be a flat maxed out rectangle first, then a
                    // triangular cutout or reverse; to find these
                    // keep track of the current x values
                    var x1old = x1, x2old = x2;

                    // clip the y values, without shortcutting, we
                    // go through all cases in turn

                    // clip with ymin
                    if (y1 <= y2 && y1 < axisy.min && y2 >= axisy.min) {
                        x1 = (axisy.min - y1) / (y2 - y1) * (x2 - x1) + x1;
                        y1 = axisy.min;
                    }
                    else if (y2 <= y1 && y2 < axisy.min && y1 >= axisy.min) {
                        x2 = (axisy.min - y1) / (y2 - y1) * (x2 - x1) + x1;
                        y2 = axisy.min;
                    }

                    // clip with ymax
                    if (y1 >= y2 && y1 > axisy.max && y2 <= axisy.max) {
                        x1 = (axisy.max - y1) / (y2 - y1) * (x2 - x1) + x1;
                        y1 = axisy.max;
                    }
                    else if (y2 >= y1 && y2 > axisy.max && y1 <= axisy.max) {
                        x2 = (axisy.max - y1) / (y2 - y1) * (x2 - x1) + x1;
                        y2 = axisy.max;
                    }

                    // if the x value was changed we got a rectangle
                    // to fill
                    if (x1 != x1old) {
                        ctx.lineTo(axisx.p2c(x1old), axisy.p2c(y1));
                        // it goes to (x1, y1), but we fill that below
                    }

                    // fill triangular section, this sometimes result
                    // in redundant points if (x1, y1) hasn't changed
                    // from previous line to, but we just ignore that
                    ctx.lineTo(axisx.p2c(x1), axisy.p2c(y1));
                    ctx.lineTo(axisx.p2c(x2), axisy.p2c(y2));

                    // fill the other rectangle if it's there
                    if (x2 != x2old) {
                        ctx.lineTo(axisx.p2c(x2), axisy.p2c(y2));
                        ctx.lineTo(axisx.p2c(x2old), axisy.p2c(y2));
                    }
                }
            }

            ctx.save();
            ctx.translate(plotOffset.left, plotOffset.top);
            ctx.lineJoin = "round";

            var lw = series.lines.lineWidth,
                sw = series.shadowSize;
            // FIXME: consider another form of shadow when filling is turned on
            if (lw > 0 && sw > 0) {
                // draw shadow as a thick and thin line with transparency
                ctx.lineWidth = sw;
                ctx.strokeStyle = "rgba(0,0,0,0.1)";
                // position shadow at angle from the mid of line
                var angle = Math.PI / 18;
                plotLine(series.datapoints, Math.sin(angle) * (lw / 2 + sw / 2), Math.cos(angle) * (lw / 2 + sw / 2), series.xaxis, series.yaxis);
                ctx.lineWidth = sw / 2;
                plotLine(series.datapoints, Math.sin(angle) * (lw / 2 + sw / 4), Math.cos(angle) * (lw / 2 + sw / 4), series.xaxis, series.yaxis);
            }

            ctx.lineWidth = lw;
            ctx.strokeStyle = series.color;
            var fillStyle = getFillStyle(series.lines, series.color, 0, plotHeight);
            if (fillStyle) {
                ctx.fillStyle = fillStyle;
                plotLineArea(series.datapoints, series.xaxis, series.yaxis);
            }

            if (lw > 0)
                plotLine(series.datapoints, 0, 0, series.xaxis, series.yaxis);
            ctx.restore();
        }

        function drawSeriesPoints(series) {
            function plotPoints(datapoints, radius, fillStyle, offset, shadow, axisx, axisy, symbol) {
                var points = datapoints.points, ps = datapoints.pointsize;

                for (var i = 0; i < points.length; i += ps) {
                    var x = points[i], y = points[i + 1];
                    if (x == null || x < axisx.min || x > axisx.max || y < axisy.min || y > axisy.max)
                        continue;

                    ctx.beginPath();
                    x = axisx.p2c(x);
                    y = axisy.p2c(y) + offset;
                    if (symbol == "circle")
                        ctx.arc(x, y, radius, 0, shadow ? Math.PI : Math.PI * 2, false);
                    else
                        symbol(ctx, x, y, radius, shadow);
                    ctx.closePath();

                    if (fillStyle) {
                        ctx.fillStyle = fillStyle;
                        ctx.fill();
                    }
                    ctx.stroke();
                }
            }

            ctx.save();
            ctx.translate(plotOffset.left, plotOffset.top);

            var lw = series.points.lineWidth,
                sw = series.shadowSize,
                radius = series.points.radius,
                symbol = series.points.symbol;
            if (lw > 0 && sw > 0) {
                // draw shadow in two steps
                var w = sw / 2;
                ctx.lineWidth = w;
                ctx.strokeStyle = "rgba(0,0,0,0.1)";
                plotPoints(series.datapoints, radius, null, w + w / 2, true,
                    series.xaxis, series.yaxis, symbol);

                ctx.strokeStyle = "rgba(0,0,0,0.2)";
                plotPoints(series.datapoints, radius, null, w / 2, true,
                    series.xaxis, series.yaxis, symbol);
            }

            ctx.lineWidth = lw;
            ctx.strokeStyle = series.color;
            plotPoints(series.datapoints, radius,
                getFillStyle(series.points, series.color), 0, false,
                series.xaxis, series.yaxis, symbol);
            ctx.restore();
        }

        function drawBar(x, y, b, barLeft, barRight, offset, fillStyleCallback, axisx, axisy, c, horizontal, lineWidth) {
            var left, right, bottom, top,
                drawLeft, drawRight, drawTop, drawBottom,
                tmp;

            // in horizontal mode, we start the bar from the left
            // instead of from the bottom so it appears to be
            // horizontal rather than vertical
            if (horizontal) {
                drawBottom = drawRight = drawTop = true;
                drawLeft = false;
                left = b;
                right = x;
                top = y + barLeft;
                bottom = y + barRight;

                // account for negative bars
                if (right < left) {
                    tmp = right;
                    right = left;
                    left = tmp;
                    drawLeft = true;
                    drawRight = false;
                }
            }
            else {
                drawLeft = drawRight = drawTop = true;
                drawBottom = false;
                left = x + barLeft;
                right = x + barRight;
                bottom = b;
                top = y;

                // account for negative bars
                if (top < bottom) {
                    tmp = top;
                    top = bottom;
                    bottom = tmp;
                    drawBottom = true;
                    drawTop = false;
                }
            }

            // clip
            if (right < axisx.min || left > axisx.max ||
                top < axisy.min || bottom > axisy.max)
                return;

            if (left < axisx.min) {
                left = axisx.min;
                drawLeft = false;
            }

            if (right > axisx.max) {
                right = axisx.max;
                drawRight = false;
            }

            if (bottom < axisy.min) {
                bottom = axisy.min;
                drawBottom = false;
            }

            if (top > axisy.max) {
                top = axisy.max;
                drawTop = false;
            }

            left = axisx.p2c(left);
            bottom = axisy.p2c(bottom);
            right = axisx.p2c(right);
            top = axisy.p2c(top);

            // fill the bar
            if (fillStyleCallback) {
                c.beginPath();
                c.moveTo(left, bottom);
                c.lineTo(left, top);
                c.lineTo(right, top);
                c.lineTo(right, bottom);
                c.fillStyle = fillStyleCallback(bottom, top);
                c.fill();
            }

            // draw outline
            if (lineWidth > 0 && (drawLeft || drawRight || drawTop || drawBottom)) {
                c.beginPath();

                // FIXME: inline moveTo is buggy with excanvas
                c.moveTo(left, bottom + offset);
                if (drawLeft)
                    c.lineTo(left, top + offset);
                else
                    c.moveTo(left, top + offset);
                if (drawTop)
                    c.lineTo(right, top + offset);
                else
                    c.moveTo(right, top + offset);
                if (drawRight)
                    c.lineTo(right, bottom + offset);
                else
                    c.moveTo(right, bottom + offset);
                if (drawBottom)
                    c.lineTo(left, bottom + offset);
                else
                    c.moveTo(left, bottom + offset);
                c.stroke();
            }
        }

        function drawSeriesBars(series) {
            function plotBars(datapoints, barLeft, barRight, offset, fillStyleCallback, axisx, axisy) {
                var points = datapoints.points, ps = datapoints.pointsize;

                for (var i = 0; i < points.length; i += ps) {
                    if (points[i] == null)
                        continue;
                    drawBar(points[i], points[i + 1], points[i + 2], barLeft, barRight, offset, fillStyleCallback, axisx, axisy, ctx, series.bars.horizontal, series.bars.lineWidth);
                }
            }

            ctx.save();
            ctx.translate(plotOffset.left, plotOffset.top);

            // FIXME: figure out a way to add shadows (for instance along the right edge)
            ctx.lineWidth = series.bars.lineWidth;
            ctx.strokeStyle = series.color;
            var barLeft = series.bars.align == "left" ? 0 : -series.bars.barWidth / 2;
            var fillStyleCallback = series.bars.fill ? function (bottom, top) {
                return getFillStyle(series.bars, series.color, bottom, top);
            } : null;
            plotBars(series.datapoints, barLeft, barLeft + series.bars.barWidth, 0, fillStyleCallback, series.xaxis, series.yaxis);
            ctx.restore();
        }

        function getFillStyle(filloptions, seriesColor, bottom, top) {
            var fill = filloptions.fill;
            if (!fill)
                return null;

            if (filloptions.fillColor)
                return getColorOrGradient(filloptions.fillColor, bottom, top, seriesColor);

            var c = $.color.parse(seriesColor);
            c.a = typeof fill == "number" ? fill : 0.4;
            c.normalize();
            return c.toString();
        }

        function insertLegend() {
            placeholder.find(".legend").remove();

            if (!options.legend.show)
                return;

            var fragments = [], rowStarted = false,
                lf = options.legend.labelFormatter, s, label;
            for (var i = 0; i < series.length; ++i) {
                s = series[i];
                label = s.label;
                if (!label)
                    continue;

                if (i % options.legend.noColumns == 0) {
                    if (rowStarted)
                        fragments.push('</tr>');
                    fragments.push('<tr>');
                    rowStarted = true;
                }

                if (lf)
                    label = lf(label, s);

                fragments.push(
                    '<td class="legendColorBox"><div style="border:1px solid ' + options.legend.labelBoxBorderColor + ';padding:1px"><div style="width:4px;height:0;border:5px solid ' + s.color + ';overflow:hidden"></div></div></td>' +
                        '<td class="legendLabel">' + label + '</td>');
            }
            if (rowStarted)
                fragments.push('</tr>');

            if (fragments.length == 0)
                return;

            var table = '<table style="font-size:smaller;color:' + options.grid.color + '">' + fragments.join("") + '</table>';
            if (options.legend.container != null)
                $(options.legend.container).html(table);
            else {
                var pos = "",
                    p = options.legend.position,
                    m = options.legend.margin;
                if (m[0] == null)
                    m = [m, m];
                if (p.charAt(0) == "n")
                    pos += 'top:' + (m[1] + plotOffset.top) + 'px;';
                else if (p.charAt(0) == "s")
                    pos += 'bottom:' + (m[1] + plotOffset.bottom) + 'px;';
                if (p.charAt(1) == "e")
                    pos += 'right:' + (m[0] + plotOffset.right) + 'px;';
                else if (p.charAt(1) == "w")
                    pos += 'left:' + (m[0] + plotOffset.left) + 'px;';
                var legend = $('<div class="legend">' + table.replace('style="', 'style="position:absolute;' + pos + ';') + '</div>').appendTo(placeholder);
                if (options.legend.backgroundOpacity != 0.0) {
                    // put in the transparent background
                    // separately to avoid blended labels and
                    // label boxes
                    var c = options.legend.backgroundColor;
                    if (c == null) {
                        c = options.grid.backgroundColor;
                        if (c && typeof c == "string")
                            c = $.color.parse(c);
                        else
                            c = $.color.extract(legend, 'background-color');
                        c.a = 1;
                        c = c.toString();
                    }
                    var div = legend.children();
                    $('<div style="position:absolute;width:' + div.width() + 'px;height:' + div.height() + 'px;' + pos + 'background-color:' + c + ';"> </div>').prependTo(legend).css('opacity', options.legend.backgroundOpacity);
                }
            }
        }


        // interactive features

        var highlights = [],
            redrawTimeout = null;

        // returns the data item the mouse is over, or null if none is found
        function findNearbyItem(mouseX, mouseY, seriesFilter) {
            var maxDistance = options.grid.mouseActiveRadius,
                smallestDistance = maxDistance * maxDistance + 1,
                item = null, foundPoint = false, i, j;

            for (i = series.length - 1; i >= 0; --i) {
                if (!seriesFilter(series[i]))
                    continue;

                var s = series[i],
                    axisx = s.xaxis,
                    axisy = s.yaxis,
                    points = s.datapoints.points,
                    ps = s.datapoints.pointsize,
                    mx = axisx.c2p(mouseX), // precompute some stuff to make the loop faster
                    my = axisy.c2p(mouseY),
                    maxx = maxDistance / axisx.scale,
                    maxy = maxDistance / axisy.scale;

                // with inverse transforms, we can't use the maxx/maxy
                // optimization, sadly
                if (axisx.options.inverseTransform)
                    maxx = Number.MAX_VALUE;
                if (axisy.options.inverseTransform)
                    maxy = Number.MAX_VALUE;

                if (s.lines.show || s.points.show) {
                    for (j = 0; j < points.length; j += ps) {
                        var x = points[j], y = points[j + 1];
                        if (x == null)
                            continue;

                        // For points and lines, the cursor must be within a
                        // certain distance to the data point
                        if (x - mx > maxx || x - mx < -maxx ||
                            y - my > maxy || y - my < -maxy)
                            continue;

                        // We have to calculate distances in pixels, not in
                        // data units, because the scales of the axes may be different
                        var dx = Math.abs(axisx.p2c(x) - mouseX),
                            dy = Math.abs(axisy.p2c(y) - mouseY),
                            dist = dx * dx + dy * dy; // we save the sqrt

                        // use <= to ensure last point takes precedence
                        // (last generally means on top of)
                        if (dist < smallestDistance) {
                            smallestDistance = dist;
                            item = [i, j / ps];
                        }
                    }
                }

                if (s.bars.show && !item) { // no other point can be nearby
                    var barLeft = s.bars.align == "left" ? 0 : -s.bars.barWidth / 2,
                        barRight = barLeft + s.bars.barWidth;

                    for (j = 0; j < points.length; j += ps) {
                        var x = points[j], y = points[j + 1], b = points[j + 2];
                        if (x == null)
                            continue;

                        // for a bar graph, the cursor must be inside the bar
                        if (series[i].bars.horizontal ?
                            (mx <= Math.max(b, x) && mx >= Math.min(b, x) &&
                                my >= y + barLeft && my <= y + barRight) :
                            (mx >= x + barLeft && mx <= x + barRight &&
                                my >= Math.min(b, y) && my <= Math.max(b, y)))
                            item = [i, j / ps];
                    }
                }
            }

            if (item) {
                i = item[0];
                j = item[1];
                ps = series[i].datapoints.pointsize;

                return { datapoint: series[i].datapoints.points.slice(j * ps, (j + 1) * ps),
                    dataIndex: j,
                    series: series[i],
                    seriesIndex: i };
            }

            return null;
        }

        function onMouseMove(e) {
            if (options.grid.hoverable)
                triggerClickHoverEvent("plothover", e,
                    function (s) {
                        return s["hoverable"] != false;
                    });
        }

        function onMouseLeave(e) {
            if (options.grid.hoverable)
                triggerClickHoverEvent("plothover", e,
                    function (s) {
                        return false;
                    });
        }

        function onClick(e) {
            triggerClickHoverEvent("plotclick", e,
                function (s) {
                    return s["clickable"] != false;
                });
        }

        // trigger click or hover event (they send the same parameters
        // so we share their code)
        function triggerClickHoverEvent(eventname, event, seriesFilter) {
            var offset = eventHolder.offset(),
                canvasX = event.pageX - offset.left - plotOffset.left,
                canvasY = event.pageY - offset.top - plotOffset.top,
                pos = canvasToAxisCoords({ left: canvasX, top: canvasY });

            pos.pageX = event.pageX;
            pos.pageY = event.pageY;

            var item = findNearbyItem(canvasX, canvasY, seriesFilter);

            if (item) {
                // fill in mouse pos for any listeners out there
                item.pageX = parseInt(item.series.xaxis.p2c(item.datapoint[0]) + offset.left + plotOffset.left);
                item.pageY = parseInt(item.series.yaxis.p2c(item.datapoint[1]) + offset.top + plotOffset.top);
            }

            if (options.grid.autoHighlight) {
                // clear auto-highlights
                for (var i = 0; i < highlights.length; ++i) {
                    var h = highlights[i];
                    if (h.auto == eventname && !(item && h.series == item.series &&
                        h.point[0] == item.datapoint[0] &&
                        h.point[1] == item.datapoint[1]))
                        unhighlight(h.series, h.point);
                }

                if (item)
                    highlight(item.series, item.datapoint, eventname);
            }

            placeholder.trigger(eventname, [ pos, item ]);
        }

        function triggerRedrawOverlay() {
            var t = options.interaction.redrawOverlayInterval;
            if (t == -1) {      // skip event queue
                drawOverlay();
                return;
            }

            if (!redrawTimeout)
                redrawTimeout = setTimeout(drawOverlay, t);
        }

        function drawOverlay() {
            redrawTimeout = null;

            // draw highlights
            octx.save();
            octx.clearRect(0, 0, canvasWidth, canvasHeight);
            octx.translate(plotOffset.left, plotOffset.top);

            var i, hi;
            for (i = 0; i < highlights.length; ++i) {
                hi = highlights[i];

                if (hi.series.bars.show)
                    drawBarHighlight(hi.series, hi.point);
                else
                    drawPointHighlight(hi.series, hi.point);
            }
            octx.restore();

            executeHooks(hooks.drawOverlay, [octx]);
        }

        function highlight(s, point, auto) {
            if (typeof s == "number")
                s = series[s];

            if (typeof point == "number") {
                var ps = s.datapoints.pointsize;
                point = s.datapoints.points.slice(ps * point, ps * (point + 1));
            }

            var i = indexOfHighlight(s, point);
            if (i == -1) {
                highlights.push({ series: s, point: point, auto: auto });

                triggerRedrawOverlay();
            }
            else if (!auto)
                highlights[i].auto = false;
        }

        function unhighlight(s, point) {
            if (s == null && point == null) {
                highlights = [];
                triggerRedrawOverlay();
            }

            if (typeof s == "number")
                s = series[s];

            if (typeof point == "number")
                point = s.data[point];

            var i = indexOfHighlight(s, point);
            if (i != -1) {
                highlights.splice(i, 1);

                triggerRedrawOverlay();
            }
        }

        function indexOfHighlight(s, p) {
            for (var i = 0; i < highlights.length; ++i) {
                var h = highlights[i];
                if (h.series == s && h.point[0] == p[0]
                    && h.point[1] == p[1])
                    return i;
            }
            return -1;
        }

        function drawPointHighlight(series, point) {
            var x = point[0], y = point[1],
                axisx = series.xaxis, axisy = series.yaxis;

            if (x < axisx.min || x > axisx.max || y < axisy.min || y > axisy.max)
                return;

            var pointRadius = series.points.radius + series.points.lineWidth / 2;
            octx.lineWidth = pointRadius;
            octx.strokeStyle = $.color.parse(series.color).scale('a', 0.5).toString();
            var radius = 1.5 * pointRadius,
                x = axisx.p2c(x),
                y = axisy.p2c(y);

            octx.beginPath();
            if (series.points.symbol == "circle")
                octx.arc(x, y, radius, 0, 2 * Math.PI, false);
            else
                series.points.symbol(octx, x, y, radius, false);
            octx.closePath();
            octx.stroke();
        }

        function drawBarHighlight(series, point) {
            octx.lineWidth = series.bars.lineWidth;
            octx.strokeStyle = $.color.parse(series.color).scale('a', 0.5).toString();
            var fillStyle = $.color.parse(series.color).scale('a', 0.5).toString();
            var barLeft = series.bars.align == "left" ? 0 : -series.bars.barWidth / 2;
            drawBar(point[0], point[1], point[2] || 0, barLeft, barLeft + series.bars.barWidth,
                0, function () {
                    return fillStyle;
                }, series.xaxis, series.yaxis, octx, series.bars.horizontal, series.bars.lineWidth);
        }

        function getColorOrGradient(spec, bottom, top, defaultColor) {
            if (typeof spec == "string")
                return spec;
            else {
                // assume this is a gradient spec; IE currently only
                // supports a simple vertical gradient properly, so that's
                // what we support too
                var gradient = ctx.createLinearGradient(0, top, 0, bottom);

                for (var i = 0, l = spec.colors.length; i < l; ++i) {
                    var c = spec.colors[i];
                    if (typeof c != "string") {
                        var co = $.color.parse(defaultColor);
                        if (c.brightness != null)
                            co = co.scale('rgb', c.brightness);
                        if (c.opacity != null)
                            co.a *= c.opacity;
                        c = co.toString();
                    }
                    gradient.addColorStop(i / (l - 1), c);
                }

                return gradient;
            }
        }
    }

    $.plot = function (placeholder, data, options) {
        //var t0 = new Date();
        var plot = new Plot($(placeholder), data, options, $.plot.plugins);
        //(window.console ? console.log : alert)("time used (msecs): " + ((new Date()).getTime() - t0.getTime()));
        return plot;
    };

    $.plot.version = "0.7";

    $.plot.plugins = [];

    // returns a string with the date d formatted according to fmt
    $.plot.formatDate = function (d, fmt, monthNames) {
        var leftPad = function (n) {
            n = "" + n;
            return n.length == 1 ? "0" + n : n;
        };

        var r = [];
        var escape = false, padNext = false;
        var hours = d.getUTCHours();
        var isAM = hours < 12;
        if (monthNames == null)
            monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

        if (fmt.search(/%p|%P/) != -1) {
            if (hours > 12) {
                hours = hours - 12;
            } else if (hours == 0) {
                hours = 12;
            }
        }
        for (var i = 0; i < fmt.length; ++i) {
            var c = fmt.charAt(i);

            if (escape) {
                switch (c) {
                    case 'h':
                        c = "" + hours;
                        break;
                    case 'H':
                        c = leftPad(hours);
                        break;
                    case 'M':
                        c = leftPad(d.getUTCMinutes());
                        break;
                    case 'S':
                        c = leftPad(d.getUTCSeconds());
                        break;
                    case 'd':
                        c = "" + d.getUTCDate();
                        break;
                    case 'm':
                        c = "" + (d.getUTCMonth() + 1);
                        break;
                    case 'y':
                        c = "" + d.getUTCFullYear();
                        break;
                    case 'b':
                        c = "" + monthNames[d.getUTCMonth()];
                        break;
                    case 'p':
                        c = (isAM) ? ("" + "am") : ("" + "pm");
                        break;
                    case 'P':
                        c = (isAM) ? ("" + "AM") : ("" + "PM");
                        break;
                    case '0':
                        c = "";
                        padNext = true;
                        break;
                }
                if (c && padNext) {
                    c = leftPad(c);
                    padNext = false;
                }
                r.push(c);
                if (!padNext)
                    escape = false;
            }
            else {
                if (c == "%")
                    escape = true;
                else
                    r.push(c);
            }
        }
        return r.join("");
    };

    // round to nearby lower multiple of base
    function floorInBase(n, base) {
        return base * Math.floor(n / base);
    }

})(jQuery);
jQuery.fn.spb_graph = function (json) {
    var mainWrap = this;
    window.spb_graph = {
        //инициализация
        init: function () {
            this.mainWrap = mainWrap;
            this.json = json;

            spb_graph.objs = {};
            spb_graph.lider = spb_graph.json.lider;
            spb_graph.current = spb_graph.json.current;

            //если текущий == сравниваемому делаем сравниваемым первого из селекта
            if (spb_graph.lider == spb_graph.current)
                spb_graph.lider = spb_graph.lider = spb_graph.json.clubs[0][0];

            //ограничение минимального количества туров в сетке до 30
            spb_graph.length = spb_graph.json.data[spb_graph.current].tour_moving.length > 30 ? spb_graph.json.data[spb_graph.current].tour_moving.length : 30;

            spb_graph.colsWidth = parseInt(spb_graph.mainWrap.width() / spb_graph.length, 10);
            spb_graph.buildData();
            //инициализация графиков
            spb_graph.update(spb_graph.lider);
            //инициализация сетки
            spb_graph.draw.grid.init();
            //строим выбиралку
            spb_graph.selects();
        },

        //работаем с данными
        buildData: function () {
            for (var indexes in spb_graph.json.data)
                for (var keys in spb_graph.json.data[indexes]) {
                    //для пропущенных голов проставляем отрицательные значения
                    //чтоб опустить график ниже OX
                    if (keys == 'mpt_tour')
                        for (var item = 0; item < spb_graph.json.data[indexes][keys].length; item++)
                            spb_graph.json.data[indexes][keys][item][1] = -spb_graph.json.data[indexes][keys][item][1];
                    //дублируем данные для забитых, пропущенных, чтоб прорисовать в два графика
                    if (keys == 'mzt_mpt_tour')
                        spb_graph.json.data[indexes].mzt_mpt_tour2 = spb_graph.json.data[indexes].mzt_mpt_tour;
                }
        },

        //обновление графиков
        update: function (lider) {
            spb_graph.lider = lider;
            //удаляем старые графики и таблицы сравнения со старыми данными
            spb_graph.mainWrap.find('div.graph, div#table').remove();

            //проверяем константу максимального количества точек со сравниваемым
            if (spb_graph.json.data[lider].tour_moving.length > spb_graph.length)
                spb_graph.length = spb_graph.json.data[lider].tour_moving.length;

            //перемещение мышки
            spb_graph.mainWrap.mousemove(function (e) {
                var num = parseInt((e.clientX - spb_graph.mainWrap.offset().left) / spb_graph.colsWidth, 10);
                //избавляемся от лишних вызовов функций
                if (spb_graph.num != num /*&& !jQuery(e.target).parents('#table').length*/) {
                    spb_graph.action(num);
                    spb_graph.num = num;
                }
            });

            //клик по графикам и табличке
            spb_graph.mainWrap.click(function (e) {
                var gameID,
                //какой тур активен
                    num = parseInt((e.clientX - spb_graph.mainWrap.offset().left) / spb_graph.colsWidth, 10);

                //клик по табличке, либо по текущей табличке
                if (!jQuery(e.target).parents('#table .lider').length)
                    gameID = spb_graph.json.data[spb_graph.current].tour_label[num][5];
                //клик по табличке - лидеру
                else
                    gameID = spb_graph.json.data[spb_graph.lider].tour_label[num][5];

                //собираем урлу
                window.location.href = window.location.href.replace(/club_(.*)$/, 'game_' + gameID);
            });

            //собираем оси и параметры отображения графиков
            spb_graph.plots = spb_graph.draw.graphs();
            spb_graph.$plots = [];

            //инициализация длины канвы из рассчета количества элементов сетки * длину одного элемента сетки
            var style = '<style type="text/css">div#spb_graph, div#spb_graph div.graph, div#spb_select { width:' + spb_graph.colsWidth * spb_graph.length + 'px; }</style>';
            spb_graph.mainWrap.append(style);

            for (var graph = 0; graph < spb_graph.plots.length; graph++) {
                //если график место в туре - переворачиваем его, чтоб внизу были большие значения, вверху - меньшие
                if (spb_graph.plots[graph].name == 'tour_moving')
                    spb_graph.draw.revert(spb_graph.plots[graph].data);

                spb_graph.plots[graph].obj.addClass('graph');
                spb_graph.mainWrap.append(spb_graph.plots[graph].obj);
                //рисуем плагином из наших кастомных параметров и осей
                spb_graph.$plots.push(
                    jQuery.plot(
                        jQuery('.' + spb_graph.plots[graph].name),
                        spb_graph.plots[graph].data,
                        spb_graph.plots[graph].options
                    )
                );

                //расставляем названия осей для всех графиков кроме дублирующего забито/пропущено
                if (spb_graph.plots[graph].name != 'mzt_mpt_tour2') {
                    var labels = spb_graph.draw.labels.init(spb_graph.plots[graph].name, spb_graph.plots[graph].data);
                    for (var i = 0; i < labels.length; i++)
                        spb_graph.plots[graph].obj.append(labels[i]);
                }

                //инициализируем маркуры для графика место в туре
                if (spb_graph.plots[graph].name == 'tour_moving')
                    spb_graph.draw.markers.init(spb_graph.$plots[graph]);
            }
            spb_graph.table.init();
        },

        //события
        action: function (num) {
            if (num == undefined)
                num = spb_graph.length - 1;
            spb_graph.num = num;
            //сетка
            spb_graph.draw.grid.show(num);
            //маркеры для места в туре
            spb_graph.draw.markers.show(num);
            //табличка для забитых/пропущенных в туре
            spb_graph.table.show(num);
        },

        //рисовалка
        draw: {
            //графиков
            graphs: function () {
                var Graph = function (dataName) {

                    this.obj = jQuery('<div class="' + dataName[0] + '" />');
                    this.name = dataName[0];
                    this.data = [];

                    /*общие параметры для каждого графика*/
                    this.options = {
                        xaxis: {show: false, labelHeight: 0, labelWidth: 0, tickLength: 0, tickSize: 0},
                        yaxis: {show: false, labelHeight: 0, labelWidth: 0, tickLength: -5, autoscaleMargin: 0.25},
                        shadowSize: 0,
                        grid: {borderWidth: 0, hoverable: true, markingsLineWidth: 0, minBorderMargin: 0.5 /*для отображения нулевой оси по иксу, иначе обрезает до 1 px*/}
                    }

                    //ОХ
                    var ox = {
                        data: [
                            [0.65, 0],
                            [spb_graph.length + '.55', 0]
                        ],
                        lines: {show: true, lineWidth: 2},
                        points: {symbol: function () {
                            return;
                        }, show: false},
                        color: '#000'
                    }

                    //два графика для забитых/пропущенных
                    //для одного берем минимум, для другого максимум, т.к. плагин не позволяет
                    //красить одну линию в разные заливки
                    if (dataName[0] == 'mzt_mpt_tour')
                        this.options.yaxis.min = 0;
                    if (dataName[0] == 'mzt_mpt_tour2')
                        this.options.yaxis.max = 0;

                    for (var i = 0; i < dataName.length; i++) {

                        //с кем сравниваем
                        var lider = {
                            data: spb_graph.json.data[spb_graph.lider][dataName[i]],
                            lines: {show: true, lineWidth: 2, fill: false},
                            points: {symbol: function () {
                                return;
                            }, show: false},
                            name: dataName[i],
                            color: '#999'
                        };

                        //текущий клуб
                        var current = {
                            data: spb_graph.json.data[spb_graph.current][dataName[i]],
                            lines: {show: true, lineWidth: 2, fill: true},
                            points: {symbol: function () {
                                return;
                            }, show: false},
                            name: dataName[i]
                        };

                        //линии и заливки зеленого цвета для конкретных графиков
                        if (dataName[i] == 'mzt_tour' || dataName[i] == 'tour_moving' || dataName[i] == 'mzt_mpt_tour') {
                            current.color = 'rgb(40,143,0)';
                            dataName[i] != 'tour_moving' ?
                                current.lines.fillColor = 'rgba(126,188,102,.8)' :
                                current.lines.fill = false;
                            //красный цвет
                        } else if (dataName[i] == 'mpt_tour' || dataName[i] == 'mzt_mpt_tour2') {
                            current.color = 'rgb(237,28,36)';
                            current.lines.fillColor = 'rgba(244,119,124,.8)';
                        }
                        //собираем параметры и точки
                        this.data.push(current, lider);
                    }
                    //и склеиваем с ОХ
                    this.data.push(ox);

                    return this;
                }
                //что будем рисовать ([какие ключи брать из массива данных])
                return [
                    new Graph(['tour_moving']),
                    new Graph(['mzt_tour', 'mpt_tour']),
                    new Graph(['mzt_mpt_tour']),
                    new Graph(['mzt_mpt_tour2'])
                ];
            },

            //возвращает максимальное или минимальное значение из массива точек [[n,m],...]
            maxminValue: function (data, type) {
                var val = data[0].data[0][0];
                for (var count = 0; count < data.length; count++) {
                    if (data[count].name) {
                        var
                        //определяем какой ключ брать, если массив изменен функцией revert для места в туре [[n,m,k],...]
                            j = data[count].data[0].length > 2 ? 2 : 1,
                            len = data[count].data.length;

                        for (var i = 0; i < len; i++)
                            //что нужно вернуть, минимум или максимум
                            if (type == 'max' && data[count].data[i][j] > val || type == 'min' && data[count].data[i][j] < val)
                                val = data[count].data[i][j];
                    }
                }
                return val;
            },

            //переворачивает значения массива для графика места в туре (чтоб выводить первое место выше)
            revert: function (data) {
                for (var keys = 0; keys < data.length; keys++)
                    if (data[keys].name) {
                        if (data[keys].data[0].length > 2)
                            for (var items = 0; items < data[keys].data.length; items++)
                                data[keys].data[items].splice(1, 1);

                        for (var items = 0; items < data[keys].data.length; items++) {
                            data[keys].data[items].push(data[keys].data[items][1]);
                            data[keys].data[items][1] = spb_graph.json.clubs.length - data[keys].data[items][1];
                        }
                    }
            },

            //сетка
            grid: {
                init: function () {
                    var wrap = jQuery('<div id="grid" />');
                    for (var i = 0; i < spb_graph.length; i++) {
                        var item = jQuery('<div />');
                        var tick = jQuery('<span class="tick" />');
                        var count = i;
                        var tourCount = jQuery('<span class="tour">' + ++count + '</span>');
                        count = i + 1;

                        //проставляем классы для первого, второго и четных элементов
                        if (count == 1) {
                            item.addClass('first');
                            tourCount.html('&nbsp;1&nbsp;тур');
                        }
                        if (count == 2)
                            item.addClass('second');
                        if (count % 5 != 0 && count != 1)
                            item.addClass('hidden');
                        if (count % 2 != 0)
                            item.addClass('odd');

                        wrap.append(item.append(tick, tourCount));
                    }

                    //отступ для сетки, высчитывается от высоты всех графиков, чтоб опустить цыфры под них
                    var padding = function () {
                        var height = 0;
                        jQuery('div#spb_graph div.graph, div#spb_graph div#table').each(function (i, obj) {
                            height += parseInt(jQuery(obj).height(), 10) +
                                parseInt(jQuery(obj).css('margin-bottom'), 10) +
                                parseInt(jQuery(obj).css('margin-top'), 10) +
                                34 //padding from wrap for fix IE 8-;
                        });
                        return height + 'px';
                    }
                    var style = '<style type="text/css">div#grid div { padding-bottom:' + padding() + '; width:' + spb_graph.colsWidth + 'px; }\ndiv#spb_graph div.markerWrap div { width:' + spb_graph.colsWidth + 'px; }</style>';
                    spb_graph.mainWrap.append(wrap).prepend(style);
                    //складываем элементы сетки в объект, чтоб быстрей до них добраться
                    spb_graph.objs.grid = spb_graph.mainWrap.find('#grid');
                    spb_graph.action();
                },

                show: function (num) {
                    spb_graph.objs.grid.find('.active').removeClass('active').end().find('div:eq(' + num + ')').addClass('active');
                }
            },

            //маркеры со значением места для графика место в туре
            markers: {
                init: function (plot) {
                    //точки из графика
                    var points = plot.getData();
                    //canvas графика
                    var placeholder = plot.getPlaceholder();

                    for (var i = 0; i < points.length; i++) {
                        if (points[i].name) {
                            var wrap = jQuery('<div class="markerWrap" />');
                            var count = 0;

                            for (var j = 0; j < points[i].data.length; j++, count++) {
                                var marker = jQuery('<div>' + Math.abs(points[i].data[j][2]) + '</div>');
                                marker.css({
                                    'background-color': points[i].color,
                                    'top': parseInt(points[i].yaxis.p2c(points[i].data[j][1]) - 6, 10),
                                    'left': spb_graph.colsWidth * j - 1	//points[i].xaxis.p2c(points[i].data[j][0]) - Math.floor(spb_graph.colsWidth/2)
                                });

                                wrap.append(marker);
                            }
                            placeholder.prepend(wrap);
                        }
                    }
                    spb_graph.objs.markers = spb_graph.mainWrap.find('div.markerWrap');

                    //разводим маркеры, если накладываются
                    count = spb_graph.objs.markers;
                    var markers = [];
                    markers[1] = spb_graph.objs.markers.eq(0).find('div');
                    markers[2] = spb_graph.objs.markers.eq(1).find('div');
                    markers[2].each(function (i, obj) {
                        var marker1 = obj = jQuery(obj);
                        var marker2 = jQuery(markers[1][i]);
                        marker1.top = parseInt(marker1.css('top'), 10);
                        marker2.top = parseInt(marker2.css('top'), 10);
                        //зеленый выше серого - зеленый поднимаем выше, серый опускаем
                        if (marker1.top < marker2.top && marker2.top - marker1.top < 11) {
                            marker1.css('top', marker1.top - 2);
                            marker2.css('top', marker1.top + 9);
                        }
                        //серый выше зеленого - серый поднимаем выше, зеленый опускаем
                        else if (marker2.top < marker1.top && marker1.top - marker2.top < 11) {
                            marker1.css('top', marker2.top + 9);
                            marker2.css('top', marker2.top - 2);
                        }

                    });
                },

                show: function (num) {
                    spb_graph.objs.markers.find('.active').removeClass('active');
                    spb_graph.objs.markers.eq(0).find('div:eq(' + num + ')').add(spb_graph.objs.markers.eq(1).find('div:eq(' + num + ')')).addClass('active');
                }
            },

            //названия осей Y
            labels: {
                init: function (name, data) {
                    var names = {
                        //names				top					bottom
                        'tour_moving': ['1 место в туре', spb_graph.json.clubs.length], //максимальное место = количество команд
                        'mzt_tour': ['Забито', 'Пропущено'],
                        'mzt_mpt_tour': ['Разница мячей', '']
                    };

                    if (names[name] == undefined)
                        return;

                    var label = [];
                    for (var i = 0; i < 2; i++) {
                        label[i] = '<div class="label_' + i + '">' + names[name][i] + '</div>';
                    }

                    return [label[0], label[1]];
                }
            }
        },

        //таблица забитых/пропущенных
        table: {
            init: function () {
                var wrap = jQuery('<div id="table" />');
                var text = '', type, current, wrapClass, name = [];
                var color = [];

                //если туры сравниваемого больше текущего - берем его
                var data = spb_graph.json.data[spb_graph.current].tour_label.length > spb_graph.json.data[spb_graph.lider].tour_label.length ?
                    spb_graph.json.data[spb_graph.current].tour_label :
                    spb_graph.json.data[spb_graph.lider].tour_label;

                for (var keys = 0; keys < data.length; keys++) {
                    text += '<div class="wrap">';
                    for (var i = 0; i < 2; i++) {

                        //таблица для текущего клуба
                        if (i == 0) {
                            current = spb_graph.current;
                            type = spb_graph.json.data[current].tour_label;
                            wrapClass = 'current';
                            //для сравниваемого
                        } else {
                            current = spb_graph.lider;
                            type = spb_graph.json.data[current].tour_label;
                            wrapClass = 'lider';
                        }
                        color = ['', ''];

                        //режем имена клубов на 10 символов, чтоб влезали в таблицу по ширине
                        if (type[keys]) {
                            if (spb_graph.json.data[type[keys][0]].name.length > 10)
                                name[0] = spb_graph.json.data[type[keys][0]].name.slice(0, 10) + '...';
                            else
                                name[0] = spb_graph.json.data[type[keys][0]].name;

                            if (spb_graph.json.data[current].name.length > 10)
                                name[1] = spb_graph.json.data[current].name.slice(0, 10) + '...';
                            else
                                name[1] = spb_graph.json.data[current].name;
                        }

                        //если не в гостсях
                        if (type[keys] && type[keys][3] != 1) {
                            if (type[keys][1] > type[keys][2])
                                color = ['green', 'red'];
                            else if (type[keys][1] < type[keys][2])
                                color = ['red', 'green'];
                            text += '<div class="' + wrapClass + '">';
                            text += '<span class="' + color[0] + '" style="text-align:right;">' + name[0] + '</span>';
                            text += '<span class="count">' + type[keys][1] + ':' + type[keys][2] + '</span>';
                            text += '<span class="' + color[1] + '" style="text-align:left;">' + name[1] + '</span>';
                            text += '</div>';
                            //если в гостях
                        } else if (type[keys]) {
                            if (type[keys][1] > type[keys][2])
                                color = ['green', 'red'];
                            else if (type[keys][1] < type[keys][2])
                                color = ['red', 'green'];
                            text += '<div class="' + wrapClass + '">';
                            text += '<span class="' + color[0] + '" style="text-align:right;">' + name[1] + '</span>';
                            text += '<span class="count">' + type[keys][1] + ':' + type[keys][2] + '</span>';
                            text += '<span class="' + color[1] + '" style="text-align:left;">' + name[0] + '</span>';
                            text += '</div>';
                        } else {
                            text += '<div class="' + wrapClass + '">';
                            text += '<span style="text-align:right;">&mdash;</span>';
                            text += '<span class="count">&nbsp;</span>';
                            text += '<span style="text-align:left;">&mdash;</span>';
                            text += '</div>';
                        }
                    }
                    text += '</div>';
                }
                wrap.append(text).insertBefore(spb_graph.mainWrap.find('div.mzt_mpt_tour'));

                //рассчитываем координаты таблицы
                var rightLimit = spb_graph.mainWrap.width() - wrap.find('div.wrap:eq(0)').width() - 2;
                wrap.find('div.wrap').each(function (i, obj) {
                    obj = jQuery(obj);
                    var left = spb_graph.colsWidth * i - parseInt(obj.width() / 2, 10) + 6; // 6 = padding for canvas
                    if (left < 0)
                        left = 0;
                    else if (left > rightLimit)
                        left = rightLimit;
                    obj.css('left', left);
                });

                spb_graph.objs.tables = wrap;
            },

            show: function (num) {
                spb_graph.objs.tables.find('div.wrap').hide().eq(num).show();
            }
        },

        //переключалка сравниваемых клубов
        selects: function () {
            var
                wrap = jQuery('<div id="spb_select" />'),
                selectWrap = jQuery('<div class="selectWrap" />'),
                select = jQuery('<select id="select" />'),
                label = '<label for="select">Сравнение с:</label>',
                img = '<span></span>';

            wrap.append('<div class="title">Движение по турам</div>');
            for (var keys = 0; keys < spb_graph.json.clubs.length; keys++)
                if (spb_graph.json.clubs[keys][0] != spb_graph.json.current)
                    select.append('<option value="' + spb_graph.json.clubs[keys][0] + '"' + (spb_graph.lider == spb_graph.json.clubs[keys][0] ? 'selected="selected"' : '') + '>' + spb_graph.json.clubs[keys][1] + '</option>');

            select.change(function () {
                spb_graph.update(jQuery(this).val());
                spb_graph.action();
            });

            wrap.append(selectWrap.append(img, label, select)).insertBefore(spb_graph.mainWrap);
        }
    }
    //инициализация всего
    spb_graph.init();
}
/* NEW STATS GRAPHS */
$.fn.new_stats_graph = function (data) {
    var obj = {
        placeholder: this,
        name: this.attr('data-name'),
        type: this.attr('data-type')
    };

    this.create = {
        pie: function () {
            var
                presetColors = {
                    'В': '#4ea12e',
                    'Н': '#666',
                    'П': '#ed1c24'
                },

                colors = [],

                labelFormatter = function (label, series) {
                    return "<div style='font-size:11px; text-align:center; padding:2px; color:white;'>" + label + ' (' + series.data[0][1] + ')' + "</div>";
                },

                settings = {
                    series: {
                        pie: {
                            show: true,
                            radius: 1,
                            label: {
                                show: true,
                                radius: 1 / 2,
                                formatter: labelFormatter,
                                background: {opacity: 0}
                            }
                        }
                    },
                    legend: {show: false}
                };
            for (var i = 0; i < data.length; i++)
                colors.push(presetColors[data[i].label]);

            settings.colors = colors;

            $.plot(obj.placeholder, data, settings);
        },
        lines: function () {
            var settings = {
                series: {
                    lines: {
                        lineWidth: 2
                    },
                    shadowSize: 0
                },
                xaxis: {
                    tickSize: 1,
                    autoscaleMargin: 0,
                    max: (function () {
                        var max = 0;
                        for (var i = 0; i < data.length; i++) {
                            if (data[i].data.length > max)
                                max = data[i].data.length;
                        }
                        return max;
                    })()
                },
                yaxis: {
                    tickSize: 1,
                    autoscaleMargin: 0,
                    tickFormatter: function (n) {
                        if (n == 0) return '';
                        else return n;
                    }
                },
                grid: {
                    borderWidth: 1,
                    borderColor: {top: '#ccc', right: '#ccc', bottom: '#4ea12e', left: '#ccc'}
                },
                colors: [
                    '#fff',
                    '#ed1c24',
                    '#4ea12e'
                ]
            };

            data.unshift({data: [
                [0, 0]
            ]});

            $.plot(obj.placeholder, data, settings);
        },
        bars: function () {
            var
                arrs = arrsData(),
                max = maxInArr(),

                wrap = $('<div />').addClass('bars'),
                out = '',
                lengthData = arrs.length - 1,
                lengthCols = arrs[0].length - 1;

            for (var item = 0; item < arrs[0].length; item++)
                for (var col = 0; col < arrs.length; col++) {
                    var
                        text = arrs[col][item],
                        height = Math.floor(text / max * 100),
                        last = col == lengthData && item == lengthCols ? ' last' : '';

                    height = height <= 0 ? 1 : height;
                    out += '<div class="bar_' + col + last + '" style="height:' + height + 'px;"><span>' + text + '</span></div>';
                }

            function arrsData() {
                var outArr = [];
                for (var i = 0; i < data.length; i++)
                    outArr.push(data[i].data);
                return outArr;
            }

            function maxInArr() {
                var max = 0;

                for (var arr = 0; arr < arrs.length; arr++)
                    for (var item = 0; item < arrs[arr].length; item++)
                        max = arrs[arr][item] > max ? arrs[arr][item] : max;

                return max;
            }

            obj.placeholder.append(wrap.html(out));
        }
    }
    if (obj.type)
        this.create[obj.type]();
    else
        console.log('Graph create error: el $(\'' + this.selector + '\') not found in the DOM');
};
/* /NEW STATS GRAPHS */
$(document).ready(function () {
    var moreRowTableTournament = $('.more-btn-tournir-table-js');
    var moreRowTable = $('.more-btn-table-js');

    moreRowTableTournament.on('click', function (event) {
        var elem = $(this);
        var tournamentTable = elem.parent();
        var tournamentTableRow = tournamentTable.find('.b-tournaments-table__row');
        event.preventDefault();

        tournamentTableRow.removeClass('b-tournaments-table__row_hidden');
        elem.remove();
    });


    moreRowTable.on('click', function (event) {
        var elem = $(this);
        var tournamentTable = elem.parent();
        var tournamentTableRow = tournamentTable.find('table tr');
        event.preventDefault();

        tournamentTableRow.removeClass('hidden');
        elem.remove();
    });
});


var spb_scripts = spb_scripts || {};

$(document).ready(function () {
    var dataChooiser = $('.data-chooiser-js');
    var dataChooiserItem = dataChooiser.find('a');

    dataChooiserItem.on('click', function (event) {
        var elem = $(this);
        var index = elem.parent().parent().find('>*').index(elem.parent());
        var dataTd = $('.choose-table-js').find('.choose-data-js');
        var choosenData = elem.attr('id').replace('data-', '');

        event.preventDefault();

        dataChooiser.find('a').removeClass('selected');
        dataChooiser.find('>*:eq(' + index + ') a').addClass('selected');

        $.each(dataTd, function () {
            var td = $(this);
            var html = td.data(choosenData);

            if (td.find('a').length !== 0) {
                td.find('a').html(html);
            } else {
                td.html(html);
            }
        });
    });


    var teamsTable = $('.tournaments-teams-js');
    var gamesTable = $('.tournaments-games-js');

    if ((teamsTable.length !== 0) && (gamesTable.length !== 0)) {
        var game = gamesTable.find('[data-team1], [data-team2]');
        var team = teamsTable.find('tr');

        game.on({
            'mouseover': function () {
                var elem = $(this);
                var team1 = elem.data('team1');
                var team2 = elem.data('team2');

                $.each(team, function () {
                    var row = $(this);

                    if ((row.data('team') === team1) || (row.data('team') === team2)) {
                        row.addClass('hover');
                    }
                });
            },
            'mouseout': function () {
                team.removeClass('hover');
            }
        });

        team.on({
            'mouseover': function () {
                var elem = $(this);
                var team = elem.data('team');

                $.each(game, function () {
                    var row = $(this);

                    if ((row.data('team1') === team) || (row.data('team2') === team)) {
                        row.addClass('hover');
                    }
                });
            },
            'mouseout': function () {
                game.removeClass('hover');
            }
        });
    }

    /* Обратный отсчет лайва (start) */
    var counter = $('.live-counter-js');

    if (counter.length > 0) {
        var count = 60;
        var liveCounterTimer = null;

        counter.on('click', function () {
            location.reload();
        });

        spb_scripts.livePageReloadTimer = function () {
            count = count - 1;
            if (count <= 0) {
                clearInterval(liveCounterTimer);
                location.reload();
            } else {
                counter.text(count);
            }
        };

        liveCounterTimer = setInterval(spb_scripts.livePageReloadTimer, 1000);
    }
    /* Обратный отсчет лайва (end) */


    /* Движение между турами (start) */
    var pairBlock = $('.pair-js');
    var prevNextTour = $('.prev-tour-js, .next-tour-js');
    var prevElem = undefined;
    var touchStartPos = 0;

    function checkExistsFinalAndThirdPlaceMatchForPrevTour(prevTour, team0id, team1id, team2id, team3id) {
        var prevPrevTour = prevTour.prev('.tour-js');
        if (prevPrevTour.length !== 0) {
            var prevTeam0 = prevTour.find('div[data-team="' + team0id + '"]').length;
            var prevTeam1 = prevTour.find('div[data-team="' + team1id + '"]').length;
            var prevTeam2 = prevTour.find('div[data-team="' + team2id + '"]').length;
            var prevTeam3 = prevTour.find('div[data-team="' + team3id + '"]').length;

            var prevPrevTeam0 = prevPrevTour.find('div[data-team="' + team0id + '"]').length;
            var prevPrevTeam1 = prevPrevTour.find('div[data-team="' + team1id + '"]').length;
            var prevPrevTeam2 = prevPrevTour.find('div[data-team="' + team2id + '"]').length;
            var prevPrevTeam3 = prevPrevTour.find('div[data-team="' + team3id + '"]').length;

            var count_prev_teams = (prevTeam0 + prevTeam1 + prevTeam2 + prevTeam3);
            var count_prev_prev_teams = (prevPrevTeam0 + prevPrevTeam1 + prevPrevTeam2 + prevPrevTeam3);

            if (count_prev_teams == 2 && count_prev_prev_teams == 2) {
                if (
                    (prevTeam0 != prevPrevTeam0) &&
                        (prevTeam1 != prevPrevTeam1) &&
                        (prevTeam2 != prevPrevTeam2) &&
                        (prevTeam3 != prevPrevTeam3)
                    ) {
                    return true;
                }
            }
        }
        return false;
    }

    function checkExistsFinalAndThirdPlaceMatchForNextTour(nextTour, team0id, team1id, team2id, team3id) {
        if (team2id != 0) {
            return false;
        }
        if (team3id != 0) {
            return false;
        }

        var nextNextTour = nextTour.next('.tour-js');
        var nextTeam0 = nextTour.find('div[data-team="' + team0id + '"]').length;
        var nextTeam1 = nextTour.find('div[data-team="' + team1id + '"]').length;

        var nextNextTeam0 = nextNextTour.find('div[data-team="' + team0id + '"]').length;
        var nextNextTeam1 = nextNextTour.find('div[data-team="' + team1id + '"]').length;

        if (nextTeam0 == 0 && nextTeam1 == 0 && nextNextTeam0 == 1 && nextNextTeam1 == 1) {
            return true;
        }
        return false;
    }

    function mouseover(elem) {
        var team0id = elem.find('.b-tournament__pairborders').eq(0).data('team0');
        var team1id = elem.find('.b-tournament__pairborders').eq(0).data('team1');
        var team2id = elem.find('.b-tournament__pairborders').eq(0).data('team2');
        var team3id = elem.find('.b-tournament__pairborders').eq(0).data('team3');
        var tour = elem.closest('.tour-js');
        var nextTour = tour.next('.tour-js');
        var prevTour = tour.prev('.tour-js');

        // не показываем кнопку если нет следующего/предыдущего тура
        if (
            (prevTour.find('div[data-team="' + team0id + '"]').length !== 0) ||
                (prevTour.find('div[data-team="' + team1id + '"]').length !== 0) ||
                (prevTour.find('div[data-team="' + team2id + '"]').length !== 0) ||
                (prevTour.find('div[data-team="' + team3id + '"]').length !== 0)
            ) {
            elem.find('.prev-tour-js').css('display', 'block');
        }

        if (nextTour.length !== 0) {
            elem.find('.next-tour-js').css('display', 'block');
        }

        $('.b-onlines-box__item').removeClass('b-onlines-box__item_type_hover');
        elem.find('.b-onlines-box__item').addClass('b-onlines-box__item_type_hover');

        nextTour.find('div[data-team="' + team0id + '"]').parents('.b-onlines-box__item').addClass('b-onlines-box__item_type_hover');
        nextTour.find('div[data-team="' + team1id + '"]').parents('.b-onlines-box__item').addClass('b-onlines-box__item_type_hover');
        nextTour.find('div[data-team="' + team2id + '"]').parents('.b-onlines-box__item').addClass('b-onlines-box__item_type_hover');
        nextTour.find('div[data-team="' + team3id + '"]').parents('.b-onlines-box__item').addClass('b-onlines-box__item_type_hover');

        if (checkExistsFinalAndThirdPlaceMatchForNextTour(nextTour, team0id, team1id, team2id, team3id)) {
            var nextNextTour = nextTour.next('.tour-js');
            nextNextTour.find('div[data-team="' + team0id + '"]').parents('.b-onlines-box__item').addClass('b-onlines-box__item_type_hover');
            nextNextTour.find('div[data-team="' + team1id + '"]').parents('.b-onlines-box__item').addClass('b-onlines-box__item_type_hover');
            nextNextTour.find('div[data-team="' + team2id + '"]').parents('.b-onlines-box__item').addClass('b-onlines-box__item_type_hover');
            nextNextTour.find('div[data-team="' + team3id + '"]').parents('.b-onlines-box__item').addClass('b-onlines-box__item_type_hover');
        }
        prevTour.find('div[data-team="' + team0id + '"]').parents('.b-onlines-box__item').addClass('b-onlines-box__item_type_hover');
        prevTour.find('div[data-team="' + team1id + '"]').parents('.b-onlines-box__item').addClass('b-onlines-box__item_type_hover');
        prevTour.find('div[data-team="' + team2id + '"]').parents('.b-onlines-box__item').addClass('b-onlines-box__item_type_hover');
        prevTour.find('div[data-team="' + team3id + '"]').parents('.b-onlines-box__item').addClass('b-onlines-box__item_type_hover');

        // Для случаев когда есть Финал и Матч за 3 место
        if (checkExistsFinalAndThirdPlaceMatchForPrevTour(prevTour, team0id, team1id, team2id, team3id)) {
            var prevPrevTour = prevTour.prev('.tour-js');
            prevPrevTour.find('div[data-team="' + team0id + '"]').parents('.b-onlines-box__item').addClass('b-onlines-box__item_type_hover');
            prevPrevTour.find('div[data-team="' + team1id + '"]').parents('.b-onlines-box__item').addClass('b-onlines-box__item_type_hover');
            prevPrevTour.find('div[data-team="' + team2id + '"]').parents('.b-onlines-box__item').addClass('b-onlines-box__item_type_hover');
            prevPrevTour.find('div[data-team="' + team3id + '"]').parents('.b-onlines-box__item').addClass('b-onlines-box__item_type_hover');
        }
    }

    function mouseout(elem) {
        elem.parent().find('.prev-tour-js').css('display', 'none');
        elem.parent().find('.next-tour-js').css('display', 'none');

        $('.b-onlines-box__item').removeClass('b-onlines-box__item_type_hover');
    }

    pairBlock.on({
        'mouseover': function () {
            var elem = $(this);
            mouseover(elem);
        },
        'mouseout': function () {
            var elem = $(this);
            mouseout(elem);
        },
        'touchstart': function () {
            touchStartPos = $(window).scrollTop();
        },
        'touchend': function (e) {
            var elem = $(this);

            var swipe_distance = touchStartPos - $(window).scrollTop();
            if (swipe_distance > 5 || swipe_distance < -5) {
                // Это свайп
                mouseout(elem)
                return false;
            }

            if (prevElem) {
                if (elem.data('taped') == 1) {
                    return true;
                }
                mouseout(prevElem);
                prevElem.data('taped', 0);
            }

            mouseover(elem);

            elem.data('taped', 1);
            prevElem = elem;
            e.preventDefault();
            return false;
        }
    });

    prevNextTour.on('click touchend', function () {
        var elem = $(this);
        var btnType = elem.attr('class').match('next') !== null ? 'next' : 'prev';
        var tour = elem.closest('.tour-js');
        var nextTour = tour.next('.tour-js');
        var prevTour = tour.prev('.tour-js');
        var team0id = elem.parent().find('.b-tournament__pairborders').eq(0).data('team0');
        var team1id = elem.parent().find('.b-tournament__pairborders').eq(0).data('team1');
        var team2id = elem.parent().find('.b-tournament__pairborders').eq(0).data('team2');
        var team3id = elem.parent().find('.b-tournament__pairborders').eq(0).data('team3');
        var nextPair;
        var prevPair;

        //$('.b-onlines-box__item').removeClass('b-onlines-box__item_type_checked').parents('.b-tournament__pairborders').removeClass('b-tournament__pairborders_type_blinked');
        $('.b-onlines-box__item').parents('.b-tournament__pairborders').removeClass('b-tournament__pairborders_type_blinked');

        if (nextTour.find('div[data-team="' + team0id + '"]').length !== 0) {
            nextPair = nextTour.find('div[data-team="' + team0id + '"]');
        } else if (nextTour.find('div[data-team="' + team1id + '"]').length !== 0) {
            nextPair = nextTour.find('div[data-team="' + team1id + '"]');
        } else if (nextTour.find('div[data-team="' + team2id + '"]').length !== 0) {
            nextPair = nextTour.find('div[data-team="' + team2id + '"]');
        } else if (nextTour.find('div[data-team="' + team3id + '"]').length !== 0) {
            nextPair = nextTour.find('div[data-team="' + team3id + '"]');
        }

        if (prevTour.find('div[data-team="' + team0id + '"]').length !== 0) {
            prevPair = prevTour.find('div[data-team="' + team0id + '"]');
        } else if (prevTour.find('div[data-team="' + team1id + '"]').length !== 0) {
            prevPair = prevTour.find('div[data-team="' + team1id + '"]');
        } else if (prevTour.find('div[data-team="' + team2id + '"]').length !== 0) {
            prevPair = prevTour.find('div[data-team="' + team2id + '"]');
        } else if (prevTour.find('div[data-team="' + team3id + '"]').length !== 0) {
            prevPair = prevTour.find('div[data-team="' + team3id + '"]');
        }

        var scroll_top = 0;
        if (btnType === 'next') {
            if (nextPair === undefined) {
                if (checkExistsFinalAndThirdPlaceMatchForNextTour(nextTour, team0id, team1id, team2id, team3id)) {
                    var nextNextTour = nextTour.next('.tour-js');
                    scroll_top = nextNextTour.find('div[data-team="' + team0id + '"]').eq(0).offset().top - 25;
                    nextNextTour.find('div[data-team="' + team0id + '"]').parents('.b-tournament__pairborders').eq(0).addClass('b-tournament__pairborders_type_blinked');
                    nextNextTour.find('div[data-team="' + team1id + '"]').parents('.b-tournament__pairborders').eq(0).addClass('b-tournament__pairborders_type_blinked');
                    nextNextTour.find('div[data-team="' + team2id + '"]').parents('.b-tournament__pairborders').eq(0).addClass('b-tournament__pairborders_type_blinked');
                    nextNextTour.find('div[data-team="' + team3id + '"]').parents('.b-tournament__pairborders').eq(0).addClass('b-tournament__pairborders_type_blinked');
                }
            } else if (nextPair.length !== 0) {
                scroll_top = nextPair.parents('.b-onlines-box__item').eq(0).offset().top - 25;
                nextTour.find('div[data-team="' + team0id + '"]').parents('.b-tournament__pairborders').eq(0).addClass('b-tournament__pairborders_type_blinked');
                nextTour.find('div[data-team="' + team1id + '"]').parents('.b-tournament__pairborders').eq(0).addClass('b-tournament__pairborders_type_blinked');
                nextTour.find('div[data-team="' + team2id + '"]').parents('.b-tournament__pairborders').eq(0).addClass('b-tournament__pairborders_type_blinked');
                nextTour.find('div[data-team="' + team3id + '"]').parents('.b-tournament__pairborders').eq(0).addClass('b-tournament__pairborders_type_blinked');
            }
        } else {
            if (prevPair.length !== 0) {
                scroll_top = prevPair.parents('.b-onlines-box__item').eq(0).offset().top - 25;
                if (checkExistsFinalAndThirdPlaceMatchForPrevTour(prevTour, team0id, team1id, team2id, team3id)) {
                    var prevPrevTour = prevTour.prev('.tour-js');
                    scroll_top = prevPrevTour.find('.b-onlines-box__item').eq(0).offset().top - 25;

                    prevPrevTour.find('div[data-team="' + team0id + '"]').parents('.b-tournament__pairborders').eq(0).addClass('b-tournament__pairborders_type_blinked');
                    prevPrevTour.find('div[data-team="' + team1id + '"]').parents('.b-tournament__pairborders').eq(0).addClass('b-tournament__pairborders_type_blinked');
                    prevPrevTour.find('div[data-team="' + team2id + '"]').parents('.b-tournament__pairborders').eq(0).addClass('b-tournament__pairborders_type_blinked');
                    prevPrevTour.find('div[data-team="' + team3id + '"]').parents('.b-tournament__pairborders').eq(0).addClass('b-tournament__pairborders_type_blinked');
                }

                prevTour.find('div[data-team="' + team0id + '"]').parents('.b-tournament__pairborders').eq(0).addClass('b-tournament__pairborders_type_blinked');
                prevTour.find('div[data-team="' + team1id + '"]').parents('.b-tournament__pairborders').eq(0).addClass('b-tournament__pairborders_type_blinked');
                prevTour.find('div[data-team="' + team2id + '"]').parents('.b-tournament__pairborders').eq(0).addClass('b-tournament__pairborders_type_blinked');
                prevTour.find('div[data-team="' + team3id + '"]').parents('.b-tournament__pairborders').eq(0).addClass('b-tournament__pairborders_type_blinked');
            }
        }
        /* Чтобы страница всегда скролилась
         var onScreen = prevPair.isOnScreen();
         if (!onScreen) {
         */
        $('html, body').animate({
            scrollTop: scroll_top
        }, 200);
        //} */

        /*
         nextTour.find('div[data-team="'+team0id+'"]').parents('.b-onlines-box__item').eq(0).addClass('b-onlines-box__item_type_checked');
         nextTour.find('div[data-team="'+team1id+'"]').parents('.b-onlines-box__item').eq(0).addClass('b-onlines-box__item_type_checked');
         nextTour.find('div[data-team="'+team2id+'"]').parents('.b-onlines-box__item').eq(0).addClass('b-onlines-box__item_type_checked');
         nextTour.find('div[data-team="'+team3id+'"]').parents('.b-onlines-box__item').eq(0).addClass('b-onlines-box__item_type_checked');
         prevTour.find('div[data-team="'+team0id+'"]').parents('.b-onlines-box__item').eq(0).addClass('b-onlines-box__item_type_checked');
         prevTour.find('div[data-team="'+team1id+'"]').parents('.b-onlines-box__item').eq(0).addClass('b-onlines-box__item_type_checked');
         prevTour.find('div[data-team="'+team2id+'"]').parents('.b-onlines-box__item').eq(0).addClass('b-onlines-box__item_type_checked');
         prevTour.find('div[data-team="'+team3id+'"]').parents('.b-onlines-box__item').eq(0).addClass('b-onlines-box__item_type_checked');

         elem.parent().find('.b-onlines-box__item').addClass('b-onlines-box__item_type_checked');
         */
    });
    /* Движение между турами (end) */
});

$.fn.isOnScreen = function () {
    var win = $(window);
    var bounds = this.offset();
    var viewport = {
        top: win.scrollTop(),
        left: win.scrollLeft()
    };

    viewport.right = viewport.left + win.width();
    viewport.bottom = viewport.top + win.height();

    bounds.right = bounds.left + this.outerWidth();
    bounds.bottom = bounds.top + this.outerHeight();

    return (!(viewport.right < bounds.left || viewport.left > bounds.right || viewport.bottom < bounds.top || viewport.top > bounds.bottom));

};
(function ($) {

    // Maximum redraw attempts when fitting labels within the plot

    var REDRAW_ATTEMPTS = 10;

    // Factor by which to shrink the pie when fitting labels within the plot

    var REDRAW_SHRINK = 0.95;

    function init(plot) {

        var canvas = null,
            target = null,
            options = null,
            maxRadius = null,
            centerLeft = null,
            centerTop = null,
            processed = false,
            ctx = null;

        // interactive variables

        var highlights = [];

        // add hook to determine if pie plugin in enabled, and then perform necessary operations

        plot.hooks.processOptions.push(function (plot, options) {
            if (options.series.pie.show) {

                options.grid.show = false;

                // set labels.show

                if (options.series.pie.label.show == "auto") {
                    if (options.legend.show) {
                        options.series.pie.label.show = false;
                    } else {
                        options.series.pie.label.show = true;
                    }
                }

                // set radius

                if (options.series.pie.radius == "auto") {
                    if (options.series.pie.label.show) {
                        options.series.pie.radius = 3 / 4;
                    } else {
                        options.series.pie.radius = 1;
                    }
                }

                // ensure sane tilt

                if (options.series.pie.tilt > 1) {
                    options.series.pie.tilt = 1;
                } else if (options.series.pie.tilt < 0) {
                    options.series.pie.tilt = 0;
                }
            }
        });

        plot.hooks.bindEvents.push(function (plot, eventHolder) {
            var options = plot.getOptions();
            if (options.series.pie.show) {
                if (options.grid.hoverable) {
                    eventHolder.unbind("mousemove").mousemove(onMouseMove);
                }
                if (options.grid.clickable) {
                    eventHolder.unbind("click").click(onClick);
                }
            }
        });

        plot.hooks.processDatapoints.push(function (plot, series, data, datapoints) {
            var options = plot.getOptions();
            if (options.series.pie.show) {
                processDatapoints(plot, series, data, datapoints);
            }
        });

        plot.hooks.drawOverlay.push(function (plot, octx) {
            var options = plot.getOptions();
            if (options.series.pie.show) {
                drawOverlay(plot, octx);
            }
        });

        plot.hooks.draw.push(function (plot, newCtx) {
            var options = plot.getOptions();
            if (options.series.pie.show) {
                draw(plot, newCtx);
            }
        });

        function processDatapoints(plot, series, datapoints) {
            if (!processed) {
                processed = true;
                canvas = plot.getCanvas();
                target = $(canvas).parent();
                options = plot.getOptions();
                plot.setData(combine(plot.getData()));
            }
        }

        function combine(data) {

            var total = 0,
                combined = 0,
                numCombined = 0,
                color = options.series.pie.combine.color,
                newdata = [];

            // Fix up the raw data from Flot, ensuring the data is numeric

            for (var i = 0; i < data.length; ++i) {

                var value = data[i].data;

                // If the data is an array, we'll assume that it's a standard
                // Flot x-y pair, and are concerned only with the second value.

                // Note how we use the original array, rather than creating a
                // new one; this is more efficient and preserves any extra data
                // that the user may have stored in higher indexes.

                if ($.isArray(value) && value.length == 1) {
                    value = value[0];
                }

                if ($.isArray(value)) {
                    // Equivalent to $.isNumeric() but compatible with jQuery < 1.7
                    if (!isNaN(parseFloat(value[1])) && isFinite(value[1])) {
                        value[1] = +value[1];
                    } else {
                        value[1] = 0;
                    }
                } else if (!isNaN(parseFloat(value)) && isFinite(value)) {
                    value = [1, +value];
                } else {
                    value = [1, 0];
                }

                data[i].data = [value];
            }

            // Sum up all the slices, so we can calculate percentages for each

            for (var i = 0; i < data.length; ++i) {
                total += data[i].data[0][1];
            }

            // Count the number of slices with percentages below the combine
            // threshold; if it turns out to be just one, we won't combine.

            for (var i = 0; i < data.length; ++i) {
                var value = data[i].data[0][1];
                if (value / total <= options.series.pie.combine.threshold) {
                    combined += value;
                    numCombined++;
                    if (!color) {
                        color = data[i].color;
                    }
                }
            }

            for (var i = 0; i < data.length; ++i) {
                var value = data[i].data[0][1];
                if (numCombined < 2 || value / total > options.series.pie.combine.threshold) {
                    newdata.push({
                        data: [
                            [1, value]
                        ],
                        color: data[i].color,
                        label: data[i].label,
                        angle: value * Math.PI * 2 / total,
                        percent: value / (total / 100)
                    });
                }
            }

            if (numCombined > 1) {
                newdata.push({
                    data: [
                        [1, combined]
                    ],
                    color: color,
                    label: options.series.pie.combine.label,
                    angle: combined * Math.PI * 2 / total,
                    percent: combined / (total / 100)
                });
            }

            return newdata;
        }

        function draw(plot, newCtx) {

            if (!target) {
                return; // if no series were passed
            }

            var canvasWidth = plot.getPlaceholder().width(),
                canvasHeight = plot.getPlaceholder().height(),
                legendWidth = target.children().filter(".legend").children().width() || 0;

            ctx = newCtx;

            // WARNING: HACK! REWRITE THIS CODE AS SOON AS POSSIBLE!

            // When combining smaller slices into an 'other' slice, we need to
            // add a new series.  Since Flot gives plugins no way to modify the
            // list of series, the pie plugin uses a hack where the first call
            // to processDatapoints results in a call to setData with the new
            // list of series, then subsequent processDatapoints do nothing.

            // The plugin-global 'processed' flag is used to control this hack;
            // it starts out false, and is set to true after the first call to
            // processDatapoints.

            // Unfortunately this turns future setData calls into no-ops; they
            // call processDatapoints, the flag is true, and nothing happens.

            // To fix this we'll set the flag back to false here in draw, when
            // all series have been processed, so the next sequence of calls to
            // processDatapoints once again starts out with a slice-combine.
            // This is really a hack; in 0.9 we need to give plugins a proper
            // way to modify series before any processing begins.

            processed = false;

            // calculate maximum radius and center point

            maxRadius = Math.min(canvasWidth, canvasHeight / options.series.pie.tilt) / 2;
            centerTop = canvasHeight / 2 + options.series.pie.offset.top;
            centerLeft = canvasWidth / 2;

            if (options.series.pie.offset.left == "auto") {
                if (options.legend.position.match("w")) {
                    centerLeft += legendWidth / 2;
                } else {
                    centerLeft -= legendWidth / 2;
                }
                if (centerLeft < maxRadius) {
                    centerLeft = maxRadius;
                } else if (centerLeft > canvasWidth - maxRadius) {
                    centerLeft = canvasWidth - maxRadius;
                }
            } else {
                centerLeft += options.series.pie.offset.left;
            }

            var slices = plot.getData(),
                attempts = 0;

            // Keep shrinking the pie's radius until drawPie returns true,
            // indicating that all the labels fit, or we try too many times.

            do {
                if (attempts > 0) {
                    maxRadius *= REDRAW_SHRINK;
                }
                attempts += 1;
                clear();
                if (options.series.pie.tilt <= 0.8) {
                    drawShadow();
                }
            } while (!drawPie() && attempts < REDRAW_ATTEMPTS)

            if (attempts >= REDRAW_ATTEMPTS) {
                clear();
                target.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>");
            }

            if (plot.setSeries && plot.insertLegend) {
                plot.setSeries(slices);
                plot.insertLegend();
            }

            // we're actually done at this point, just defining internal functions at this point

            function clear() {
                ctx.clearRect(0, 0, canvasWidth, canvasHeight);
                target.children().filter(".pieLabel, .pieLabelBackground").remove();
            }

            function drawShadow() {

                var shadowLeft = options.series.pie.shadow.left;
                var shadowTop = options.series.pie.shadow.top;
                var edge = 10;
                var alpha = options.series.pie.shadow.alpha;
                var radius = options.series.pie.radius > 1 ? options.series.pie.radius : maxRadius * options.series.pie.radius;

                if (radius >= canvasWidth / 2 - shadowLeft || radius * options.series.pie.tilt >= canvasHeight / 2 - shadowTop || radius <= edge) {
                    return;	// shadow would be outside canvas, so don't draw it
                }

                ctx.save();
                ctx.translate(shadowLeft, shadowTop);
                ctx.globalAlpha = alpha;
                ctx.fillStyle = "#000";

                // center and rotate to starting position

                ctx.translate(centerLeft, centerTop);
                ctx.scale(1, options.series.pie.tilt);

                //radius -= edge;

                for (var i = 1; i <= edge; i++) {
                    ctx.beginPath();
                    ctx.arc(0, 0, radius, 0, Math.PI * 2, false);
                    ctx.fill();
                    radius -= i;
                }

                ctx.restore();
            }

            function drawPie() {

                var startAngle = Math.PI * options.series.pie.startAngle;
                var radius = options.series.pie.radius > 1 ? options.series.pie.radius : maxRadius * options.series.pie.radius;

                // center and rotate to starting position

                ctx.save();
                ctx.translate(centerLeft, centerTop);
                ctx.scale(1, options.series.pie.tilt);
                //ctx.rotate(startAngle); // start at top; -- This doesn't work properly in Opera

                // draw slices

                ctx.save();
                var currentAngle = startAngle;
                for (var i = 0; i < slices.length; ++i) {
                    slices[i].startAngle = currentAngle;
                    drawSlice(slices[i].angle, slices[i].color, true);
                }
                ctx.restore();

                // draw slice outlines

                if (options.series.pie.stroke.width > 0) {
                    ctx.save();
                    ctx.lineWidth = options.series.pie.stroke.width;
                    currentAngle = startAngle;
                    for (var i = 0; i < slices.length; ++i) {
                        drawSlice(slices[i].angle, options.series.pie.stroke.color, false);
                    }
                    ctx.restore();
                }

                // draw donut hole

                drawDonutHole(ctx);

                ctx.restore();

                // Draw the labels, returning true if they fit within the plot

                if (options.series.pie.label.show) {
                    return drawLabels();
                } else return true;

                function drawSlice(angle, color, fill) {

                    if (angle <= 0 || isNaN(angle)) {
                        return;
                    }

                    if (fill) {
                        ctx.fillStyle = color;
                    } else {
                        ctx.strokeStyle = color;
                        ctx.lineJoin = "round";
                    }

                    ctx.beginPath();
                    if (Math.abs(angle - Math.PI * 2) > 0.000000001) {
                        ctx.moveTo(0, 0); // Center of the pie
                    }

                    //ctx.arc(0, 0, radius, 0, angle, false); // This doesn't work properly in Opera
                    ctx.arc(0, 0, radius, currentAngle, currentAngle + angle / 2, false);
                    ctx.arc(0, 0, radius, currentAngle + angle / 2, currentAngle + angle, false);
                    ctx.closePath();
                    //ctx.rotate(angle); // This doesn't work properly in Opera
                    currentAngle += angle;

                    if (fill) {
                        ctx.fill();
                    } else {
                        ctx.stroke();
                    }
                }

                function drawLabels() {

                    var currentAngle = startAngle;
                    var radius = options.series.pie.label.radius > 1 ? options.series.pie.label.radius : maxRadius * options.series.pie.label.radius;

                    for (var i = 0; i < slices.length; ++i) {
                        if (slices[i].percent >= options.series.pie.label.threshold * 100) {
                            if (!drawLabel(slices[i], currentAngle, i)) {
                                return false;
                            }
                        }
                        currentAngle += slices[i].angle;
                    }

                    return true;

                    function drawLabel(slice, startAngle, index) {

                        if (slice.data[0][1] == 0) {
                            return true;
                        }

                        // format label text

                        var lf = options.legend.labelFormatter, text, plf = options.series.pie.label.formatter;

                        if (lf) {
                            text = lf(slice.label, slice);
                        } else {
                            text = slice.label;
                        }

                        if (plf) {
                            text = plf(text, slice);
                        }

                        var halfAngle = ((startAngle + slice.angle) + startAngle) / 2;
                        var x = centerLeft + Math.round(Math.cos(halfAngle) * radius);
                        var y = centerTop + Math.round(Math.sin(halfAngle) * radius) * options.series.pie.tilt;

                        var html = "<span class='pieLabel' id='pieLabel" + index + "' style='position:absolute;top:" + y + "px;left:" + x + "px;'>" + text + "</span>";
                        target.append(html);

                        var label = target.children("#pieLabel" + index);
                        var labelTop = (y - label.height() / 2);
                        var labelLeft = (x - label.width() / 2);

                        label.css("top", labelTop);
                        label.css("left", labelLeft);

                        // check to make sure that the label is not outside the canvas

                        if (0 - labelTop > 0 || 0 - labelLeft > 0 || canvasHeight - (labelTop + label.height()) < 0 || canvasWidth - (labelLeft + label.width()) < 0) {
                            return false;
                        }

                        if (options.series.pie.label.background.opacity != 0) {

                            // put in the transparent background separately to avoid blended labels and label boxes

                            var c = options.series.pie.label.background.color;

                            if (c == null) {
                                c = slice.color;
                            }

                            var pos = "top:" + labelTop + "px;left:" + labelLeft + "px;";
                            $("<div class='pieLabelBackground' style='position:absolute;width:" + label.width() + "px;height:" + label.height() + "px;" + pos + "background-color:" + c + ";'></div>")
                                .css("opacity", options.series.pie.label.background.opacity)
                                .insertBefore(label);
                        }

                        return true;
                    } // end individual label function
                } // end drawLabels function
            } // end drawPie function
        } // end draw function

        // Placed here because it needs to be accessed from multiple locations

        function drawDonutHole(layer) {
            if (options.series.pie.innerRadius > 0) {

                // subtract the center

                layer.save();
                var innerRadius = options.series.pie.innerRadius > 1 ? options.series.pie.innerRadius : maxRadius * options.series.pie.innerRadius;
                layer.globalCompositeOperation = "destination-out"; // this does not work with excanvas, but it will fall back to using the stroke color
                layer.beginPath();
                layer.fillStyle = options.series.pie.stroke.color;
                layer.arc(0, 0, innerRadius, 0, Math.PI * 2, false);
                layer.fill();
                layer.closePath();
                layer.restore();

                // add inner stroke

                layer.save();
                layer.beginPath();
                layer.strokeStyle = options.series.pie.stroke.color;
                layer.arc(0, 0, innerRadius, 0, Math.PI * 2, false);
                layer.stroke();
                layer.closePath();
                layer.restore();

                // TODO: add extra shadow inside hole (with a mask) if the pie is tilted.
            }
        }

        //-- Additional Interactive related functions --

        function isPointInPoly(poly, pt) {
            for (var c = false, i = -1, l = poly.length, j = l - 1; ++i < l; j = i)
                ((poly[i][1] <= pt[1] && pt[1] < poly[j][1]) || (poly[j][1] <= pt[1] && pt[1] < poly[i][1]))
                    && (pt[0] < (poly[j][0] - poly[i][0]) * (pt[1] - poly[i][1]) / (poly[j][1] - poly[i][1]) + poly[i][0])
                && (c = !c);
            return c;
        }

        function findNearbySlice(mouseX, mouseY) {

            var slices = plot.getData(),
                options = plot.getOptions(),
                radius = options.series.pie.radius > 1 ? options.series.pie.radius : maxRadius * options.series.pie.radius,
                x, y;

            for (var i = 0; i < slices.length; ++i) {

                var s = slices[i];

                if (s.pie.show) {

                    ctx.save();
                    ctx.beginPath();
                    ctx.moveTo(0, 0); // Center of the pie
                    //ctx.scale(1, options.series.pie.tilt);	// this actually seems to break everything when here.
                    ctx.arc(0, 0, radius, s.startAngle, s.startAngle + s.angle / 2, false);
                    ctx.arc(0, 0, radius, s.startAngle + s.angle / 2, s.startAngle + s.angle, false);
                    ctx.closePath();
                    x = mouseX - centerLeft;
                    y = mouseY - centerTop;

                    if (ctx.isPointInPath) {
                        if (ctx.isPointInPath(mouseX - centerLeft, mouseY - centerTop)) {
                            ctx.restore();
                            return {
                                datapoint: [s.percent, s.data],
                                dataIndex: 0,
                                series: s,
                                seriesIndex: i
                            };
                        }
                    } else {

                        // excanvas for IE doesn;t support isPointInPath, this is a workaround.

                        var p1X = radius * Math.cos(s.startAngle),
                            p1Y = radius * Math.sin(s.startAngle),
                            p2X = radius * Math.cos(s.startAngle + s.angle / 4),
                            p2Y = radius * Math.sin(s.startAngle + s.angle / 4),
                            p3X = radius * Math.cos(s.startAngle + s.angle / 2),
                            p3Y = radius * Math.sin(s.startAngle + s.angle / 2),
                            p4X = radius * Math.cos(s.startAngle + s.angle / 1.5),
                            p4Y = radius * Math.sin(s.startAngle + s.angle / 1.5),
                            p5X = radius * Math.cos(s.startAngle + s.angle),
                            p5Y = radius * Math.sin(s.startAngle + s.angle),
                            arrPoly = [
                                [0, 0],
                                [p1X, p1Y],
                                [p2X, p2Y],
                                [p3X, p3Y],
                                [p4X, p4Y],
                                [p5X, p5Y]
                            ],
                            arrPoint = [x, y];

                        // TODO: perhaps do some mathmatical trickery here with the Y-coordinate to compensate for pie tilt?

                        if (isPointInPoly(arrPoly, arrPoint)) {
                            ctx.restore();
                            return {
                                datapoint: [s.percent, s.data],
                                dataIndex: 0,
                                series: s,
                                seriesIndex: i
                            };
                        }
                    }

                    ctx.restore();
                }
            }

            return null;
        }

        function onMouseMove(e) {
            triggerClickHoverEvent("plothover", e);
        }

        function onClick(e) {
            triggerClickHoverEvent("plotclick", e);
        }

        // trigger click or hover event (they send the same parameters so we share their code)

        function triggerClickHoverEvent(eventname, e) {

            var offset = plot.offset();
            var canvasX = parseInt(e.pageX - offset.left);
            var canvasY = parseInt(e.pageY - offset.top);
            var item = findNearbySlice(canvasX, canvasY);

            if (options.grid.autoHighlight) {

                // clear auto-highlights

                for (var i = 0; i < highlights.length; ++i) {
                    var h = highlights[i];
                    if (h.auto == eventname && !(item && h.series == item.series)) {
                        unhighlight(h.series);
                    }
                }
            }

            // highlight the slice

            if (item) {
                highlight(item.series, eventname);
            }

            // trigger any hover bind events

            var pos = { pageX: e.pageX, pageY: e.pageY };
            target.trigger(eventname, [pos, item]);
        }

        function highlight(s, auto) {
            //if (typeof s == "number") {
            //	s = series[s];
            //}

            var i = indexOfHighlight(s);

            if (i == -1) {
                highlights.push({ series: s, auto: auto });
                plot.triggerRedrawOverlay();
            } else if (!auto) {
                highlights[i].auto = false;
            }
        }

        function unhighlight(s) {
            if (s == null) {
                highlights = [];
                plot.triggerRedrawOverlay();
            }

            //if (typeof s == "number") {
            //	s = series[s];
            //}

            var i = indexOfHighlight(s);

            if (i != -1) {
                highlights.splice(i, 1);
                plot.triggerRedrawOverlay();
            }
        }

        function indexOfHighlight(s) {
            for (var i = 0; i < highlights.length; ++i) {
                var h = highlights[i];
                if (h.series == s)
                    return i;
            }
            return -1;
        }

        function drawOverlay(plot, octx) {

            var options = plot.getOptions();

            var radius = options.series.pie.radius > 1 ? options.series.pie.radius : maxRadius * options.series.pie.radius;

            octx.save();
            octx.translate(centerLeft, centerTop);
            octx.scale(1, options.series.pie.tilt);

            for (var i = 0; i < highlights.length; ++i) {
                drawHighlight(highlights[i].series);
            }

            drawDonutHole(octx);

            octx.restore();

            function drawHighlight(series) {

                if (series.angle <= 0 || isNaN(series.angle)) {
                    return;
                }

                //octx.fillStyle = parseColor(options.series.pie.highlight.color).scale(null, null, null, options.series.pie.highlight.opacity).toString();
                octx.fillStyle = "rgba(255, 255, 255, " + options.series.pie.highlight.opacity + ")"; // this is temporary until we have access to parseColor
                octx.beginPath();
                if (Math.abs(series.angle - Math.PI * 2) > 0.000000001) {
                    octx.moveTo(0, 0); // Center of the pie
                }
                octx.arc(0, 0, radius, series.startAngle, series.startAngle + series.angle / 2, false);
                octx.arc(0, 0, radius, series.startAngle + series.angle / 2, series.startAngle + series.angle, false);
                octx.closePath();
                octx.fill();
            }
        }
    } // end init (plugin body)

    // define pie specific options and their default values

    var options = {
        series: {
            pie: {
                show: false,
                radius: "auto",	// actual radius of the visible pie (based on full calculated radius if <=1, or hard pixel value)
                innerRadius: 0, /* for donut */
                startAngle: 3 / 2,
                tilt: 1,
                shadow: {
                    left: 5,	// shadow left offset
                    top: 15,	// shadow top offset
                    alpha: 0.02	// shadow alpha
                },
                offset: {
                    top: 0,
                    left: "auto"
                },
                stroke: {
                    color: "#fff",
                    width: 1
                },
                label: {
                    show: "auto",
                    formatter: function (label, slice) {
                        return "<div style='font-size:x-small;text-align:center;padding:2px;color:" + slice.color + ";'>" + label + "<br/>" + Math.round(slice.percent) + "%</div>";
                    },	// formatter function
                    radius: 1,	// radius at which to place the labels (based on full calculated radius if <=1, or hard pixel value)
                    background: {
                        color: null,
                        opacity: 0
                    },
                    threshold: 0	// percentage at which to hide the label (i.e. the slice is too narrow)
                },
                combine: {
                    threshold: -1,	// percentage at which to combine little slices into one larger slice
                    color: null,	// color to give the new slice (auto-generated if null)
                    label: "Other"	// label to give the new slice
                },
                highlight: {
                    //color: "#fff",		// will add this functionality once parseColor is available
                    opacity: 0.5
                }
            }
        }
    };

    $.plot.plugins.push({
        init: init,
        options: options,
        name: "pie",
        version: "1.1"
    });

})(jQuery);

var spbc = spbc || {};
spbc.s4 = function () {
    return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
};

spbc.uuid = function () {
    return spbc.s4() + spbc.s4() + spbc.s4() + spbc.s4() + spbc.s4() + spbc.s4() + spbc.s4() + spbc.s4();
};

spbc.setLastAction = function (lastAction) {
    try {
        sessionStorage.setItem("last_action", lastAction);
    }
    catch (e) {
    }
};

spbc.getCookie = function (cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') c = c.substring(1);
        if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
    }
    return "";
}

spbc.go = function () {

    var last_action = "none";
    var last_history = "none";
    var spbc_uuid = "none";

    try {
        //spbc_uuid = localStorage.getItem("spbc_uuid");
        spbc_uuid = spbc.getCookie("spbc_uuid");
        if (!spbc_uuid) {
            spbc_uuid = spbc.uuid();
            //localStorage.setItem("spbc_uuid", spbc_uuid);
            document.cookie = "spbc_uuid=" + spbc_uuid + "; expires=Thu, 18 Dec 2023 12:00:00 UTC; path=/";
        }
    } catch (e) {
        spbc_uuid = "uuid_fail";
    }

    var spbc_duid = spbc.s4() + spbc.s4();
    var last_duid = "none";

    try {
        last_duid = sessionStorage.getItem("last_duid");
        sessionStorage.setItem("last_duid", spbc_duid);
    } catch (e) {
        last_duid = "ss_fail";
    }

    if (!last_duid) {
        last_duid = "empty";
    }

    try {
        last_action = sessionStorage.getItem("last_action");
        sessionStorage.setItem("last_action", "init");

        last_history = sessionStorage.getItem("last_history");
        if (!last_history) {
            last_history = '';
        }

        var durl = document.URL;
        var durlc = encodeURIComponent(durl.substring(durl.length - 15));

        var new_history = durlc + "|" + last_history;

        if (new_history.length > 100) {
            new_history = new_history.substring(0, 100);
        }

        sessionStorage.setItem("last_history", new_history);
    } catch (e) {
        last_action = "ss_fail";
        last_history = "ss_fail";
    }

    if (!last_action) {
        last_action = "empty";
    }

    var page_model_full_id = 'none';
    if (Drupal.settings && Drupal.settings.spb_current_page_node_id) {
        page_model_full_id = 'Sportbox_Node_Node_' + Drupal.settings.spb_current_page_node_id;
    }

    var page_type = 'none';
    if (Drupal.settings && Drupal.settings.spbc_page_type) {
        page_type = Drupal.settings.spbc_page_type;
    }

    var main_rubric = 'none';
    if (Drupal.settings && Drupal.settings.spbc_main_rubric_id) {
        main_rubric = Drupal.settings.spbc_main_rubric_id;
    }

    var xmlhttp = new XMLHttpRequest();
    var req = "/sbtracking/pageview2?action_name=pageview2";
    req = req + "&url=" + encodeURIComponent(document.URL);
    req = req + "&urlref=" + encodeURIComponent(document.referrer);
    req = req + "&last_action=" + encodeURIComponent(last_action);
    req = req + "&last_history=" + encodeURIComponent(last_history);
    req = req + "&uuid=" + encodeURIComponent(spbc_uuid);
    req = req + "&duid=" + encodeURIComponent(spbc_duid);
    req = req + "&last_duid=" + encodeURIComponent(last_duid);
    req = req + "&pmfi=" + encodeURIComponent(page_model_full_id);
    req = req + "&page_type=" + encodeURIComponent(page_type);
    req = req + "&main_rubric=" + encodeURIComponent(main_rubric);

    xmlhttp.open("POST", req, true);
    xmlhttp.send(null);
}

$(document).ready(function () {
    if ($('.render-transfer-graphs-js').length < 1) {
        return false;
    }

    function sortLines(lines) {
        lines.sort(function (a, b) {
            if (parseInt($(a).data('summ')) > parseInt($(b).data('summ'))) {
                return -1;
            } else if (parseInt($(a).data('summ')) < parseInt($(b).data('summ'))) {
                return 1;
            } else {
                return 0;
            }
        });
        return lines;
    }

    function construct_graphs(wrap, classname) {
        var lines = sortLines(wrap.find(classname)),
            etalon = parseInt($(lines[0]).data('summ'));

        for (var i = 0; i < lines.length; i++) {
            if (i === 0) {
                $(lines[0]).find('.graph_left_part').width('100%');
                $(lines[0]).find('.graph_right_part').width(0);
            } else {
                var value = parseInt($(lines[i]).data('summ')),
                    itemWidth = Math.round((value / etalon) * 100);

                $(lines[i]).find('.graph_left_part').width(itemWidth + '%');
                $(lines[i]).find('.graph_right_part').width(parseInt(100 - itemWidth) + '%');
            }
        }
    }

    $('.render-transfer-graphs-js').each(function () {
        construct_graphs($(this), '.transfer_graph_line');
        construct_graphs($(this), '.transfer_graph_line2');
    });
});
//var onlines_block_class= '.js-_COMPONENT_CLASS';


//var onlines_block_class= '.js-_COMPONENT_CLASS';

var tour_games_block_js = {
    bind_list_expander: function (element_id) {
        var $this = $('#' + element_id);
        var onlines_block_item_arr = $this.find('.list > *');
        var max_item_view = 9;
        var more_view_button_tpl = '<a class="more-btn more-btn_type_dotted more-btn_no_margins" href="#"><span class="glyphicon glyphicon-option-horizontal"></span></a>';

        if (onlines_block_item_arr.length > max_item_view) {
            $.each(onlines_block_item_arr, function (index) {
                if (index + 1 > max_item_view) {
                    $(this).addClass('hidden');
                }
            });

            $(more_view_button_tpl)
                .on('click', function (e) {
                    e.preventDefault();
                    onlines_block_item_arr.removeClass('hidden');
                    $(this).remove();
                })
                .appendTo($this);
        }
    }
};

//var onlines_block_class= '.js-_COMPONENT_CLASS';

//var onlines_block_class= '.js-_COMPONENT_CLASS';


//var onlines_block_class= '.js-_COMPONENT_CLASS';

var spb2015_search = {};

spb2015_search.initSearchForm = function (element_id) {
    var searchForm = $('#' + element_id);
    var searchText = searchForm.find('input[name=keys]');

    // Sample
    var sampleElement = $('.search-sample');
    var sampleTextArr = ['Аршавин', 'футбол', 'теннис', 'волейбол', 'турнирная таблица'];
    sampleElement.html('Например, <em>' + sampleTextArr[Math.floor(Math.random() * sampleTextArr.length)] + '</em>');
    sampleElement.click(function () {
        searchText.focus();
    });
    searchText.focus(function () {
        sampleElement.hide();
    }).blur(function () {
        if (searchText.val() != '') {
            return;
        }
        sampleElement.show();
    });
    if (searchText.val() != '') {
        sampleElement.hide();
    }
    searchForm.append(sampleElement);

    // Календарь
    var calendarLink = $('.search-calendar-link');
    var datepickerOptions = {
        language: "ru",
        format: 'yyyy-mm-dd',
        endDate: new Date(),
        autoclose: true
    };
    calendarLink.datepicker(datepickerOptions);
    calendarLink.click(function () {
        return false;
    });
    calendarLink.on('changeDate', function () {
        var formattedDate = calendarLink.datepicker('getFormattedDate');

        var since = $('<input type="hidden" name="since">');
        since.val(formattedDate);
        searchForm.append(since);

        var upto = $('<input type="hidden" name="upto">');
        upto.val(formattedDate);
        searchForm.append(upto);

        searchForm.submit();
    });

    // Расширенный поиск
    var advancedSearchLink = $('.search-advanced-link');
    advancedSearchLink.click(function () {
        var searchTextValue = searchText.val();
        if (searchTextValue != '') {
            var url = advancedSearchLink.attr('href').split("?")[0];
            advancedSearchLink.attr('href', url + '?keys=' + encodeURIComponent(searchTextValue));

            setTimeout(function () {
                advancedSearchLink.attr('href', url);
            }, 100);
        }
    });
};

spb2015_search.initAdvancedSearchForm = function (element_id) {
    var searchForm = $('#' + element_id);

    var advancedSearch = $('.advanced-search', searchForm);
    if (!advancedSearch.length) {
        return;
    }

    // Тип материала
    var contentTypes = $('.content-types', advancedSearch);
    var contentTypesSelectAll = contentTypes.find('.content-types-select-all');
    var contentTypesCheckboxes = contentTypes.find('.content-types-select');
    contentTypesSelectAll.change(function () {
        var checked = $(this).prop('checked');
        contentTypesCheckboxes.prop('checked', checked);
    });

    contentTypesCheckboxes.change(function () {
        var checked = $(this).prop('checked');
        if (!checked) {
            contentTypesSelectAll.prop('checked', false);
        } else {
            var allIsChecked = contentTypesCheckboxes.filter(':not(:checked)').length == 0;
            contentTypesSelectAll.prop('checked', allIsChecked);
        }
    });

    // Рубрики
    var rubrics = $('.search-rubrics', advancedSearch);
    var rubricsSelectAll = rubrics.find('.search-rubrics-select-all');
    var rubricsCheckboxes = rubrics.find('.search-rubrics-select');

    rubricsSelectAll.change(function () {
        var checked = $(this).prop('checked');
        rubricsCheckboxes.prop('checked', checked);
    });

    rubricsCheckboxes.change(function () {
        var checked = $(this).prop('checked');
        if (!checked) {
            rubricsSelectAll.prop('checked', false);
        } else {
            var allIsChecked = rubricsCheckboxes.filter(':not(:checked)').length == 0;
            rubricsSelectAll.prop('checked', allIsChecked);
        }
    });

    function zeroPad(n, width) {
        n = n.toString();
        if (n.length >= width) {
            return n;
        } else {
            return new Array(width - n.length + 1).join('0') + n;
        }
    }

    function formatDate(date) {
        return date.getFullYear() + '-' + zeroPad(date.getMonth() + 1, 2) + '-' + zeroPad(date.getDate(), 2);
    }

    $('.content-dates-select', advancedSearch).change(function () {
        $('.content-dates-select', advancedSearch).prop('checked', false).parent().removeClass('selected');
        $(this).prop('checked', true).addClass('selected');

        var dateStart = new Date();
        var dateEnd = new Date();

        var since = '', upto = '';

        switch ($(this).val()) {
            case '1':
                since = formatDate(dateStart);
                upto = since;
                break;
            case '2':
                dateStart.setDate(dateStart.getDate() - 1);
                since = formatDate(dateStart);
                upto = since;
                break;
            case '3':
                dateStart.setDate(dateStart.getDate() - 7);
                since = formatDate(dateStart);
                upto = formatDate(dateEnd);
                break;
            case '4':
                dateStart.setMonth(dateStart.getMonth() - 1);
                since = formatDate(dateStart);
                upto = formatDate(dateEnd);
                break;
        }

        $('.calendar-since', advancedSearch).val(since).datepicker('update');
        $('.calendar-upto', advancedSearch).val(upto).datepicker('update');
    });

    var datepickerOptions = {
        language: "ru",
        format: 'yyyy-mm-dd',
        endDate: new Date(),
        autoclose: true
    };
    $('.calendar-since', advancedSearch).datepicker(datepickerOptions);
    $('.calendar-upto', advancedSearch).datepicker(datepickerOptions);
};

if (typeof spb_scripts != "object") {
    var spb_scripts = {};
}
if (typeof spb_scripts.Components != "object") {
    spb_scripts.Components = {};
}

spb_scripts.Components.TopResultBlock = {
    init: function (elem) {
        var self = spb_scripts.Components.TopResultBlock;

        self.options = {};
        self.$elem = $('#' + elem);

        if (spb_scripts.helpers.isOperaMini()) {
            return;
        }

        self.calendar = self.$elem.find('.js-global-calendar');

        self.calendar.datepicker({
            language: "ru",
            format: "yyyy-mm-dd",
            todayHighlight: true
        });

        self.calendar.on('changeDate', function (event) {
            var s_date = event.date,
                r_date = s_date;

            if (typeof( s_date ) == 'string') {
                var split_date = s_date.split('-');
                r_date = new Date();
                r_date.setMonth(split_date[1], split_date[0]);
                r_date.setYear(split_date[2]);
            }

            var r_date_month = '' + (r_date.getMonth() + 1);

            if (r_date_month.match(/^\d$/) !== null) {
                r_date_month = '0' + r_date_month;
            }

            var r_date_date = '' + r_date.getDate();

            if (r_date_date.match(/^\d$/) !== null) {
                r_date_date = '0' + r_date_date;
            }

            var date_param = r_date.getFullYear() + '-' + r_date_month + '-' + r_date_date;

            window.location.href = '/stats/' + date_param;
        });
    }
}
if (typeof spb_scripts != "object") {
    var spb_scripts = {};
}
if (typeof spb_scripts.Components != "object") {
    spb_scripts.Components = {};
}

spb_scripts.Components.TopVideoBlock = {
    init: function (elem) {
        var self = spb_scripts.Components.TopVideoBlock;

        self.options = {};
        self.$elem = $('#' + elem);

        self.tabs();
        self.uploading();
    },
    tabs: function () {
        var self = spb_scripts.Components.TopVideoBlock;
        var tabs_links = self.$elem.find('.js-tabs');
        var tabs_list = [];

        tabs_links.each(function () {
            tabs_list.push($('#' + $(this).data('type')));
        });
        tabs_list = $($.map(tabs_list, function (el) {
            return el.get();
        }));
        tabs_list.hide();

        tabs_links.on('click', function (e) {
            var tab = $(this);
            var type = tab.data('type');

            if (!type) {
                return;
            }
            e.preventDefault();

            tabs_links.removeClass('select');
            tabs_list.hide();

            tab.addClass('select');
            $('#' + type).show();
        });

        tabs_links.eq(0).click();
    },
    uploading: function () {
        var self = spb_scripts.Components.TopVideoBlock;
        var more_link = self.$elem.find('.js-uploading');

        more_link.on('click', function (e) {
            e.preventDefault();

            var elem = $(this);
            self.options.type = elem.data('type');
            var list = self.$elem.find('#block-' + self.options.type + ' ul');

            if (self.options.type == "recommended") {
                self.options.page_offset = self.options.recommended_page_offset;
            }
            if (self.options.type == "announce") {
                self.options.page_offset = self.options.announce_page_offset;
            }

            $.ajax({
                url: '/top-videos_NEW/more',
                type: 'get',
                data: self.options,
                success: function (response) {
                    if (self.options.type == "recommended") {
                        self.options.recommended_page_offset = self.options.recommended_page_offset + self.options.page_size;
                    }
                    if (self.options.type == "announce") {
                        self.options.announce_page_offset = self.options.announce_page_offset + self.options.page_size;
                    }

                    list.append(response);
                },
                error: function () {
                    console.log('error');
                }
            });

        });

    }
};


if (typeof spb_scripts != "object") {
    var spb_scripts = {};
}
if (typeof spb_scripts.Components != "object") {
    spb_scripts.Components = {};
}

spb_scripts.Components.TeazerListBlock = {
    init: function (elem) {
        var $list = $('#' + elem).find('.list');

        if (!spb_scripts.helpers.isOperaMini()) {
            $list.moreRead({
                'min-screen-width': 992,
                callback: function () {
                    SPB.teaserImageLoader();
                }
            });
        }
    }
}


var spb2015_search = {};

spb2015_search.initSearchForm = function (element_id) {
    var searchForm = $('#' + element_id);
    var searchText = searchForm.find('input[name=keys]');

    // Sample
    var sampleElement = $('.search-sample');
    var sampleTextArr = ['Аршавин', 'футбол', 'теннис', 'волейбол', 'турнирная таблица'];
    sampleElement.html('Например, <em>' + sampleTextArr[Math.floor(Math.random() * sampleTextArr.length)] + '</em>');
    sampleElement.click(function () {
        searchText.focus();
    });
    searchText.focus(function () {
        sampleElement.hide();
    }).blur(function () {
        if (searchText.val() != '') {
            return;
        }
        sampleElement.show();
    });
    if (searchText.val() != '') {
        sampleElement.hide();
    }
    searchForm.append(sampleElement);

    // Календарь
    var calendarLink = $('.search-calendar-link');
    var datepickerOptions = {
        language: "ru",
        format: 'yyyy-mm-dd',
        endDate: new Date(),
        autoclose: true
    };
    calendarLink.datepicker(datepickerOptions);
    calendarLink.click(function () {
        return false;
    });
    calendarLink.on('changeDate', function () {
        var formattedDate = calendarLink.datepicker('getFormattedDate');

        var since = $('<input type="hidden" name="since">');
        since.val(formattedDate);
        searchForm.append(since);

        var upto = $('<input type="hidden" name="upto">');
        upto.val(formattedDate);
        searchForm.append(upto);

        searchForm.submit();
    });

    // Расширенный поиск
    var advancedSearchLink = $('.search-advanced-link');
    advancedSearchLink.click(function () {
        var searchTextValue = searchText.val();
        if (searchTextValue != '') {
            var url = advancedSearchLink.attr('href').split("?")[0];
            advancedSearchLink.attr('href', url + '?keys=' + encodeURIComponent(searchTextValue));

            setTimeout(function () {
                advancedSearchLink.attr('href', url);
            }, 100);
        }
    });
};

spb2015_search.initAdvancedSearchForm = function (element_id) {
    var searchForm = $('#' + element_id);

    var advancedSearch = $('.advanced-search', searchForm);
    if (!advancedSearch.length) {
        return;
    }

    // Тип материала
    var contentTypes = $('.content-types', advancedSearch);
    var contentTypesSelectAll = contentTypes.find('.content-types-select-all');
    var contentTypesCheckboxes = contentTypes.find('.content-types-select');
    contentTypesSelectAll.change(function () {
        var checked = $(this).prop('checked');
        contentTypesCheckboxes.prop('checked', checked);
    });

    contentTypesCheckboxes.change(function () {
        var checked = $(this).prop('checked');
        if (!checked) {
            contentTypesSelectAll.prop('checked', false);
        } else {
            var allIsChecked = contentTypesCheckboxes.filter(':not(:checked)').length == 0;
            contentTypesSelectAll.prop('checked', allIsChecked);
        }
    });

    // Рубрики
    var rubrics = $('.search-rubrics', advancedSearch);
    var rubricsSelectAll = rubrics.find('.search-rubrics-select-all');
    var rubricsCheckboxes = rubrics.find('.search-rubrics-select');

    rubricsSelectAll.change(function () {
        var checked = $(this).prop('checked');
        rubricsCheckboxes.prop('checked', checked);
    });

    rubricsCheckboxes.change(function () {
        var checked = $(this).prop('checked');
        if (!checked) {
            rubricsSelectAll.prop('checked', false);
        } else {
            var allIsChecked = rubricsCheckboxes.filter(':not(:checked)').length == 0;
            rubricsSelectAll.prop('checked', allIsChecked);
        }
    });

    function zeroPad(n, width) {
        n = n.toString();
        if (n.length >= width) {
            return n;
        } else {
            return new Array(width - n.length + 1).join('0') + n;
        }
    }

    function formatDate(date) {
        return date.getFullYear() + '-' + zeroPad(date.getMonth() + 1, 2) + '-' + zeroPad(date.getDate(), 2);
    }

    $('.content-dates-select', advancedSearch).change(function () {
        $('.content-dates-select', advancedSearch).prop('checked', false).parent().removeClass('selected');
        $(this).prop('checked', true).addClass('selected');

        var dateStart = new Date();
        var dateEnd = new Date();

        var since = '', upto = '';

        switch ($(this).val()) {
            case '1':
                since = formatDate(dateStart);
                upto = since;
                break;
            case '2':
                dateStart.setDate(dateStart.getDate() - 1);
                since = formatDate(dateStart);
                upto = since;
                break;
            case '3':
                dateStart.setDate(dateStart.getDate() - 7);
                since = formatDate(dateStart);
                upto = formatDate(dateEnd);
                break;
            case '4':
                dateStart.setMonth(dateStart.getMonth() - 1);
                since = formatDate(dateStart);
                upto = formatDate(dateEnd);
                break;
        }

        $('.calendar-since', advancedSearch).val(since).datepicker('update');
        $('.calendar-upto', advancedSearch).val(upto).datepicker('update');
    });

    var datepickerOptions = {
        language: "ru",
        format: 'yyyy-mm-dd',
        endDate: new Date(),
        autoclose: true
    };
    $('.calendar-since', advancedSearch).datepicker(datepickerOptions);
    $('.calendar-upto', advancedSearch).datepicker(datepickerOptions);
};


if (typeof spb_scripts != "object") {
    var spb_scripts = {};
}
if (typeof spb_scripts.Components != "object") {
    spb_scripts.Components = {};
}

spb_scripts.Components.AnnounceBlock = {
    init: function (elem) {
        var self = spb_scripts.Components.AnnounceBlock;

        self.$elem = $('#' + elem);

        self.slider();
    },
    slider: function () {
        var self = spb_scripts.Components.AnnounceBlock;

        self.$elem.flexslider({
            selector: '.js-announce-slides > li',
            animation: 'slide',
            animationLoop: true,
            slideshow: true,
            slideshowSpeed: 5000,
            animationSpeed: 400,
            pauseOnAction: true,
            prevText: '<svg class="svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40" width="40px" height="40px"><polygon class="ico" points="24.97,32.061 12.909,20 24.97,7.939 27.091,10.061 17.151,20 27.091,29.939 	"/></svg>',
            nextText: '<svg class="svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40" width="40px" height="40px"><polygon class="ico" points="15.03,7.939 27.091,20 15.03,32.061 12.909,29.939 22.849,20 12.909,10.061 	"/></svg>',
            start: function () {
                self.$elem.addClass('show');
            }
        });
    }
};


//var onlines_block_class= '.js-_COMPONENT_CLASS';


if (typeof spb_scripts != "object") {
    var spb_scripts = {};
}
if (typeof spb_scripts.Components != "object") {
    spb_scripts.Components = {};
}

spb_scripts.Components.TVChannelBlock = {
    server_time: 0,
    hide_out_time: true,
    limit: 5,

    init: function (elem, server_time, hide_out_time, limit) {
        var self = spb_scripts.Components.TVChannelBlock;

        self.options = {};
        self.$elem = $('#' + elem);

        self.server_time = server_time;
        self.hide_out_time = hide_out_time;
        self.limit = limit;

        var near_transmission_count = 0;

        self.$elem.find('.channel-js .tv-transmission-container-js').each(function () {
            var elem = $(this);
            var time_start = elem.data('timeStart');
            var time_finish = elem.data('timeFinish');

            if (self.server_time > time_finish) {
                elem.addClass('out_time');
                if (self.hide_out_time) {
                    elem.addClass('hide');
                }
            } else if ((self.server_time > time_start) && (self.server_time < time_finish)) {
                var percentage;
                var progress;
                elem.addClass('right_now');
                percentage = Math.round(100 * ((self.server_time - time_start) / (time_finish - time_start)));
                progress = '<div class="tv_progress" style="width:' + percentage + '%">&nbsp;</div>';
                elem.find('.tv-transmission-js').parent().prepend(progress);

            } else if ((near_transmission_count >= self.limit - 1) && self.hide_out_time) {
                elem.addClass('hide');
            } else {
                near_transmission_count++;
            }
        });
    },

    load: function (component_instance_id, channels_ids_arr, selected_date, hide_out_time, limit, server_time) {
        $.ajax(
            '/tvchannelblock',
            {
                data: {
                    channels_ids_arr: channels_ids_arr,
                    selected_date: selected_date,
                    hide_out_time: hide_out_time,
                    limit: limit
                },
                method: 'POST',
                success: function (data) {
                    $('#' + component_instance_id).append(data);
                    spb_scripts.Components.TVChannelBlock.init(
                        component_instance_id,
                        server_time,
                        hide_out_time,
                        limit
                    );
                }
            }
        );
    }
};

